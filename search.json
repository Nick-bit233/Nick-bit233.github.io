[{"title":"LangChainé€Ÿæˆæ–‡æ¡£","path":"/2024/01/23/LangChainé€Ÿæˆæ–‡æ¡£/","content":"æ³¨æ„ï¼Œæœ¬ç¯‡åŸºäºlangchainå®˜æ–¹æ–‡æ¡£ç¼–å†™ï¼Œä¼—æ‰€å‘¨çŸ¥LangChainçš„æ›´æ–°é¢‘ç‡å¾ˆé«˜ï¼Œå› æ­¤æœ¬æ–‡ä¸ä¿è¯å…·æœ‰æ—¶æ•ˆæ€§ æœ€åæ›´æ–°æ—¶é—´ï¼š2024-01-23ï¼Œ LangChainç‰ˆæœ¬0.1.2 LangChainåŸºç¡€ï¼šä½¿ç”¨é“¾å’ŒLLMå¯¹è¯ å®‰è£…langchain ä½¿ç”¨pipï¼š 1234pip install langchainpip install langchain-core # æ­£å¸¸æ¥è¯´ï¼Œä¸Šé¢ä¸€è¡Œå‘½ä»¤ä¹Ÿä¼šåŒæ—¶å®‰è£…langchain-corepip install langchain-community # å®‰è£…ç¬¬ä¸‰æ–¹è´¡çŒ®çš„langchainåº“pip install langchain-openai # ä½¿ç”¨OPENAIçš„æ¨¡å‹å’Œapiéœ€è¦çš„é›†æˆåŒ… å¦‚æœä½ ä½¿ç”¨OPENAI çš„ apiï¼Œå¯èƒ½éœ€è¦æŒ‰ç…§ä¸‹é¢çš„æ–¹æ³•é…ç½®apiï¼š 1234567891011121314151617181920212223&quot;&quot;&quot;é…ç½®éƒ¨åˆ†ï¼šé‡‡ç”¨ç¯å¢ƒå˜é‡ï¼Œä½†æ‰€æœ‰å˜é‡åœ¨å®ä¾‹åŒ–ç±»å¯¹è±¡æ—¶å‡å¯ä»¥ä¼ å…¥å‚æ•°çš„å½¢å¼è¦†ç›–&quot;&quot;&quot;# API_KEYapi_key = &quot;sk-xxx&quot; # é»˜è®¤è°ƒç”¨æ¨¡å‹åç§°model_name = &quot;gpt-3.5-turbo&quot;# é»˜è®¤è°ƒç”¨æ¨¡å‹çš„æœ€å¤§tokenæ•°max_tokens = 4096# é»˜è®¤è°ƒç”¨æ¨¡å‹çš„æ¸©åº¦temperature = 0# å…¶ä»–é…ç½®&quot;&quot;&quot;å¦‚æœæƒ³æŠŠ OPENAI API çš„è¯·æ±‚æ ¹è·¯ç”±ä¿®æ”¹æˆè‡ªå·±æˆ–ç¬¬ä¸‰æ–¹çš„ä»£ç†åœ°å€ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ â€œOPENAI_API_BASEâ€ æ¥è¿›è¡Œä¿®æ”¹ã€‚12/14å¤‡æ³¨ï¼šå®æµ‹openaiçš„pythonåº“æ— æ³•æ­£ç¡®ä½¿ç”¨httpè§„åˆ™ä»£ç†ï¼ˆæˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä¹Ÿè®¸è¦å»çœ‹æºç ï¼‰ï¼Œ å¦‚æœä½¿ç”¨å®˜æ–¹æ¥å£ï¼Œå»ºè®®å¼€å¯å…¨å±€ä»£ç†ï¼Œç„¶åä¸å†è®¾ç½®ä»£ç†ç¯å¢ƒå˜é‡&quot;&quot;&quot;# set openai api keyos.environ[&quot;OPENAI_API_KEY&quot;] = api_key# set openai proxy# os.environ[&quot;OPENAI_PROXY&quot;] = &quot;http://127.0.0.1:7890&quot;# set openai base urlos.environ[&quot;OPENAI_API_BASE&quot;] = &quot;https://aigptx.top/v1&quot; åŸºæœ¬ä½¿ç”¨ åŸºç¡€LLMæŸ¥è¯¢ LangChainåŒ…æ‹¬ä¸¤ç§ä½¿ç”¨è¯­è¨€æ¨¡å‹çš„æ–¹æ³•ï¼š LangChain LLMs ç±»ï¼ˆæ¥æ”¶å­—ç¬¦ä¸²ã€è¾“å‡ºå­—ç¬¦ä¸²ï¼‰ LangChain èŠå¤©æ¨¡å‹ï¼ˆæ¥æ”¶æ¶ˆæ¯ã€è¾“å‡ºæ¶ˆæ¯ï¼Œå…¶ä¸­æ¶ˆæ¯æ˜¯ä¸€ä¸ªlangChainå®šä¹‰çš„ç±»ï¼‰ï¼Œç±»åé€šå¸¸ä»¥Chatå¼€å¤´ 123456789101112131415161718192021222324252627282930from langchain.llms import OpenAIfrom langchain.chat_models import ChatOpenAI# å¯¼å…¥æ¶ˆæ¯ç±»å‹from langchain.schema import ( AIMessage, HumanMessage, SystemMessage)###### ç›´æ¥invoke llm å¯¹è±¡llm = OpenAI(model_name=model_name)result = llm.invoke(&quot;æ€ä¹ˆè¯„ä»·äººå·¥æ™ºèƒ½&quot;)print(result)##########chat = ChatOpenAI(model_name=model_name) # å®ä¾‹åŒ–ä¸€ä¸ªchatå¯¹è±¡# æ¶ˆæ¯ç±»å‹ï¼šAIMessage, HumanMessage, SystemMessageï¼ˆåˆ†åˆ«å¯¹åº”AIå›å¤ï¼Œç”¨æˆ·è¾“å…¥ï¼Œç³»ç»Ÿæç¤ºï¼‰messages = [ SystemMessage(content=&quot;You are a helpful assistant that translates English to French.&quot;), HumanMessage(content=&quot;Translate this sentence from English to French. I love programming.&quot;)]# invoke chat å¯¹è±¡ï¼Œè¿”å›â€œAIMessageâ€ç±»å‹çš„å¯¹è±¡result = chat.invoke(messages)print(type(result)) # -&gt; AIMessageprint(result)##### ä½¿ç”¨Promptæ¨¡æ¿ å¸®åŠ©ä½ é€šè¿‡ç®€å•è¾“å…¥æ„å»ºæç¤ºæ¨¡æ¿ï¼š 12345678910111213141516from langchain.prompts import PromptTemplatefrom langchain.prompts import ChatPromptTemplateif chat_prompt: chat_prompt = ChatPromptTemplate.from_template(&quot;What is a good name for a company that makes &#123;product&#125;?&quot;) print(chat_prompt.format(product=&quot;colorful socks&quot;)) return chat_prompt# é€šè¿‡ PromptTemplate ç±»æ¥åˆ›å»ºæç¤ºæ¨¡æ¿prompt = PromptTemplate( input_variables=[&quot;product&quot;], # è¿™æ˜¯ä¸€ä¸ªå¯ä»¥ä¿®æ”¹çš„å‚æ•°ï¼Œä¼šè¢«å¡«å…¥ä¸‹é¢çš„templateå­—ç¬¦ä¸²ä¸­ template=&quot;What is a good name for a company that makes &#123;product&#125;?&quot;,)# ç±»ä¼¼string.format()çš„ç”¨æ³•ï¼Œä¼ å…¥å‚æ•°å¡«å……æ¨¡æ¿ä¸­çš„å˜é‡print(prompt.format(product=&quot;colorful socks&quot;))return prompt ä½¿ç”¨é“¾å¼è°ƒç”¨è¿æ¥æ¨¡æ¿ã€æ¨¡å‹å’Œè§£æè¾“å‡º 123456789101112131415161718192021222324252627282930313233343536373839from langchain.chat_models import ChatOpenAIfrom langchain.prompts import ChatPromptTemplatefrom langchain_core.output_parsers import StrOutputParserimport osdef basic_chain_usage_test(use_chain_pipe=True): # åŸºæœ¬ç»“æ„ï¼šprompt + model + output parser prompt = ChatPromptTemplate.from_template( &quot;tell me a short joke about &#123;topic&#125;, use &#123;language&#125;&quot; ) model = ChatOpenAI(model_name=model_name, temperature=0.9) output_parser = StrOutputParser() if not use_chain_pipe: # langchainçš„å„ç§ç±»å‹éƒ½å…·æœ‰invokeå‡½æ•° # promptç±»å‹çš„invokeå‡½æ•°ä¼šå°†è¾“å…¥çš„å‚æ•°å¡«å……åˆ°promptæ¨¡æ¿ä¸­ï¼Œè¿”å›ä¸€ä¸ªå¸¦æœ‰messageåçš„promptå¯¹è±¡ prompt_value = prompt.invoke(&#123;&quot;topic&quot;: &quot;ice cream&quot;, &quot;language&quot;: &quot;Chinese&quot;&#125;) print(f&quot;prompt: &#123;prompt_value&#125;&quot;) # modelç±»å‹çš„invokeå‡½æ•°ä¼šå°†prompt valueä¼ é€’ç»™å·²å®ä¾‹åŒ–çš„modelå¯¹è±¡ï¼Œè¿™é‡Œmodelæ˜¯ä¸€ä¸ªLLMèŠå¤©æ¨¡å‹ï¼Œè¿”å›ä¸€ä¸ªmessageå¯¹è±¡ message = model.invoke(prompt_value) print(type(message)) print(f&quot;message: &#123;message&#125;&quot;) # output parserç±»å‹çš„invokeå‡½æ•°ä¼šå¤„ç†messageå¯¹è±¡ä¸­è¿”å›çš„ä¿¡æ¯ã€‚è¿™é‡Œçš„StrOutputParseræ˜¯ä¸€ä¸ªåŸºç¡€è¾“å‡ºå™¨ï¼Œå°†ç»“æœè½¬æ¢ä¸ºå­—ç¬¦ä¸² result = output_parser.invoke(message.content) print(type(result)) print(f&quot;output: &#123;result&#125;&quot;) return # piece together then different components into a single chain using LCEL # use | (unix pipe operator) as the operator to connect the components # ä½¿ç”¨ | ä½œä¸ºè¿æ¥ç¬¦å·ï¼Œå°†ä¸åŒçš„ç»„ä»¶è¿æ¥èµ·æ¥ï¼Œä»¥å½¢æˆä¸€ä¸ªé“¾å¼ç®¡é“ chain = prompt | model | output_parser result = chain.invoke(&#123;&quot;topic&quot;: &quot;pigeons&quot;, &quot;language&quot;: &quot;Chinese&quot;&#125;) print(f&quot;reply: &#123;result&#125;&quot;) LCELå’Œå¯è¿è¡Œç®¡é“ ä¸Šè¿°ä¾‹å­ä¸­ï¼Œç±»ä¼¼chain = prompt | model | output_parserçš„è¯­æ³•ç³–è¢«ç§°ä¸ºLCELï¼ˆLangChain Expression Languageï¼‰ã€‚ æ¯ä¸ªæ”¯æŒLCELè¯­æ³•ç³–çš„å¯¹è±¡ï¼Œåº•å±‚éƒ½è¢«æŠ½è±¡ä¸ºäº†ä¸€ä¸ªâ€œå¯è¿è¡Œâ€ç±»ï¼šRunnableï¼Œå¤šä¸ªå¯è¿è¡Œå¯¹è±¡çš„è¾“å…¥è¾“å‡ºç›¸è¿æ¥ï¼Œç»„æˆâ€œå¯è¿è¡Œç®¡é“â€ï¼Œå³RunnableParallelã€‚å®ƒå…è®¸æ¥å—æ¥è‡ªinvokeå‡½æ•°å¾—åˆ°çš„è¾“å…¥ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå­—å…¸ç±»å‹ï¼‰ï¼Œç„¶åæ ¹æ®å…¶ä¸Šå­ç±»çš„å®ç°ä¸åŒï¼Œå¤„ç†æ•°æ®å¹¶å¾—åˆ°è¾“å‡ºã€‚ è®°ä½ä¸‹é¢çš„å‡ ç‚¹ï¼š ä½¿ç”¨RunnableParallel()å¯ä»¥å®ä¾‹åŒ–ä¸€ä¸ªå¯è¿è¡Œç®¡é“å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å­˜å‚¨çš„æ•°æ®ç»“æ„è¢«è§†ä¸ºä¸€ä¸ªå­—å…¸ï¼Œå¯ä»¥é€šè¿‡å‚æ•°èµ‹å€¼æ¥è®¾ç½®å­—å…¸çš„é”®å€¼å¯¹ï¼Œæˆ–æ˜¯ç›´æ¥ä¼ å…¥ä¸€ä¸ªå­—å…¸ã€‚ ä½¿ç”¨RunnablePassthrough()å‡½æ•°å¯ä»¥æŒ‡ä»£invokeå‡½æ•°çš„è¾“å…¥ï¼Œè¿”å›ç±»å‹æ˜¯å­—å…¸ ä½¿ç”¨RunnablePassthrough.assign()å‡½æ•°å¯ä»¥ä¿®æ”¹invokeå‡½æ•°çš„è¾“å…¥çš„å­—å…¸ï¼ŒåŒ…æ‹¬æ·»åŠ æ–°çš„é”®å€¼å¯¹ï¼Œè¿”å›ç±»å‹æ˜¯å­—å…¸ ä½¿ç”¨ä»»ä½•lambdaè¡¨è¾¾å¼å¯ä»¥ç›´æ¥å¤„ç†invokeå‡½æ•°çš„è¾“å…¥ï¼Œè¿”å›çš„åˆ™æ˜¯lambadè¡¨è¾¾å¼çš„ç»“æœ 12345678910111213141516from langchain_core.runnables import RunnableParallel, RunnablePassthroughrunnable = RunnableParallel( passed=RunnablePassthrough(), extra=RunnablePassthrough.assign(mult=lambda x: x[&quot;num&quot;] * 3), modified=lambda x: x[&quot;num&quot;] + 1,)runnable.invoke(&#123;&quot;num&quot;: 1&#125;)# è¾“å‡ºç»“æœï¼š&#123; &#x27;passed&#x27;: &#123;&#x27;num&#x27;: 1&#125;, &#x27;extra&#x27;: &#123;&#x27;num&#x27;: 1, &#x27;mult&#x27;: 3&#125;, &#x27;modified&#x27;: 2&#125; åœ¨LCELçš„é“¾å¼è¯­æ³•ä¸­ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡ä¹‹é—´ä»¥|è¿æ¥äº†ï¼Œå®ä¾‹åŒ–RunnableParallel()çš„æ­¥éª¤å¯ä»¥ç›´æ¥ç®€å†™ä¸ºå®šä¹‰ä¸€ä¸ªå­—å…¸ï¼š 12345678910retrieval_chain = ( # ä¸‹é¢çš„ä¸‰ç§å†™æ³•ç­‰ä»·ï¼š # RunnableParallel(&#123;&quot;context&quot;: retriever, &quot;question&quot;: RunnablePassthrough()&#125;) # RunnableParallel(context=retriever, question=RunnablePassthrough()) &#123;&quot;context&quot;: retriever, &quot;question&quot;: RunnablePassthrough()&#125; | prompt | model | StrOutputParser()) å¯ä»¥ä½¿ç”¨itemgetterå‡½æ•°å¿«é€Ÿæ£€ç´¢ä¸€ä¸ªç‰¹å®šçš„è¾“å…¥é”®å€¼ï¼ˆéœ€è¦çº¿å¯¼å…¥åç§°ï¼‰ 1234567891011121314from operator import itemgetterchain = ( &#123; &quot;context&quot;: itemgetter(&quot;question&quot;) | retriever, &quot;question&quot;: itemgetter(&quot;question&quot;), &quot;language&quot;: itemgetter(&quot;language&quot;), &#125; | prompt | model | StrOutputParser())chain.invoke(&#123;&quot;question&quot;: &quot;where did harrison work&quot;, &quot;language&quot;: &quot;italian&quot;&#125;) å¯ä»¥ä½¿ç”¨RunnableLambda()å‡½æ•°ï¼Œå…è®¸è°ƒç”¨ä»»ä½•å·²å®šä¹‰çš„å¤–éƒ¨å‡½æ•°æ¥å¤„ç†è¾“å…¥æ•°æ®ï¼Œå¹¶è¿”å›ä½ è‡ªå®šä¹‰çš„ç»“æœã€‚ä½†æ˜¯ï¼Œè¿™äº›å‡½æ•°éƒ½å¿…é¡»æœ‰ä¸”åªæœ‰ä¸€ä¸ªç±»å‹ä¸ºå­—å…¸çš„å‚æ•°ã€‚ 1234567891011121314def multiple_length_function(_dict): return len(_dict[&quot;text1&quot;]) * len(_dict[&quot;text2&quot;]) chain = ( &#123; &quot;x&quot;: &#123;&quot;text1&quot;: itemgetter(&quot;foo&quot;), &quot;text2&quot;: itemgetter(&quot;bar&quot;)&#125; | RunnableLambda(multiple_length_function), &#125; | prompt | model)chain.invoke(&#123;&quot;foo&quot;: &quot;abc&quot;, &quot;bar&quot;: &quot;gah&quot;&#125;)# xçš„å†…å®¹æ˜¯9 (3*3=9) å¯è¿è¡Œç®¡é“ç»„æˆçš„é“¾æ˜¯å¯ä»¥éšæ„åµŒå¥—çš„ï¼Œä½ å¯ä»¥å°†å…¶è§†ä¸ºä¸€ä¸ªå¸¦æœ‰ç‰¹å®šåŠŸèƒ½çš„å­—å…¸ï¼Œå…è®¸å¤šå±‚å¥—å¨ƒï¼š 1234567891011121314151617181920212223242526272829303132prompt1 = ChatPromptTemplate.from_template( &quot;generate a &#123;attribute&#125; color. Return the name of the color and nothing else:&quot;)prompt2 = ChatPromptTemplate.from_template( &quot;what is a fruit of color: &#123;color&#125;. Return the name of the fruit and nothing else:&quot;)prompt3 = ChatPromptTemplate.from_template( &quot;what is a country with a flag that has the color: &#123;color&#125;. Return the name of the country and nothing else:&quot;)prompt4 = ChatPromptTemplate.from_template( &quot;What is the color of &#123;fruit&#125; and the flag of &#123;country&#125;?&quot;)color_generator = ( &#123; &quot;attribute&quot;: RunnablePassthrough()&#125; | prompt1 | &#123; &quot;color&quot;: model | StrOutputParser() &#125;)color_to_fruit = prompt2 | model | StrOutputParser()color_to_country = prompt3 | model | StrOutputParser()question_generator = ( color_generator | &#123; &quot;fruit&quot;: color_to_fruit, &quot;country&quot;: color_to_country &#125; | prompt4) å¤–éƒ¨å‚æ•°ç»‘å®š Runnable.bind()çš„å‡½æ•°å…è®¸ä½ åœ¨å¤–éƒ¨æ·»åŠ å¯è¿è¡Œç®¡é“å¯¹è±¡çš„å‚æ•°ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥ä¸ºæ¨¡å‹å¯¹è±¡ç»‘å®šå‚æ•°ä¸ºä¾‹ã€‚ æœ€å¸¸ç”¨çš„åŠŸèƒ½æ˜¯ï¼Œä¸ºæ¨¡å‹ç»‘å®šstopå‚æ•°ï¼Œå¯ä»¥æŒ‡å®šLangChainåœ¨åŒ¹é…åˆ°åˆ°LLMçš„æŸäº›è¾“å‡ºåç»ˆæ­¢LLMçš„åç»­è¾“å‡ºï¼Œç›´æ¥è¿”å›å·²è¾“å‡ºçš„å†…å®¹ï¼š 12345678910111213141516171819202122232425262728prompt = ChatPromptTemplate.from_messages( [ ( &quot;system&quot;, &quot;Write out the following equation using algebraic symbols then solve it. Use the format EQUATION:... SOLUTION:... &quot;, ), (&quot;human&quot;, &quot;&#123;equation_statement&#125;&quot;), ])runnable = ( &#123;&quot;equation_statement&quot;: RunnablePassthrough()&#125; | prompt | model.bind(stop=&quot;SOLUTION&quot;) | StrOutputParser())print(runnable.invoke(&quot;x raised to the third plus seven equals 12&quot;))### ä¸åŠ bind(stop=&quot;SOLUTION&quot;)çš„ç»“æœï¼šEQUATION: x^3 + 7 = 12SOLUTION:Subtracting 7 from both sides of the equation, we get:x^3 = 12 - 7x^3 = 5### åŠ ä¸Šbind(stop=&quot;SOLUTION&quot;)çš„ç»“æœï¼šEQUATION: x^3 + 7 = 12 é™„åŠ å‡½æ•°è°ƒç”¨åŠŸèƒ½ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯OPENAIç­‰æ”¯æŒå‡½æ•°è°ƒç”¨çš„æ¨¡å‹ï¼Œä½ è¿˜å¯ä»¥å®šä¹‰å‡½æ•°ï¼ˆè¿™è¦æ±‚LLMä»¥å›ºå®šçš„æ ¼å¼è¾“å‡ºç»“æœï¼‰ï¼Œå¹¶ä½¿ç”¨bindå‡½æ•°å°†å…¶ç»‘å®šåˆ°LLMå¯¹è±¡æˆ–èŠå¤©æ¨¡å‹å¯¹è±¡ä¸­ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546from langchain.chat_models import ChatOpenAIfrom langchain.prompts import ChatPromptTemplatefrom langchain.output_parsers.openai_functions import JsonOutputFunctionsParserfrom langchain.output_parsers.openai_functions import JsonKeyOutputFunctionsParserfrom langchain_core.runnables import RunnableParallel, RunnablePassthroughdef prompt_chain_with_input_and_output_handle(): prompt = ChatPromptTemplate.from_template(&quot;tell me a joke about &#123;foo&#125;&quot;) model = ChatOpenAI(model_name=model_name, temperature=0.9) # ä¸ºmodelå®šä¹‰å‡½æ•°è°ƒç”¨ï¼Œè¿™å›è¦æ±‚modelè¿”å›ä¸€ä¸ªç¬¦åˆè¯¥functionå®šä¹‰çš„ï¼Œjsonæ ¼å¼çš„ç»“æœ functions = [ &#123; &quot;name&quot;: &quot;joke&quot;, &quot;description&quot;: &quot;A joke&quot;, &quot;parameters&quot;: &#123; &quot;type&quot;: &quot;object&quot;, &quot;properties&quot;: &#123; &quot;setup&quot;: &#123;&quot;type&quot;: &quot;string&quot;, &quot;description&quot;: &quot;The setup for the joke&quot;&#125;, &quot;punchline&quot;: &#123; &quot;type&quot;: &quot;string&quot;, &quot;description&quot;: &quot;The punchline for the joke&quot;, &#125;, &#125;, &quot;required&quot;: [&quot;setup&quot;, &quot;punchline&quot;], &#125;, &#125; ] # è¿™ä¸ªç®¡é“çš„å®šä¹‰ä½¿å¾—å½“ç”¨æˆ·è¾“å…¥&quot;ears&quot;æ—¶ï¼Œmap_å¯¹è±¡ä¸­å®é™…å¾—åˆ°çš„æ•°æ®æ˜¯&#123;&quot;foo&quot;: &quot;ears&quot;&#125; map_ = RunnableParallel(foo=RunnablePassthrough()) # chain = ( # map_ # | prompt # | model.bind(function_call=&#123;&quot;name&quot;: &quot;joke&quot;&#125;, functions=functions) # | JsonKeyOutputFunctionsParser(key_name=&quot;setup&quot;) # ä½¿ç”¨Parserä»jsonä¸­æå–æƒ³è¦è¾“å‡ºkeyï¼ˆå¦‚ï¼šsetupï¼‰å­—æ®µ # ) chain = ( map_ | prompt | model.bind(function_call=&#123;&quot;name&quot;: &quot;joke&quot;&#125;, functions=functions) # ç»‘å®šå‡½æ•°å’ŒæŒ‡å®šå‡½æ•°è°ƒç”¨ | JsonOutputFunctionsParser() # ä½¿ç”¨Parseræå–æ•´ä¸ªjson ) result = chain.invoke(&quot;ears&quot;) print(result) æ¨¡å‹è¿è¡Œæ—¶é…ç½®ä¿®æ”¹ å¦‚æœä½ ä¸æƒ³åœ¨æŸäº›æ¨¡å‹è¿è¡Œæ—¶ä½¿ç”¨å…¨å±€çš„è¯­è¨€æ¨¡å‹é…ç½®å‚æ•°ï¼ˆæ¨¡å‹åç§°ï¼Œæ¸©åº¦ï¼Œæœ€å¤§tokené™åˆ¶ç­‰ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š é¦–å…ˆï¼Œåœ¨å®ä¾‹åŒ–modelæ—¶æŒ‡å®šå¯ä»¥è¦†ç›–ä¿®æ”¹çš„å‚æ•°ï¼Œä½¿ç”¨ConfigurableFieldï¼Œå…¶ä¸­idå­—æ®µè¦ä¸ä½ ä½¿ç”¨çš„æ¨¡å‹åç«¯åŒ¹é…ï¼Œè€Œåç§°å’Œæè¿°å¯ä»¥è‡ªå®šä¹‰ã€‚ 1234567891011from langchain.prompts import PromptTemplatefrom langchain_core.runnables import ConfigurableFieldfrom langchain_openai import ChatOpenAImodel = ChatOpenAI(temperature=0).configurable_fields( temperature=ConfigurableField( id=&quot;llm_temperature&quot;, name=&quot;LLM Temperature&quot;, description=&quot;The temperature of the LLM&quot;, )) ä½¿ç”¨æ¨¡å‹æ—¶ï¼ˆåŒ…æ‹¬åœ¨LCELä¸­ä½¿ç”¨æ—¶ï¼‰ï¼Œç”¨å‡½æ•°å³å¯è¦†ç›–é…ç½®ï¼š 12345model.with_config( configurable=&#123; &quot;llm_temperature&quot;: 0.9 &#125;).invoke(&quot;pick a random number&quot;) è¿˜å¯ä»¥ä½¿ç”¨configurable_alternativesæŒ‡å®šä¸€å¥—å¯æ›¿ä»£çš„é…ç½®æ–¹æ¡ˆï¼Œè¯¦ç»†è¯·å‚è€ƒï¼šConfigure chain internals at runtime | ğŸ¦œï¸ğŸ”— Langchain åŠ å…¥å¯¹è¯è®°å¿† å¦‚æœéœ€è¦è¿›è¡Œå¤šè½®å¯¹è¯ï¼Œåˆ™æœ‰å¿…è¦å°†æ¯æ¬¡å¯¹è¯çš„å†…å®¹è®°å½•ä¸‹æ¥ï¼Œå¹¶åœ¨ä¸‹ä¸€æ¬¡æç¤ºæ—¶æä¾›å†å²æ¶ˆæ¯ã€‚ å¯ä»¥é€šè¿‡åœ¨å®šä¹‰promptæ—¶æ·»åŠ å…³äºå†å²çš„MessagesPlaceholderå ä½ç¬¦æ¥å®ç°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839def test_memory_chain(): from operator import itemgetter from langchain.chat_models import ChatOpenAI from langchain.memory import ConversationBufferMemory from langchain.prompts import ChatPromptTemplate, MessagesPlaceholder from langchain_core.runnables import RunnableLambda, RunnablePassthrough model = ChatOpenAI(model_name=model_name) # ä½¿ç”¨èŠå¤©LLMæ¨¡å‹å’ŒèŠå¤©æç¤ºæ¨¡æ¿ prompt = ChatPromptTemplate.from_messages( [ (&quot;system&quot;, &quot;You are a helpful chatbot&quot;), # è¿™æ˜¯ç³»ç»Ÿæç¤º MessagesPlaceholder(variable_name=&quot;history&quot;), # è¿™æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œç”¨äºå°†å¯¹è¯å†å²å¡«å……åˆ°æ¨¡æ¿ä¸­ (&quot;human&quot;, &quot;&#123;input&#125;&quot;), # è¿™æ˜¯ç”¨æˆ·è¾“å…¥ ] ) memory = ConversationBufferMemory(return_messages=True) # æ·»åŠ ä¸€ä¸ªConversationBufferMemoryå¯¹è±¡ï¼Œç”¨äºå­˜å‚¨å¯¹è¯å†å² mem = memory.load_memory_variables(&#123;&#125;) # åˆå§‹åŒ–memoryï¼Œè¿”å›å€¼ä¸ºè¿™æ ·çš„å­—å…¸ï¼š&#123;&quot;history&quot;: []&#125; print(f&quot;init memory: &#123;mem&#125;&quot;) chain = ( RunnablePassthrough.assign( history=RunnableLambda(memory.load_memory_variables) | itemgetter(&quot;history&quot;) ) # ä»memoryä¸­åŠ è½½é”®å€¼ä¸º&quot;history&quot;çš„å˜é‡ï¼Œç„¶åå°†å…¶é€šè¿‡ç®¡é“è¾“å…¥ç»™ä¸‹ä¸€æ­¥çš„prompt | prompt | model ) inputs = &#123;&quot;input&quot;: &quot;hi im bob&quot;&#125; response = chain.invoke(inputs) print(f&quot;first response: &#123;response&#125;&quot;) memory.save_context(inputs, &#123;&quot;output&quot;: response.content&#125;) # ä¸€æ¬¡chain invokeåï¼Œéœ€è¦æ›´æ–°memoryä¸­çš„context mem = memory.load_memory_variables(&#123;&#125;) # é‡æ–°åŠ è½½memoryï¼Œè¿”å›å€¼ä¸­ä¼šæœ‰å·²ç»å­˜å‚¨çš„å¯¹è¯å†å² print(f&quot;memory after first invoke: &#123;mem&#125;&quot;) # å†æ¬¡è¿›è¡Œå¯¹è¯ï¼Œè¿™æ¬¡ä¼šå°†å¯¹è¯å†å²å¡«å……åˆ°promptä¸­ inputs = &#123;&quot;input&quot;: &quot;can you tell what is my name?&quot;&#125; response = chain.invoke(inputs) print(f&quot;second response: &#123;response&#125;&quot;) è®°ä½ï¼ŒMessagesPlaceholderå ä½ç¬¦ä¸æ­¢ç”¨äºè®°å¿†å†å²ï¼Œå¯ä»¥è®°å½•ä»»ä½•å¤–éƒ¨å†…å®¹ï¼Œå½“ä½ éœ€è¦ä»å¤–éƒ¨æ·»åŠ ä¿¡æ¯æ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚ LangChainå®ç°æ£€ç´¢å¢å¼ºï¼ˆRAGï¼‰ æ£€ç´¢å¢å¼ºçš„å«ä¹‰æ˜¯ï¼ŒLLMå¯èƒ½ä¸çŸ¥é“ç”¨æˆ·éœ€è¦çš„ç‰¹å®šæ•°æ®ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªç¨‹åºæ£€ç´¢å¤–éƒ¨æ•°æ®ï¼Œç„¶ååœ¨æ‰§è¡Œç”Ÿæˆæ­¥éª¤æ—¶å°†å…¶ä¼ é€’ç»™LLMã€‚ æ£€ç´¢å¢å¼ºçš„æ­¥éª¤é€šå¸¸æ˜¯å°†å¤–éƒ¨æºæ•°æ®ï¼ˆé€šå¸¸æ˜¯å„ç§æ–‡æ¡£ï¼‰è¿›è¡ŒåŠ è½½ã€æ‹†åˆ†å¤„ç†ï¼Œç„¶åè½¬åŒ–ä¸ºå‘é‡ï¼ˆè¢«ç§°ä¸ºâ€œåµŒå…¥â€ï¼‰ï¼Œè¿™å°†ä¿å­˜æ•°æ®ä¸­çš„è¯­ä¹‰ä¿¡æ¯ï¼Œå»é™¤å¹²æ‰°ï¼Œä»¥æ–¹ä¾¿è¯­è¨€æ¨¡å‹ç†è§£ï¼Œæœ€åå­˜å‚¨åœ¨ä¸€ç§ä»‹è´¨ä¸­ï¼ˆå¦‚å‘é‡æ•°æ®åº“ï¼‰ï¼Œå½“æ¨¡å‹éœ€è¦æ—¶ï¼Œé€šè¿‡ä¸€ç§æ–¹æ³•ä»ä»‹è´¨ä¸­â€œæ£€ç´¢â€æ•°æ®ã€‚ åŠ è½½æ–‡æ¡£ LangChainæ”¯æŒå„ç§æ–‡æ¡£æ ¼å¼çš„è¯»å–ï¼Œå¦‚æœä½ çš„æ•°æ®åªæ˜¯ç®€å•çš„æ–‡æœ¬æ ¼å¼ï¼ˆå¦‚markdownå’Œtxtï¼‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨TextLoaderè·å¾—ä¸€ä»½å­˜å‚¨åœ¨å†…å­˜çš„æ–‡æ¡£å¯¹è±¡ã€‚ 12345678910111213from langchain_community.document_loaders import TextLoaderloader = TextLoader(&quot;./index.md&quot;)loader.load()# æ–‡æ¡£å¯¹è±¡çš„æ•°æ®ç»“æ„ç¤ºä¾‹ï¼š[ Document( page_content=&#x27;--- sidebar_position: 0 --- # Document loader ... &#x27;, metadata=&#123;&#x27;source&#x27;: &#x27;../docs/docs/modules/data_connection/document_loaders/index.md&#x27;&#125; )]# æ¯ä¸ªæ–‡æ¡£åŒ…å«ä¸¤ä¸ªå¯¹è±¡ï¼Œpage_contentæ˜¯æ–‡æœ¬å½¢å¼å­˜å‚¨çš„å†…å®¹ï¼ŒmetadataåŒ…å«æ–‡æœ¬çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚å­˜å‚¨è·¯å¾„source å…³äºæ‰€æœ‰æ”¯æŒçš„æ–‡æ¡£æ ¼å¼å’Œç›¸å…³åº“ï¼Œå‚è€ƒï¼šhttps://python.langchain.com/docs/integrations/document_loaders/ ä¸‹é¢æˆ‘ä»¬ä¼šä»‹ç»å…¶ä»–é’ˆå¯¹å¸¸ç”¨æ ¼å¼çš„Loaderï¼š CSVè¡¨æ ¼ 12345678910111213from langchain_community.document_loaders.csv_loader import CSVLoader# ä¸åŒçš„CSVæ–‡æ¡£å¯èƒ½æœ‰ä¸åŒçš„åˆ†éš”ç¬¦ï¼Œè¯»å–æ—¶å¯ä»¥æŒ‡å®šï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šè¡¨å¤´çš„åç§°loader = CSVLoader(file_path=&#x27;./example_data/mlb_teams_2012.csv&#x27;, csv_args=&#123; &#x27;delimiter&#x27;: &#x27;,&#x27;, &#x27;quotechar&#x27;: &#x27;&quot;&#x27;, &#x27;fieldnames&#x27;: [&#x27;MLB Team&#x27;, &#x27;Payroll in millions&#x27;, &#x27;Wins&#x27;]&#125;)data = loader.load()# è¯»å–CSVæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æŒ‡å®šsource_columnå‚æ•°å°†æ–‡æœ¬çš„å…ƒæ•°æ®ä»é»˜è®¤çš„â€œæ–‡ä»¶è·¯å¾„â€è½¬åŒ–ä¸ºæ¯ä¸€åˆ—çš„è¡¨å¤´åç§°# åœ¨æ–‡æœ¬-é—®ç­”ä»»åŠ¡ä¸­è¿™ç§å¤„ç†ä¹Ÿè®¸æœ‰ç”¨ã€‚loader = CSVLoader(file_path=&#x27;./example_data/mlb_teams_2012.csv&#x27;, source_column=&quot;Team&quot;) HTMLç½‘é¡µ 12345678910111213from langchain_community.document_loaders import UnstructuredHTMLLoader# ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨UnstructuredHTMLLoaderï¼Œè¿™å°†ç›´æ¥æå–htmlä¸­çš„çº¯æ–‡æœ¬å†…å®¹åˆ°page_contentä¸­ï¼Œè€Œå¿½ç•¥å…¶ä»–çš„æ‰€æœ‰å†…å®¹ã€‚loader = UnstructuredHTMLLoader(&quot;example_data/fake-content.html&quot;)data = loader.load()# å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨BeautifulSoup4from langchain_community.document_loaders import BSHTMLLoader# è¿™å°†ä½¿å¾—htmlä¸­çš„çº¯æ–‡æœ¬å†…å®¹è¢«æå–åˆ°page_contentä¸­ï¼Œè€Œç½‘é¡µæ ‡é¢˜ï¼ˆå¦‚æœæœ‰ï¼‰è¢«å†™å…¥å…ƒæ•°æ®ä¸­çš„&#x27;title&#x27;å­—æ®µloader = BSHTMLLoader(&quot;example_data/fake-content.html&quot;)data = loader.load()data JSON JSONLoaderç±»å®šä¹‰äº†åŠ è½½JSONæ ¼å¼æ–‡ä»¶çš„æ–¹æ³•ã€‚LangChainå…è®¸ä½ ä»ä¸€ä¸ªjsonæ–‡ä»¶ä¸­è¯»å–å‡ºå¤šä¸ªä¸åŒçš„æ–‡æ¡£ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šè¯»å–å“ªäº›é”®å¯¹åº”çš„å€¼çš„å†…å®¹ã€‚è¿™æ˜¯é€šè¿‡ä¸€ä¸ªåä¸ºjqçš„pythonåº“å®ç°çš„ã€‚ åœ¨å®ä¾‹åŒ–JSONLoaderçš„æ—¶å€™ï¼Œå¯ä»¥ä¼ å…¥jq_schemaå‚æ•°ï¼Œå…¶ä¸­æŒ‡å®šäº†è¦ä»jsonæ–‡ä»¶çš„å“ªä¸ªé”®ä¸­æå–å¯¹è±¡ã€‚jq_schemaçš„è¯­æ³•ä¸luaå­—å…¸ç±»ä¼¼ï¼Œç›´æ¥ä½¿ç”¨.å¯ä»¥è®¿é—®å­çº§é”®å€¼å¯¹ï¼Œå¦‚æœå¯¹è±¡æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œä½¿ç”¨[]å¯ä»¥æå–æ•´ä¸ªåˆ—è¡¨ä¸­çš„æ¯ä¸ªå¯¹è±¡ï¼Œè¿™ä¼šè®©JSONLoaderè¿”å›å¤šä¸ªDocumentå¯¹è±¡ç»„æˆçš„åˆ—è¡¨ï¼Œå…¶åœ¨åˆ—è¡¨ä¸­çš„ç´¢å¼•åºå·å°†è¢«å†™å…¥å…ƒæ•°æ®ä¸­ã€‚ 12345678910111213141516171819202122232425262728293031323334353637loader = JSONLoader( file_path=&#x27;./example_data/facebook_chat.json&#x27;, jq_schema=&#x27;.messages[].content&#x27;, text_content=False)data = loader.load()# ç¤ºä¾‹ï¼šå¦‚æœjsoné•¿è¿™è¿™æ ·ï¼š &#123; &#x27;joinable_mode&#x27;: &#123;&#x27;link&#x27;: &#x27;&#x27;, &#x27;mode&#x27;: 1&#125;, &#x27;messages&#x27;: [&#123;&#x27;content&#x27;: &#x27;Bye!&#x27;, &#x27;sender_name&#x27;: &#x27;User 2&#x27;, &#x27;timestamp_ms&#x27;: 1675597571851&#125;, ... &#123;&#x27;content&#x27;: &#x27;Goodmorning! $50 is too low.&#x27;, &#x27;sender_name&#x27;: &#x27;User 2&#x27;, &#x27;timestamp_ms&#x27;: 1675577876645&#125;], &#x27;title&#x27;: &#x27;User 1 and User 2 chat&#x27; &#125;# dataä¸­çš„å†…å®¹å°†ä¼šæ˜¯ï¼š [ Document( page_content=&#x27;Bye!&#x27;, metadata=&#123; &#x27;source&#x27;: &#x27;/Users/avsolatorio/WBG/langchain/docs/modules/indexes/document_loaders/examples/example_data/facebook_chat.json&#x27;, &#x27;seq_num&#x27;: 1 &#125; ), ... Document( page_content=&#x27;Goodmorning! $50 is too low.&#x27;, metadata=&#123; &#x27;source&#x27;: &#x27;/Users/avsolatorio/WBG/langchain/docs/modules/indexes/document_loaders/examples/example_data/facebook_chat.json&#x27;, &#x27;seq_num&#x27;: 10 &#125; ), ] å¸¸è§çš„jsonæ ¼å¼å¯¹åº”çš„jq_schemaè¯­æ³•å¦‚ä¸‹ï¼š 12345678JSON -&gt; [&#123;&quot;text&quot;: ...&#125;, &#123;&quot;text&quot;: ...&#125;, &#123;&quot;text&quot;: ...&#125;]jq_schema -&gt; &quot;.[].text&quot;JSON -&gt; &#123;&quot;key&quot;: [&#123;&quot;text&quot;: ...&#125;, &#123;&quot;text&quot;: ...&#125;, &#123;&quot;text&quot;: ...&#125;]&#125;jq_schema -&gt; &quot;.key[].text&quot;JSON -&gt; [&quot;...&quot;, &quot;...&quot;, &quot;...&quot;]jq_schema -&gt; &quot;.[]&quot; å¦‚æœä½ çš„jsonæ–‡æ¡£æ ¼å¼æ˜¯ä¸€ä¸ªåç¼€åä¸º.jsonlçš„ JSON Linesæ–‡ä»¶ï¼Œè¿™ç§æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªç¬¦åˆjsonæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å­˜å‚¨å¤šä¸ªjsonå¯¹è±¡ã€‚å¯¹äºè¿™ç§æ–‡ä»¶ï¼Œåœ¨åŠ è½½æ—¶json_lines=Trueå‚æ•°å³å¯ã€‚æŒ‡å®šçš„jq_schemaç´¢å¼•ä¼šå¯¹æ¯ä¸€è¡Œçš„jsonå¯¹è±¡èµ·ä½œç”¨ã€‚ 1234567loader = JSONLoader( file_path=&#x27;./example_data/facebook_chat_messages.jsonl&#x27;, jq_schema=&#x27;.content&#x27;, text_content=False, json_lines=True)data = loader.load() ä½ è¿˜å¯ä»¥è‡ªå®šä¹‰è¦å°†å“ªäº›jsonæ–‡ä»¶çš„å†…å®¹å†™å…¥æ–‡æ¡£çš„metadataï¼Œå³å…ƒæ•°æ®å­—æ®µä¸­ï¼Œè¿™éœ€è¦é€šè¿‡ä¼ å…¥ä¸€ä¸ªmetadata_funcæ¥å®ç°ï¼š 1234567891011121314151617181920212223# metadata_funcæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æºæ•°æ®çš„jsonå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯¹åº”å…¶åœ¨æ–‡æ¡£ä¸­çš„å…ƒæ•°æ®å¯¹è±¡ã€‚def metadata_func(record: dict, metadata: dict) -&gt; dict: # å°†åŸjsonçš„&quot;sender_name&quot;å­—æ®µçš„å€¼å†™å…¥æ–‡æ¡£å…ƒæ•°æ®çš„&quot;sender_name&quot;å­—æ®µ metadata[&quot;sender_name&quot;] = record.get(&quot;sender_name&quot;) # ä½ ä¹Ÿå¯ä»¥ä¿®æ”¹å·²æœ‰å…ƒæ•°æ®çš„å†…å®¹ï¼Œå¦‚è¿™é‡Œä¿®æ”¹äº†æ‰€æœ‰æ–‡æ¡£ä¸­å…ƒæ•°æ®çš„è·¯å¾„ï¼Œ # å°†å®ƒä»¬è·¯å¾„ä¸­ /langchain å‰çš„éƒ¨åˆ†éƒ½åˆ é™¤äº†ã€‚ if &quot;source&quot; in metadata: source = metadata[&quot;source&quot;].split(&quot;/&quot;) source = source[source.index(&quot;langchain&quot;):] metadata[&quot;source&quot;] = &quot;/&quot;.join(source) return metadataloader = JSONLoader( file_path=&#x27;./example_data/facebook_chat.json&#x27;, jq_schema=&#x27;.messages[]&#x27;, content_key=&quot;content&quot;, metadata_func=metadata_func)data = loader.load() Markdown 1234567from langchain_community.document_loaders import UnstructuredMarkdownLoadermarkdown_path = &quot;../README.md&quot;# å¦‚æœåŠ å…¥å‚æ•°mode=&quot;elements&quot;ï¼Œå°†ä¼šä¿ç•™æ‰€æœ‰markdownè¯­æ³•çš„ç¬¦å·ï¼ˆå¦‚```)ï¼Œå¦åˆ™åªä¼šæå–æ–‡æœ¬loader = UnstructuredMarkdownLoader(markdown_path, mode=&quot;elements&quot;)data = loader.load() PDF æœ‰å¤šç§æ–¹æ³•æå–PDFæ–‡ä»¶çš„å†…å®¹ï¼ˆåŸºäºåº•å±‚çš„ä¸åŒï¼‰ï¼Œè¯¦æƒ…å‚è§ï¼šhttps://python.langchain.com/docs/modules/data_connection/document_loaders/pdf è¿™é‡Œä»‹ç»ä½¿ç”¨PyPDFLoaderè¯»å–æ–‡ä»¶ï¼Œå®ƒè¿”å›ä¸€ä¸ªDocumentçš„åˆ—è¡¨ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æ˜¯pdfä¸­ä¸€é¡µçš„å†…å®¹å¯¹åº”çš„æ–‡æ¡£ï¼Œé¡µç ä¿¡æ¯ä¼šè¢«å­˜å‚¨åˆ°å…ƒæ•°æ®ä¸­ã€‚ 1234567# ç¡®ä¿å…ˆå®‰è£…äº†pypdf# pip install pypdffrom langchain_community.document_loaders import PyPDFLoaderloader = PyPDFLoader(&quot;example_data/layout-parser-paper.pdf&quot;)pages = loader.load_and_split() å¦‚æœæƒ³ä»è¯»å–å›¾åƒä¸­çš„æ–‡å­—ï¼Œå¯ä»¥ä½¿ç”¨ rapidocr-onnxruntime ,è¿™æ˜¯ä¸€ä¸ªOCRåŒ…ï¼Œå¯ä»¥è¯†åˆ«å›¾åƒä¸­çš„æ–‡æœ¬å¹¶å­˜å‚¨åˆ°æ–‡æ¡£ä¸­ã€‚å®‰è£…å®ŒæˆååŠ å…¥å‚æ•°extract_images=Trueå³å¯ 12345# pip install rapidocr-onnxruntimeloader = PyPDFLoader(&quot;https://arxiv.org/pdf/2103.15348.pdf&quot;, extract_images=True)pages = loader.load() å¦‚æœå¯¹pdfæ–‡æ¡£çš„ç»“æ„æ— æ‰€è°“ï¼Œä½¿ç”¨éç»“æ„åŒ–æ•°æ®å¯ä»¥åªæå–æ‰€æœ‰çš„çº¯ç¼–ç æ•°æ®åˆ°æ–‡æ¡£ã€‚ 1234from langchain_community.document_loaders import UnstructuredPDFLoaderloader = UnstructuredPDFLoader(&quot;example_data/layout-parser-paper.pdf&quot;) # åŒæ ·ï¼ŒåŠ å…¥mode=&quot;elements&quot;å¯ä»¥ä¿ç•™å…ƒç´ data = loader.load() Pythonæºç  å¯ä»¥ä½¿ç”¨PythonLoaderç±»ç›´æ¥åŠ è½½pythonä»£ç ä¸ºæ–‡æ¡£ã€‚ 1from langchain_community.document_loaders import PythonLoader æ‰¹é‡åŠ è½½æ–‡æ¡£ ä»ä¸€ä¸ªç›®å½•ä¸‹åŠ è½½ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½ä»¥éç»“æ„åŒ–çš„æ–¹å¼ï¼ˆç›´æ¥è¯»å–æ–‡æœ¬ï¼‰åŠ è½½åˆ°æ–‡æ¡£å¯¹è±¡ä¸­ï¼Œè¿”å›ä¸€ä¸ªåˆ—è¡¨ã€‚ DirectoryLoaderç›¸å…³å‚æ•°ï¼š glob : ç”¨æ¥æ§åˆ¶åŠ è½½ç¬¦åˆå“ªäº›è·¯å¾„åå’Œæ‰©å±•åçš„æ–‡ä»¶ show_progress=Trueï¼šæ˜¾ç¤ºè¿›åº¦æ¡ï¼Œéœ€è¦å…ˆå®‰è£…tqdmåº“ use_multithreading=Trueï¼šä½¿ç”¨å¤šçº¿ç¨‹åŠ å¿«é€Ÿåº¦ loader_cls=TextLoaderï¼šæŒ‡å®šæ‰€æœ‰æ–‡ä»¶ä½¿ç”¨æŸä¸ªç‰¹å®šçš„æ–‡æ¡£åŠ è½½å™¨ç±» silent_errors=Trueï¼šå¦‚æœåŠ è½½è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼ˆå¦‚ç¼–ç é—®é¢˜ï¼‰ï¼Œå¿½ç•¥é”™è¯¯å¹¶ç»§ç»­åŠ è½½ï¼ˆé»˜è®¤å°†ä¼šç»ˆæ­¢åŠ è½½ï¼Œå¹¶ä¸ä¼šè¿”å›å·²åŠ è½½çš„å†…å®¹åˆ°å†…å­˜ï¼‰ loader_kwargs=&#123;&#125; ï¼šå…¶ä»–åŠ è½½æ—¶çš„å‚æ•°ï¼Œä»¥å­—å…¸å½¢å¼ä¼ å…¥ è¦åœ¨åŠ è½½è¿‡ç¨‹ä¸­è‡ªåŠ¨æ£€æµ‹æ–‡ä»¶ç¼–ç ï¼Œä¼ å…¥&#123;'autodetect_encoding':True&#125; 12345from langchain_community.document_loaders import DirectoryLoadertext_loader_kwargs=&#123;&#x27;autodetect_encoding&#x27;: True&#125;loader = DirectoryLoader(path, glob=&quot;**/*.txt&quot;, loader_cls=TextLoader, loader_kwargs=text_loader_kwargs)docs = loader.load() åˆ†å‰²æ–‡æ¡£ å¤„ç†é•¿æ–‡æœ¬æ—¶ï¼Œæœ‰å¿…è¦å°†æ–‡æœ¬åˆ†å‰²æˆå—ã€‚å°½ç®¡è¿™å¬èµ·æ¥å¾ˆç®€å•ï¼Œä½†è¿™é‡Œæœ‰å¾ˆå¤šæ½œåœ¨çš„å¤æ‚æ€§ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‚¨å¸Œæœ›å°†è¯­ä¹‰ç›¸å…³çš„æ–‡æœ¬ç‰‡æ®µæ”¾åœ¨ä¸€èµ·ã€‚â€œè¯­ä¹‰ç›¸å…³â€çš„å«ä¹‰å¯èƒ½å–å†³äºæ–‡æœ¬çš„ç±»å‹ã€‚ å…³äºLangChainæ”¯æŒçš„æ‰€æœ‰åˆ†å‰²å™¨ç±»å‹ï¼Œå‚è€ƒï¼šText Splitters | ğŸ¦œï¸ğŸ”— Langchain è¿™é‡Œåªä»‹ç»ä¸¤ç§ï¼šåŸºäºå­—ç¬¦ï¼ˆå•è¯ï¼‰æ‹†åˆ†å’ŒåŸºäºè¯­ä¹‰æ‹†åˆ†ã€‚ æŒ‰ç…§å­—ç¬¦æ‹†åˆ†æ–‡æ¡£ æœ€ç®€å•çš„æ–¹æ³•ï¼ŒæŒ‰ç…§å­—ç¬¦æ•°åˆ‡åˆ†æ–‡æ¡£ï¼Œä¸€èˆ¬åªé€‚ç”¨äºè¥¿æ–‡ã€‚ 12345678910111213141516171819from langchain.text_splitter import CharacterTextSplittertext_splitter = CharacterTextSplitter( separator=&quot; &quot;, chunk_size=1000, chunk_overlap=200, length_function=len, is_separator_regex=False,)# è¿™é‡Œä¼ å…¥çš„æ˜¯çº¯æ–‡æœ¬çš„åˆ—è¡¨å¯¹è±¡ï¼Œå°†ä¼šåˆ†åˆ«æ‹†åˆ†æ¯ä¸ªå¯¹è±¡ã€‚# metadataæ˜¯å¯é€‰çš„ï¼Œä¼šä¸€ä¸€å¯¹åº”åœ°å†™å…¥è¢«æ‹†åˆ†çš„æ–‡æ¡£ä¸­çš„å…ƒæ•°æ®ã€‚# è¿”å›å€¼æ˜¯Documentç±»å‹documents = text_splitter.create_documents( [doc1, doc2, ...], metadatas=[meta1, meta2, ...])print(documents[0]) æŒ‰ç…§å•è¯æ‹†åˆ† æ¨èæ™®éæƒ…å†µä¸‹æœ‰ä¸€å †é•¿æ–‡æœ¬æ—¶ä½¿ç”¨ï¼Œå¸Œæœ›å°½å¯èƒ½çš„å°†ç›¸è¿‘çš„æ®µè½å’Œè¯­å¥æ”¾åœ¨ä¸€ä¸ªåˆ†å—ä¸­ï¼Œé€‚ç”¨äºå„ç§è¯­è¨€çš„ç¼–ç ã€‚ 12345678910111213from langchain.text_splitter import RecursiveCharacterTextSplittertext_splitter = RecursiveCharacterTextSplitter( # Set a really small chunk size, just to show. chunk_size=100, chunk_overlap=20, length_function=len, is_separator_regex=False,)texts = text_splitter.create_documents([doc])print(texts[0])print(texts[1]) æ ¹æ®è¯­ä¹‰æ‹†åˆ† è¿™å°†æ ¹æ®æ–‡æœ¬ä¸­çš„è¯­ä¹‰ç›¸ä¼¼æ€§æ‹†åˆ†æ–‡æœ¬ï¼Œè¯­ä¹‰æ›´ç›¸ä¼¼çš„ï¼Œæ›´æœ‰å¯èƒ½æ”¾åœ¨ä¸€èµ·ã€‚éœ€è¦æ–‡æœ¬åµŒå…¥ç¼–ç æ¨¡å‹çš„ä»‹å…¥ã€‚ è¿™é‡Œä½¿ç”¨OPENAIçš„æ–‡æœ¬åµŒå…¥apiä½œä¸ºè¯­ä¹‰ç›¸ä¼¼åº¦æ£€æŸ¥çš„ä¾‹å­ï¼Œä½¿ç”¨å‰éœ€è¦å…ˆé…ç½®å¥½ç›¸å…³apiç¯å¢ƒå˜é‡: 12345678910!pip install --quiet langchain_experimental langchain_openaifrom langchain_experimental.text_splitter import SemanticChunkerfrom langchain_openai.embeddings import OpenAIEmbeddingstext_splitter = SemanticChunker(OpenAIEmbeddings())docs = text_splitter.create_documents([doc])print(docs[0].page_content) ç¼–ç æ–‡æ¡£ä¸ºå‘é‡åµŒå…¥ ç¼–ç æ–‡æ¡£åˆ°å‘é‡åµŒå…¥éå¸¸ç®€å•ï¼Œåªéœ€åˆ¶å®šå¥½æ¨¡å‹ï¼Œç„¶åä¼ å…¥å­—ç¬¦ä¸²æ ¼å¼çš„æ–‡æœ¬å³å¯ã€‚å‰é¢å°èŠ‚ä¸­åŠ è½½çš„æ–‡æ¡£å¯¹è±¡ï¼Œå¯ä»¥ä»page_contentå­—æ®µä¸­å–å‡ºå­—ç¬¦ä¸²å€¼ã€‚ å¯ä»¥ä½¿ç”¨çš„æ–‡æœ¬-å‘é‡ç¼–ç æ¨¡å‹åŠè¯´æ˜æ–‡æ¡£å‚è€ƒï¼šText embedding models | ğŸ¦œï¸ğŸ”— Langchain ä¸‹é¢ä¼šä½¿ç”¨åœ¨çº¿è°ƒç”¨OPENAIçš„æ–‡æ¡£ç¼–ç æ¨¡å‹ä¸ºä¾‹å­ã€‚ 12345678910111213141516from langchain_openai import OpenAIEmbeddings# å¦‚æœä½ åœ¨å…¨å±€è®¾ç½®äº†ç¯å¢ƒå˜é‡ï¼Œåˆ™æ— éœ€ä¼ å…¥api keyçš„å‚æ•°embeddings_model = OpenAIEmbeddings(openai_api_key=&quot;...&quot;)# è¿™é‡Œç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºä¾‹å­embeddings = embeddings_model.embed_documents( [ &quot;Hi there!&quot;, &quot;Oh, hello!&quot;, &quot;What&#x27;s your name?&quot;, &quot;My friends call me World&quot;, &quot;Hello World!&quot; ])len(embeddings), len(embeddings[0]) å¯ä»¥ä½¿ç”¨æ–‡æœ¬-å‘é‡ç¼–ç æ¨¡å‹å¿«é€Ÿæ¯”è¾ƒä¸åŒæ–‡æœ¬ç›´æ¥çš„ç›¸ä¼¼åº¦ï¼Œå¦‚ï¼š 123456789embedded_query = embeddings_model.embed_query(&quot;What was the name mentioned in the conversation?&quot;)embedded_query[:5] # è¾“å‡ºembed_queryä¼ å…¥çš„æ–‡æœ¬ä¸embeddings_modelä¸­å·²ç¼–ç çš„5ä¸ªæ–‡æœ¬ä¹‹é—´ï¼ˆå„ä¸ªï¼‰çš„ç›¸ä¼¼åº¦ã€‚# è¾“å‡ºä¸¾ä¾‹ï¼š[0.0053587136790156364, -0.0004999046213924885, 0.038883671164512634, -0.003001077566295862, -0.00900818221271038] åˆ›å»ºå‘é‡å­˜å‚¨å™¨ ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨ FAISS å‘é‡æ•°æ®åº“ï¼Œè¯¥æ•°æ®åº“åˆ©ç”¨äº†Facebook AIç›¸ä¼¼æ€§æœç´¢ï¼ˆFAISSï¼‰åº“ã€‚ ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–ä¸åŒçš„å‘é‡å­˜å‚¨å™¨åº“ï¼Œå‚è€ƒï¼šVector stores | ğŸ¦œï¸ğŸ”— Langchain å…ˆå®‰è£…ç›¸å…³ä¾èµ–ï¼š 1pip install faiss-cpu ç›¸å…³æ­¥éª¤å¦‚ä¸‹ï¼š åŠ è½½ä¸€ä¸ªç¤ºä¾‹æ–‡æ¡£ ä½¿ç”¨åˆ†å‰²å™¨å°†æ–‡æ¡£åˆ†å‰²ä¸ºå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸² å¯¹äºæ¯ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œè¿›è¡Œå‘é‡åµŒå…¥ç¼–ç ï¼ˆä½¿ç”¨OpenAIEmbeddingsï¼‰ï¼Œç„¶åä½¿ç”¨FAISS.from_documentså­˜å‚¨åˆ°æ•°æ®åº“å¯¹è±¡ã€‚ 123456789101112from langchain_community.document_loaders import TextLoaderfrom langchain_openai import OpenAIEmbeddingsfrom langchain.text_splitter import CharacterTextSplitterfrom langchain_community.vectorstores import FAISS# è¯»å–æºæ–‡ä»¶raw_documents = TextLoader(&#x27;../../../state_of_the_union.txt&#x27;).load()# åˆ†å‰²æ–‡æœ¬ä¸ºè‹¥å¹²å—ï¼Œå¹¶è½¬æ¢ä¸ºå¯¹åº”çš„æ–‡æ¡£å¯¹è±¡text_splitter = CharacterTextSplitter(chunk_size=1000, chunk_overlap=0)documents = text_splitter.split_documents(raw_documents)# åˆ›å»ºå‘é‡æ•°æ®åº“ï¼Œä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼šæ–‡æ¡£å¯¹è±¡åˆ—è¡¨ å’Œ åµŒå…¥æ¨¡å‹çš„å®ä¾‹åŒ–å¯¹è±¡db = FAISS.from_documents(documents, OpenAIEmbeddings()) ç›¸ä¼¼æ€§æœç´¢ åˆ›å»ºå¥½å‘é‡æ•°æ®åº“åï¼Œå°±å¯ä»¥æ ¹æ®ç›¸ä¼¼æ€§ï¼Œæœç´¢å‡ºéœ€è¦çš„æ–‡æœ¬å†…å®¹ï¼Œç„¶åè§£ç ä¸ºå¯è¯»çš„æ–‡æœ¬ã€‚ similarity_searchå‡½æ•°å°†ä¼šæŸ¥è¯¢è¾“å…¥æ–‡æœ¬ï¼Œæ‰¾å‡ºæœ€ç›¸å…³çš„å¤šä¸ªæ–‡æ¡£ï¼Œå¹¶è¿”å›å…¶è§£ç åçš„æ–‡æ¡£å†…å®¹ã€‚ 123query = &quot;What did the president say about Ketanji Brown Jackson&quot;docs = db.similarity_search(query)print(docs[0].page_content) å¦‚æœè¾“å…¥ä¸æ˜¯å¯è¯»æ–‡æœ¬ï¼Œè€Œæ˜¯ä¸€ä¸ªå·²ç»ç¼–ç å¥½çš„å‘é‡ï¼Œä½¿ç”¨å‡½æ•°similarity_search_by_vector 123embedding_vector = OpenAIEmbeddings().embed_query(query)docs = db.similarity_search_by_vector(embedding_vector)print(docs[0].page_content) åµŒå…¥ç¼“å­˜ ä½¿ç”¨å¸¦æœ‰ç¼“å­˜çš„æ–‡æœ¬åµŒå…¥ç±»ï¼Œå¯ä»¥ä½¿å¾—ä»é‡å¤çš„æ–‡æœ¬åˆ›å»ºå‘é‡æ•°æ®åº“æ—¶ï¼Œä¸å†è°ƒç”¨æ¨¡å‹ç¼–ç è€Œç›´æ¥æŸ¥è¯¢ç¼“å­˜ä¸­çš„ç»“æœã€‚è¿™å¯èƒ½å¯ä»¥å‡å°‘æ¨¡å‹çš„è°ƒç”¨é‡ã€‚ é€šå¸¸ï¼ŒåµŒå…¥ç¼“å­˜å’Œå‘é‡æ•°æ®åº“ä¸€èµ·ä½¿ç”¨ï¼Œå½“æŸ¥è¯¢ç¼“å­˜å‘½ä¸­æ—¶ï¼ŒLangChainç›´æ¥ä»ç¼“å­˜ä¸­æ„å»ºå‘é‡æ•°æ®åº“ï¼Œè€Œä¸æ˜¯ä»åŸå§‹æ–‡æœ¬ç¼–ç å¼€å§‹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š ä¸ºäº†ä½¿ç”¨ç¼“å­˜ï¼Œé¦–å…ˆéœ€è¦å¼•å…¥åç§°CacheBackedEmbeddingsï¼Œå¹¶æŒ‡å®šä¸€ä¸ªç”¨äºåº•å±‚ç¼–ç åµŒå…¥å‘é‡çš„æ¨¡å‹ï¼Œè¿™é‡Œä»ç„¶ä½¿ç”¨OpenAIEmbeddings åˆ›å»ºä¸€ä¸ªç¼“å­˜çš„å­˜å‚¨ä½ç½®ï¼Œä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œç¼“å­˜ä½äºæœ¬åœ°æ–‡ä»¶ç›®å½•&quot;./cache/&quot;ä¸­ã€‚ ä½ ä¹Ÿå¯ä»¥å°†ç¼“å­˜è®¾ä¸ºå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ˆå¦‚æœä½ çš„å†…å­˜è¶³å¤Ÿï¼‰ï¼Œä½¿ç”¨å¦‚ä¸‹çš„è¯­å¥ï¼š from langchain.storage import InMemoryByteStore store = InMemoryByteStore() æŒ‡å®šä¸€ä¸ªå‘½åç©ºé—´å‚æ•°namespaceï¼Œå‘½åç©ºé—´æ¯”è¾ƒé‡è¦ï¼Œå®ƒä¿è¯äº†ä½ ä½¿ç”¨ ä¸åŒçš„åµŒå…¥æ¨¡å‹ ç¼–ç  åŒä¸€æ–‡æœ¬ æ—¶ä¸ä¼šè§¦å‘ç¼“å­˜å‘½ä¸­ï¼ˆå¦åˆ™è¿™å®¹æ˜“å¯¼è‡´ä¸åŒæ¨¡å‹é—´çš„å†²çªï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå°†å…¶æŒ‡å®šä¸ºåµŒå…¥æ¨¡å‹çš„åç§°å³å¯ã€‚ 1234567891011121314from langchain.embeddings import CacheBackedEmbeddingsfrom langchain.storage import LocalFileStorefrom langchain.text_splitter import CharacterTextSplitterfrom langchain_community.document_loaders import TextLoaderfrom langchain_community.vectorstores import FAISSfrom langchain_openai import OpenAIEmbeddingsunderlying_embeddings = OpenAIEmbeddings()store = LocalFileStore(&quot;./cache/&quot;)cached_embedder = CacheBackedEmbeddings.from_bytes_store( underlying_embeddings, store, namespace=underlying_embeddings.model) å®Œæˆåï¼Œä½ å¯ä»¥ä½¿ç”¨cached_embedderä»£æ›¿OpenAIEmbeddings()ç­‰åº•å±‚åµŒå…¥æ¨¡å‹åˆ›å»ºå‘é‡æ•°æ®åº“ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨åœ¨éœ€è¦æ—¶ä½¿ç”¨ç¼“å­˜ã€‚ ä½¿ç”¨list(store.yield_keys())å¯ä»¥æŸ¥çœ‹ç¼“å­˜ä¸­çš„ä¸»é”®ã€‚ æ£€ç´¢å™¨ ä¸Šé¢çš„å†…å®¹ä»‹ç»äº†ç®€å•çš„å‘é‡æ•°æ®åº“è¯­ä¹‰æœç´¢ï¼Œå®ƒä»¬ç›´æ¥è¿”å›ç›¸åº”çš„æ–‡æœ¬ã€‚ä½†å®é™…ä½¿ç”¨æ—¶ï¼Œå¾€å¾€éœ€è¦ç»“æ„åŒ–çš„æ•°æ®ï¼Œå› æ­¤éœ€è¦åŒ…è£…æ£€ç´¢å™¨ã€‚ LangChainæä¾›äº†è®¸å¤šå†…ç½®çš„æ£€ç´¢å™¨å¯¹è±¡ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®Œæˆå¤šæŸ¥è¯¢ã€æ’åºã€æ—¶é—´åŠ æƒç­‰åŠŸèƒ½ã€‚å…³äºæ‰€æœ‰çš„æ£€ç´¢å™¨ç±»ï¼Œå‚è€ƒï¼šRetrievers | ğŸ¦œï¸ğŸ”— Langchain åŸºç¡€æ£€ç´¢å™¨ - åŸºäºå‘é‡æ•°æ®åº“ å¯ä»¥ç›´æ¥ä»å‘é‡æ•°æ®åº“å¯¹è±¡æ„å»ºæ£€ç´¢å™¨ 12345678# çœç•¥äº†å‰ç½®æ­¥éª¤â€¦â€¦db = FAISS.from_documents(docs, embeddings)# åˆ›å»ºæ£€ç´¢å™¨retriever = db.as_retriever()# æŸ¥è¯¢ç›¸å…³çš„æ–‡æ¡£(é»˜è®¤ä»¥ç›¸ä¼¼æ€§æœç´¢)docs = retriever.get_relevant_documents(&quot;what did he say about ketanji brown jackson&quot;) åœ¨åˆ›å»ºæ£€ç´¢å™¨æ—¶ï¼Œå¯ä»¥æŒ‡å®šå…¶ä½¿ç”¨çš„æ£€ç´¢æ–¹æ³•ï¼Œ å¦‚æœ€å¤§è¾¹ç¼˜ç›¸å…³æ€§æœç´¢ï¼ˆMMRï¼‰,å‰ææ˜¯å¯¹åº”çš„å‘é‡æ•°æ®åº“å¯¹è±¡æ”¯æŒè¿™ç§æ£€ç´¢ã€‚ åœ¨search_kwargså‚æ•°ä¸­å¯ä»¥ä½¿ç”¨å­—å…¸ä¼ å…¥å…¶ä»–å‚æ•°ï¼Œå¦‚ç›¸ä¼¼æ€§åˆ†æ•°é˜ˆå€¼ï¼ˆåªè¿”å›åˆ†æ•°é«˜äºè¯¥é˜ˆå€¼çš„æ–‡æ¡£ï¼‰ï¼Œæˆ–åœ¨æŒ‡å®štop kï¼ˆåªè¿”å›kä¸ªæœ€ç›¸å…³çš„æ–‡æ¡£ï¼‰ç­‰ã€‚ 123456789101112# ä½¿ç”¨MMRæ£€ç´¢retriever = db.as_retriever( search_type=&quot;mmr&quot;)# ä½¿ç”¨å¸¦æœ‰é˜ˆå€¼çš„ç›¸ä¼¼æ€§æœç´¢retriever = db.as_retriever( search_type=&quot;similarity_score_threshold&quot;, search_kwargs=&#123;&quot;score_threshold&quot;: 0.5&#125;)# æŒ‡å®šTop kretriever = db.as_retriever( search_kwargs=&#123;&quot;k&quot;: 3&#125;) å¤šæŸ¥è¯¢æ£€ç´¢å™¨ MultiQueryRetriever è¿™ç§æŸ¥è¯¢å™¨çš„ç›®æ ‡æ—¶ä¸ºäº†æé«˜è¯­ä¹‰æ£€ç´¢çš„é²æ£’æ€§ã€‚ç”±äºè‡ªç„¶è¯­è¨€å­˜åœ¨ä¸€å®šçš„å†—ä½™æ€§å’Œæ­§ä¹‰ï¼Œå½“æŸ¥è¯¢æªè¾å‘ç”Ÿç»†å¾®å˜åŒ–ï¼Œæˆ–è€…åµŒå…¥ä¸èƒ½å¾ˆå¥½åœ°æ•æ‰æ•°æ®çš„è¯­ä¹‰æ—¶ï¼Œæ£€ç´¢å¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœã€‚è¿™é€šå¸¸ä¼šä½¿å¾—æ£€ç´¢åˆ°çš„æ–‡æ¡£èŒƒå›´ç¼©å°ï¼ˆå³åŒæ ·çš„é—®é¢˜ï¼Œåªæ˜¯æ”¹äº†ä¸€ä¸ªæªè¾ï¼Œå°±æŸ¥ä¸åˆ°ç›¸å…³æ–‡æ¡£äº†ï¼‰ã€‚ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å¤šæŸ¥è¯¢ï¼šå³æ¯æ¬¡æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨å¤šä¸ªè¯­ä¹‰ç›¸è¿‘çš„å­—ç¬¦ä¸²ä»£æ›¿å•ä¸€å­—ç¬¦ä¸²ï¼Œè¿›è¡Œå¤šæ¬¡æŸ¥è¯¢ï¼Œå¹¶ç»Ÿåˆæœ€ç»ˆçš„ç»“æœã€‚ åœ¨LangChainä¸­ï¼Œè‡ªç„¶åœ°ä½¿ç”¨LLMæ¥ç”Ÿæˆâ€œå¤šä¸ªè¯­ä¹‰ç›¸è¿‘çš„æŸ¥è¯¢â€ï¼Œè¿™æ ·ç”¨æˆ·åªéœ€åƒå¾€å¸¸ä¸€æ ·è¾“å…¥ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œä½†å¯ä»¥è¾¾åˆ°å¤šæŸ¥è¯¢çš„æ•ˆæœã€‚ 12345678910111213141516171819202122232425262728293031from langchain.retrievers.multi_query import MultiQueryRetrieverfrom langchain_openai import ChatOpenAIfrom langchain_community.vectorstores import Chromafrom langchain_openai import OpenAIEmbedding# æ„å»ºä¸€ä¸ªå‘é‡æ•°æ®åº“ï¼ˆè¿™é‡Œä½¿ç”¨çš„å­˜å‚¨åç«¯æ˜¯Chromaï¼‰embeddings = OpenAIEmbeddings()vectordb = Chroma.from_documents(documents=docs, embedding=embeddings)llm = ChatOpenAI(temperature=0) # å®ä¾‹åŒ–ä¸€ä¸ªLLMå¯¹è±¡ï¼Œä½œä¸ºå¤šæŸ¥è¯¢ç”Ÿæˆå™¨# æ„å»ºå¤šæŸ¥è¯¢æ£€ç´¢å™¨retriever_from_llm = MultiQueryRetriever.from_llm( retriever=vectordb.as_retriever(), llm=llm)import logging# å¢åŠ ä¸€ä¸ªloggingå¯¹è±¡ï¼Œä»¥æ‰“å°ç”Ÿæˆå‡ºçš„å¤šæŸ¥è¯¢å†…å®¹logging.basicConfig()logging.getLogger(&quot;langchain.retrievers.multi_query&quot;).setLevel(logging.INFO)question = &quot;What are the approaches to Task Decomposition?&quot;unique_docs = retriever_from_llm.get_relevant_documents(query=question)# è¾“å‡ºç¤ºä¾‹ï¼šè¿™é‡Œæ˜¯logè¾“å‡ºï¼Œå³LLMä¸ºæŸ¥è¯¢questionç”Ÿæˆçš„ç›¸è¿‘è¯­ä¹‰é—®é¢˜INFO:langchain.retrievers.multi_query:Generated queries: [ &#x27;1. How can Task Decomposition be approached?&#x27;, &#x27;2. What are the different methods for Task Decomposition?&#x27;, &#x27;3. What are the various approaches to decomposing tasks?&#x27;] ä½œä¸ºç”Ÿæˆå¤šæŸ¥è¯¢çš„åŸºç¡€ï¼Œä½ å¯ä»¥ä¿®æ”¹åº•å±‚LLMçš„é…ç½®ã€‚ä¸Šè¿°ä¾‹å­é»˜è®¤ä½¿ç”¨ä¸€ä¸ªåŸºæœ¬çš„LLMå¯¹è¯ã€‚ä½ å¯ä»¥ä½¿ç”¨åŸºæœ¬çš„LangChainé“¾æ¥å°†å…¶è‡ªå®šä¹‰ä¸ºå¸¦æœ‰ç‰¹å®špromptçš„LLMå¯¹è¯ï¼š æ³¨æ„ï¼šä¸ºäº†ä½¿å¾—æ£€ç´¢å™¨èƒ½æ­£ç¡®æ‰¾åˆ°LLMè¾“å‡ºçš„å¤šæŸ¥è¯¢å†…å®¹ï¼Œåœ¨è‡ªå®šä¹‰LLM chainæ—¶éœ€è¦å°†å…¶è¾“å‡ºæ ¼å¼åŒ–è§£æä¸ºé”®å€¼å¯¹çš„å½¢å¼ï¼Œå‚è€ƒä¸‹é¢çš„ä¾‹å­ã€‚ 12345678910111213141516171819202122232425262728293031323334# å®šä¹‰ä¸€ä¸ªLLMè¾“å‡ºæ ¼å¼è§£æå™¨ï¼Œå°†è¾“å‡ºå®‰è£…æ¢è¡Œç¬¦åˆ†å‰²ï¼Œå­˜å‚¨åˆ°ä¸€ä¸ªlinesçš„å­—å…¸é‡Œclass LineList(BaseModel): # &quot;lines&quot; is the key (attribute name) of the parsed output lines: List[str] = Field(description=&quot;Lines of text&quot;)class LineListOutputParser(PydanticOutputParser): def __init__(self) -&gt; None: super().__init__(pydantic_object=LineList) def parse(self, text: str) -&gt; LineList: lines = text.strip().split(&quot; &quot;) return LineList(lines=lines)output_parser = LineListOutputParser()# è‡ªå®šä¹‰æ’°å†™æç¤ºï¼Œè¦æ±‚LLMè¾“å‡º5ä¸ªå¤šæŸ¥è¯¢è¯­å¥QUERY_PROMPT = PromptTemplate( input_variables=[&quot;question&quot;], template=&quot;&quot;&quot;You are an AI language model assistant. Your task is to generate five different versions of the given user question to retrieve relevant documents from a vector database. By generating multiple perspectives on the user question, your goal is to help the user overcome some of the limitations of the distance-based similarity search. Provide these alternative questions separated by newlines. Original question: &#123;question&#125;&quot;&quot;&quot;,)llm = ChatOpenAI(temperature=0)# æ„é€ LLM Chainllm_chain = LLMChain(llm=llm, prompt=QUERY_PROMPT, output_parser=output_parser)# ä½¿ç”¨è‡ªå®šä¹‰çš„LLM Chain åˆ›å»ºå¤šæŸ¥è¯¢æ£€ç´¢å™¨ï¼Œå…¶ä¸­ï¼Œparser_keyå‡½æ•°æŒ‡å®šäº†# æ£€ç´¢å™¨ä»è¾“å‡ºæ•°æ®çš„å“ªä¸ªkeyä¸­è·å–æœ€ç»ˆçš„å¤šæŸ¥è¯¢è¯­å¥åˆ—è¡¨retriever = MultiQueryRetriever( retriever=vectordb.as_retriever(), llm_chain=llm_chain, parser_key=&quot;lines&quot;) ä¸Šä¸‹æ–‡å‹ç¼©æ£€ç´¢å™¨ æœ‰çš„æ—¶å€™ï¼ŒçŸ¥è¯†åº“ä¸­çš„æ¯ä¸ªæ–‡æ¡£éƒ½æ˜¯é•¿æ–‡æœ¬ï¼Œè€Œå½“æ£€ç´¢æ—¶ï¼Œç”¨æˆ·åªéœ€è¦æ–‡æ¡£çš„æ¦‚æ‹¬å†…å®¹ï¼Œæˆ–æ˜¯å…¶ä¸­ä¸æŸ¥è¯¢æœ€ç›¸å…³çš„å†…å®¹ï¼Œè€Œéæ•´ä¸ªæ–‡æ¡£ã€‚é€šå¸¸è¿™éœ€è¦å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œåå¤„ç†æ¥å®ç°ï¼Œä¸è¿‡LangChainä¸ºæ­¤åŒ…è£…äº†å‹ç¼©æ£€ç´¢å™¨ï¼Œå¯ä»¥ä¸€å¹¶å®ŒæˆæŸ¥è¯¢ç»“æœè¿‡æ»¤çš„è¿‡ç¨‹ã€‚ ä¸Šä¸‹æ–‡å‹ç¼©æ£€ç´¢å™¨åŸºäºåŸºæœ¬æ£€ç´¢å™¨ï¼Œåœ¨ä½¿ç”¨å‰ï¼Œå…ˆä»å‘é‡æ•°æ®åº“æ„å»ºä¸€ä¸ªåŸºæœ¬æ£€ç´¢å™¨ã€‚ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªLLMå®ä¾‹æ¥å†³å®šè¿‡æ»¤æ‰ç»“æœæ–‡æ¡£ä¸­çš„å“ªäº›å†…å®¹ï¼Œè¿™è¢«ç§°ä¸ºLLMChainFilterï¼š 123456789101112131415161718192021from langchain.retrievers.document_compressors import LLMChainFilter... # çœç•¥çŸ¥è¯†åº“æ•°æ®å¤„ç†çš„è¿‡ç¨‹# åˆ›å»ºåŸºæœ¬æ£€ç´¢å™¨retriever = FAISS.from_documents(texts, OpenAIEmbeddings()).as_retriever()# éœ€è¦ä¸€ä¸ªLLMä½œä¸ºè¿‡æ»¤å™¨çš„åç«¯llm = OpenAI(temperature=0)# åˆ›å»ºLLMè¿‡æ»¤å™¨_filter = LLMChainFilter.from_llm(llm)# æ„å»ºä¸Šä¸‹æ–‡å‹ç¼©æ£€ç´¢å™¨compression_retriever = ContextualCompressionRetriever( base_compressor=_filter, base_retriever=retriever)# è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶è¿”å›å‹ç¼©åçš„æŸ¥è¯¢ç»“æœcompressed_docs = compression_retriever.get_relevant_documents( &quot;What did the president say about Ketanji Jackson Brown&quot;) ä½†æ˜¯ï¼Œä½¿ç”¨LLMä½œä¸ºå‹ç¼©å’Œè¿‡æ»¤çš„åç«¯ï¼Œä¼šè®©æ¯æ¬¡æŸ¥è¯¢æ—¶éƒ½å¢åŠ è®¸å¤šé¢å¤–çš„LLMè°ƒç”¨ï¼Œå¦‚æœæƒ³è¦èŠ‚çº¦æˆæœ¬ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨åµŒå…¥æ¨¡å‹ï¼ŒæŸ¥è¯¢ç»“æœæ–‡æ¡£å†…éƒ¨è¯­å¥çš„ç›¸ä¼¼åº¦ï¼Œä»è€Œè¿”å›ç»“æœã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨EmbeddingsFilter 123456789101112131415161718192021from langchain.retrievers.document_compressors import EmbeddingsFilterfrom langchain_openai import OpenAIEmbeddings... # çœç•¥çŸ¥è¯†åº“æ•°æ®å¤„ç†çš„è¿‡ç¨‹# åˆ›å»ºåŸºæœ¬æ£€ç´¢å™¨retriever = FAISS.from_documents(texts, OpenAIEmbeddings()).as_retriever()embeddings = OpenAIEmbeddings()# æ„å»ºå‘é‡ç›¸ä¼¼åº¦è¿‡æ»¤å™¨embeddings_filter = EmbeddingsFilter(embeddings=embeddings, similarity_threshold=0.76)# æ„å»ºä¸Šä¸‹æ–‡å‹ç¼©æ£€ç´¢å™¨compression_retriever = ContextualCompressionRetriever( base_compressor=embeddings_filter, base_retriever=retriever)# è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶è¿”å›å‹ç¼©åçš„æŸ¥è¯¢ç»“æœcompressed_docs = compression_retriever.get_relevant_documents( &quot;What did the president say about Ketanji Jackson Brown&quot;) LangChainè¿˜æä¾›å¤šç§è¿‡æ»¤å™¨ï¼Œå¦‚å»é™¤å†—ä½™çš„å‘é‡åµŒå…¥ç­‰ã€‚å¹¶ä¸”ï¼Œåˆ†å‰²æ–‡æœ¬çš„å·¥å…·ç±»ä¹Ÿå¯ä»¥è§†ä¸ºè¿‡æ»¤å™¨ã€‚ å½“ä½ éœ€è¦å¯¹è¾“å‡ºæ–‡æœ¬è¿›è¡Œä¸€äº›æµæ°´çº¿å¤„ç†æ—¶ï¼ˆå¦‚å…ˆåˆ†å‰²ï¼Œåœ¨å»é™¤å†—ä½™ï¼Œæœ€åæå–é«˜ç›¸ä¼¼åº¦æ–‡æœ¬ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ocumentCompressorPipelineæ„å»ºä¸€ä¸ªæµæ°´çº¿å‹ç¼©å™¨ï¼ŒLangChainå°†ä¼šè‡ªåŠ¨æŒ‰æ­¥éª¤å¤„ç†ä¸­é—´æ–‡æ¡£ï¼Œåªè¾“å‡ºæœ€ç»ˆç»“æœã€‚ 12345678910111213141516171819from langchain.retrievers.document_compressors import DocumentCompressorPipelinefrom langchain.text_splitter import CharacterTextSplitterfrom langchain_community.document_transformers import EmbeddingsRedundantFiltersplitter = CharacterTextSplitter(chunk_size=300, chunk_overlap=0, separator=&quot;. &quot;) # æ–‡æœ¬åˆ†å‰²redundant_filter = EmbeddingsRedundantFilter(embeddings=embeddings) # å»é™¤å†—ä½™relevant_filter = EmbeddingsFilter(embeddings=embeddings, similarity_threshold=0.76) # ç›¸ä¼¼åº¦æ¯”è¾ƒ# æ„å»ºæµæ°´çº¿å‹ç¼©å™¨pipeline_compressor = DocumentCompressorPipeline( transformers=[splitter, redundant_filter, relevant_filter]# æ„å»ºä¸Šä¸‹æ–‡å‹ç¼©æ£€ç´¢å™¨)compression_retriever = ContextualCompressionRetriever( base_compressor=pipeline_compressor, base_retriever=retriever)compressed_docs = compression_retriever.get_relevant_documents( &quot;What did the president say about Ketanji Jackson Brown&quot;) å¤šå‘é‡æ£€ç´¢å™¨ MultiVector Retriever æ³¨æ„ï¼šè¿™ä¸å¤šæŸ¥è¯¢ä¸åŒï¼Œå¤šå‘é‡çš„æ„æ€æ—¶ï¼Œæ¯ä¸ªæºæ–‡æ¡£åœ¨å­˜å…¥çŸ¥è¯†åº“ï¼ˆå‘é‡æ•°æ®åº“ï¼‰æ—¶ï¼Œå…·æœ‰å¤šä¸ªå¯¹åº”çš„å‘é‡åµŒå…¥ï¼Œè€Œå®ƒä»¬çš„ç‰¹æ€§ä¸åŒï¼ˆå¦‚åˆ†åˆ«æè¿°äº†æ‘˜è¦ï¼Œé‡ç‚¹é—®é¢˜ã€‚è§£å†³æ–¹æ¡ˆç­‰æ–‡æ¡£å†…å®¹çš„ä¸åŒæ–¹é¢ï¼‰ã€‚ç„¶åæ£€ç´¢æ—¶ï¼ŒæŒ‰ç…§æŸ¥è¯¢çš„è¯­ä¹‰åå¥½æŸ¥æ‰¾åŒä¸€æ–‡æ¡£çš„ä¸åŒå‘é‡åµŒå…¥ã€‚ 1TODO å¸¦æœ‰æ—¶é—´åŠ æƒçš„æ£€ç´¢å™¨ åœ¨æ£€ç´¢è¯­ä¹‰æ—¶ï¼Œä¹Ÿè€ƒè™‘åŒæ ·çš„æ–‡æ¡£æˆ–çŸ¥è¯†å†…å®¹ ä¸Šä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´ã€‚ è¯­ä¹‰ç›¸ä¼¼åº¦ + (1.0 - decay_rate) ^ è·ç¦»ä¸Šæ¬¡æ£€ç´¢è¿‡å»çš„æ—¶é—´ï¼ˆå°æ—¶ï¼‰ decay_rateè¢«è®¾å®šä¸º0-1ä¹‹é—´çš„å€¼ï¼Œè¶Šæ¥è¿‘0ï¼Œæ„å‘³ç€åœ¨æ£€ç´¢æ—¶ï¼Œæ–°é²œæ—¶é—´å¯¹æ–‡æ¡£æ£€ç´¢ç»“æœçš„å½±å“è¶Šå¤§ï¼Œåä¹‹äº¦ç„¶ã€‚å› æ­¤decay_rateä¸º1æ—¶ï¼Œæ—¶é—´åŠ æƒç›¸å½“äºä¸å­˜åœ¨ï¼›decay_rateä¸º0æ—¶ï¼Œåˆ™æ— è®ºæ–‡æ¡£ä¸Šä¸€æ¬¡è®¿é—®çš„æ—¶é—´è·ç¦»å¤šä¹…ï¼Œæ–‡æ¡£éƒ½æœ‰ç›¸åŒçš„æ–°é²œåº¦ã€‚ 12345678910111213141516171819202122232425262728293031from datetime import datetime, timedeltaimport faissfrom langchain.docstore import InMemoryDocstorefrom langchain.retrievers import TimeWeightedVectorStoreRetrieverfrom langchain.schema import Documentfrom langchain_community.vectorstores import FAISSfrom langchain_openai import OpenAIEmbeddings# å®šä¹‰åµŒå…¥æ¨¡å‹embeddings_model = OpenAIEmbeddings()# åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„å‘é‡æ•°æ®åº“embedding_size = 1536index = faiss.IndexFlatL2(embedding_size)vectorstore = FAISS(embeddings_model, index, InMemoryDocstore(&#123;&#125;), &#123;&#125;)# ä¿®æ”¹decay_rateæ¥æµ‹è¯•æ—¶é—´åŠ æƒçš„æ£€ç´¢æ•ˆæœretriever = TimeWeightedVectorStoreRetriever( vectorstore=vectorstore, decay_rate=0.01, k=1)yesterday = datetime.now() - timedelta(days=1)# æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºæ–‡æ¡£ï¼Œè®¾ç½®ä¸Šæ¬¡æ£€ç´¢æ—¶é—´ä¸ºæ˜¨å¤©retriever.add_documents( [Document(page_content=&quot;hello world&quot;, metadata=&#123;&quot;last_accessed_at&quot;: yesterday&#125;)])# å†æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸è®¾å®šä¸Šæ¬¡æ£€ç´¢æ—¶é—´retriever.add_documents([Document(page_content=&quot;hello foo&quot;)])retriever.get_relevant_documents(&quot;hello world&quot;)# åœ¨decay_rateæ¥è¿‘0çš„æ—¶å€™ä¼šè¿”å›&quot;hello world&quot;ï¼Œè€Œæ¥è¿‘1æ—¶ä¼šè¿”å›&quot;hello foo&quot; å°†æ£€ç´¢å™¨åŒ…è£…ä¸ºLLM Chain 12345678910111213141516171819from langchain_community.vectorstores import FAISSfrom langchain_openai import OpenAIEmbeddingsfrom langchain.chains import create_retrieval_chain... # çœç•¥çŸ¥è¯†åº“æ•°æ®å¤„ç†çš„è¿‡ç¨‹vector = FAISS.from_documents(documents, OpenAIEmbeddings())retriever = vector.as_retriever()... # æœ‰ä¸¤ç§æ–¹å¼æ„å»ºå¸¦æœ‰æ£€ç´¢å™¨çš„é“¾ï¼Œä¸€æ˜¯åœ¨å·²æœ‰é“¾çš„åŸºç¡€ä¸Šä½¿ç”¨create_retrievalç›¸å…³å‡½æ•°chain = prompt | llm | output_parserretrieval_chain = create_retrieval_chain(retriever, chain)# äºŒæ˜¯ç›´æ¥åœ¨é“¾çš„RunnableParalleç®¡é“ä¸­ä¼ å…¥retrieverå¯¹è±¡ï¼ˆä¹Ÿæ˜¯Runnableçš„ï¼‰retrieval_chain = ( &#123;&quot;context&quot;: retriever, &quot;question&quot;: RunnablePassthrough()&#125; | prompt | llm | output_parser) å°†æ£€ç´¢å™¨åŒ…è£…ä¸ºæ™ºèƒ½ä½“å·¥å…· 1234567891011121314from langchain_community.vectorstores import FAISSfrom langchain_openai import OpenAIEmbeddingsfrom langchain.tools.retriever import create_retriever_tool... # çœç•¥çŸ¥è¯†åº“æ•°æ®å¤„ç†çš„è¿‡ç¨‹vector = FAISS.from_documents(documents, OpenAIEmbeddings())retriever = vector.as_retriever()# åˆ›å»ºæ£€ç´¢å™¨å·¥å…·retriever_tool = create_retriever_tool( retriever, &quot;langsmith_search&quot;, &quot;Search for information about LangSmith. For any questions about LangSmith, you must use this tool!&quot;,) LangChain Agent æ ¸å¿ƒæ¦‚å¿µ AgentActionï¼šdataclassï¼Œè¡¨ç¤ºAgenté‡‡å–çš„ä¸€ä¸ªåŠ¨ä½œï¼Œé€šå¸¸æ˜¯ä½¿ç”¨å·¥å…· å±æ€§ï¼š tool åº”è¯¥è°ƒç”¨çš„å·¥å…·çš„åç§° tool_input è¯¥å·¥å…·çš„è¾“å…¥ å®é™…ä½¿ç”¨æ—¶é€šå¸¸ä¸ºå¸¦Logçš„AgentActionMessageLog AgentFinishï¼šæ™ºèƒ½ä½“å‡†å¤‡è¿”å›ç»™ç”¨æˆ·æ—¶çš„æœ€ç»ˆç»“æœ å±æ€§ï¼š return_values å­—å…¸é›†ï¼ŒåŒ…å«æ‰€æœ‰æœ€ç»ˆè¾“å‡º é€šå¸¸æœ‰ä¸€ä¸ªåä¸ºoutputçš„keyï¼Œè¡¨ç¤ºå›å¤ç»™ç”¨æˆ·çš„å­—ç¬¦ä¸² Intermediate Stepsï¼šè®°å½•æ‰€æœ‰æ™ºèƒ½ä½“çš„å†å²åŠ¨ä½œï¼Œå’Œä¸æœ¬æ¬¡è¿è¡Œç›¸å…³çš„è¾“å‡º é€šå¸¸è¢«ä¿å­˜ä¸ºä¸€ä¸ªåˆ—è¡¨æ•°æ®ç±»å‹ï¼šList[Tuple(AgentAction, Observation)] ä¸ºäº†æœ€å¤§åŒ–æ¡†æ¶çš„çµæ´»æ€§ï¼ŒObservationçš„ç±»å‹å¯ä»¥æ˜¯â€œä»»æ„â€ï¼ˆAnyï¼‰ï¼Œä½†é€šå¸¸æ˜¯å­—ç¬¦ä¸² æ™ºèƒ½ä½“é“¾åŸºç±»ï¼šAgent è¿™æ˜¯ä¸€ä¸ªåœ¨LangChainçš„é“¾ çš„åŸºç¡€ä¸Šæ„å»ºçš„ç±»ï¼ŒåŠŸèƒ½æ˜¯è®©å¤§æ¨¡å‹å†³ç­–ä¸‹ä¸€æ­¥çš„è¡ŒåŠ¨ã€‚ å†æ¬¡æé†’ï¼šè®°ä½ LangChainçš„é“¾ çš„æ¦‚å¿µå…¶å®åªæ˜¯åŒ…è£…å¥½ä¸€ä¸ªæç¤ºå¤§æ¨¡å‹å¹¶è§£æè¾“å‡ºçš„è¿‡ç¨‹ï¼Œå¹¶å…è®¸åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é—´æ’å…¥é¢å¤–çš„æ•°æ®å¤„ç†æ­¥éª¤ã€‚ æ—¢ç„¶AgentåŸºäºChainç±»å‹æ„å»ºï¼Œå› æ­¤åº•å±‚ä¸Šå¯èƒ½ä½¿ç”¨ä¸¤ç§LangChainæç¤ºç­–ç•¥åŒ…è£…ï¼Œå³ çº¯LLM æˆ– èŠå¤©æ¨¡å‹ï¼ˆChat Modelsï¼‰ï¼Œæ ¹æ®è¯¥ç±»å‹çš„ä¸åŒï¼ŒAgentå…·æœ‰ä¸åŒçš„ â€œé¢„æœŸç±»å‹â€ ï¼ˆIntended Model Typeï¼‰ åŒæ—¶ï¼ŒLangChainä¸ºå¸¸ç”¨åŠŸèƒ½åŒ…è£…å¥½äº†è‹¥å¹²æ™ºèƒ½ä½“ç±»ï¼Œå®ƒä»¬æ”¯æŒçš„åŠŸèƒ½å„ä¸ç›¸åŒã€‚ æ™ºèƒ½ä½“æ‰§è¡Œå™¨ç±»ï¼šAgentExecutor ç¨‹åºè¿è¡Œæ—¶ï¼Œå®é™…æ‰§è¡Œæ™ºèƒ½ä½“åŠŸèƒ½çš„èº¯å£³ï¼ˆè¿è¡Œæ—¶ï¼‰ï¼Œè¿›è¡Œå®é™…è°ƒç”¨æ™ºèƒ½ä½“ã€æ‰§è¡Œå®ƒé€‰æ‹©çš„åŠ¨ä½œã€å°†åŠ¨ä½œè¾“å‡ºä¼ é€’å›ä»£ç†çš„æ“ä½œï¼Œå¹¶é‡å¤è¿™äº›æ“ä½œã€‚ AgentExecutoråœ¨è¿è¡Œæ—¶å¯ä»¥å¤„ç†çš„é—®é¢˜ï¼š å¦‚æœAgenté€‰æ‹©äº†ä¸å­˜åœ¨çš„å·¥å…· å¦‚æœAgentçš„è¾“å‡ºæ— æ³•è§£æä¸ºåˆæ³•çš„å·¥å…·è°ƒç”¨æˆ–æœ€ç»ˆè¾“å‡º å¦‚æœAgenté€‰æ‹©çš„å·¥å…·åœ¨è¿è¡Œæ—¶å‘ç”Ÿé”™è¯¯ è®°å½•Agentåœ¨æ‰€æœ‰çº§åˆ«ä¸Šçš„è¿è¡Œæ—¥å¿—ï¼ˆå¯ä»¥è¾“å‡ºåˆ°æ§åˆ¶å°æˆ–ä½¿ç”¨LangSmithè®°å½•ï¼‰ é¢„ç½®æ™ºèƒ½ä½“çš„ä½¿ç”¨ é¢„æœŸç±»å‹æ˜¯Chat Modelsçš„å†…ç½®æ™ºèƒ½ä½“ OpenAI Tools ä½¿ç”¨OPENAIæ”¯æŒâ€œå·¥å…·è°ƒç”¨â€çš„æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹ç»è¿‡äº†å¾®è°ƒï¼Œå¢å¼ºäº†æ£€æµ‹ä½•æ—¶è°ƒç”¨å‡½æ•°ï¼Œå¹¶è¾“å‡º åº”è¯¥ä¼ é€’ç»™è¯¥å‡½æ•°çš„å‚æ•° ä½œä¸ºå“åº”çš„èƒ½åŠ›ã€‚è¿™ä½¿å¾—LangChainå¯ç”¨åˆ©ç”¨è¿™ä¸€ç‰¹æ€§è°ƒç”¨å¤šä¸ªå‡½æ•°ï¼Œä»¥æ­¤æ¥é€‰æ‹©AgentActionï¼Œè¿›è¡ŒåŠ¨ä½œè§„åˆ’ å’Œä¸‹é¢çš„â€œå‡½æ•°è°ƒç”¨â€çš„åŒºåˆ«æ˜¯ï¼Œâ€œå‡½æ•°è°ƒç”¨â€åªæ”¯æŒæ¨ç†å•ä¸ªå‡½æ•°ï¼Œè€Œâ€œå·¥å…·è°ƒç”¨â€æ”¯æŒä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ã€‚ åªåœ¨OPENAIæœ€æ–°çš„æ¨¡å‹ï¼ˆgpt-3.5-turbo-1106æˆ–gpt-4-1106ï¼‰ä»¥åæ”¯æŒã€‚ å› ä¸ºâ€œå·¥å…·è°ƒç”¨â€æ˜¯â€œå‡½æ•°è°ƒç”¨â€çš„ä¸Šä½æ›¿ä»£ï¼Œå› æ­¤OPENAIè®¤ä¸ºâ€œå‡½æ•°è°ƒç”¨â€æ˜¯åºŸæ—§çš„åŠŸèƒ½ï¼Œä¸å»ºè®®å†ä½¿ç”¨æ—§çš„OpenAI Functionsï¼Œè€Œæ˜¯ç»Ÿä¸€ä½¿ç”¨OpenAI Toolsæ„å»ºæ™ºèƒ½ä½“ã€‚ éœ€è¦å¯¼å…¥çš„å¼•ç”¨ï¼š 123456# æ”¯æŒOPENAIçš„agentfrom langchain.agents import AgentExecutor, create_openai_tools_agent# åº•å±‚çš„èŠå¤©æ¨¡å‹from langchain_openai import ChatOpenAI# å…¶ä»–é€‚ç”¨äºåˆ›å»ºå·¥å…·ï¼Œç½‘ç»œé€šä¿¡ç­‰çš„åŒ…éƒ½çœç•¥äº†â€¦â€¦ åˆ›å»ºæ™ºèƒ½ä½“ 12345678910111213141516# å®šä¹‰å¯ç”¨çš„å·¥å…·åˆ—è¡¨ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå¯¼å…¥Langchainå†…ç½®çš„å…¶ä¸­ä¸€ä¸ªç½‘ç»œæœç´¢å·¥å…·from langchain_community.tools.tavily_search import TavilySearchResultstools = [TavilySearchResults(max_results=1)] # é€šå¸¸å·¥å…·å®šä¹‰ä¸ºå…¨å±€å˜é‡def new_openai_tools_agent(): # å®šä¹‰ä¸€ä¸ªæç¤ºè¯ï¼Œå¯è‡ªå®šä¹‰ï¼Œè¿™é‡Œä»ä¸€ä¸ªlangchainä»“åº“ä¸­è·å– from langchain import hub prompt = hub.pull(&quot;hwchase17/openai-tools-agent&quot;) # å®ä¾‹åŒ–ä¸€ä¸ªèŠå¤©æ¨¡å‹å¯¹è±¡ llm = ChatOpenAI(model=&quot;gpt-3.5-turbo-1106&quot;, temperature=0) # å®ä¾‹åŒ–æ™ºèƒ½ä½“å¯¹è±¡ agent = create_openai_tools_agent(llm, tools, prompt)\treturn agent å®ä¾‹åŒ–è¿è¡Œæ—¶å¹¶æ‰§è¡Œæ™ºèƒ½ä½“ 123456agent = new_openai_tools_agent()# åˆ›å»ºæ™ºèƒ½ä½“æ‰§è¡Œå™¨agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)# è¾“å…¥å†…å®¹input = &#123;&quot;input&quot;: &quot;what is LangChain?&quot;&#125;agent_executor.invoke(input) é»˜è®¤InputåªåŒ…å«ç”¨æˆ·çš„ä¸€ä¸ªå­—ç¬¦ä¸²é”®å€¼å¯¹ï¼Œä½†é‰´äºOpenAI Toolsæ™ºèƒ½ä½“æ˜¯åŸºäºèŠå¤©æ¨¡å‹çš„ï¼Œå¯å†è¾“å…¥ä¸­æ·»åŠ ä»»æ„çš„å¯¹è¯å†å²ï¼Œè¿™å’ŒèŠå¤©æ¨¡å‹çš„é“¾è°ƒç”¨ä¸€æ ·ï¼š 1234567891011from langchain_core.messages import AIMessage, HumanMessageagent_executor.invoke( &#123; &quot;input&quot;: &quot;what&#x27;s my name? Don&#x27;t use tools to look this up unless you NEED to&quot;, &quot;chat_history&quot;: [ HumanMessage(content=&quot;hi! my name is bob&quot;), AIMessage(content=&quot;Hello Bob! How can I assist you today?&quot;), ], &#125;) OpenAI Functions ä¸OpenAI Toolsä¸€è‡´ï¼Œä½¿ç”¨OPENAIæ¨¡å‹å†…éƒ¨çš„â€œå‡½æ•°è°ƒç”¨â€ï¼ˆFunction callingï¼‰åŠŸèƒ½ ä½¿ç”¨æ—¶ï¼Œåªéœ€ä¿®æ”¹ä¸Šè¿°å¯¼å…¥çš„å‡½æ•°åcreate_openai_tools_agentä¸ºcreate_openai_functions_agentå³å¯ï¼Œå…¶ä»–é…ç½®å®Œå…¨ç›¸åŒã€‚ ä¹Ÿé€‚ç”¨äºå…¶ä»–å¼€æºæ¨¡å‹æä¾›çš„ä¸OpenAI Functionså…¼å®¹æ ¼å¼çš„APIæ¥å£ï¼Œå› ä¸ºè¿™äº›æ¨¡å‹é€šå¸¸æ²¡æœ‰éšç€OPENAIè€Œæ›´æ–°apiï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶é€‰æ‹©æ—§ç‰ˆçš„create_openai_tools_agent éœ€è¦å¯¼å…¥çš„å¼•ç”¨ï¼š 1234567# æ”¯æŒOPENAIæ¨¡å‹çš„agentfrom langchain.agents import AgentExecutor, create_openai_functions_agent# åº•å±‚çš„èŠå¤©æ¨¡å‹from langchain_openai import ChatOpenAIprompt = hub.pull(&quot;hwchase17/openai-functions-agent&quot;)# å…¶ä»–çš„éƒ¨åˆ†çœç•¥ï¼Œä¸OpenAI Tools åŸºæœ¬ä¸€è‡´ Structured Chat Structured Chatï¼ˆç»“æ„åŒ–å¯¹è¯ï¼‰Agentä¸OpenAI Toolsçš„åŸç†åŸºæœ¬ç›¸åŒï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œå› ä¸ºä¸ä¾èµ–æ¨¡å‹è‡ªèº«ç»è¿‡å¾®è°ƒè€Œè¾“å‡ºå‡½æ•°è°ƒç”¨çš„èƒ½åŠ›ï¼Œç»“æ„åŒ–å¯¹è¯Agenté€šè¿‡**_ å¼•å¯¼å¤§æ¨¡å‹è¾“å‡ºæœ‰æ•ˆçš„ æ ¼å¼åŒ–ï¼ˆæˆ–ç§°åºåˆ—åŒ–ï¼‰å‡½æ•°å‚æ•°_** æ¥è§£æå¹¶è°ƒç”¨å·¥å…·ï¼Œå†å°†ç»“æœåé¦ˆç»™å¤§æ¨¡å‹ï¼Œç”±æ­¤å®Œæˆä¸€æ­¥çš„AgentActionã€‚ é»˜è®¤çš„åºåˆ—åŒ–æ–¹æ³•æ˜¯JSONã€‚ éœ€è¦å¯¼å…¥çš„å¼•ç”¨ï¼š 123from langchain.agents import AgentExecutor, create_structured_chat_agent# åº•å±‚çš„èŠå¤©æ¨¡å‹ä»ç„¶å¯ç”¨ä½¿ç”¨OPENAIæ¨¡å‹from langchain_openai import ChatOpenAI å®ä¾‹åŒ–Agent 12345678910111213141516# å®šä¹‰å¯ç”¨çš„å·¥å…·åˆ—è¡¨ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå¯¼å…¥Langchainå†…ç½®çš„å…¶ä¸­ä¸€ä¸ªç½‘ç»œæœç´¢å·¥å…·from langchain_community.tools.tavily_search import TavilySearchResultstools = [TavilySearchResults(max_results=1)] # é€šå¸¸å·¥å…·å®šä¹‰ä¸ºå…¨å±€å˜é‡def new_structured_chat_agent(): # å®šä¹‰ä¸€ä¸ªæç¤ºè¯ï¼Œå¯è‡ªå®šä¹‰ï¼Œè¿™é‡Œä»ä¸€ä¸ªlangchainä»“åº“ä¸­è·å– from langchain import hub prompt = hub.pull(&quot;hwchase17/structured-chat-agent&quot;) # å®ä¾‹åŒ–ä¸€ä¸ªèŠå¤©æ¨¡å‹å¯¹è±¡ llm = ChatOpenAI(model=&quot;gpt-3.5-turbo&quot;, temperature=0) # å®ä¾‹åŒ–æ™ºèƒ½ä½“å¯¹è±¡ agent = create_structured_chat_agent(llm, tools, prompt)\treturn agent å› ä¸ºéâ€œå·¥å…·è°ƒç”¨â€çš„å¤§æ¨¡å‹å¯èƒ½ä¸æŒ‰ç…§æ ¼å¼åŒ–è¦æ±‚è¾“å‡ºï¼Œåœ¨å®ä¾‹åŒ–Agentæ—¶ï¼Œå¯ä»¥é€šè¿‡å‚æ•°æ§åˆ¶æ˜¯å¦è‡ªåŠ¨å¤„ç†å¯èƒ½çš„è§£æé”™è¯¯ã€‚ 12345678agent = new_structured_chat_agent()# åˆ›å»ºæ™ºèƒ½ä½“æ‰§è¡Œå™¨agent_executor = AgentExecutor( agent=agent, tools=tools, verbose=True, handle_parsing_errors=True)# è¾“å…¥å†…å®¹input = &#123;&quot;input&quot;: &quot;what is LangChain?&quot;&#125;agent_executor.invoke(input) Structured Chat Agentå†…éƒ¨å°†ä¼šä»¥ä¸‹é¢çš„æ–¹å¼è¾“å‡ºå‡½æ•°è°ƒç”¨çš„è¿‡ç¨‹ï¼Œä½†æœ€åè¿”å›ç”¨æˆ·çš„ç»“æœoutputä»ç„¶æ˜¯è‡ªç„¶è¯­è¨€ã€‚ 12&gt; Entering new AgentExecutor chain...Action: { â€œactionâ€: â€œtavily_search_results_jsonâ€, â€œaction_inputâ€: {â€œqueryâ€: â€œLangChainâ€} } 123# è¿™æ˜¯å·¥å…·è°ƒç”¨è¿”å›çš„ç»“æœï¼Œè¿™è¡Œæ³¨é‡Šæ˜¯æ–¹ä¾¿ä½ ç†è§£å†…å®¹çš„ï¼Œå¹¶ä¸åœ¨å®é™…çš„è¾“å‡ºä¸­å‡ºç°[&#123;&#x27;url&#x27;: &#x27;https://www.ibm.com/topics/langchain&#x27;, &#x27;content&#x27;: &#x27;LangChain is essentially a library of abstractions for Python and Javascript...&#x27;&#125;]Action: { â€œactionâ€: â€œFinal Answerâ€, â€œaction_inputâ€: â€œLangChain is an open source orchestration framework â€¦â€ } 123456&gt; Finished chain.&#123;&#x27;input&#x27;: &#x27;what is LangChain?&#x27;, &#x27;output&#x27;: &#x27;LangChain is an open source orchestration framework ....&#x27;&#125; JSON Chat ä¸Structured Chat AgentåŸºæœ¬ä¸€è‡´ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ JSON Chat Agentä»…æ”¯æŒ ä¸€ä¸ªè¾“å…¥å‚æ•° çš„å·¥å…·è°ƒç”¨æƒ…å†µï¼Œå¦‚æœä½ çš„Agentéœ€è¦è°ƒç”¨å«å¤šä¸ªå‚æ•°çš„å·¥å…·ï¼Œè¯·ä½¿ç”¨Structured Chat Agent å¼ºåˆ¶æ¨¡å‹ä½¿ç”¨JSONæ ¼å¼è¾“å‡ºå‡½æ•°è°ƒç”¨å‚æ•°ã€‚é€‚ç”¨äºä¸“é—¨å¯¹JSONæ ¼å¼è¿›è¡Œå¾®è°ƒæˆ–å¼•å¯¼çš„æ¨¡å‹ã€‚ ä½¿ç”¨æ—¶ï¼Œåªéœ€å°†ä¸Šè¿°æ­¥éª¤ä¸­å¯¼å…¥çš„åç§°create_structured_chat_agentæ›¿æ¢ä¸ºcreate_json_chat_agent å¦‚æœè§‚å¯Ÿä¸­é—´è¾“å‡ºï¼Œä¼šå‘ç°JSON Chatä¸Structured Chatçš„åŒºåˆ«æ˜¯åœ¨è¾“å‡ºåºåˆ—åŒ–æ–‡æœ¬æ—¶ä¸å†åŠ å…¥markdownæ ‡è®°ä»£ç æ®µçš„ç¬¦å·``` ```ï¼Œæ•´ä¸ªå¯¹è¯çš„å…¨å±€éƒ½è§†æ–‡æœ¬ä¸ºJSONæ ¼å¼ã€‚ 123from langchain.agents import AgentExecutor, create_json_chat_agent# åº•å±‚çš„èŠå¤©æ¨¡å‹ä»ç„¶å¯ç”¨ä½¿ç”¨OPENAIæ¨¡å‹from langchain_openai import ChatOpenAI åˆ«å¿˜äº†ä»¥ä¸Šæ‰€æœ‰åŸºäºå¯¹è¯æ¨¡å‹çš„Agentéƒ½å¯ä»¥åœ¨è¾“å…¥ä¸­ç®€å•åœ°åŠ å…¥å¯¹è¯å†å²ã€‚ é¢„æœŸç±»å‹æ˜¯çº¯LLMçš„å†…ç½®æ™ºèƒ½ä½“ XML å¯¹XMLç‰¹æ”»ï¼Œè¦æ±‚æ¨¡å‹ä»¥XMLæ ¼å¼è¾“å‡ºå‡½æ•°è°ƒç”¨ä¿¡æ¯ï¼Œé€‚åˆäºæ“…é•¿XMLå¤„ç†çš„æ¨¡å‹ã€‚ä¸**JSON Chat Agentä¸€æ ·ï¼Œä»…æ”¯æŒå•ä¸€å‚æ•°çš„å·¥å…·è°ƒç”¨** éœ€è¦å¯¼å…¥çš„å¼•ç”¨ï¼š 123from langchain.agents import AgentExecutor, create_xml_agent# ä½¿ç”¨ Anthropicâ€™s Claude æ¨¡å‹from langchain_community.chat_models import ChatAnthropic å®ä¾‹åŒ–å¹¶è¿è¡ŒAgent 1234567891011121314151617181920# å®šä¹‰å¯ç”¨çš„å·¥å…·åˆ—è¡¨ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå¯¼å…¥Langchainå†…ç½®çš„å…¶ä¸­ä¸€ä¸ªç½‘ç»œæœç´¢å·¥å…·from langchain_community.tools.tavily_search import TavilySearchResultstools = [TavilySearchResults(max_results=1)] # é€šå¸¸å·¥å…·å®šä¹‰ä¸ºå…¨å±€å˜é‡def new_xml_agent(): # å®šä¹‰ä¸€ä¸ªæç¤ºè¯ï¼Œå¯è‡ªå®šä¹‰ï¼Œè¿™é‡Œä»ä¸€ä¸ªlangchainä»“åº“ä¸­è·å– from langchain import hub prompt = hub.pull(&quot;hwchase17/xml-agent-convo&quot;) # å®ä¾‹åŒ–ä¸€ä¸ªclaude-2æ¨¡å‹æŸ¥è¯¢å¯¹è±¡\tllm = ChatAnthropic(model=&quot;claude-2&quot;) # å®ä¾‹åŒ–æ™ºèƒ½ä½“å¯¹è±¡ aagent = create_xml_agent(llm, tools, prompt)\treturn agentagent = new_xml_agent()agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)agent_executor.invoke(&#123;&quot;input&quot;: &quot;what is LangChain?&quot;&#125;) ä¸­é—´è¾“å‡ºå°†ä¼šç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š 1234567891011&gt; Entering new AgentExecutor chain...&lt;tool&gt;tavily_search_results_json&lt;/tool&gt;&lt;tool_input&gt;what is LangChain? &lt;!--è¿™æ˜¯å·¥å…·è°ƒç”¨è¿”å›çš„ç»“æœï¼Œè¿™è¡Œæ³¨é‡Šæ˜¯æ–¹ä¾¿ä½ ç†è§£å†…å®¹çš„ï¼Œå¹¶ä¸åœ¨å®é™…çš„è¾“å‡ºä¸­å‡ºç°--&gt;[&#123;&#x27;url&#x27;: &#x27;https://aws.amazon.com/what-is/langchain/&#x27;, &#x27;content&#x27;: &#x27;What Is LangChain? ......&#x27;&#125;] &lt;final_answer&gt;LangChain is an open source framework .....&lt;/final_answer&gt;&gt; Finished chain. åº•å±‚ä¸æ˜¯å¯¹è¯æ¨¡å‹çš„æ¥å£ï¼Œå› æ­¤æ¨¡å‹ä¸ä¼šè®¤ä¸ºAgentçš„ä¸€æ¬¡è°ƒç”¨æ˜¯ä¸€åœºå¯¹è¯çš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œä½ ä»ç„¶å¯ä»¥åŠ å…¥â€œå†å²æ¶ˆæ¯â€ï¼Œåªä¸è¿‡éœ€è¦å°†å†å²çš„è¾“å…¥ ä»ä½¿ç”¨å¯¹è¯æ¨¡å‹çš„Messageç±» æ”¹ä¸º è¾“å…¥ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼š 1234567agent_executor.invoke( &#123; &quot;input&quot;: &quot;what&#x27;s my name? Only use a tool if needed, otherwise respond with Final Answer&quot;, # Notice that chat_history is a string, since this prompt is aimed at LLMs, not chat models &quot;chat_history&quot;: &quot;Human: Hi! My name is Bob AI: Hello Bob! Nice to meet you&quot;, &#125;) ReAct ä½¿ç”¨â€œReAct&quot;ç­–ç•¥ï¼Œè€Œä¸æ˜¯æŸç§æ ¼å¼åŒ–æ–‡æœ¬æ¥å¼•å¯¼Agentæ‰§è¡Œå‡½æ•°è°ƒç”¨ï¼Œå…·ä½“å‚è§ï¼šReActè®ºæ–‡ ä½¿ç”¨æ–¹æ³•å’ŒJSON Chat Agentä»¥åŠ XML Agentä¸€è‡´ï¼ŒåŒæ ·ï¼Œè®©ReAct**è°ƒç”¨çš„æ¯ä¸ªå·¥å…·åªèƒ½å«æœ‰å•ä¸€å‚æ•°** éœ€è¦å¯¼å…¥çš„å¼•ç”¨ 123from langchain.agents import AgentExecutor, create_react_agent# æ³¨æ„ä½¿ç”¨éèŠå¤©Chatçš„æ¨¡å‹from langchain_openai import OpenAI å®ä¾‹åŒ–å¹¶è¿è¡ŒAgent 1234567891011121314151617181920# å®šä¹‰å¯ç”¨çš„å·¥å…·åˆ—è¡¨ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå¯¼å…¥Langchainå†…ç½®çš„å…¶ä¸­ä¸€ä¸ªç½‘ç»œæœç´¢å·¥å…·from langchain_community.tools.tavily_search import TavilySearchResultstools = [TavilySearchResults(max_results=1)] # é€šå¸¸å·¥å…·å®šä¹‰ä¸ºå…¨å±€å˜é‡def new_react_agent(): # å®šä¹‰ä¸€ä¸ªæç¤ºè¯ï¼Œå¯è‡ªå®šä¹‰ï¼Œè¿™é‡Œä»ä¸€ä¸ªlangchainä»“åº“ä¸­è·å– from langchain import hub prompt = hub.pull(&quot;hwchase17/react&quot;) # å®ä¾‹åŒ–ä¸€ä¸ªæ¨¡å‹å¯¹è±¡\tllm = OpenAI() # å®ä¾‹åŒ–æ™ºèƒ½ä½“å¯¹è±¡ agent = create_react_agent(llm, tools, prompt)\treturn agentagent = new_react_agent()agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)agent_executor.invoke(&#123;&quot;input&quot;: &quot;what is LangChain?&quot;&#125;) ä¸­é—´è¾“å‡ºå°†ä¼šç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š 123456789101112131415161718192021&gt; Entering new AgentExecutor chain...I should research LangChain to learn more about it.Action: tavily_search_results_jsonAction Input: &quot;LangChain&quot;# è¿™æ˜¯å·¥å…·è°ƒç”¨è¿”å›çš„ç»“æœï¼Œè¿™è¡Œæ³¨é‡Šæ˜¯æ–¹ä¾¿ä½ ç†è§£å†…å®¹çš„ï¼Œå¹¶ä¸åœ¨å®é™…çš„è¾“å‡ºä¸­å‡ºç°[&#123;&#x27;url&#x27;: &#x27;https://www.ibm.com/topics/langchain&#x27;, &#x27;content&#x27;: &#x27;LangChain is essentially a library of .....&#x27;&#125;] I should read the summary and look at the different features and integrations of LangChain.Action: tavily_search_results_jsonAction Input: &quot;LangChain features and integrations&quot;[&#123;&#x27;url&#x27;: &#x27;https://www.ibm.com/topics/langchain&#x27;, &#x27;content&#x27;: &quot;LangChain provides integrations for over 25 different embedding methods .....&quot;&#125;] I should take note of the launch date and popularity of LangChain.Action: tavily_search_results_jsonAction Input: &quot;LangChain launch date and popularity&quot;[&#123;&#x27;url&#x27;: &#x27;https://www.ibm.com/topics/langchain&#x27;, &#x27;content&#x27;: &quot;LangChain is an open source orchestration framework for .....&quot;&#125;] I now know the final answer.Final Answer: LangChain is an open source orchestration framework for building applications using large language models (LLMs) like chatbots and virtual agents .....&gt; Finished chain. ä»¥é˜²ä½ æ²¡æœ‰å»çœ‹ReActçš„è®ºæ–‡ï¼Œç®€å•è§£é‡Šæ˜¯ï¼Œè¿™é‡ŒAgentçš„æ¯ä¸ªåŠ¨ä½œè¦æ±‚LLMè¾“å‡ºä¸‰è¡Œæ–‡æœ¬ï¼š ç¬¬ä¸€è¡Œï¼šè§£é‡Šä½ è¦é‡‡å–çš„è¡ŒåŠ¨ ç¬¬äºŒè¡Œï¼šé€‰æ‹©ä¸€ä¸ªè¦ä½¿ç”¨çš„å·¥å…·å‡½æ•°çš„åç§° ç¬¬ä¸‰è¡Œï¼šç»™å‡ºä½¿ç”¨è¿™ä¸ªå·¥å…·çš„è¾“å…¥å‚æ•° Self Ask With Search è¿™æ˜¯ä¸€ä¸ªç®€å•çš„åŒ…è£…ï¼Œä»…ä»…è®©æ¨¡å‹æ‰§è¡Œä¸€ä¸ªç®€å•çš„ç½‘ç»œæœç´¢æ­¥éª¤ã€‚ è¿™ä¸ªç±»ç”¨æ¥å¸®åŠ©å¼€å‘è€…ç†Ÿæ‚‰å¦‚ä½•è‡ªå®šä¹‰æ„å»ºä¸€ä¸ªAgentï¼Œä¹Ÿé€‚ç”¨äºéå¸¸å°çš„æ¨¡å‹ï¼Œæ‰§è¡Œç®€å•å’Œè½»é‡åŒ–çš„æœç´¢ä»»åŠ¡æ—¶ä½¿ç”¨ã€‚ ä½¿ç”¨æ­¤Agentæ—¶ï¼Œåªå…è®¸å®šä¹‰å”¯ä¸€çš„å·¥å…·ï¼Œè¯¥å·¥å…·çš„åç§°ï¼ˆnameå­—æ®µï¼‰å¿…é¡»æ˜¯&quot;Intermediate Answer&quot;ï¼Œè¿”å›å°½å¯èƒ½ç²¾ç®€çš„æœç´¢ç»“æœï¼ŒAgentè´Ÿè´£ä»ä¸­å¯»æ‰¾å’Œæ€»ç»“å‡ºä¸€ä¸ªæœ€ä½³çš„ç­”æ¡ˆã€‚ 123456789101112131415161718192021222324from langchain.agents import AgentExecutor, create_self_ask_with_search_agentfrom langchain_community.llms import Fireworksfrom langchain_community.tools.tavily_search import TavilyAnswer# TavilyAnswerå·¥å…·ç±»åªä¼šè¿”å›ç²¾ç®€çš„æœç´¢ç»“æœï¼Œè®°å¾—å°†å…¶å‘½åä¸º&quot;Intermediate Answer&quot;# toolsæ•°ç»„é‡Œåªèƒ½æœ‰ä¸€ä¸ªè¿™æ ·çš„å·¥å…·tools = [TavilyAnswer(max_results=1, name=&quot;Intermediate Answer&quot;)]def new_self_ask_with_search_agent(): # å®šä¹‰ä¸€ä¸ªæç¤ºè¯ï¼Œå¯è‡ªå®šä¹‰ï¼Œè¿™é‡Œä»ä¸€ä¸ªlangchainä»“åº“ä¸­è·å– from langchain import hub prompt = hub.pull(&quot;hwchase17/self-ask-with-search&quot;) # å®ä¾‹åŒ–ä¸€ä¸ªæ¨¡å‹å¯¹è±¡\tllm = Fireworks() # å®ä¾‹åŒ–æ™ºèƒ½ä½“å¯¹è±¡ agent = create_self_ask_with_search_agent(llm, tools, prompt)\treturn agentagent = new_self_ask_with_search_agent()agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)agent_executor.invoke(&#123;&quot;input&quot;: &quot;what is LangChain?&quot;&#125;) å·¥å…·ç±»ï¼šTool å·¥å…·æ˜¯æ™ºèƒ½ä½“å¯ä»¥è°ƒç”¨çš„å‡½æ•°ã€‚ Tool è¢«æŠ½è±¡ä¸ºä¸¤ä¸ªç»„ä»¶ï¼š input schemaï¼šå‘Šè¯‰LLMè°ƒç”¨è¯¥å·¥å…·éœ€è¦å“ªäº›å‚æ•°ï¼Œéœ€è¦ä¸ºæ¯ä¸ªå‚æ•°å®šä¹‰åˆç†çš„å‘½ååŠæè¿°ï¼Œå®ƒä»¬å°†è¢«LangChainåµŒå…¥è¿›Agentçš„promptä¸­ã€‚ functionï¼šå®é™…è¦è¿è¡Œçš„å‡½æ•°ï¼Œé€šå¸¸ç±»å‹å³ä¸ºä¸€ä¸ªpythonå‡½æ•°ã€‚ å·¥å…·çš„ä½¿ç”¨å’Œå®ç° Langchainå†…ç½®å·¥å…· åœ¨è¿™é‡ŒæŸ¥çœ‹ç›®å‰çš„å†…ç½®å·¥å…·å’Œå®ƒä»¬çš„ä½¿ç”¨æ–¹æ³•ï¼šhttps://python.langchain.com/docs/integrations/tools æ­¥éª¤ï¼šã€ä»¥ä½¿ç”¨WikipediaæŸ¥è¯¢å·¥å…·ä¸ºä¾‹ã€‘ é¦–å…ˆå¯¼å…¥Pythonåç§°ï¼Œéƒ¨åˆ†å·¥å…·ä¾èµ–äºç¬¬ä¸‰æ–¹pythonåº“æˆ–æ’ä»¶ï¼Œéœ€è¦å…ˆå®‰è£…å®ƒä»¬ï¼š %pip install --upgrade --quiet wikipedia å¯¼å…¥åç§°æ—¶ï¼Œè¯·å‚è€ƒå„å·¥å…·çš„æ–‡æ¡£ï¼Œç¡®ä¿ä»æ­£ç¡®çš„åº“è·¯å¾„å¯¼å…¥ã€‚ éƒ¨åˆ†å·¥å…·çš„ä½¿ç”¨å¯èƒ½è¿˜éœ€è¦å¯¼å…¥ä¸ºäº†è°ƒç”¨è¯¥å·¥å…·è€Œç¼–å†™çš„é¢å¤–æ¨¡å—ï¼ˆå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºï¼‰ æ›´ä¸ºç¹ççš„å¯èƒ½éœ€è¦åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šé…ç½®æœåŠ¡ï¼Œæˆ–å‰å¾€ç¬¬ä¸‰æ–¹å¹³å°é…ç½®å¯†é’¥ç­‰ï¼Œè¯·å‚è€ƒå…·ä½“çš„å†…ç½®å·¥å…·ä½¿ç”¨æ–‡æ¡£ from langchain.tools import WikipediaQueryRun from langchain_community.utilities import WikipediaAPIWrapper è¿™é‡Œå°±éœ€è¦ä¸€ä¸ªåŒ…è£…ç»´åŸºç™¾ç§‘APIè°ƒç”¨çš„æ¨¡å— åšå¥½äº†è¿™äº›ä»¥åï¼Œå¯ä»¥å®ä¾‹åŒ–ç”Ÿæˆå·¥å…·å¯¹è±¡ wikipedia_tool = WikipediaQueryRun(api_wrapper=WikipediaAPIWrapper()) å¦‚æœä½ ä¸çŸ¥é“ä¸€ä¸ªå†…ç½®å·¥å…·çš„å…·ä½“å®šä¹‰ï¼Œå¯ä»¥è°ƒè¯•å¦‚ä¸‹åŸºæœ¬å±æ€§ï¼ˆä¸‹é¢ä»¥toolä¸ºä¾‹ï¼‰ï¼š tool.nameåç§°ï¼šå­—ç¬¦ä¸²ï¼Œå®šä¹‰å·¥å…·çš„åç§°ï¼Œå¯ä»¥åœ¨å®ä¾‹åŒ–æ—¶æŒ‡å®š tool.descriptionæè¿°ï¼šå­—ç¬¦ä¸²ï¼Œæè¿°å·¥å…·çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨å®ä¾‹åŒ–æ—¶æŒ‡å®š tool.argså‚æ•°ï¼šé»˜è®¤ä½¿ç”¨JSONæ ¼å¼ï¼ˆå³pythonå­—å…¸å¯¹è±¡ï¼‰ï¼Œæ¯ä¸€æ¡å‚æ•°çš„å½¢å¼ä¸º&lt;å‚æ•°å&gt;ï¼š&#123;'title': &lt;å‚æ•°æ ‡é¢˜&gt;ï¼Œ'description':&lt;å‚æ•°æè¿°&gt;, 'type': &lt;å‚æ•°ç±»å‹&gt;&#125;ï¼Œå…¶ä¸­å‚æ•°åæ˜¯å”¯ä¸€çš„keyï¼Œå‚æ•°æ ‡é¢˜å’Œæè¿°æ˜¯å¯é€‰çš„ï¼Œæé«˜å¼€å‘æ—¶çš„å¯è¯»æ€§ï¼Œä¾‹å¦‚ï¼š &#123;'query': &#123;'title': 'Query', 'type': 'string'&#125;&#125; return_directï¼šå¸ƒå°”å˜é‡ï¼Œå®šä¹‰å‡½æ•°çš„è¾“å‡ºæ˜¯å¦æ˜¯ç›´æ¥è¿”å›ç»™ç”¨æˆ·çš„å†…å®¹ å¦‚æœä¸€ä¸ªå·¥å…·åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨tool.run(&lt;å‚æ•°&gt;)è°ƒç”¨å·¥å…·ï¼Œå¦åˆ™ï¼Œè°ƒç”¨å·¥å…·æ—¶ä¼ å…¥å®Œæ•´çš„å‚æ•°å­—å…¸ï¼Œæ ¼å¼ä¸º&#123;&lt;å‚æ•°å&gt;: &lt;å‚æ•°å€¼&gt;&#125;ï¼Œä¾‹å¦‚ï¼š tool.run(&#123;&quot;query&quot;:&quot;langchain&quot;&#125;) è‡ªå®šä¹‰å·¥å…· åˆ›å»ºè‡ªå®šä¹‰å·¥å…·æœ‰å¤šç§æ–¹æ³•ï¼Œå¯èƒ½ä¼šéœ€è¦å¯¼å…¥å¦‚ä¸‹çš„åŒ…ï¼š 12from langchain.pydantic_v1 import BaseModel, Fieldfrom langchain.tools import BaseTool, StructuredTool, tool ä½¿ç”¨@tool è£…é¥°å™¨ æœ€ç®€å•çš„æ–¹æ³•ï¼Œåªéœ€è¦åœ¨å‡½æ•°å®šä¹‰å‰åŠ ä¸Š@toolä¿®é¥°ç¬¦ ä¼šé»˜è®¤ä½¿ç”¨å‡½æ•°åç§°ä½œä¸ºå·¥å…·åç§°ï¼Œä½†å¯ä»¥é€šè¿‡ä¼ é€’å­—ç¬¦ä¸²ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°æ¥è¦†ç›–æ­¤åç§°ã€‚ å‡½æ•°éœ€è¦å…·æœ‰ä¸€ä¸ªpythoné£æ ¼çš„docstringï¼Œè¿™å°†æˆä¸º@toolä¿®é¥°ç¬¦ç”Ÿæˆçš„å·¥å…·çš„æè¿°ã€‚ ä¾‹å¦‚ï¼š 12345678910111213@tooldef multiply(a: int, b: int) -&gt; int: &quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot; # è¿™ä¸ªå°±æ˜¯docstring return a * bprint(multiply.name)print(multiply.description)print(multiply.args)## è¾“å‡ºå¦‚ä¸‹ï¼šmultiplymultiply(a: int, b: int) -&gt; int - Multiply two numbers.&#123;&#x27;a&#x27;: &#123;&#x27;title&#x27;: &#x27;A&#x27;, &#x27;type&#x27;: &#x27;integer&#x27;&#125;, &#x27;b&#x27;: &#123;&#x27;title&#x27;: &#x27;B&#x27;, &#x27;type&#x27;: &#x27;integer&#x27;&#125;&#125; è¦†ç›–å®šä¹‰å·¥å…·å±æ€§çš„ä¾‹å­ï¼š 1234567891011121314151617181920# è¿™ä¸ªç±»å®šä¹‰äº†ä¸€ä¸ªå‚æ•°è¾“å…¥çš„åŸºæœ¬æ¨¡å¼ï¼Œç”¨æ¥è¦†ç›–åŸå‡½æ•°å®šä¹‰çš„å‚æ•°class SearchInput(BaseModel): query: str = Field(description=&quot;should be a search query&quot;)# è¦†ç›–äº†å·¥å…·çš„åç§°ï¼Œå‚æ•°ï¼ˆä½¿ç”¨è‡ªå®šä¹‰çš„SearchInputï¼‰å’Œreturn_directå±æ€§@tool(&quot;search-tool&quot;, args_schema=SearchInput, return_direct=True)def search(query: str) -&gt; str: &quot;&quot;&quot;Look up things online.&quot;&quot;&quot; return &quot;LangChain&quot;print(search.name)print(search.description)print(search.args)print(search.return_direct)## è¾“å‡ºå¦‚ä¸‹ï¼šsearch-toolsearch-tool(query: str) -&gt; str - Look up things online.&#123;&#x27;query&#x27;: &#123;&#x27;title&#x27;: &#x27;Query&#x27;, &#x27;description&#x27;: &#x27;should be a search query&#x27;, &#x27;type&#x27;: &#x27;string&#x27;&#125;&#125;True ç»§æ‰¿BaseToolå­ç±» å­ç±»åŒ–BaseToolç±»æ¥æ˜¾å¼å®šä¹‰è‡ªå®šä¹‰å·¥å…· è‡ªç”±åº¦æœ€é«˜ï¼Œä½†éœ€è¦æ›´å¤šçš„ä»£ç é‡ éœ€è¦å…ˆç»§æ‰¿BaseModelå®šä¹‰å·¥å…·éœ€è¦ä¼ å…¥çš„å‚æ•°ï¼Œç„¶åç»§æ‰¿BaseToolå®šä¹‰å·¥å…·çš„å…¶ä»–å±æ€§ ä¸¾ä¸ªä¾‹å­ï¼šè¿˜æ˜¯ä¹˜æ³•è®¡ç®—å™¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546from typing import Optional, Typefrom langchain.callbacks.manager import ( AsyncCallbackManagerForToolRun, CallbackManagerForToolRun,)# å®šä¹‰Input Modelæ—¶ï¼Œå‚æ•°åç§°ä¸ºå˜é‡åï¼Œå‚æ•°ç±»å‹æ˜¾ç¤ºæŒ‡å®šï¼Œä½¿ç”¨ä¸€ä¸ªFieldå¯¹è±¡å®šä¹‰å¯é€‰çš„å±æ€§ï¼ˆæ ‡é¢˜ï¼Œæè¿°ç­‰ï¼‰class CalculatorInput(BaseModel): a: int = Field(description=&quot;first number&quot;) b: int = Field(description=&quot;second number&quot;)class CustomCalculatorTool(BaseTool): # å®šä¹‰å·¥å…·çš„åŸºæœ¬å±æ€§ name = &quot;Calculator&quot; description = &quot;useful for when you need to answer questions about math&quot; args_schema: Type[BaseModel] = CalculatorInput # è®¾ç½®å‚æ•°æ—¶éœ€è¦æ˜¾ç¤ºæŒ‡å®šç±»å‹ return_direct: bool = True # é‡å†™runå‡½æ•°ï¼Œå®ç°å·¥å…·çš„æ‰§è¡Œ def _run( self, a: int, b: int, run_manager: Optional[CallbackManagerForToolRun] = None ) -&gt; str: &quot;&quot;&quot;Use the tool.&quot;&quot;&quot; return a * b # é‡å†™_arunå‡½æ•°ï¼Œå®ç°å·¥å…·çš„å¼‚æ­¥æ‰§è¡Œ # å¦‚æœå·¥å…·ä¸éœ€è¦å¼‚æ­¥æ‰§è¡Œï¼Œå¯ä»¥ç›´æ¥è¿”å›å¼‚å¸¸ async def _arun( self, a: int, b: int, run_manager: Optional[AsyncCallbackManagerForToolRun] = None, ) -&gt; str: &quot;&quot;&quot;Use the tool asynchronously.&quot;&quot;&quot; raise NotImplementedError(&quot;Calculator does not support async&quot;)# å®ä¾‹åŒ–ä¸€ä¸ªè‡ªå®šä¹‰å·¥å…·search = CustomSearchTool()print(search.name)print(search.args)## è¾“å‡ºå¦‚ä¸‹ï¼šCalculator&#123;&#x27;a&#x27;: &#123;&#x27;title&#x27;: &#x27;A&#x27;, &#x27;description&#x27;: &#x27;first number&#x27;, &#x27;type&#x27;: &#x27;integer&#x27;&#125;, &#x27;b&#x27;: &#123;&#x27;title&#x27;: &#x27;B&#x27;, &#x27;description&#x27;: &#x27;second number&#x27;, &#x27;type&#x27;: &#x27;integer&#x27;&#125;&#125;True ç»§æ‰¿ StructuredTool æ•°æ®ç±» ç›¸å½“äºæ··åˆäº†å‰ä¸¤ç§æ–¹æ³•ã€‚ æœ‰ä¸€å®šçš„è‡ªç”±åº¦ï¼ŒåŒæ—¶å†™æ³•ç®€å•ã€‚ å…ˆå®šä¹‰å¥½ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åä½¿ç”¨StructuredTool.from_functionæ–¹æ³•ï¼Œä¼ å…¥å·¥å…·çš„å±æ€§å³å¯ã€‚ ä¸¾ä¾‹ï¼š 1234567891011# å·¥å…·è¦æ‰§è¡Œçš„å‡½æ•°def search_function(query: str): return &quot;LangChain&quot;# å·¥å…·å‚æ•°ä¼šé»˜è®¤è®¾ä¸ºå‡½æ•°å‚æ•°search = StructuredTool.from_function( func=search_function, name=&quot;Search&quot;, description=&quot;useful for when you need to answer questions about current events&quot;, # coroutine= ... &lt;- åŒæ ·å¯ä»¥æŒ‡å®šå¼‚æ­¥æ‰§è¡Œçš„æ–¹æ³•) å¦‚æœéœ€è¦è‡ªå®šä¹‰å‚æ•°è¦†ç›–å‡½æ•°çš„å‚æ•°ï¼Œå¯ä»¥æŒ‡å®šargs_schema: 123456789101112131415161718# è‡ªå®šä¹‰å‚æ•°ç±»class CalculatorInput(BaseModel): a: int = Field(description=&quot;first number&quot;) b: int = Field(description=&quot;second number&quot;)# å·¥å…·è¦æ‰§è¡Œçš„å‡½æ•°def multiply(a: int, b: int) -&gt; int: &quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot; return a * bcalculator = StructuredTool.from_function( func=multiply, name=&quot;Calculator&quot;, description=&quot;multiply numbers&quot;, args_schema=CalculatorInput, return_direct=True, # coroutine= ... &lt;- åŒæ ·å¯ä»¥æŒ‡å®šå¼‚æ­¥æ‰§è¡Œçš„æ–¹æ³•) é”™è¯¯å¤„ç† å¦‚æœå·¥å…·æ‰§è¡Œå‡½æ•°çš„è¿‡ç¨‹ç§é‡åˆ°å¼‚å¸¸å¹¶è¿”å›ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ™ºèƒ½ä½“ä¼šç»ˆæ­¢å½“å‰ä»»åŠ¡ã€‚ å¦‚æœå¸Œæœ›æ™ºèƒ½ä½“åœ¨é‡åˆ°æŸäº›å½±å“ä¸å¤§çš„å¼‚å¸¸åä¹Ÿå¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œéœ€è¦åœ¨å‡½æ•°æ‰§è¡Œä½“å†…æŠ›å‡ºToolException å¹¶ç›¸åº”åœ°è®¾ç½® handle_tool_error ã€‚ å½“å·¥å…·æŠ›å‡º ToolException æ—¶ï¼Œä»£ç†ä¸ä¼šåœæ­¢å·¥ä½œï¼Œè€Œæ˜¯æ ¹æ®å·¥å…·çš„å¼‚å¸¸å¤„ç†å‡½æ•°handle_tool_errorå¤„ç†å¼‚å¸¸ï¼Œå¤„ç†ç»“æœå°†ä½œä¸ºè§‚å¯Ÿè¿”å›ç»™ä»£ç†ï¼Œå¹¶ä»¥çº¢è‰²æ‰“å°ã€‚ 123456789101112131415from langchain_core.tools import ToolExceptiondef search_tool1(s: str): raise ToolException(&quot;The search tool1 is not available.&quot;)search = StructuredTool.from_function( func=search_tool1, name=&quot;Search_tool1&quot;, description=&quot;A bad tool&quot;, handle_tool_error=True, # æ·»åŠ å¼‚å¸¸å¤„ç†å±æ€§æ ‡è®°)search.run(&quot;test&quot;) ### è¾“å‡ºï¼š&#x27;The search tool1 is not available.&#x27; å¦‚æœåªæŠ›å‡ºäº†ToolException å¼‚å¸¸è€Œæ²¡æœ‰å®šä¹‰ handle_tool_errorå±æ€§ï¼Œåˆ™LangChainä»ç„¶ä¸ä¼šè®©æ™ºèƒ½ä½“å¤„ç†å¼‚å¸¸ã€‚ å½“handle_tool_errorå±æ€§ä»…å®šä¹‰ä¸ºTrueè€Œä¸æ˜¯å¼‚å¸¸å¤„ç†å‡½æ•°æ—¶ï¼ŒLangChainä¼šå°†å¼‚å¸¸å­—ç¬¦ä¸²ä½œä¸ºå¤„ç†ç»“æœè¿”å›ç»™æ™ºèƒ½ä½“ã€‚ handle_tool_errorå±æ€§å®šä¹‰ä¸ºä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå…¶éœ€è¦æ¥å—ToolExceptionç±»å‹çš„å¼‚å¸¸å¯¹è±¡ï¼Œå¹¶è¿”å›å­—ç¬¦ä¸²ã€‚ 123456789101112131415161718192021def _handle_error(error: ToolException) -&gt; str: return ( &quot;The following errors occurred during tool execution:&quot; + error.args[0] + &quot;Please try another tool.&quot; )search = StructuredTool.from_function( func=search_tool1, name=&quot;Search_tool1&quot;, description=&quot;A bad tool&quot;, handle_tool_error=_handle_error,)search.run(&quot;test&quot;)### è¾“å‡ºï¼š&#x27;&#x27;&#x27;The following errors occurred during tool execution:The search tool1 is not available. Please try another tool.&#x27;&#x27;&#x27; åœ¨OPENAIèŠå¤©æ¨¡å‹ä¸­ä½¿ç”¨å·¥å…· å¦‚æœä½ åªæ˜¯éœ€è¦ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œæˆ–æ˜¯è§‰å¾—LangChainä¸­çš„å†…ç½®å·¥å…·å¾ˆå¥½ç”¨ï¼Œä½†ä¸éœ€è¦ä¸€ä¸ªæ™ºèƒ½ä½“æ¥å†³å®šå·¥å…·çš„è°ƒç”¨ï¼Œå¯ä»¥å°†å·¥å…·è°ƒç”¨æ˜¾å¼åœ°åµŒå…¥ChatOpenAIèŠå¤©æ¨¡å‹çš„æç¤ºä¸­ï¼š 1234567891011from langchain.schema import HumanMessagefrom langchain_openai import ChatOpenAIfrom langchain.tools import MoveFileTool, format_tool_to_openai_functionmodel = ChatOpenAI(model=&quot;gpt-3.5-turbo-0613&quot;)tools = [MoveFileTool()]functions = [format_tool_to_openai_function(t) for t in tools]message = model.predict_messages( [HumanMessage(content=&quot;move file foo to bar&quot;)], functions=functions) è‡ªå®šä¹‰æ™ºèƒ½ä½“ æ™ºèƒ½ä½“å…¶å®åªæ˜¯ä¸€ä¸ªå¸¦æœ‰ å·¥å…·è°ƒç”¨å’Œè®°å¿†çš„ LLMæŸ¥è¯¢æˆ–å¯¹è¯ç³»ç»Ÿï¼Œåœ¨åº•å±‚å®Œå…¨å¯ä»¥ä½¿ç”¨LangChainçš„ICLEè¯­æ³•ï¼ˆå³â€œé“¾â€ï¼‰æ¥å®ç°ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ChatOpenAIä½œä¸ºåŸºç¡€å¯¹è¯æ¨¡å‹æ¥å®ç°è‡ªå®šä¹‰æ™ºèƒ½ä½“ã€‚ å…ˆå®šä¹‰å¥½è¦ä½¿ç”¨çš„æ¨¡å‹å’Œå·¥å…· åœ¨å¯¹LLMæç¤ºçš„æ—¶å€™ï¼Œè®°å¾—åŠ ä¸ŠMessagesPlaceholder,ä»¥å®ç°å’Œæ™ºèƒ½ä½“çš„å¯¹è¯å…·æœ‰å†å²è®°å¿†èƒ½åŠ›ã€‚ 123456789101112131415161718192021222324252627282930from langchain_openai import ChatOpenAIfrom langchain.agents import toolfrom langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholderfrom langchain_core.messages import AIMessage, HumanMessagefrom langchain_community.tools.convert_to_openai import format_tool_to_openai_function@tooldef get_word_length(word: str) -&gt; int: &quot;&quot;&quot;Returns the length of a word.&quot;&quot;&quot; return len(word)tools = [get_word_length] # å®šä¹‰å·¥å…·chat_history = [] # è®°å½•å†å²llm = ChatOpenAI(model=&quot;gpt-3.5-turbo&quot;, temperature=0) # å®šä¹‰llm# å°†å·¥å…·ç»‘å®šåˆ°llmllm_with_tools = llm.bind(functions=[format_tool_to_openai_function(t) for t in tools])MEMORY_KEY = &quot;chat_history&quot;prompt = ChatPromptTemplate.from_messages( [ ( &quot;system&quot;, &quot;You are very powerful assistant, but bad at calculating lengths of words.&quot;, ), MessagesPlaceholder(variable_name=MEMORY_KEY), (&quot;user&quot;, &quot;&#123;input&#125;&quot;), MessagesPlaceholder(variable_name=&quot;agent_scratchpad&quot;), ]) ç„¶åï¼Œä»langchain.agents.format_scratchpadåŒ…ä¸­å¯¼å…¥è‡ªå®šä¹‰åˆ›å»ºæ™ºèƒ½ä½“çš„åŸºç¡€ç±»å‹ã€‚ è¿™é‡Œï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å°†å‡½æ•°è°ƒç”¨è½¬åŒ–ä¸ºOPENAI apiçš„å½¢å¼ï¼Œæ‰€ä»¥å¯¼å…¥format_to_openai_function_messageså‡½æ•°ï¼Œå¹¶åŒæ—¶å¯¼å…¥OpenAIFunctionsAgentOutputParseræ¥è§£æOPENAI æ¨¡å‹è¿”å›çš„è¾“å‡ºã€‚ ä½¿ç”¨é“¾å¼æ–¹æ³•åˆ›å»ºæ™ºèƒ½ä½“ï¼Œé€šå¸¸ä¸€ä¸ªé“¾æ¡çš„æ„æˆæ˜¯ï¼š è¾“å…¥ï¼šå³æ ¸å¿ƒæ¦‚å¿µä¸­çš„AgentActionï¼Œå°†â€œç”¨æˆ·è¾“å…¥â€ï¼Œâ€œä¸­é—´æ­¥éª¤â€å’Œâ€œå†å²â€ä¸‰ä¸ªéƒ¨åˆ†æŒ‰ç…§å­—å…¸é”®å€¼å¯¹çš„æ ¼å¼é…ç½®ã€‚ å¿…è¦çš„æ—¶å€™ï¼ˆå¦‚ä½¿ç”¨OPENAI apiçš„å·¥å…·è°ƒç”¨ï¼‰ï¼Œè¦å°†è¾“å…¥è½¬åŒ–ä¸ºæ¨¡å‹æ¥å£æ”¯æŒçš„æ ¼å¼ã€‚ æç¤ºï¼šæŒ‰ç…§å·²å®šä¹‰å¥½çš„æç¤ºæ¨¡æ¿ å·²ç»‘å®šå¥½å·¥å…·çš„LLMå¯¹è±¡æˆ–èŠå¤©æ¨¡å‹å¯¹è±¡ è§£æè¾“å‡ºçš„å¯¹è±¡ï¼Œæ ¹æ®ä½ æŸ¥è¯¢çš„æ¨¡å‹å†³å®šã€‚ 123456789101112131415from langchain.agents.format_scratchpad import format_to_openai_function_messagesfrom langchain.agents.output_parsers import OpenAIFunctionsAgentOutputParseragent = ( &#123; &quot;input&quot;: lambda x: x[&quot;input&quot;], &quot;agent_scratchpad&quot;: lambda x: format_to_openai_function_messages( x[&quot;intermediate_steps&quot;] ), &quot;chat_history&quot;: lambda x: x[&quot;chat_history&quot;], &#125; | prompt | llm_with_tools | OpenAIFunctionsAgentOutputParser()) æœ€åï¼Œåˆ›å»ºä¸€ä¸ªæ™ºèƒ½ä½“æ‰§è¡Œå™¨ï¼Œé…ç½®å¥½è¾“å…¥å’Œå†å²å³å¯æ‰§è¡Œï¼š 1234567891011121314151617from langchain.agents import AgentExecutoragent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)input1 = &quot;how many letters in the word educa?&quot;result = agent_executor.invoke(&#123;&quot;input&quot;: input1, &quot;chat_history&quot;: chat_history&#125;)chat_history.extend( [ HumanMessage(content=input1), AIMessage(content=result[&quot;output&quot;]), ])input2 = &quot;is that a real word?&quot;agent_executor.invoke(&#123;&quot;input&quot;: input2, &quot;chat_history&quot;: chat_history&#125;)... AgentExecutor çš„é¢å¤–å‚æ•° verbose=Trueï¼šæ˜¯å¦è¾“å‡ºè¯¦ç»†æ‰§è¡Œä¿¡æ¯ max_iterations=10ï¼šé™åˆ¶æœ€å¤§è¿­ä»£æ¬¡æ•° max_execution_time=10ï¼šé™åˆ¶æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼ˆç§’ï¼‰ handle_parsing_errors=Trueï¼šæ˜¯å¦è‡ªåŠ¨å¤„ç†è§£æé”™è¯¯ï¼ˆè§ä¸‹é¢çš„å°èŠ‚) handle_parsing_errors=&quot;...&quot;ï¼šå¤„ç†è§£æé”™è¯¯ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ï¼ˆè§ä¸‹é¢çš„å°èŠ‚) æ™ºèƒ½ä½“æ‰§è¡Œçš„ç›‘ç£å’Œæ£€æŸ¥ æŒ‰æ­¥éª¤æ‰§è¡Œ è°ƒç”¨AgentExecutorç±»å¯¹è±¡çš„iterå‡½æ•°ï¼Œè·å¾—æ¯ä¸€ä¸ªä¸­é—´æ­¥éª¤çš„è¿­ä»£å™¨ã€‚ç”±æ­¤ï¼Œå¯ä»¥è‡ªç”±æ§åˆ¶æ‰§è¡Œå“ªäº›æ­¥éª¤ï¼Œå¹¶éšæ—¶å¯ä»¥æ’å…¥å…¶ä»–åŠŸèƒ½çš„ä»£ç ã€‚ 123456789101112131415question = &quot;What is the product of the 998th, 999th and 1000th prime numbers?&quot;for step in agent_executor.iter(&#123;&quot;input&quot;: question&#125;): # è¿™ç§å†™æ³•ç­‰ä»·äº: # output = step.get(&quot;intermediate_step&quot;) # if output: if output := step.get(&quot;intermediate_step&quot;): action, value = output[0] if action.tool == &quot;GetPrime&quot;: print(f&quot;Used Tool GetPrimeï¼Œget numberï¼š &#123;value&#125; ...&quot;) assert is_prime(int(value)) # è¯¢é—®æ§åˆ¶å°ç”¨æˆ·æ˜¯å¦ç»§ç»­Agentæ‰§è¡Œ _continue = input(&quot;Should the agent continue (Y/n)?: &quot;) or &quot;Y&quot; if _continue.lower() != &quot;y&quot;: break è·å¾—ä¸­é—´æ­¥éª¤çš„æ—¥å¿— æ™ºèƒ½ä½“æ‰§è¡Œå®Œæ¯•åï¼Œagent_executor.invokeä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰æ‰§è¡Œå†å²çš„æƒ…å†µï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š 12345response = agent_executor.invoke(&#123;&quot;input&quot;: &quot;What is Leo DiCaprio&#x27;s middle name?&quot;&#125;)print(response.keys())# TODO è¦è·å¾—æ¯ä¸€ä¸ªä¸­é—´æ­¥éª¤çš„è¯¦ç»†æƒ…å†µï¼Œè·å–response[&quot;intermediate_steps&quot;]å³å¯ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«ä¸¤ä¸ªå¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯ï¼š ä¸€ä¸ªAgentActionMessageLogå¯¹è±¡ï¼Œè®°å½•å½“å‰æ­¥éª¤è°ƒç”¨å·¥å…·çš„è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬å·¥å…·åç§°ï¼Œå‚æ•°ï¼Œæ—¥å¿—å­—ç¬¦ä¸²ï¼Œå®é™…åµŒå…¥LLMæç¤ºä¸­çš„AIMessageå¯¹è±¡ç­‰ï¼‰ å¦‚æœæ­¥éª¤æ˜¯â€œè¾“å‡ºç»“æœè¿”å›ç»™ç”¨æˆ·â€ï¼Œåˆ™è¿™é‡Œä¼šæ˜¯ä¸€ä¸ªAgentFinishå¯¹è±¡ã€‚ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸ºè°ƒç”¨å·¥å…·è¿”å›çš„â€œObservationâ€ 123456789101112131415161718[( AgentActionMessageLog( tool=&#x27;Wikipedia&#x27;, tool_input=&#x27;Leo DiCaprio&#x27;, log=&#x27; Invoking: `Wikipedia` with `Leo DiCaprio` &#x27;, message_log=[ AIMessage( content=&#x27;&#x27;, additional_kwargs=&#123; &#x27;function_call&#x27;: &#123; &#x27;name&#x27;: &#x27;Wikipedia&#x27;, &#x27;arguments&#x27;: &#x27;&#123; &quot;__arg1&quot;: &quot;Leo DiCaprio&quot; &#125;&#x27; &#125; &#125;) ] ), &#x27;Page: Leonardo DiCaprio Summary: Leonardo Wilhelm DiCaprio (; Italian: [diËˆkaËprjo]; born November 1&#x27;)] è‡ªæˆ‘æ£€æŸ¥é”™è¯¯ æ³¨æ„ï¼šè¿™å’Œä¹‹å‰ä»‹ç»çš„å·¥å…·ç±»çš„é”™è¯¯å¤„ç†ä¸åŒï¼Œå‰è€…åªæ˜¯å¤„ç†è°ƒç”¨å·¥å…·æ—¶ï¼Œå·¥å…·å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ã€‚è€Œè¿™é‡Œæ˜¯ä»æ™ºèƒ½ä½“çš„å±‚é¢ä¸Šï¼Œé˜²æ­¢LLMåœ¨è¾“å‡ºå¯¹ä»»åŠ¡çš„æ¨ç†æ—¶å‡ºç°å¹»è§‰ï¼Œäº§ç”Ÿä¸ç¬¦åˆè§„å®šæ ¼å¼çš„å­—ç¬¦ä¸²ï¼ˆå¦‚jsonæ ¼å¼ï¼ŒReActèŒƒå¼ç­‰ï¼‰ åœ¨å®ä¾‹åŒ–ä»»æ„ AgentExecutorçš„æ—¶å€™åŠ å…¥å‚æ•°handle_parsing_errors=Trueï¼Œå¯ä»¥ä½¿LangChainè‡ªåŠ¨å¤„ç†æ™ºèƒ½ä½“çš„ä¸å½“è¾“å‡ºï¼Œè¿™ä¸»è¦åŒ…æ‹¬æ— æ•ˆçš„æ ¼å¼æˆ–ä¸å®Œæ•´çš„å›åº”ã€‚ 123agent_executor = AgentExecutor( agent=agent, tools=tools, verbose=True, handle_parsing_errors=True) ä¾‹å¦‚ï¼Œå¦‚æœAgentä½¿ç”¨â€œReAct&quot;ç­–ç•¥ï¼Œä½†LLMå¹¶æœªéµå¾ªæç¤ºè¾“å‡ºâ€œAction: â€å­—æ®µæ—¶ï¼ŒLangChainå°†å‘LLMè‡ªåŠ¨é‡å‘ä¸€æ¡æ¶ˆæ¯ï¼Œå‘ŠçŸ¥é”™è¯¯æ ¼å¼çš„ä½ç½®çš„åº”å½“çš„è¾“å‡ºï¼Œä»¥æ­¤å°è¯•å¼•å¯¼LLMçº æ­£é”™è¯¯ã€‚ 1234567891011121314151617&gt; Entering new AgentExecutor chain...# LLMçš„è¿”å›ï¼Œç¼ºå°‘ Action: å­—æ®µThought: I should search for &quot;Leo DiCaprio&quot; on WikipediaAction Input: Leo DiCaprio# LangChainç”Ÿæˆçš„é”™è¯¯åé¦ˆï¼Œå°†ä½œä¸ºä¸‹ä¸€æ­¥çš„Inputè‡ªåŠ¨è¾“å…¥ç»™LLMInvalid Format: Missing &#x27;Action:&#x27; after ...# LLMçš„ä¸‹ä¸€æ­¥è¿”å›ï¼Œè¿™æ¬¡çš„æ ¼å¼æ­£ç¡®Thought:I should search for &quot;Leonardo DiCaprio&quot; on WikipediaAction: WikipediaAction Input: Leonardo DiCaprio# æ­£ç¡®æ‰§è¡Œå·¥å…·è°ƒç”¨åï¼Œè¿”å›ç»™LLMå·¥å…·è°ƒç”¨çš„è¾“å‡ºç»“æœPage: Leonardo DiCaprio Summary: Leonardo Wilhelm DiCaprio (; Italian: [diËˆkaËprjo]; born November 1 ... å¦‚æœè¦å°†è‡ªåŠ¨ç”Ÿæˆçš„é”™è¯¯åé¦ˆä¿®æ”¹ä¸ºè‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ï¼Œæ˜¾ç¤ºæŒ‡å®šå‚æ•°handle_parsing_errorsæ—¶ä¼ å…¥å­—ç¬¦ä¸²è€Œéå¸ƒå°”å€¼å³å¯ã€‚ 1234agent_executor = AgentExecutor( agent=agent, tools=tools, verbose=True, handle_parsing_errors=&quot;Check your output and make sure it conforms, use the Action/Action Input syntax&quot;,) è¿”å›ç»“æ„åŒ–è¾“å‡º ä¸Šé¢çš„æ‰€æœ‰æƒ…å†µï¼Œæ™ºèƒ½ä½“éƒ½ä»¥å­—ç¬¦ä¸²è¾“å‡ºç»“æœï¼Œå¦‚æœæƒ³è¦æ™ºèƒ½ä½“ä¹Ÿè¾“å‡ºç»“æ„åŒ–çš„æ•°æ®ï¼Œä»¥ä¾¿ç»“åˆåˆ°æ›´å¤§èŒƒå›´çš„ç³»ç»Ÿä¸­ã€‚ æˆ‘ä»¬å¯ä»¥å°†â€œè¿”å›ç»™ç”¨æˆ·â€è¿™ä¸€æ­¥éª¤ä¹Ÿè§†ä¸ºä¸€ä¸ªå·¥å…·è°ƒç”¨ï¼Œåªä¸è¿‡è°ƒç”¨çš„ç»“æœæ˜¯è¾“å‡ºç»“æ„åŒ–çš„æ–‡æœ¬ã€‚åœ¨LangChainç§ï¼Œå¯ä»¥å®šä¹‰Responseç±»æ¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚ ã€æ³¨æ„ï¼šä»¥ä¸‹ç¤ºä¾‹ä»¥åŸºäºOPENAIèŠå¤©æ¨¡å‹çš„æ™ºèƒ½ä½“ä¸ºä¾‹ã€‘ 12345678910from typing import Listfrom pydantic import BaseModel, Fieldclass Response(BaseModel): &quot;&quot;&quot;Final response to the question being asked&quot;&quot;&quot; answer: str = Field(description=&quot;The final answer to respond to the user&quot;) sources: List[int] = Field( description=&quot;List of page chunks that contain answer to the question. Only include a page chunk if it contains relevant information&quot; ) ç„¶åï¼Œåœ¨å®šä¹‰å·¥å…·æ—¶ï¼Œä½¿ç”¨å‡½æ•°convert_pydantic_to_openai_functionå°†Responseç±»å®šä¹‰ä¸ºå·¥å…·å‡½æ•°: 1234567891011121314from langchain_openai import ChatOpenAIfrom langchain_community.tools.convert_to_openai import format_tool_to_openai_functionfrom langchain.utils.openai_functions import convert_pydantic_to_openai_functionllm = ChatOpenAI(temperature=0)llm_with_tools = llm.bind( functions=[ # å…¶ä»–å·¥å…·ï¼Œä¾‹å¦‚ä¸€ä¸ª retriever tool format_tool_to_openai_function(retriever_tool), ... # Response ç»“æ„åŒ–è¿”å›å·¥å…· convert_pydantic_to_openai_function(Response), ]) å®šä¹‰ è§£æResponseå·¥å…·è¾“å‡ºçš„å‡½æ•°ã€‚è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨é¢„ç½®æ™ºèƒ½ä½“ï¼Œå› æ­¤å¼•å…¥åç§°AgentFinishå’ŒAgentActionMessageLogæ¥åŒ…è£…LLMè¾“å‡ºçš„ä¸­é—´æ­¥éª¤æ•°æ®ç»“æ„ï¼Œä»¥ä¾¿å¾—åˆ°å¯ä»¥è¢«LangChainå…¶ä»–æ¨¡å—è§£æçš„å¯¹è±¡ã€‚ 123456789101112131415161718192021import jsonfrom langchain_core.agents import AgentActionMessageLog, AgentFinishdef parse(output): # å¦‚æœLLMæ²¡æœ‰è°ƒç”¨ä»»ä½•å‡½æ•°ï¼Œå°†è‡ªå®šä¹‰å›ç­”ç»“æœç›´æ¥åŒ…è£…ä¸ºAgentFinish if &quot;function_call&quot; not in output.additional_kwargs: return AgentFinish(return_values=&#123;&quot;output&quot;: output.content&#125;, log=output.content) # å¦‚æœLLMè¦è°ƒç”¨æŸä¸ªéResponseç±»çš„å‡½æ•°ï¼Œå°†å…¶å‡½æ•°åå’Œå‚æ•°æŠ½å–å‡ºæ¥ function_call = output.additional_kwargs[&quot;function_call&quot;] name = function_call[&quot;name&quot;] inputs = json.loads(function_call[&quot;arguments&quot;]) # å¦‚æœLLMè°ƒç”¨äº†Responseå‡½æ•°å‡†å¤‡è¿”å›ç»“æ„åŒ–æ•°æ®ï¼Œå°†è¿”å›åŒ…è£…ä¸ºAgentFinishã€‚ if name == &quot;Response&quot;: return AgentFinish(return_values=inputs, log=str(function_call)) # å¦åˆ™ï¼Œå°†è¿”å›åŒ…è£…ä¸º agent actionï¼Œè¿™å°†ä½¿LangChainä»£æ›¿æˆ‘ä»¬æ‰§è¡Œå‡½æ•°å¹¶ç»§ç»­ä¸‹ä¸€æ­¥ä¸æ™ºèƒ½ä½“çš„äº¤äº’ã€‚ else: return AgentActionMessageLog( tool=name, tool_input=inputs, log=&quot;&quot;, message_log=[output] ) æœ€åï¼Œä½¿ç”¨parseä½œä¸ºé“¾æ­¥éª¤ä¸­è§£ææ™ºèƒ½ä½“è¾“å‡ºçš„åŠ¨ä½œï¼š 12345678910111213141516171819202122232425262728from langchain.agents.format_scratchpad import format_to_openai_function_messagesprompt = ChatPromptTemplate.from_messages( [ (&quot;system&quot;, &quot;You are a helpful assistant&quot;), (&quot;user&quot;, &quot;&#123;input&#125;&quot;), MessagesPlaceholder(variable_name=&quot;agent_scratchpad&quot;), ])agent = ( &#123; &quot;input&quot;: lambda x: x[&quot;input&quot;], # Format agent scratchpad from intermediate steps &quot;agent_scratchpad&quot;: lambda x: format_to_openai_function_messages( x[&quot;intermediate_steps&quot;] ), &#125; | prompt | llm_with_tools | parse)agent_executor = AgentExecutor(tools=[retriever_tool], agent=agent, verbose=True)agent_executor.invoke( &#123;&quot;input&quot;: &quot;...&quot;&#125;, return_only_outputs=True,) å·¥å…·åŒ…ï¼šToolkits å¯¹äºè®¸å¤šå¸¸è§ä»»åŠ¡ï¼Œä»£ç†å°†éœ€è¦ä¸€ç»„ç›¸å…³çš„å·¥å…·ã€‚ä¸ºæ­¤ï¼ŒLangChainæä¾›äº†å·¥å…·åŒ…çš„æ¦‚å¿µâ€”â€”å®ç°ç‰¹å®šç›®æ ‡æ‰€éœ€çš„å¤§çº¦3-5ä¸ªå·¥å…·çš„ç»„åˆã€‚ ä½¿ç”¨å·¥å…·åŒ…éå¸¸æ–¹ä¾¿ï¼Œåªéœ€å¯¼å…¥å·¥å…·åŒ…çš„åç§°ï¼Œç„¶åä½¿ç”¨get_tools()æ–¹æ³•å³å¯è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…å«è¯¥å·¥å…·åŒ…ä¸­çš„æ‰€æœ‰å·¥å…·ï¼Œä½ å¯ä»¥ç›´æ¥å°†è¯¥åˆ—è¡¨ä½œä¸ºå‚æ•°ä¼ å…¥å®ä¾‹åŒ–Agentçš„æ–¹æ³•ä¸­ï¼Œè½»æ¾æ„‰å¿«ï¼ 12345678# Initialize a toolkittoolkit = ExampleTookit(...)# Get list of toolstools = toolkit.get_tools()# Create agentagent = create_agent_method(llm, tools, prompt) Langchainå†…ç½®å·¥å…·åŒ… æ‰€æœ‰å†…ç½®å·¥å…·åŒ…çš„ä½¿ç”¨æ–‡æ¡£ï¼šhttps://python.langchain.com/docs/integrations/toolkits"},{"title":"Nickbit 2023å½±è§†æ¸¸è‰ºæ€»ç»“","path":"/2023/12/31/Nickbit2023å½±è§†æ¸¸è‰ºæ€»ç»“/","content":"ç¥ æ–°å¹´å¿«ä¹ï¼ ä»Šå¤©æ˜¯2023å¹´çš„æœ€åä¸€å¤©ï¼Œå¦‚æœä½ çœ‹è¿‡è¿™ä¸ªåšå®¢çš„ä¸€äº›å†å²å¸–å­çš„è¯ï¼Œä½ ä¼šå‘ç°æœ‰ä¸¤ä¸ªå¾€å¹´çš„å½±è§†æ¸¸è‰ºæ€»ç»“åˆ—è¡¨â€¦â€¦æ²¡é”™å®ƒä»¬æ˜¯æˆ‘å½“ä½ æƒ³ç€â€œè¦å¥½å¥½è®°å½•ä¸€ä¸‹æ¯å¹´éƒ½ä½“éªŒäº†ä»€ä¹ˆæœ‰ä»·å€¼çš„ä½œå“â€è€Œåˆ›å»ºçš„åˆ—è¡¨ï¼Œç„¶åäº‹å®å°±æ˜¯ï¼Œå®ƒä»¬éƒ½æ²¡æœ‰åœ¨æ¥å¹´çš„1æœˆ1æ—¥ä¹‹å‰è¢«å¥½å¥½å¡«å†™è¿‡ã€‚æ€»ä¹‹ä¸æ˜¯çƒ‚å°¾äº†å°±æ˜¯ä»€ä¹ˆæ—¶å€™çªç„¶æƒ³èµ·æ¥äº†é©¬åç‚®å¼çš„è¡¥äº† ä¸€ä¸‹ã€‚ä»¥è‡³äºæˆ‘ç°åœ¨å›è¿‡å¤´çœ‹ï¼Œè¡¨é‡Œå¡«çš„æŸäº›å†…å®¹æ›´æ˜¯ä¸€ç‚¹å°è±¡éƒ½æ‰¾ä¸å›æ¥äº†ã€‚ å› æ­¤ï¼Œä»Šå¹´å†³å®šç—›å®šæ€ç—›ï¼Œä»åˆ—è¡¨çš„å½¢å¼æ”¹ä¸ºä¸€ç¯‡å®Œæ•´çš„å›¾æ–‡ï¼Œå¹¶ä¸”ä¸€å®šè¦åœ¨2023.12.31æ™šä¸Šä¹‹å‰å‘å¸ƒå‡ºæ¥ã€‚å½“ç„¶ä½“éªŒè¿‡çš„å†…å®¹ä¸ä¸€å®šéƒ½æ˜¯ä»Šå¹´å‘å¸ƒçš„ï¼Œå¦‚æœæ˜¯è€æ¸¸æˆ/è¡¥ç•ªä¹‹ç±»çš„ä¼šç‰¹åˆ«æ ‡æ³¨å‡ºæ¥ã€‚æ­¤å¤–ï¼ŒæŒ‰ç…§æƒ¯ä¾‹æˆ‘ä¼šå¯¹æ‰€æœ‰å®Œæ•´ä½“éªŒè¿‡çš„ä½œå“æ‰“åˆ†ï¼Œè¯¥åˆ†æ•°çº¯ç²¹ä¸»è§‚ï¼Œä½†è¿˜æ˜¯åˆ†ä¸ºäº†å®¢è§‚å’Œä¸»è§‚ä¸¤ä¸ªéƒ¨åˆ†ï¼š å®¢è§‚åˆ†æ•°ï¼šå°†æˆ‘çš„ä»·å€¼è§‚å¯¹é½æ¥è§¦è¿‡çš„å¤§å¤šæ•°ç¤¾åŒºå’Œè‡ªåª’ä½“å¾—åˆ°çš„è¯„åˆ†ï¼Œæ»¡åˆ†10åˆ†ï¼Œæœ€å°åˆ†å€¼0.1 ä¸»è§‚åˆ†æ•°ï¼šå®Œå…¨ä»¥æˆ‘çš„å–œå¥½è¯„å®šçš„åˆ†æ•°ï¼Œæ»¡åˆ†2åˆ†ï¼Œæœ€å°åˆ†å€¼0.5 å¥½äº†ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œæ¥çœ‹ä¸‹2023å¹´éƒ½çœ‹äº†ç©äº†ä¹äº†å†™å•¥å§â€¦â€¦ æ¸¸æˆç¯‡ ç¥ä¹‹å¤©å¹³ ï¼ˆASTLIBRA Revisionï¼‰ å‘è¡Œæ—¶é—´ï¼š2022.10 ä½“éªŒæ—¶é—´ï¼š1æœˆ-3æœˆ è¯„åˆ†ï¼š11ï¼ˆ9.6 + 1.5 = 11.1ï¼‰ è™½ç„¶å®é™…ä¸Šè¿™æ˜¯22å¹´çš„ä½œå“ï¼Œä½†æ˜¯ä¸å¦¨ç¢æ˜¯æ•´ä¸ªå¯’å‡ç©çš„æœ€å°½å…´çš„æ¸¸æˆï¼Œè£è·Nickbit 2023é™¤å¤•å¤œæ¨èæ¸¸æˆï¼Œè®©æˆ‘ä»¬å¼•ç”¨ä¸€ä¸‹å½“æ—¶çš„è¯„è¯­ï¼š å¤è€çš„æ¨ªç‰ˆæœºåˆ¶ï¼Œçœ‹èµ·æ¥èƒ¡ä¹±çš„ç¾æœ¯è´´å›¾ï¼Œé£æ ¼å„å¼‚çš„é…ä¹ï¼Œ éƒ½æ²¡æ³•æ©ç›–ä¸€ä¸ªå†…å®¹å……å®ï¼Œå¼•å…¥å…¥èƒœï¼Œéœ‡æ’¼äººå¿ƒçš„æ•…äº‹ã€‚ 2022çš„æœ€åç»™æˆ‘è¿™ä¸ªç‹¬ç«‹æ¸¸æˆè’å¹´ä¸€ä¸ªæœ€å¤§çš„æƒŠå–œï¼ ï¼ˆè¿™ä¹ˆä¸€æƒ³ç¡®å®ï¼Œå»å¹´ç©çš„æ¸¸æˆéƒ½æ²¡æœ‰ä»€ä¹ˆè®©æˆ‘ç‰¹åˆ«æƒŠå–œçš„å†…å®¹ï¼Œè€Œä»Šå¹´ä¸‹é¢è¿™äº›å¯éƒ½æ˜¯é‡é‡çº§â€¦â€¦å¥½èµ·æ¥äº†å•Šï¼ï¼‰ éœæ ¼æ²ƒèŒ¨ä¹‹é— å‘è¡Œæ—¶é—´ï¼š2023.2 ä½“éªŒæ—¶é—´ï¼š2æœˆ-4æœˆ è¯„åˆ†ï¼š9+ï¼ˆ8.2 + 1.5 = 9.7ï¼‰ æˆ‘æ˜¯éšè—å“ˆè¿·ï¼Œå› æ­¤æ¸¸æˆå‡ºäº†å¾ˆå¿«æˆ‘å°±å¼€å§‹ç©äº†ï¼Œè™½ç„¶é¡¶ç€å½“æ—¶å·²ç»ç”¨äº†4å¹´çš„1650æ˜¾å¡ç¬”è®°æœ¬ï¼Œå¤šæ•°æƒ…å†µä¸‹30å¸§éƒ½è·‘ä¸åˆ°ï¼Œæˆ‘è¿˜æ˜¯é¡ºåˆ©é€šå…³äº†ä¸»çº¿å†…å®¹ã€‚å°±æ¸¸æˆè´¨é‡æ¥è¯´ï¼Œã€Šéœæ ¼æ²ƒèŒ¨ä¹‹é—ã€‹æ˜¯æ¯”è¾ƒæŠ½è±¡çš„ï¼Œå°¤å…¶æ˜¯å½“æˆ‘æ¢äº†é«˜é…ç”µè„‘å†æ¥ç©ï¼Œå‘ç°å®ƒçš„ä¼˜åŒ–ç¡®å®å¾ˆå¥½ï¼Œä½†æ˜¯å›¾åƒå’Œå…‰å½±è´¨é‡è¿˜æ˜¯ä¸å¤Ÿmagicï¼Œä¸å“ˆåˆ©æ³¢ç‰¹ç”µå½±çš„è´¨æ„Ÿç›¸å·®ç”šè¿œã€‚è‡³äºå¼€æ”¾ä¸–ç•Œçš„å†…å®¹è®¾è®¡ï¼Œç®€å•æ¦‚æ‹¬ä¸ºé­”æ³•ã€ŠåŸç¥ã€‹ï¼ˆç¬‘ï¼‰ï¼Œä½†ä½œä¸ºå¼€å‘å•†çš„å¼€å‘ä¸–ç•Œçš„å¤„å¥³ä½œï¼Œæˆ‘è§‰å¾—æ— å¯åšéã€‚æœ‰ä¸¤ä¸ªè®¾è®¡å¯ä»¥ä¸Šå¤§åˆ†ï¼šä¸€æ˜¯è®¾è®¡ä¸»è§’è®¾è®¡æ˜¯æ‰®æ¼”â€œæˆ‘è‡ªå·±â€ï¼ŒäºŒæ˜¯éª‘æ‰«æŠŠçš„ç«é€Ÿå…³å¡ã€‚ æ¸”å¸†æš—æ¶Œ å‘è¡Œæ—¶é—´ï¼š2023.3 ä½“éªŒæ—¶é—´ï¼š3æœˆ-4æœˆ è¯„åˆ†ï¼š9ï¼ˆ8.1 + 1 = 9.1ï¼‰ å¾ˆæœ‰æ„æ€çš„å°å“æ¸¸æˆï¼Œæ•´ä½“è®¾è®¡éå¸¸å·¥æ•´ï¼Œç»è¥+æ¢ç´¢+çº¿æ€§å‰§æƒ…é“¾ï¼Œå…‹ç³»ææ€–è¦ç´ è‡ªç„¶å“ä¸å€’æˆ‘è¿™ä¸ªç»éªŒä¸°å¯Œçš„COCè°ƒæŸ¥å‘˜ã€‚ä¸è¿‡è‡ªç”±åº¦ä»ç„¶ä¸å¤Ÿé«˜ï¼Œå¦‚æœï¼Œæˆ‘æ˜¯è¯´å¦‚æœï¼Œèƒ½å’Œå¤ç¥å¯¹æˆ˜çš„è¯â€¦â€¦ å¡å°”è¾¾ä¼ è¯´ï¼šç‹å›½ä¹‹æ³ª å‘è¡Œæ—¶é—´ï¼š2023.5 ä½“éªŒæ—¶é—´ï¼š5æœˆ-6æœˆ è¯„åˆ†ï¼š11+ï¼ˆ10 + 1.5 = 11.5ï¼‰ æˆ‘çŸ¥é“ä½ ä»¬è¦è¯´â€œå”¯ä¸€çœŸç¥â€äº†ï¼Œä¸è¿‡å¯æƒœå½“æ—¶å¿™ç€æ¯•è®¾ï¼ŒåŸºæœ¬ä¸Šæ˜¯åŒ†åŒ†è¿‡äº†ä¸»çº¿ï¼Œç„¶åå°±æ²¡æœ‰æ‰“å¼€è¿‡äº†ã€‚æˆ‘å…¶å®æ²¡æœ‰ç©è¿‡é‡ç‚Šï¼Œç”šè‡³äº‘ä¹Ÿæ²¡æœ‰äº‘å¤šå°‘ï¼Œä½†è¿™ä¸å¦¨ç¢æˆ‘å¯¹æ–°ä¸–ä»£çš„å¡å°”è¾¾ä¼ è¯´ç³»åˆ—æœ‰äº†ä¸€å¥—è‡ªå·±çš„ç†è§£ã€‚ä»»å¤©å ‚çš„å¼€æ”¾ä¸–ç•Œè®¾è®¡å…¶å®æ˜¯ä¸€ä¸ªâ€œç¥ç»ç½‘ç»œâ€ï¼Œåœ¨è¿™ä¸ªæ— æ¯”ç©ºæ—·å’Œä¸°å¯Œçš„ä¸–ç•Œé‡Œï¼Œä½ å¯ä»¥è‡ªç”±åœ°åšä¸€åˆ‡ï¼Œä½†æ•…äº‹çš„ç»“å±€æ€»æ˜¯ä¸€å®šçš„ã€‚ä½ å¯ä»¥èµ°æ— æ•°çš„ä¸åŒè·¯å¾„ï¼Œä½†æœ€ç»ˆéƒ½ä¼šè¾“å‡ºåˆ°ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœä½ ä¸æŠŠè‡ªå·±æ‰®æ¼”æˆæ—å…‹ï¼Œé‚£ä¹ˆå§‹ç»ˆæ— æ³•ä»£å…¥åˆ°è¿™ä¸ªæ¢¦å¹»çš„ä¸–ç•Œé‡Œï¼Œä½†å¦‚æœæŠŠè‡ªå·±å¸¦å…¥åˆ°æ—å…‹ï¼Œé‚£å­¤ç‹¬çš„æ„Ÿè§‰åˆä¼šç¬é—´æ¶Œä¸Šå¿ƒå¤´â€¦â€¦å°±ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œç‹æ³ªè´§çœŸä»·å®çš„è‰ºæœ¯å“ åšå¾·ä¹‹é—¨3 å‘è¡Œæ—¶é—´ï¼š2023.8 ä½“éªŒæ—¶é—´ï¼š8æœˆ-9æœˆ è¯„åˆ†ï¼š11+ï¼ˆ9.8 + 2 = 11.8ï¼‰ çœŸæ­£çš„â€œå”¯ä¸€çœŸç¥â€ï¼ŒGOTYï¼ï¼ï¼æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ä¸œè¥¿æœ‰ä»€ä¹ˆé­”åŠ›ï¼Œè®©æˆ‘çš„æš‘å‡å¹³ç™½æ— æ•…åœ°å¤šäº†å‡ ä¸ªå‡ ä¹é€šå®µçš„æ™šä¸Šâ€¦â€¦åªèƒ½è¯´éª°å­è™½ç„¶ç®€å•ï¼Œä½†æ˜¯å®ƒçš„é­…åŠ›çœŸçš„è®©äººæ¬²ç½¢ä¸èƒ½ï¼ˆå¯¹ï¼Œå°±æ˜¯è¯´SLäº†ä¸¤å°æ—¶æ²¡æŠ•å‡ºä¸€ä¸ªé‡å‡»è¿™ä»¶äº‹ï¼‰ã€‚å½“ç„¶æ‹‰ç‘å®‰çš„ç½‘çŠ¶å™äº‹è®¾è®¡åŠŸä¸å¯æ²¡ï¼Œåšå¾·ä¹‹é—¨3æ„å»ºäº†ä¸€ç§ä¸å¡å°”è¾¾å®Œå…¨ä¸åŒçš„å¼€å‘ä¸–ç•ŒèŒƒå¼ï¼Œå‰§æƒ…ä¸å†æ”¶æ•›åˆ°æŸä¸ªèŠ‚ç‚¹ï¼Œè€Œæ˜¯ä½ çš„è‡ªç”±é€‰æ‹©ï¼Œè™½ç„¶ç°åœ¨è¿˜åšä¸åˆ°åƒTRPGä¸€æ ·ä¸»æŒäººçš„å®Œå…¨è‡ªç”±ï¼Œä½†ä¹Ÿè®¸è¿™æ‰æ˜¯æœªæ¥â€¦â€¦ ViewFinder å‘è¡Œæ—¶é—´ï¼š2023.7 ä½“éªŒæ—¶é—´ï¼š8æœˆ-9æœˆ è¯„åˆ†ï¼š10ï¼ˆ8 + 2 = 10ï¼‰ éå¸¸æƒŠè‰³çš„æ¸¸æˆï¼Œç©æ³•åˆ›æ„æ— æ•Œï¼Œå±äºæ˜¯åˆåˆ·æ–°äº†æˆ‘å…³äºç©æ³•è®¾è®¡çš„ä¸–ç•Œè§‚ã€‚æœ€åçš„é™æ—¶æŒ‘æˆ˜ä¹Ÿå¾ˆæœ‰ç´§å¼ æ„Ÿï¼Œä¸è¿‡è¢«ä¸å°‘äººæ‰¹è¯„ç ´åäº†æ•´ä½“çš„æ¸¸æˆä½“éªŒæ„Ÿhhhhã€‚å¯¹äºè¿‡åº¦è®¾è®¡ï¼Œæ‰¹è¯„çš„å£°éŸ³ç¡®å®å¾ˆåˆ°ä½ï¼Œæœ¬ä½œä¸å°‘ç©æ³•è®¾è®¡éƒ½æœ‰è™å¤´è›‡å°¾çš„æ„Ÿè§‰ï¼Œå¼€å§‹å¾ˆæƒŠè‰³ï¼Œä½†æ˜¯å¾ˆå¿«åˆ°ä¸‹ä¸€ä¸ªå…³å¡å°±è¢«æŠ›å¼ƒè½¬åˆ°å¦ä¸€ä¸ªè§£è°œæ€è·¯å»äº†ï¼Œä¹Ÿè®¸â€œçŸ­è§†â€æ˜¯è¿™ä¸ªå®éªŒæ€§ä½œå“æœ€å¤§çš„é—æ†¾ã€‚æˆäºˆâ€œå¹´åº¦æœ€ä½³åˆ›æ„â€ã€‚ PSï¼šé‚£åªçŒ«å¾ˆå¯çˆ± æ˜Ÿä¹‹æµ· Sea of Stars å‘è¡Œæ—¶é—´ï¼š2023.8 ä½“éªŒæ—¶é—´ï¼š10æœˆ è¯„åˆ†ï¼š8+ï¼ˆ8.2 + 0.5 = 8.7ï¼‰ è¢«æ™®éè®¤ä¸ºâ€œåä¸å‰¯å®â€çš„å¹´åº¦æœ€ä½³ç‹¬ç«‹ã€‚åœ¨ç©çš„æ—¶å€™æˆ‘ç¡®å®ä¹Ÿæ˜¯ç»å†äº†ä¸€æ³¢â€œæœŸå¾…â€â€”â€”â€œå¤±æœ›â€â€”â€”â€œåˆæœŸå¾…â€â€”â€”â€œåˆå¤±æœ›â€çš„è¿‡å±±è½¦å†ç¨‹ã€‚åœ¨æˆ‘ç©åˆ°1/10çš„æ—¶å€™æˆ‘ä»¥ä¸ºæˆ‘å·²ç»æ‰“å®Œäº†1/3ï¼Œå½“æˆ‘ç©åˆ°1/3çš„æ—¶å€™æˆ‘ä»¥ä¸ºæˆ‘è¦æ‰“æœ€ç»ˆbossäº†ï¼Œè€Œå½“æˆ‘ç©¿è¶Šæ˜Ÿä¹‹æµ·å‘ç°è¿˜æœ‰ä¸€ä¸ªæ–°çš„å¤§åœ°å›¾æ—¶ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œç›¸ä¿¡æˆ‘ï¼Œå·²ç»ä¸ä¼šå†æœ‰æ–°é²œæ„Ÿäº†ã€‚**å†…å®¹è¡¨è¾¾çš„æ‹–æ²“æ—¶è¿™ä¸ªæ¸¸æˆæœ€å¤§çš„é—®é¢˜ã€‚**å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘è¿˜æ˜¯é€šå…³äº†ã€‚å‰§æƒ…è™½ç„¶ç€å®è€å¥—ä½†å¥½åœ¨è¡¨ç°åŠ›ä¸é”™ï¼ˆè™½ç„¶ä½†æ˜¯æˆ‘ä¹Ÿè§‰å¾—å«â€œåŠ å°”ä¼ â€æ›´åˆé€‚ï¼‰ã€‚æœ€å®è‡³åå½’çš„ä¼°è®¡è¿˜åªèƒ½æ˜¯èŠ±è´¹äº†å¤§é‡å¿ƒè¡€çš„ç¾æœ¯äº†ï¼Œåœ¨æ­¤æˆäºˆâ€œå¹´åº¦æœ€ä½³åƒç´ ç¾æœ¯â€ã€‚ å·´åˆ«å¡”åœ£æ­Œ å‘è¡Œæ—¶é—´ï¼š2023.9 ä½“éªŒæ—¶é—´ï¼š11æœˆ è¯„åˆ†ï¼š11ï¼ˆ9.2 + 2 = 11.2ï¼‰ æˆ‘åªç©äº†ä¸€ä¸ªä¸‹åˆï¼Œç„¶ååœ¨ç¾¤é‡Œå°±æ˜¯è¿™ä¹ˆè¯´çš„ï¼šâ€œç¬¦å·å­¦çˆ±å¥½è€…ç›´æ¥é«˜æ½®â€ éå¸¸ç”µæ³¢ç³»çš„æ¸¸æˆï¼Œè¯­è¨€ç ´è¯‘å’Œç¬¦å·è§£å¯†çš„ç©æ³•è‡ªç„¶åªæœ‰çˆ±å¥½è€…æ‰ä¼šè¢«æ·±æ·±å¸å¼•ï¼Œè·¯äººå¯èƒ½ç¬¬ä¸€ç« å°±æ”¾å¼ƒäº†ã€‚ä½†æ˜¯æ¸¸æˆæ•´ä½“çš„ç¾æœ¯é£æ ¼å’Œçº¿æ¡è®¾è®¡éå¸¸æˆ³æˆ‘ï¼Œä»¥è‡³äºåœ¨æœ¬æ–‡ä¸­è·å¾—äº†æœ€å¤šçš„å›¾ç‰‡å±•ç¤ºä½ï¼ˆé€šå…³äº†ä»¥åç«‹åˆ»å°±ä½œä¸ºäº†æˆ‘çš„æ¡Œé¢å£çº¸ï¼‰ã€‚å…¶å®ç ´è¯‘ç©æ³•çš„æ•´ä½“éš¾åº¦ä¸å¤§ï¼Œè¿™å¹¶éæ˜¯ä¸€ä¸ªç¡¬æ ¸è§£å¯†æ¸¸æˆï¼Œæ¸¸æˆå†…çš„æ–‡æ³•ä¹Ÿä¸æ˜¯èƒ½æ‹“å±•åˆ°çœŸå®çš„ä¸–ç•Œçš„ï¼Œä¹Ÿè®¸è¿™åè€Œæ˜¯ä¸€ä¸ªâ€œä¸è¿‡åº¦è®¾è®¡â€çš„ä¼˜ç§€ä¾‹å­ã€‚æˆäºˆâ€œå¹´åº¦æœ€ä½³ç‹¬ç«‹æ¸¸æˆâ€ã€‚ å·´åˆ«å·æ¼«æ¸¸æŒ‡å— ç¨€æœ‰çš„å¤šçº¿å™äº‹çš„è§£è°œæ¸¸æˆï¼Œé€»è¾‘é—­ç¯éå¸¸åˆ°ä½ï¼Œè§£è°œå¼•å¯¼ä¹Ÿååˆ†è´´å¿ƒã€‚åœ¨æ­¤ä½©æœä½œè€…çš„æƒ³è±¡åŠ›å’Œé€»è¾‘åŠ›ã€‚æ•…äº‹å’‹ä¸€å¬ä¸çŸ¥æ‰€äº‘ï¼Œç©åˆ°ä¸€åŠå°±è±ç„¶å¼€æœ—ã€‚çœ‹ä¼¼æ˜¯ä¸€ä¸ªç«¥è¯æ•…äº‹ï¼Œä½†å…¶å®ç¥ä¼¼ã€Šå»æœˆçƒã€‹ã€ã€Šçµé­‚æ‘†æ¸¡è€…ã€‹ï¼Œã€Šå·´åˆ«å·æ¼«æ¸¸æŒ‡å—ã€‹æ˜¯ä¸€ä¸ªç«‹æ„æ­»äº¡æ•™è‚²çš„â€œç½—æ›¼Â·ç½—å…°å¼â€æ•…äº‹ï¼Œéƒ½è¿™ä¸ªé«˜åº¦äº†ï¼Œæˆ‘æ˜¯ç»å¯¹ä¸ä¼šæ‰¹è¯„çš„ï¼Œæˆäºˆâ€œå¹´åº¦æœ€ä½³ç‹¬ç«‹å‰§æƒ…â€ï¼Œå¸Œæœ›å¤§å®¶æœ‰ç”Ÿä¹‹å¹´éƒ½èƒ½ä½“éªŒä¸€ç•ªã€‚ å‘è¡Œæ—¶é—´ï¼š2023.8 ä½“éªŒæ—¶é—´ï¼š11æœˆ-12æœˆ è¯„åˆ†ï¼š10ï¼ˆ8.8 + 1.5 = 10.3ï¼‰ èŠ‚å¥åŒ»ç”Ÿï¼ˆç¬¬äº”ç« ï¼‰ æœ¬æ¥æ²¡æœ‰æ‰“ç®—è®°å½•ä¸€äº›æ¸¸æˆçš„æ›´æ–°/é•¿æœŸè¿è¥å†…å®¹çš„ï¼Œä½†æ˜¯ã€ŠèŠ‚å¥åŒ»ç”Ÿã€‹çš„æ–°å…³å¡æˆ‘è§‰å¾—æœ‰å¿…è¦ç‚¹ä¸€ä¸‹ï¼Œè¿™æ¬¡çš„è®¾è®¡ç›´æ¥ä»â€œç±»éŸ³æ¸¸â€æ‹”é«˜åˆ°äº†â€œèŠ‚å¥å¤©å›½â€çš„é«˜åº¦ï¼Œæ— è®ºæ˜¯æ­Œæ›²è´¨é‡ã€æ¼”å‡ºå’Œå‰§æƒ…ç«‹æ„éƒ½åœ¨ä¿æŒçŸ­å°ç²¾æ‚çš„åŒæ—¶æœ‰äº†æå¤§çš„çªç ´ã€‚æ‰“å®Œçš„æ™šä¸Šå¿ƒæƒ…ä¹…ä¹…ä¸èƒ½å¹³å¤â€¦â€¦å¸Œæœ›è¿˜èƒ½çœ‹åˆ°æ›´å¥½çš„ï¼ï¼ˆå¦‚æœèƒ½å†ä¼˜åŒ–ä¼˜åŒ–éš¾åº¦æ›²çº¿çš„è¯ï¼ˆèœé¸¡å‘è¨€ï¼‰ï¼‰ æ›´æ–°æ—¶é—´ï¼š2023.11 ä½“éªŒæ—¶é—´ï¼š12æœˆ è¯„åˆ†ï¼š10+ï¼ˆ9.1 + 1.5 = 10.6ï¼‰ ä¸‹é¢æ˜¯ä¸€äº›æˆ‘è¿˜æ²¡æœ‰é€šå…³æˆ–æ˜¯ä¸­é€”å¼ƒå‘çš„æ¸¸æˆï¼š æ½œæ°´å‘˜æˆ´å¤« å‘è¡Œæ—¶é—´ï¼š2023.9 â€œæœ€ä½³ç‹¬ç«‹æ¸¸æˆâ€çš„æœ‰åˆ©ç«äº‰è€…ï¼Œå†…å®¹åŠå…¶ä¸°å¯Œæ˜¯å®ƒçš„ä¼˜åŠ¿ï¼Œä½†å¯æƒœä¸æ˜¯æˆ‘çš„èœã€‚ç©äº†å‡ ä¸ªå°æ—¶æœ‰ä¸€ç§å¥½åƒä»€ä¹ˆç©æ³•éƒ½æœ‰ï¼Œä½†æ˜¯ä»€ä¹ˆç©æ³•éƒ½ä¸å¤Ÿå¸å¼•æˆ‘çš„æ„Ÿè§‰ï¼ŒåŠ ä¹‹å‰§æƒ…ä¸­å¡äº†ä¸€æ¬¡å…³ï¼Œé‚æ”¾å¼ƒï¼Œåé¢ä¹Ÿæ²¡æœ‰ç»§ç»­ç©è¿‡â€¦â€¦ç©åˆ°è¿‡ç¨‹ä¸­å¸¸å¸¸æœ‰â€œè¿™ä¸ªä»»åŠ¡ä¹Ÿè¦åšï¼Œè¿™ä¸ªä»»åŠ¡ä¹Ÿè¦åšï¼Œè¦èµšé’±ï¼Œè¿˜è¦æƒ³ç€æ™šä¸Šå¯¿å¸åº—ç»è¥çš„éƒ¨åˆ†â€¦â€¦â€æœ‰ä¸€ç§ä¸Šç­çš„ç—›è‹¦â€¦â€¦ é˜¿æ–¯ç‰¹èµ–äºšï¼šå…­é¢å…ˆçŸ¥ï¼ˆAstrea: Six-Sided Oraclesï¼‰ å‘è¡Œæ—¶é—´ï¼š2023.9 åŒæ ·æ˜¯è¢«æ§ä¸ºâ€œä»Šå¹´æœ€ä½³è‚‰é¸½DBGâ€çš„æ¸¸æˆï¼Œä½†æˆ‘åªç©äº†æ–°æ‰‹çš„ç¬¬ä¸€æŠŠå°±æ²¡æœ‰ç»§ç»­äº†â€¦â€¦ä¸æ˜¯å®ƒä¸å¥½ç©ï¼Œæ˜¯æˆ‘çš„é—®é¢˜ï¼šæˆ‘çš„æ—¶é—´çœŸçš„éå¸¸å€¼é’±â€¦â€¦åªç©äº†ä¸€æŠŠå°±èƒ½æ•é”åœ°å‘ç°ï¼Œè¿™ä¸ªæ¸¸æˆç©èµ·æ¥çœŸçš„å¾ˆç´¯ï¼š7æ»´è¡€ä¸€æ¡å‘½çš„è®¾è®¡ï¼Œå¦‚æœä¸èƒ½ä¿æŒé«˜åº¦çš„è®¡ç®—é›†ä¸­å¾ˆå®¹æ˜“ç¿»è½¦ï¼Œç„¶åç­‰å¾…ä½ çš„å°±æ˜¯æ— å°½çš„SLã€‚ä½†æ˜¯åˆ›æ„ç¡®å®å¾ˆå¥½ã€‚ 14ç§æ‰«é›·å˜ä½“ å‘è¡Œæ—¶é—´ï¼š2022.11 å®¤å‹ç”Ÿæ—¥å‹æƒ…èµ é€ï¼Œé¡ºä¾¿ç»™æˆ‘ç§€äº†ä¸€ä¸‹1000å°æ—¶çš„æ¸¸æˆæ—¶é—´ã€‚æˆ‘ï¼šâ€œå°±ä¸€ä¸ªæ‰«é›·å“ªæœ‰è¿™ä¹ˆè€ç©â€¦â€¦â€æ‰“å¼€è¿‡äº†å‡ å…³ï¼šâ€œå¯¹ä¸èµ·ï¼Œå¯¹ä¸èµ·ï¼Œè¿™ä¸œè¥¿æœ‰æ¯’ï¼Œæˆ‘è§‰å¾—ä»¥æˆ‘çš„æ„å¿—åŠ›ï¼Œè¿™ä¸œè¥¿ä¸èƒ½ç¢°ï¼Œä¸èƒ½ç¢°â€¦â€¦â€ æˆ´æ£®çƒè®¡åˆ’ï¼šé»‘é›¾å´›èµ· å‘è¡Œæ—¶é—´ï¼š2023.12 â€œä»€ä¹ˆï¼Ÿä½ æŸ“ä¸Šæˆ´æ£®çƒäº†ï¼Ÿï¼ï¼â€ å¯¹ä¸èµ·ï¼Œå¯¹ä¸èµ·ï¼Œè¿™ä¸œè¥¿æ›´ä¸èƒ½ç¢°â€¦â€¦ä½†æ˜¯åœˆå…»é»‘é›¾çœŸçš„å¾ˆæœ‰æ„æ€ï¼Œduangduangææ–™å°±æ‰å‡ºæ¥äº†ï¼Œæ¯æ˜Ÿéƒ½ä¸ç”¨å‡ºï¼Œæˆ´æ£®çƒå°±å»ºå¥½äº†â€¦â€¦ç­‰ç­‰æˆ‘ç®±å­æ€ä¹ˆåˆå µä½äº†ï¼Ÿ ï¼ˆæ­¤æ—¶åšä¸»çš„ç†æ™ºå‘Šè¯‰å®ƒï¼Œå®Œæ•´å†…å®¹è¿˜æ˜¯ç­‰æ”¾å¯’å‡å†æ¥ç€ç©å§ï¼Œå¦åˆ™æœŸæœ«å°å‘½ä¸ä¿ï¼‰ åŠ¨æ¼«ç¯‡ æ³¨æ„ï¼Œå¯¹äºå½±è§†ä½œå“å’ŒåŠ¨æ¼«çš„å®¢è§‚è¯„åˆ†ï¼Œä¼šæ¯”æ¸¸æˆè¦è‹›åˆ»ï¼Œä¹Ÿè®¸è¿™æ˜¯å—åˆ°äº†bangumiçš„å½±å“ï¼Ÿï¼ˆå¹³è¡¡å…šç½ªå¤§æ¶æï¼‰ ä¼å…­ä¸ƒä¹‹æš—å½±å®¿å‘½ å¼€æ’­æ—¶é—´ï¼š2023.1 ç±»å‹ï¼šè¿½ç•ª è¯„åˆ†ï¼š8ï¼ˆ7.2 + 1 = 8.2ï¼‰ ä¸€è´¯çš„é«˜æ°´å‡†åˆ¶ä½œå›½æ¼«ï¼Œä¼å…­ä¸ƒçš„ä¸–ç•Œè§‚å’Œå‰§æƒ…æˆ‘ä¸è¿‡å¤šè¯„ä»·ï¼Œä¸è¿‡è¿™ä¸€å­£çš„ä¸»é¢˜æ›²æ˜¯çœŸæ»´å¥½å¬ã€‚ å­¤ç‹¬æ‘‡æ»š å¼€æ’­æ—¶é—´ï¼š2022.10 ç±»å‹ï¼šè¡¥ç•ª æ—¶é—´ï¼š6æœˆ-7æœˆ è¯„åˆ†ï¼š10+ï¼ˆ8.8 + 2 = 10.8ï¼‰ å»å¹´æœ€å¤§é»‘é©¬ï¼Œå‰å®¤å‹å¤§åŠ›æ¨èï¼Œæˆ‘å´å› ä¸ºå¯¹ä¹é˜Ÿç•ªæ¯«æ— å…´è¶£ç›´æ¥passçš„é”™ä»˜åŠ¨æ¼«ã€‚è¿˜å¥½ä¸€æ¯•ä¸šäº†ï¼Œå¼€å§‹æ„Ÿåˆ°å†…å¿ƒçš„ç©ºè™šï¼Œäºæ˜¯æ‹¾èµ·æ¥çœ‹äº†çœ‹ï¼šå•Šï¼Œè¿™å°±æ˜¯é’æ˜¥å•Šã€‚è°¢è°¢ä½ æ³¢å¥‡é…±ï¼Œæ•‘ä¸‹äº†ä¸€ä¸ªå·®ç‚¹åœ¨æš‘å‡æ­»å»çš„å¿ƒçµâ€¦â€¦è¿˜é¡ºä¾¿æ”¹å˜äº†æˆ‘å¯¹ä¹é˜Ÿé¢˜æçš„çœ‹æ³•ï¼Œç„¶åæœ‰äº†â€¦â€¦ BanG Dream! Itâ€™s MyGO!!! å¼€æ’­æ—¶é—´ï¼š2023.6 ç±»å‹ï¼šè¿½ç•ª è¯„åˆ†ï¼š10+ï¼ˆ8.9 + 2 = 10.9ï¼‰ â€œä»€ä¹ˆï¼Ÿä½ æŸ“ä¸ŠMâ€¦â€¦â€ä¸æ˜¯ï¼Œåœåœåœï¼Œè¿™ä¸ªä¸æ˜¯è¿™æ ·çš„ã€‚ æˆ‘è¦åœ¨è¿™é‡Œéƒ‘é‡å£°æ˜ï¼šæœ¬äººä¸æ˜¯MyGOå°é¬¼ï¼Œæˆ‘æ˜¯é‚¦é‚¦å©†ç½—é—¨ï¼ˆåˆ’æ‰ï¼‰ï¼Œä»Šå¹´3æœˆå…¥å‘ï¼Œé‚£æ˜¯åŠ¨ç”»è¿˜æ²¡å®˜å®£ã€‚éŸ³æ¸¸äººç©ç©æ¸¸æˆå¬è¯´é‚¦é‚¦æ­Œæ›²å¤šæ°ªé‡‘å°‘æœ‰é˜¿bä»£ç†å›½æœï¼ˆè™½ç„¶æœ€åè¿˜æ˜¯ä¸ºäº†æŠ½MyGOè½¬æˆ˜äº†æ—¥æœï¼‰æ²¡æ¯›ç—…å§â€¦â€¦ æ‰€ä»¥ä½ ä»¬å¿«å»çœ‹å§ï¼Œæˆ‘ä»€ä¹ˆéƒ½ä¼šåšçš„ï¼æœ‰äººæ²¡çœ‹è¿‡è¿™ä¸ªæ•…äº‹ï¼Œæˆ‘éƒ½ä¼šå¿ƒç—›çš„ï¼ BanG Dream! ï¼ˆ1-3å­£ï¼‰ å¼€æ’­æ—¶é—´ï¼š2017.1 - 2020.4 ç±»å‹ï¼šè¡¥ç•ª æ—¶é—´ï¼š9æœˆ-11æœˆ è¯„åˆ†ï¼š8ï¼ˆ7 + 1 = 8ï¼‰ æŸ“ä¸ŠMyGOç—‡çŠ¶1ï¼šè·‘å»è¡¥å®Œå‰ä¸‰å­£ï¼Œå®¢è§‚ç‚¹è¯´ï¼Œé‚¦é‚¦çš„å‰äº”å¹´åŠ¨ç”»ç¡®å®å°±æ˜¯ä¸€ä¸ªç²‰ä¸å‘ä½œå“ï¼Œå‰§æƒ…éå¸¸å¥—è·¯ï¼Œä¹Ÿå¸å¼•ä¸æ¥å¤–äººï¼Œå…¥å‘äº†ä»¥åå½“äº†è§£è§’è‰²çš„è¡¥å……ææ–™çœ‹æ‰æ˜¯æ­£è§£ã€‚ å°‘å¥³â˜†æ­Œå‰§ Revue Starlight ï¼ˆTV+å‰§åœºç‰ˆï¼‰ å¼€æ’­æ—¶é—´ï¼š2018.7ï¼ˆTVï¼‰ 2021.6ï¼ˆå‰§åœºç‰ˆï¼‰ ç±»å‹ï¼šè¡¥ç•ª æ—¶é—´ï¼š9æœˆ-10æœˆ è¯„åˆ†ï¼šTVï¼š 8+ï¼ˆ7.9 + 1ï¼‰ å‰§åœºç‰ˆï¼š 10ï¼ˆ8.5 + 1.5ï¼‰ æŸ“ä¸ŠMyGOç—‡çŠ¶2ï¼šè·‘å»çœ‹æ‰­æ›²é•¿é¢ˆé¹¿â€¦â€¦ç›¸å¯¹äºTVç‰ˆï¼Œå‰§åœºç‰ˆçš„ååŠ²æ‰æ˜¯æ›´å¤§çš„ï¼Œè¿™æ˜¯ä¸€ç§åæ­£æˆ‘ä»æœªè§è¿‡çš„è¡¨è¾¾å½¢å¼ï¼Œå¹¶ä¸”æå…·å†²å‡»åŠ›ã€‚æˆ‘è®¤ä¸ºå°‘æ­Œçš„ç«‹æ„æ˜¯è¿™äº›â€œæ‰­æ›²æ€ªâ€ç•ªé‡Œæœ€é«˜çš„ï¼Œå°‘å¥³ä¸æ˜¯é‡ç‚¹ï¼Œæˆé•¿ä¹Ÿä¸æ˜¯ï¼Œç”šè‡³è¯´å°è¯çš„äººéƒ½å¯ä»¥è¢«è§£æ„æ‰ï¼Œä½†æ˜¯å¥¹è¿˜æ˜¯ä»ç„¶æœ‰ä¸€ç§å¥‡å¦™çš„é­…åŠ›ï¼Œå•Šï¼Œå“‡å¡åˆ©é©¬æ–¯.jpgï¼ˆå®Œå…¨æ²¡ææ‡‚ï¼‰ å¥‡å·§è®¡ç¨‹è½¦ ODD TAXI å¼€æ’­æ—¶é—´ï¼š2021.4 ç±»å‹ï¼šè¡¥ç•ª æ—¶é—´ï¼š10æœˆ-11æœˆ è¯„åˆ†ï¼š10ï¼ˆ8.5 + 1.5 = 10ï¼‰ æŸ“ä¸ŠMyGOç—‡çŠ¶3ï¼šâ€¦â€¦ä¸æ˜¯ï¼Œè¿™ä¸ªæ²¡å…³ç³»å§ã€‚ä¸è¿‡ç¡®å®æ˜¯è¿½å®Œäº†/è¡¥å®Œäº†å‰é¢è¿™äº›åŸåˆ›ï¼Œçªç„¶è§‰å¾—åº”è¯¥æŠŠè¿‘ä¸¤å¹´çš„å¥½è¯„åŸåˆ›éƒ½è¡¥ä¸€ä¸‹ï¼Œäºæ˜¯ç¿»åˆ°çš„ã€Šå¥‡å·§è®¡ç¨‹è½¦ ã€‹ï¼ˆå½“å¹´å’Œã€Šå¥‡è›‹ç‰©è¯­ã€‹åŒå°ç«æŠ€çš„æ—¶å€™æˆ‘é€‰æ‹©äº†çœ‹åè€…ï¼Œå”‰æ®‹å¿µâ€¦â€¦ï¼‰ï¼Œäº‹å®è¯æ˜ä¹Ÿæ²¡æœ‰è®©æˆ‘å¤±æœ›ï¼Œæ¼‚äº®çš„æ ¸å¿ƒè¯¡è®¡å’Œå¤šçº¿å™äº‹ï¼Œâ€œåŠ¨æ¼«åŒ–æ—¥å‰§â€åä¸è™šä¼ ã€‚ è‘¬é€çš„èŠ™è‰è² å¼€æ’­æ—¶é—´ï¼š2023.10 ç±»å‹ï¼šè¿½ç•ª è¯„åˆ†ï¼š10ï¼ˆ8.8 + 1.5 = 10.3ï¼‰ 2023å…¬è®¤å¹´åº¦æœ€ä½³åŠ¨æ¼«ï¼Œå› æ­¤åœ¨ä»Šå¹´çš„æœ€åä¹Ÿå¼€å§‹è·Ÿä¸Šæ½®æµè¿½ç•ªï¼ŒèŠ™è‰è²ç»™æˆ‘çš„æœ€å¤§è§‚æ„Ÿæ˜¯æ— è™‘ã€‚çœ‹è¿™éƒ¨åŠ¨ç”»æ²¡æœ‰ä»»ä½•è´Ÿæ‹…ï¼Œä¼¼ä¹æ¯ä¸€ä¸ªæ•…äº‹éƒ½æ˜¯çœŸçš„åœ¨å“ªä¸ªé¥è¿œçš„å¤§é™†å‘ç”Ÿï¼Œè€Œå’Œä½ åˆæ¯«æ— å…³ç³»ã€‚åªéœ€æ”¾è½»æ¾ï¼Œäº«å—è¿™ä¸ªè™šæ„å´åˆæ— æ¯”çœŸå®çš„æ•…äº‹â€¦â€¦è¿™æ˜¯ä¸€ç§å¤šä¹ˆç¾å¥½çš„æ„Ÿè§‰ï¼Œä¹Ÿè®¸å°±æ˜¯ç¥ä½œä¸ºä»€ä¹ˆè¢«ç§°ä¸ºç¥ä½œå§â€¦â€¦ å½±è§†ç¯‡ æµæµªåœ°çƒ2 å¼€æ’­æ—¶é—´ï¼š2023.1 è¯„åˆ†ï¼š10ï¼ˆ8.6 + 1.5 = 10.1ï¼‰ æ˜¥èŠ‚æœŸé—´å‡Œæ™¨è§‚å½±ã€‚å¸…æ˜¯çœŸæ»´å¸…ï¼Œçœ‹å‡ºäº†ç¼–å‰§çªç ´å¤§åˆ˜å®‡å®™çš„é‡å¿ƒä¹Ÿæ˜¯çœŸçš„ï¼Œè‡³äºä¸€äº›ç¼ºç‚¹ï¼Œç‘•ä¸æ©ç‘œè¿˜æ˜¯æ¯”è¾ƒä¸­è‚¯çš„ã€‚ ä¸‰ä½“ï¼ˆç”µè§†å‰§ï¼‰ å¼€æ’­æ—¶é—´ï¼š2023.1 è¯„åˆ†ï¼š9ï¼ˆ8.5 + 0.5 = 9ï¼‰ ä¸‰ä½“ç”µè§†å‰§ï¼Œå…¶å®æˆ‘æ²¡æœ‰çœ‹åˆ°å¤§ç»“å±€ï¼Œä½†æ˜¯æˆ‘è§‰å¾—æœ‰å¿…è¦ç‚¹ä¸€ä¸‹ï¼Œæ¯•ç«Ÿæˆ‘å‡ ä¹ä¸çœ‹ç”µè§†å‰§ï¼Œè¿™æ¬¡æ˜¯ä¸‰ä½“çš„IPç»ˆäºæœ‰èƒ½æˆåŠŸå½±è§†åŒ–çš„è½¬æœºäº†æˆ‘æ‰ä¸€çœ‹ã€‚å½“ç„¶ï¼Œæˆ‘çš„è¯„ä»·æ˜¯éå¸¸ä¸é”™çš„ï¼Œè™½ç„¶æˆ‘è„‘å­çš„é‡Œçš„ä¸‰ä½“ä¸ä¸€å®šæ˜¯è¿™ä¸ªå‘³ï¼Œä½†å‰§ç‰ˆä¸‰ä½“çš„å‘³è‡³å°‘è¿˜æ˜¯é¦™çš„ã€‚ å…«è§’ç¬¼ä¸­ ä¸Šæ˜ æ—¶é—´ï¼š2023.7 è¯„åˆ†ï¼š8ï¼ˆ7.5 + 0.5 = 8ï¼‰ çœ‹ä¹‹å‰æ²¡æŠ±å¸Œæœ›ï¼Œçœ‹åˆ°è¿‡ç¨‹ä¸­æœ‰ç‚¹éœ‡æ’¼ï¼Œçœ‹åˆ°ç»“å±€æœ‰ç‚¹å¯æƒœçš„ä½œå“ï¼Œä½†æ˜¯æˆ‘çš„è¯„ä»·ä¾ç„¶æ˜¯â€œå¥½â€ï¼Œæ¯•ç«Ÿå£°éŸ³è¿˜æ˜¯è¶Šå¤šè¶Šå¥½ã€‚ å¥¥æœ¬æµ·é»˜ ä¸Šæ˜ æ—¶é—´ï¼š2023.7 è¯„åˆ†ï¼š10+ï¼ˆ9.2 + 1.5 = 10.7ï¼‰ è°¨ä»¥æ­¤æ®µæ€€å¿µæ±¤æ™“é¸¥è€å¸ˆï¼Œæ„Ÿè°¢ä»–åœ¨ç”Ÿå‘½çš„æœ€åä¸‰ä¸ªæœˆæ—¶ï¼ˆä¹Ÿè®¸ä»–è‡ªå·±è¿˜ä¸çŸ¥é“ï¼‰è¿˜åœ¨è®²åº§ä¸­åŠ›èè¿™éƒ¨å½±ç‰‡ã€‚â€œå¦‚ä»Šæˆ‘å·²æˆä¸ºæ­»ç¥ï¼Œä¸–ç•Œçš„æ¯ç­è€…ã€‚â€ï¼Œè°åˆçŸ¥é“äººå·¥æ™ºèƒ½ä¼šæ˜¯ä»€ä¹ˆæ ·ï¼Ÿ å…³äºç”µå½±æœ¬èº«ï¼Œæˆ‘çš„è§‚æ„Ÿå’Œçœ‹ã€Šæ¨¡ä»¿æ¸¸æˆã€‹æœ‰ä¸€äº›å…±é¸£ï¼Œéƒ½æ˜¯ä¼Ÿå¤§äººç‰©çš„ä¼ è®°ï¼Œéƒ½æ˜¯å¤æ‚å’Œä¸¥é‡çš„å¿ƒç†é—®é¢˜ï¼Œéƒ½æ˜¯ç¤¾ä¼šã€ä¸–ç•Œç”šè‡³å®‡å®™çš„æ€è€ƒã€‚"},{"title":"MuG Diffusion v1.0 æºç è§£æ","path":"/2023/12/27/MuG-Diffusion-v1-0-æºç è§£æ/","content":"è­¦å‘Šï¼ŒåŒ…å«å¤§é‡GPT4åˆ†æå’Œä»£å†™å†…å®¹ï¼Œå¯èƒ½å­˜åœ¨è°¬è¯¯ åŸä»“åº“åœ°å€ï¼šhttps://github.com/Keytoyze/Mug-Diffusion ï¼ˆ1ï¼‰æ•°æ®é›†å‡†å¤‡éƒ¨åˆ† æ•°æ®å‡†å¤‡è¿‡ç¨‹æ¦‚å†µå¦‚ä¸‹ï¼š æŠŠä¸‹è½½å¥½çš„æ•°æ®é›†ï¼ˆosuè°±é¢ï¼‰æ”¾åœ¨data/æ–‡ä»¶å¤¹ä¸‹ï¼Œå¯ä»¥å‡†å¤‡ä¸€ä¸ªå­æ–‡ä»¶å¤¹ æ•°æ®é›†æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªbeatmap.txtï¼Œè®°å½•è°±é¢å…ƒæ•°æ®ï¼Œç”¨äºä¸‹ä¸€æ­¥ æŒ‰ç…§configs/mug/mania_beatmap_features.yamlä¸­çš„é…ç½®ï¼ŒæŠ½å–è°±é¢çš„ç‰¹å¾ è°±é¢ç‰¹å¾éœ€è¦è½¬åŒ–ä¸ºæ•°æ®è¡¨ï¼Œå­˜æ”¾ä¸beatmap.txtåŒä¸€ç›®å½•ä¸‹çš„features.dbæ•°æ®åº“ä¸­ è‡³å°‘å‡†å¤‡ä¸¤ä¸ªè¿™æ ·çš„æ•°æ®é›†ï¼šä¸€ä¸ªè®­ç»ƒé›†ä¸€ä¸ªéªŒè¯é›† [mug/data] mug/data/convertor.py: å·¥å…·ç±»ï¼Œç”¨æ¥è§£æå•ä¸ª.osuè°±é¢æ–‡ä»¶ mug/data/dataset.py: æ„å»ºç”¨äºpytorchè®­ç»ƒçš„æ•°æ®é›†æ ¼å¼ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²ç»æŠ½å–äº†è°±é¢ç‰¹å¾ï¼Œå¹¶å­˜æ”¾åœ¨features.dbä¸­ mug/data/utils.py: ï¼ˆå¾…åˆ†æï¼‰ä¸€äº›ç”¨äºå¯¹é½çš„å·¥å…·å‡½æ•° å‡†å¤‡å¥½çš„æ•°æ®é›†æ¡ç›®ç¤ºä¾‹ï¼š 123456789101112131415161718192021222324252627&#123; &quot;meta&quot;: &#123; &quot;path&quot;: &quot;data/beatmap_4k/1469980 Silentroom vs. Frums - Aegleseeker/Silentroom vs. Frums - Aegleseeker ([Crz]Alleyne) [The Last Observation].osu&quot;, &quot;audio&quot;: &quot;data/beatmap_4k/1469980 Silentroom vs. Frums - Aegleseeker/audio.ogg&quot;, &quot;game_mode&quot;: 3, &quot;cs&quot;: 4.0, &quot;version&quot;: &quot;The Last Observation&quot;, &quot;set_id&quot;: 1469980 &#125;, &quot;convertor&quot;: &#123; &quot;frame_ms&quot;: 46.439909297052154, &quot;max_frame&quot;: 4096, &quot;mirror&quot;: False, &quot;random&quot;: False, &quot;mirror_at_interval_prob&quot;: 0, &quot;offset_ms&quot;: 0, &quot;rate&quot;: 1.0 &#125;, &quot;note&quot;: array([[0., 0., 0., ..., 0., 0., 0.], [0., 0., 0., ..., 0., 0., 0.], [0., 0., 0., ..., 0., 0., 0.], ..., [0., 0., 0., ..., 0., 0., 0.], [0., 0., 0., ..., 0., 0., 0.], [0., 0., 0., ..., 0., 0., 0.]], dtype=float32), &#x27;valid_flag&#x27;: array([1., 1., 1., ..., 0., 0., 0.]), &#x27;audio&#x27;: array([[0., 0., 0., ..., 0., 0., 0.], [0., 0., 0., ..., 0., 0., 0.], [0., 0., 0., ..., 0., 0., 0.], ..., [0., 0., 0., ..., 0., 0., 0.], [0., 0., 0., ..., 0., 0., 0.], [0., 0., 0., ..., 0., 0., 0.]], dtype=float32), &#x27;feature&#x27;: array([ 24, 39, 41, 53, 55, 58, 81, 110, 124, 142, 157, 179, 192, 212, 225, 237, 259, 275, 293, 314, 327])&#125; noteï¼šè°±é¢éŸ³ç¬¦çš„æ•°æ®ï¼ˆæ–‡æœ¬ -&gt; å‘é‡ï¼‰ featureï¼šè°±é¢ç‰¹å¾çš„æ•°æ®ï¼Œosuå…ƒæ•°æ®å’Œettåˆ†æ•°ç­‰ ï¼ˆæ–‡æœ¬ -&gt; å‘é‡ï¼‰ audioï¼šéŸ³é¢‘çš„å¼ é‡æ•°æ® ï¼ˆæœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæ¨¡å‹æ˜¯æ€ä¹ˆå¤„ç†é•¿åº¦ä¸åŒçš„éŸ³é¢‘çš„ï¼Ÿï¼‰ valid_flagï¼šï¼Ÿä¸€ä¸ªæ ‡è®°å‘é‡ï¼Œç”¨äºæ ‡è®°è°±é¢ä¸­çš„éŸ³ç¬¦æ˜¯å¦æœ‰æ•ˆï¼Œå³æ˜¯å¦åœ¨éŸ³é¢‘ä¸­æœ‰å¯¹åº”çš„éŸ³ç¬¦ï¼Ÿ 12345# æ•°æ®é›†ä¸­å„å¼ é‡çš„shape[&#x27;note&#x27;].shape: (16, 4096)[&#x27;audio&#x27;].shape: (128, 32768)[&#x27;feature&#x27;].shape: (21,)[&#x27;valid flag&#x27;].shape: (4096,) å¤„ç†éŸ³é¢‘çš„ç¼“å­˜.npzæ–‡ä»¶æ”¾ç½®äºdata/audio_cacheæ–‡ä»¶å¤¹ä¸­ã€‚ [scripts] å¦‚æœæˆ‘çš„åˆ¤æ–­æ²¡é”™ï¼Œå‡†å¤‡æ•°æ®è¿™ä¸ªé˜¶æ®µæ—¶å®Œå…¨æ‰‹åŠ¨çš„ï¼Œçœ‹åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„è„šæœ¬éƒ½æ²¡æœ‰è¢«å¼•ç”¨è¿‡â€¦â€¦ scripts/prepare_beatmap.py: ç”¨æœ¬åœ°ä¸‹è½½çš„osuè°±é¢äºåˆ¶ä½œbeatmap.txtï¼Œç»™å®šè¾“å…¥è¾“å‡ºæ–‡ä»¶å¤¹ scripts/prepare_ranked_beatmap.py: ä»osuç½‘ç«™ä¸Šçˆ¬å–è°±é¢ï¼Œåˆ¶ä½œbeatmap.txtï¼Œéœ€è¦ç”¨åˆ°kuitè‡ªå·±çš„ç½‘ç«™æœåŠ¡ scripts/prepare_beatmap_from_ranking_mapper.py: åŒä¸Šï¼Œä¸è¿‡ä¼¼ä¹æ˜¯ä»ç‰¹å®šçš„è°±å¸ˆidä¸­è·å– scripts/prepare_beatmap_features.py: ä»beatmap.txtä¸­è¯»å–è°±é¢å…ƒæ•°æ®ï¼ŒæŠ½å–è°±é¢ç‰¹å¾ï¼Œå¹¶æäº¤åˆ°features.dbä¸­ æŠ½å–ç‰¹å¾éœ€è¦ä»¥ä¸‹å‚æ•°ï¼š 1234567beat_map_path = beatmap.txt æ–‡ä»¶çš„è·¯å¾„ï¼Œè®°å¾—é“ºé¢æ–‡ä»¶çš„å­˜æ”¾ä½ç½®ä¸è¯¥txtä½äºåŒä¸€ç›®å½•features_yaml = é…ç½®featureæ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚&quot;configs/mug/mania_beatmap_features.yaml&quot;osu_tools = ä¸€ä¸ªosuå®˜æ–¹å¼€æºçš„è®¡ç®—osuè°±é¢ä¿¡æ¯çš„å·¥å…·ï¼Œåœ¨è¿™é‡Œä¸‹è½½ï¼šhttps://github.com/ppy/osu-tools/tree/master/PerformanceCalculatorè·å¾—æºç åï¼Œéœ€è¦ä½¿ç”¨dotnetç¼–è¯‘ï¼ˆå‚è§ä»“åº“readmeï¼‰ï¼Œç¼–è¯‘å®Œæˆåï¼Œåœ¨\\PerformanceCalculator\\bin\\Debug et6.0\\ä¸‹å¯ä»¥æ‰¾åˆ°PerformanceCalculator.dllæ–‡ä»¶ï¼Œä½¿ç”¨è¯¥æ–‡ä»¶çš„è·¯å¾„ä½œä¸ºå‚æ•°ranked_map_path = å­˜å‚¨æ¯ä¸ªè°±é¢çš„rankï¼ˆè°±é¢å®¡æ ¸ï¼‰ä¿¡æ¯ï¼Œè¯¥ä¿¡æ¯éœ€è¦é€šè¿‡é¢„å¤„ç†è·å–ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥æŒ‡å®šä¸ºNonedotnet_path = ä¸ºäº†è¿è¡ŒPerformanceCalculator.dllï¼Œéœ€è¦å®‰è£….NET6.0ï¼Œå®‰è£…å¹¶è®¾ç½®å®Œæˆç¯å¢ƒå˜é‡åï¼Œå¯ç›´æ¥ä½¿ç”¨å¡«å…¥&quot;dotnet&quot; scripts/filter_beatmap.py: ï¼ˆå¾…åˆ†æï¼‰ä¼¼ä¹æ˜¯ç”¨äºè¿‡æ»¤è°±é¢ä¸­çš„å˜é€Ÿ â€¦â€¦ å…¶ä»–è„šæœ¬ä¼¼ä¹æ˜¯ç”¨äºå¤„ç†Etternaè°±é¢çš„ï¼Œæˆ–è€…æ˜¯ä¸€äº›ç”¨äºç®—æ³•æµ‹è¯•çš„ï¼ˆç ´æ¡ˆäº†ï¼Œæ˜¯åŸæ¥stable diffusionçš„ä¸€äº›æµ‹è¯•ä»£ç ï¼‰ï¼Œè·³è¿‡è¿™ä¸€éƒ¨åˆ† æ•°æ®é›†é…ç½® å¦‚æœä½ è¦è®­ç»ƒï¼Œå¿…é¡»å‡†å¤‡åŸºæœ¬çš„ä¸¤ä¸ªæ•°æ®é›†æ–‡ä»¶å¤¹ï¼š mug.data.dataset.OsuTrainDataset mug.data.dataset.OsuVaildDataset å°†æ•°æ®é›†è·¯å¾„æŒ‡å®šåœ¨è®­ç»ƒç”¨çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œç›®å‰çš„è·¯å¾„æ˜¯configs/mug/mug_diffusion.yamlï¼Œ åŒæ—¶æœ€å¥½æœ‰ä¸€ä¸ªmug.data.dataset.OsuTestDatasetæ•°æ®é›†ï¼Œç”¨äºæµ‹è¯•. è®­ç»ƒæ•°æ®é›†ç¤ºä¾‹ç»“æ„ï¼š TODO ï¼ˆ2ï¼‰VAEç¼–è§£ç éƒ¨åˆ† è¿™éƒ¨åˆ†çš„ç›®çš„æ˜¯ä¸ºäº†å¾—åˆ°ä¸¤ä¸ªæ¨¡å‹ï¼š Encoderï¼šå°†è°±é¢ä¿¡æ¯ç¼–ç ä¸ºä¸€ä¸ªå‘é‡ Decoderï¼šå°†ä¸€ä¸ªå‘é‡è§£ç ä¸ºè°±é¢ä¿¡æ¯ [mug/firststage] è¿™éƒ¨åˆ†ç”¨äºå®ç°AutoEncoderï¼Œè‡ªåŠ¨ç¼–ç å™¨æ˜¯ä¸€ç§æ— ç›‘ç£å­¦ä¹ çš„ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œä¸»è¦ç”¨äºå­¦ä¹ è¾“å…¥æ•°æ®çš„å‹ç¼©è¡¨ç¤º AutoEncoderçš„ç»“æ„å¦‚ä¸‹ï¼š å…¶ä¸­åŒ…å«ä¸¤ä¸ªtorch.nn.Moduleç±»çš„ç»„ä»¶ï¼šç¼–ç å™¨ï¼ˆEncoderï¼‰å’Œè§£ç å™¨ï¼ˆDecoderï¼‰ã€‚ç¼–ç å™¨çš„ä½œç”¨æ˜¯å°†è¾“å…¥æ•°æ®å‹ç¼©ä¸ºä¸€ä¸ªä½ç»´åº¦çš„è¡¨ç¤ºï¼Œè€Œè§£ç å™¨åˆ™å°†è¿™ä¸ªä½ç»´åº¦çš„è¡¨ç¤ºæ¢å¤ä¸ºåŸå§‹çš„é«˜ç»´åº¦æ•°æ® æ³¨æ„ï¼šmug/firststage/autoencoder.pyä¸­çš„éƒ¨åˆ†æ¨¡å‹ä½¿ç”¨çš„ç½‘ç»œæ¨¡å—å®šä¹‰åœ¨mug/model/modules.pyä¸­ Encoderæ¨¡å‹ç»“æ„ï¼š è¾“å…¥é€šé“æ•°C=16 ç»è¿‡ä¸€ä¸ª3*3çš„å·ç§¯å±‚ï¼Œè¾“å‡ºä¸­é—´é€šé“æ•°64 ç»è¿‡ä¸€ç³»åˆ—ä¸‹é‡‡æ ·æ“ä½œï¼šåœ¨æ¯æ¬¡ä¸‹é‡‡æ ·ä¹‹å‰ï¼Œå…ˆç»è¿‡ä¸€ä¸ªæ®‹å·®å—ï¼Œå¹¶è®©æ¯ä¸¤æ¬¡ä¸‹é‡‡æ ·åï¼Œç½‘ç»œçš„é€šé“æ•°ç¿»å€ å³: 64 * [1,1,2,2,4,4] ä¸‹é‡‡æ ·ç½‘ç»œï¼šå¯é€‰ å·ç§¯ æˆ– å¹³å‡æ± åŒ– å·ç§¯ï¼š3*3å·ç§¯å±‚ï¼Œstride=2 å¹³å‡æ± åŒ–ï¼š2*2å¹³å‡æ± åŒ–å±‚ï¼Œstride=2 ä¸­é—´å±‚ï¼šä½¿ç”¨2ä¸ªæ®‹å·®å—ï¼Œæ¯ä¸ªæ®‹å·®å—åŒ…å«ä¸¤ä¸ª3*3å·ç§¯å±‚ï¼Œé€šé“æ•°ä¸å˜ è¾“å‡ºå±‚ï¼šé¦–å…ˆé€šè¿‡ä¸€ä¸ªå½’ä¸€åŒ–å±‚å¯¹æ•°æ®è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œç„¶åé€šè¿‡ä¸€ä¸ª33å·ç§¯å±‚å°†æ•°æ®çš„é€šé“æ•°è½¬æ¢ä¸ºç¼–ç å™¨çš„è¾“å‡ºé€šé“æ•°ï¼Œè¾“å‡º ç›®æ ‡è¾“å‡ºé€šé“æ•°2 çš„å‘é‡è¡¨ç¤º å¦‚ï¼šç›®æ ‡è¾“å‡ºé€šé“æ•°ä¸º32ï¼Œåˆ™è¾“å‡º64ç»´çš„å‘é‡è¡¨ç¤º Decoderæ¨¡å‹ç»“æ„ï¼š ä¸Encoderæ¨¡å‹ç»“æ„æ­£å¥½ç›¸åï¼Œå…ˆå°†è¾“å…¥å‘é‡å·ç§¯åˆ°ä¸­é—´å±‚ï¼Œç„¶åå†ç»è¿‡ä¸€ç³»åˆ—ä¸Šé‡‡æ ·æ“ä½œï¼Œæœ€åç»è¿‡å½’ä¸€åŒ–å’Œä¸€ä¸ª3*3å·ç§¯å±‚ï¼Œè¾“å‡ºç›®æ ‡è¾“å‡ºé€šé“æ•°çš„å‘é‡è¡¨ç¤º æŸå¤±å‡½æ•°ï¼šAutoEncoderKLç±»ä½¿ç”¨äº†ä¸¤ä¸ªæŸå¤±å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯é‡æ„æŸå¤±å’ŒKLæ•£åº¦æŸå¤± é‡æ„æŸå¤±ï¼šåœ¨mug/firststage/losses.pyä¸­å®šä¹‰ï¼Œè®¡ç®—é‡æ„çš„è°±é¢æ•°æ®ä¸åŸå§‹è°±é¢æ•°æ®çš„è¯¯å·®ï¼ŒåŒ…æ‹¬å¤šç§è¯¯å·®è®¡ç®—æ–¹å¼ KLæŸå¤±ï¼šè®¡ç®—ç¼–ç å™¨è¾“å‡ºçš„å‡å€¼å’Œæ–¹å·®ä¸æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„KLæ•£åº¦ KLæŸå¤±åœ¨åŠ å…¥æ€»æŸå¤±æ—¶ï¼Œéœ€è¦ä¹˜ä»¥ä¸€ä¸ªæƒé‡ç³»æ•°self.kl_weightï¼Œé»˜è®¤ä¸º0ï¼ˆä¸è€ƒè™‘KLæŸå¤±ï¼‰ AutoEncoderæ¨¡å‹çš„ä½¿ç”¨ï¼š å‚è§ä¸‹é¢diffusionçš„éƒ¨åˆ† ï¼ˆ3ï¼‰Diffusionè®­ç»ƒéƒ¨åˆ† æ¡ä»¶åµŒå…¥æ¨¡å‹ [mug/cond] mug/condè¿™ä¸ªæ–‡ä»¶å¤¹é‡Œå®ç°çš„éƒ½æ˜¯æ¡ä»¶ç¼–ç æ¨¡å‹ï¼Œå³å°†è°±é¢çš„ç‰¹å¾æç¤ºä¿¡æ¯å’ŒéŸ³é¢‘ä¿¡æ¯ä¸€èµ·ç¼–ç ï¼Œç„¶åè¾“å…¥Diffusionæ¨¡å‹çš„å»å™ªè¿‡ç¨‹ï¼Œç”¨æ¥æ§åˆ¶è¾“å‡ºç»“æœçš„æ¡ä»¶å‘é‡ã€‚ ç‰¹å¾è¾“å…¥ï¼šç‰¹å¾å®šä¹‰åœ¨ç¬¦åˆyamlæ ¼å¼çš„æ–‡æœ¬ä¸Šï¼Œé‡Œé¢çš„ä¿¡æ¯åŒ…æ‹¬å¦‚ éš¾åº¦srï¼Œlong noteæ¯”ä¾‹ï¼Œé”®å½¢ç‰¹å¾ç­‰ï¼Œè®­ç»ƒæ—¶ç‰¹å¾å­˜å‚¨åœ¨æ•°æ®é›†çš„databaseé‡Œï¼Œæ¨ç†æ˜¯å¯ä»¥æ‰‹åŠ¨è¾“å…¥ï¼Œæˆ–æ˜¯ä»ä¸€å¼ æƒ³è¦å‚è€ƒçš„è°±é¢ä¸­æå–å‡ºæ¥ éŸ³é¢‘è¾“å…¥ï¼šé€šè¿‡é¢‘è°±å˜æ¢ç¦»æ•£åŒ–åçš„éŸ³é¢‘æ•°æ®ï¼Œæœ‰å¤šç§å¤„ç†æ–¹å¼ noise levelï¼š[ä¸çŸ¥é“è¿™ä¸ªæ˜¯åœ¨å“ªé‡Œè¢«åµŒå…¥çš„â€¦â€¦] feature_cond.py - BeatmapFeatureEmbedder è°±é¢ç‰¹å¾ï¼ˆæç¤ºï¼‰åµŒå…¥ ä¸»è¦æ¨¡å‹ä¸ºBeatmapFeatureEmbedderçš„ç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ªtorch.nn.Moduleï¼Œç”¨äºå®ç°ç‰¹å¾ç¼–ç å’ŒåµŒå…¥ã€‚ è¿™é‡ŒåµŒå…¥çš„ç‰¹å¾æ˜¯è°±é¢å…ƒæ•°æ®ï¼Œå³configs/mug/mania_beatmap_features.yamlä¸­å®šä¹‰çš„ç‰¹å¾ã€‚è¯¥æ–‡ä»¶è·¯å¾„éœ€è¦ä½œä¸ºå‚æ•°ä¼ å…¥çš„æ„é€ å‡½æ•°ä¸­ã€‚ è¯»å…¥mania_beatmap_features.yamlæ–‡ä»¶çš„ä¿¡æ¯åï¼Œä¼šä½¿ç”¨mug/util.pyä¸­çš„count_beatmap_featureså‡½æ•°ï¼Œè®¡ç®—æ¯ä¸ªç‰¹å¾éœ€è¦åœ¨åµŒå…¥å‘é‡ä¸­ç”¨å‡ ä¸ªå€¼æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªboolç±»å‹çš„ç‰¹å¾éœ€è¦3ä¸ªå€¼ï¼ˆè¡¨ç¤ºTrue/Falseæˆ–è€…æ²¡æœ‰è¿™ä¸ªç‰¹å¾ï¼‰ã€‚ ä½¿ç”¨ torch.nn.Embeddingåˆ›å»ºä¸€ä¸ªåµŒå…¥å±‚self.embeddingï¼Œå…¶ç»´åº¦ä¸ºä¼ å…¥çš„å‚æ•°çš„embed_dimã€‚ 12345def __init__(self, path_to_yaml, embed_dim): super().__init__() with open(path_to_yaml) as f: self.feature_dicts = yaml.safe_load(f) self.embedding = torch.nn.Embedding(count_beatmap_features(self.feature_dicts), embed_dim) forwardæ–¹æ³•æ˜¯æ¨¡å‹çš„å‰å‘ä¼ æ’­è¿‡ç¨‹ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªè¾“å…¥xï¼Œå°†å…¶è½¬æ¢ä¸ºé•¿æ•´å‹ï¼Œç„¶åé€šè¿‡åµŒå…¥å±‚è¿›è¡Œè½¬æ¢ã€‚æœ€åï¼Œä½¿ç”¨rearrangeå‡½æ•°è°ƒæ•´å¼ é‡çš„ç»´åº¦é¡ºåºã€‚ patternè§£é‡Šï¼š è¾“å…¥æ—¶äºŒç»´å‘é‡ï¼Œå…¶å½¢çŠ¶ä¸º[B, F]ï¼Œå…¶ä¸­Bä»£è¡¨æ‰¹æ¬¡å¤§å°ï¼ŒFä»£è¡¨ç‰¹å¾æ•°é‡ã€‚ ç»è¿‡åµŒå…¥å±‚åï¼Œè¾“å‡ºçš„å½¢çŠ¶ä¸º[B, F, H]ï¼Œå…¶ä¸­Hä»£è¡¨åµŒå…¥å‘é‡çš„ç»´åº¦ï¼Œå³å‚æ•°embed_dimã€‚ 123def forward(self, x): x = rearrange(self.embedding(x.long()), &quot;b f h -&gt; b h f&quot;) # [B, H, F] return x summaryæ–¹æ³•ä½¿ç”¨torchsummaryåº“çš„summaryå‡½æ•°ï¼Œæ‰“å°å‡ºæ¨¡å‹çš„æ¦‚è¦ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¾“å‡ºå¤§å°ã€å‚æ•°æ•°é‡ã€å†…æ ¸å¤§å°ç­‰ã€‚ 123456def summary(self): import torchsummary torchsummary.summary(self, input_data=[5, ], dtypes=[torch.long], col_names=(&quot;output_size&quot;, &quot;num_params&quot;, &quot;kernel_size&quot;), depth=10, device=torch.device(&quot;cpu&quot;)) æµ‹è¯•ï¼šè¾“å…¥ä¸€ä¸ªç‰¹å¾é…ç½®æ–‡ä»¶ï¼Œæ‰“å°å‡ºæ¨¡å‹çš„æ¦‚è¦ä¿¡æ¯ã€‚ 123if __name__ == &#x27;__main__&#x27;: BeatmapFeatureEmbedder(path_to_yaml=&quot;configs/mug/mania_beatmap_features.yaml&quot;, embed_dim=128).summary() wave.py - éŸ³é¢‘æ•°æ®åµŒå…¥ è¿™é‡Œå®šä¹‰äº†STFTEncoderï¼ŒMelspectrogramEncoderç­‰æ¨¡å‹ï¼Œä¸»è¦å®ç°å°†éŸ³é¢‘ä¿¡æ¯ç¼–ç ä¸ºåµŒå…¥å‘é‡ STFTEncoderç±»æ˜¯ä¸€ä¸ªéŸ³é¢‘ç¼–ç å™¨ï¼Œä½¿ç”¨äº†çŸ­æ—¶å‚…é‡Œå¶å˜æ¢ï¼ˆSTFTï¼‰è¿›è¡ŒéŸ³é¢‘ç¼–ç ã€‚ MelspectrogramEncoderå’ŒMelspectrogramEncoder1Dç±»æ˜¯å¦å¤–ä¸¤ç§éŸ³é¢‘ç¼–ç å™¨ï¼Œä½¿ç”¨äº†æ¢…å°”é¢‘è°±å›¾ï¼ˆMelspectrogramï¼‰è¿›è¡ŒéŸ³é¢‘ç¼–ç ã€‚ S4BidirectionalLayerç±»æ˜¯ä¸€ä¸ªåŒå‘S4æ¨¡å‹å±‚ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªå½’ä¸€åŒ–å±‚å’Œä¸€ä¸ªåŒå‘S4æ¨¡å‹ã€‚ TimingDecoderç±»æ˜¯ä¸€ä¸ªè§£ç å™¨ï¼Œå®ƒç”¨äºå°†ç¼–ç åçš„éŸ³é¢‘æ•°æ®è§£ç å›åŸå§‹æ•°æ® MelspectrogramScaleEncoder1Dç±»æ˜¯ä¸€ä¸ªä¸€ç»´çš„æ¢…å°”é¢‘è°±å›¾ç¼–ç å™¨ï¼Œå®ƒä½¿ç”¨äº†æ³¨æ„åŠ›æœºåˆ¶è¿›è¡ŒéŸ³é¢‘ç¼–ç ã€‚ å®é™…æ¨¡å‹è®­ç»ƒæ—¶ï¼Œé€šè¿‡æŒ‡å®šyamlé…ç½®æ–‡ä»¶ä¸­çš„wave_stage_configå­—æ®µé€‰æ‹©éŸ³é¢‘ç¼–ç æ¨¡å‹ã€‚ åœ¨å·²çŸ¥çš„ä¸¤ç§çš„é…ç½®ä¸­ï¼Œç¼–ç éŸ³é¢‘åˆ†åˆ«ä½¿ç”¨äº†STFTEncoderå’ŒMelspectrogramScaleEncoder1Dæ¨¡å‹ï¼Œåˆ†åˆ«å¯¹åº”é…ç½®æ–‡ä»¶mug_diffusion_stft.yaml å’Œmug_diffusion.yaml LDM/DDPMæ¨¡å‹ - [mug/diffusion] æ¨¡å‹è®­ç»ƒä½¿ç”¨çš„æ˜¯Pytorch-Lightningæ¡†æ¶ï¼Œè¿™æ˜¯ä¸€ä¸ªpytorchæ·±åº¦ç¥ç»ç½‘ç»œapiçš„æŠ½è±¡å’ŒåŒ…è£…ã€‚å®ƒçš„å¥½å¤„æ˜¯å¯å¤ç”¨æ€§å¼ºï¼Œæ˜“ç»´æŠ¤ï¼Œé€»è¾‘æ¸…æ™°ç­‰ã€‚ ä¸»è¦çš„ä»£ç ç»“æ„(æœ¬é¡¹ç›®ä¸»è¦åœ¨mugç›®å½•ä¸‹)ï¼š 12345678-mug/ |-data/ |-... æ•°æ®é›†çš„ä¸­é—´æ¥å£ |-model/ |-... æ¨¡å‹çš„ä¸­é—´æ¥å£ -lr_scheduler.py -util.py-main.py å®šä¹‰å‘½ä»¤è¡Œå‚æ•°ï¼Œå®ä¾‹åŒ–æ•°æ®é›†ã€æ¨¡å‹ã€Trainerï¼Œå¼€å§‹è®­ç»ƒ diffusion.py - DDPMæ¨¡å‹ mug/diffusion/diffusion.pyæ˜¯æ‰©æ•£æ¨¡å‹çš„æ ¸å¿ƒæ–‡ä»¶ï¼Œæ ¹æ®DDPMè®ºæ–‡çš„æ–¹æ³•å®ç°äº†æ•´ä¸ªæ¡†æ¶æ¨¡å‹ï¼Œå› æ­¤ç±»åä¹Ÿå«DDPMï¼š DDPMç»§æ‰¿äº†pl.LightningModuleç±»ã€‚ä¸€ä¸ªç»§æ‰¿äº†pl.LightningModuleçš„ç±»è¢«ç§°ä¸ºLightning Moduleï¼Œéœ€è¦å®ç°ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒçš„ç»„ä»¶ï¼š 1 æ¨¡å‹ï¼šself.modelï¼Œè®­ç»ƒç”¨çš„æ¨¡å‹ç½‘ç»œï¼Œå¯åµŒå¥—torch.nn.Moduleç±»å‹ 2 ä¼˜åŒ–å™¨ï¼šå®ç°configure_optimizers()å‡½æ•°ï¼Œå…¶è¿”å›å€¼å¯ä»¥æ˜¯ä¸€ä¸ªä¼˜åŒ–å™¨æˆ–æ•°ä¸ªä¼˜åŒ–å™¨ï¼Œåˆæˆ–æ˜¯ä¸¤ä¸ªListï¼ˆä¼˜åŒ–å™¨ï¼ŒSchedulerï¼‰ 3 è®­ç»ƒæ­¥éª¤ï¼šå®ç°ä»¥ä¸‹å‡½æ•°ï¼š forward()å‡½æ•°ï¼Œå®šä¹‰å‰å‘è½¬æ’­è¿‡ç¨‹ï¼Œè¿”å›å¦‚ä½•è®¡ç®—æŸå¤±ï¼Œè¿™æ˜¯ç”¨æ¥åšæ¢¯åº¦ä¸‹é™çš„ training_step()å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å…¶å®æ˜¯åŒ…è£…äº†ä¸€ä¸ªpytorchçš„è®­ç»ƒè¿‡ç¨‹ï¼ˆå°±æ˜¯ä¸€ä¸ªforå¾ªç¯ï¼Œå¦‚æœä½ å­¦è¿‡åŸºç¡€çš„pytorchç¥ç»ç½‘ç»œå®ç°çš„è¯ï¼‰ å…¶æ¥æ”¶ä¸€ä¸ªbatchçš„æ¥è‡ªè®­ç»ƒæ•°æ®é›†çš„æ•°æ®ï¼Œç„¶åï¼Œé€šå¸¸è¿™ä¸ªå‡½æ•°ä¼šè°ƒç”¨ç±»è‡ªèº«ï¼ˆself(batch)ï¼‰ï¼Œæ¥é€šè¿‡å·²å®šä¹‰çš„æ¨¡å‹å¯¹æ•´ä¸ªæ‰¹é‡è¿›è¡Œä¸€æ­¥æ¨ç†ï¼Œ ç„¶åæ ¹æ®forward()ä¸­çš„å®šä¹‰è®¡ç®—lossæŸå¤±ã€‚ éœ€è¦è¿”å›ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«losså’Œlogä¸¤ä¸ªå­—æ®µã€‚lossè¿”å›æŸå¤±ï¼Œlogåˆ™æ˜¯å¯é€‰çš„ï¼Œè®°å½•ä¸€äº›éœ€è¦è®°å½•çš„ä¿¡æ¯ï¼Œlosså­—æ®µä¸€å®šè¦å­˜åœ¨ï¼Œ å¦åˆ™pytorch lightningä¼šè®¤ä¸ºæ­¤batchæ˜¯æ— æ•ˆçš„ï¼Œä»è€Œè¢«è·³è¿‡è®­ç»ƒéƒ¨åˆ†ã€‚ validation_step()å‡½æ•°ï¼š[å¯é€‰]ã€‚åŠŸèƒ½å’Œtraining_step()å‡½æ•°ä¸€æ ·ï¼Œä¸è¿‡æ˜¯åœ¨éªŒè¯è¿‡ç¨‹ä¸­è°ƒç”¨çš„ï¼Œä¸ä¼šå»æ›´æ–°æ¨¡å‹çš„æƒé‡ï¼Œåªè¾“å‡ºlogä¿¡æ¯ï¼Œ ä¸»è¦æ˜¯ç»™ä½ ä¸€ä¸ªå·¥å…·ï¼Œç”¨æ¥è‡ªå®šä¹‰è¾“å‡ºéªŒè¯è¿‡ç¨‹ä¸­è¦è§‚å¯Ÿçš„å˜é‡çš„ã€‚ training_epoch_end()å‡½æ•°ï¼š[å¯é€‰]ã€‚è¿™ä¸ªå‡½æ•°æ˜¯åœ¨æ¯ä¸ªepochç»“æŸæ—¶è°ƒç”¨çš„ï¼Œç”¨äºè®°å½•ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚è®­ç»ƒé›†çš„å¹³å‡æŸå¤±ç­‰ã€‚ å›åˆ°DDPMç±»æœ¬èº«ï¼Œåœ¨å®šä¹‰æ¨¡å‹æ—¶ï¼Œä½¿ç”¨çš„è¯­å¥æ˜¯ï¼š 12# mug/diffusion/diffusion.pyself.model = MugDiffusionWrapper(unet_config, first_stage_config, wave_stage_config, cond_stage_config) è¿™é‡Œï¼Œé¢å¤–å®šä¹‰äº†ä¸€ä¸ªMugDiffusionWrapperç±»ï¼Œç”¨æ¥åŒ…è£…MuG Diffusionæ¨¡å‹ä¸­åŒ…å«çš„å››ä¸ªå­æ¨¡å‹ï¼Œåˆ†åˆ«æ˜¯ï¼š cond_stage_modelï¼šå‰æ–‡æ‰€è¿°çš„BeatmapFeatureEmbedderæ¨¡å‹ï¼Œç”¨æ¥å¾—åˆ°ã€è°±é¢æç¤ºã€‘çš„å‹ç¼©è¡¨ç¤ºï¼ˆç”±å¯è¯»æ•°æ®å‹ç¼©åˆ°å‘é‡ï¼‰ è°±é¢æ•°æ®åŒ…å« osuçš„è°±é¢å…ƒæ•°æ®ï¼ˆéš¾åº¦ç­‰ï¼‰å’Œ é€šè¿‡minacalcè®¡ç®—å¾—åˆ°çš„è°±é¢æç¤ºï¼ˆå„ä¸ªé”®å½¢çš„åˆ†å¸ƒã€é”®å½¢éš¾åº¦ç­‰ï¼‰ï¼Œä¸åŒ…å«noteæ•°æ® wave_modelï¼šå‰æ–‡æ‰€è¿°çš„STFTEncoderæˆ–MelspectrogramScaleEncoder1Dæ¨¡å‹ï¼Œç”¨æ¥ç¼–ç å’Œè§£ç ã€éŸ³é¢‘æ³¢å½¢ã€‘ï¼ˆç”±éŸ³é¢‘æ•°æ®åˆ°æ¡ä»¶å‘é‡ï¼Ÿï¼‰ first_stage_modelï¼šå‰æ–‡æ‰€è¿°çš„AutoEncoderKLæ¨¡å‹ï¼Œç”¨æ¥ç¼–ç å’Œè§£ç  ã€è°±é¢noteæ•°æ®ã€‘ï¼ˆä» å‘é‡ ç¼–ç åˆ° æ½œç©ºé—´å‘é‡ å’Œ ä» æ½œç©ºé—´å‘é‡ è§£ç ï¼‰ unet_modelï¼šä¸Stable Diffusionç±»ä¼¼çš„U-Netç»“æ„ï¼Œç”¨æ¥å­¦ä¹ åå‘æ‰©æ•£å»å™ªï¼ˆDenosingï¼‰çš„æ­¥éª¤ å³ï¼Œunet_modelæ¥å—æ½œç©ºé—´çš„ä¸¤ç§è¾“å…¥ï¼š1ã€ã€æ½œç©ºé—´çš„è°±é¢å‘é‡æ•°æ®ã€‘2ã€ã€æ¡ä»¶åµŒå…¥å‘é‡ï¼ŒåŒ…æ‹¬éŸ³é¢‘å’Œè°±é¢ç‰¹å¾ï¼ˆå³â€œæç¤º promptâ€ï¼‰ã€‘ï¼Œ é€šè¿‡å¤šæ­¥æ‰©æ•£è¿­ä»£ï¼Œå­¦ä¹ æ­£å‘æ‰©æ•£å‚æ•°ï¼Œæˆ–æ˜¯åå‘æ‰©æ•£è¾“æ–°çš„è°±é¢å‘é‡è¡¨ç¤ºã€‚ åœ¨è®­ç»ƒæ—¶ï¼Œunet_modelçš„è¾“å…¥æ˜¯ä¸€ä¸ªã€è®­ç»ƒæ•°æ®é›†çš„è°±é¢æ½œç©ºé—´å‘é‡ã€‘å’Œã€è¯¥è°±é¢å¯¹åº”çš„éŸ³é¢‘å‘é‡ã€æç¤ºå‘é‡ã€‘ï¼Œè¾“å‡ºæ˜¯ä¸€ä¸ªã€æ½œç©ºé—´å‘é‡ã€‘ï¼Œ æ¯ä¸€æ¬¡è¿­ä»£ï¼Œéƒ½ä¼šä½¿å¾—ã€æ½œç©ºé—´å‘é‡ã€‘æ¥è¿‘äºä»é«˜æ–¯åˆ†å¸ƒé‡‡æ ·çš„ã€å™ªå£°æ•°æ®ã€‘ï¼Œå¹¶åŒæ—¶æ›´æ–°ç½‘ç»œæƒé‡ åœ¨æ¨ç†ç”Ÿæˆæ–°è°±é¢æ—¶ï¼Œunet_modelçš„è¾“å…¥æ˜¯ä¸€ä¸ªã€ä»é«˜æ–¯åˆ†å¸ƒç§é‡‡æ ·çš„å™ªå£°è°±é¢å‘é‡ã€‘å’Œã€ç”¨æˆ·æƒ³è¦çš„è°±é¢éŸ³é¢‘å’Œç‰¹å¾çš„è¾“å…¥å‘é‡ã€‘ï¼Œé€šè¿‡å¤šæ¬¡åå‘æ‰©æ•£ï¼Œ å¾—åˆ°ç”Ÿæˆçš„ã€è°±é¢æ½œç©ºé—´å‘é‡ã€‘ï¼Œé€šè¿‡first_stage_modelè§£ç å¾—åˆ°å¯è¯»çš„ã€è°±é¢noteæ•°æ®ã€‘ æ¯ä¸ªæ¨¡å‹çš„è¯¦ç»†ç»“æ„åœ¨ä¸‹ä¸€ä¸ªå°èŠ‚æè¿° å¯¹æ¯”ï¼šStable Diffusionï¼ˆv1ï¼‰çš„æ¨¡å‹æ¨¡å—å’Œ MuG Diffusionçš„æ¨¡å‹æ¨¡å— è¾“å…¥ç¼–ç å™¨ï¼ˆæ¡ä»¶åµŒå…¥ï¼‰ æ½œç©ºé—´æ‰©æ•£ç½‘ç»œ è¾“å‡ºè§£ç å™¨ Stable Diffusion åŸºäº CLIP æ¨¡å‹çš„æ–‡æœ¬ç¼–ç å™¨ U-Net AutoEncoderï¼ˆå›¾åƒï¼‰ MuG Diffusion åŸºäºSTFT/Melçš„éŸ³é¢‘ç¼–ç å™¨ + è°±é¢æç¤ºåµŒå…¥ U-Netï¼ˆé­”æ”¹ï¼‰ AutoEncoderï¼ˆè°±é¢Noteï¼‰ DDPMä½¿ç”¨çš„ä¼˜åŒ–å™¨æ˜¯AdamWï¼Œå¦‚æœyamlé…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†å­¦ä¹ ç‡è°ƒåº¦å™¨ï¼Œè¿˜ä¼šä½¿ç”¨Pytorchçš„LambdaLRåˆ›å»ºä¸€ä¸ªå­¦ä¹ äº†è°ƒåº¦å™¨ã€‚ 1234567# mug/diffusion/diffusion.pyopt = torch.optim.AdamW(params, lr=lr)...if self.use_scheduler: assert &#x27;target&#x27; in self.scheduler_config scheduler = instantiate_from_config(self.scheduler_config)... åœ¨MuG Diffusionçš„ä¸¤ç§é…ç½®æ–‡ä»¶é‡Œï¼Œmug_diffusion.yamlä¸­å®šä¹‰äº†å­¦ä¹ ç‡è°ƒåº¦å™¨ä¸ºStable Diffusionä½¿ç”¨çš„ ldm.lr_scheduler.LambdaLinearSchedulerï¼Œè€Œmug_diffusion_stft.yamlä¸­æ²¡æœ‰å®šä¹‰å­¦ä¹ ç‡è°ƒåº¦å™¨ unet.py - U-Netæ¨¡å‹ mug/diffusion/unet.pyä¸­å®šä¹‰äº†U-Netæ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹æ˜¯DDPMçš„æ ¸å¿ƒï¼Œç”¨äºè¿›è¡Œæ½œç©ºé—´çš„æ‰©æ•£å’Œåå‘æ‰©æ•£ã€‚ wave_modelã€cond_stage_modelå’Œfirst_stage_modelï¼ˆå³VAEï¼‰çš„è¾“å‡ºéƒ½å°†ä½œä¸ºU-Netçš„è¾“å…¥ï¼Œä¸‹é¢ä»æ¨¡å‹è¾“å…¥å’Œè¾“å‡ºçš„shapeç®€è¦æè¿°ä¸€ä¸‹æ¨¡å‹ã€‚ 1234567891011# mug/diffusion/diffusion.py ... def forward(self, x, t, c, w): &quot;&quot;&quot; x å¯¹åº” UNetModel çš„ x å‚æ•°ï¼Œè¡¨ç¤ºè¾“å…¥çš„ç‰¹å¾å¼ é‡ã€‚ t å¯¹åº” UNetModel çš„ timesteps å‚æ•°ï¼Œè¡¨ç¤ºæ—¶é—´æ­¥é•¿ã€‚ c å¯¹åº” UNetModel çš„ context å‚æ•°ï¼Œè¡¨ç¤ºä¸Šä¸‹æ–‡ä¿¡æ¯[è°±é¢æç¤º]ï¼Œç”¨äºæ¡ä»¶ç”Ÿæˆ *w å¯¹åº” UNetModel çš„ *audios å‚æ•°ï¼Œè¡¨ç¤ºéŸ³é¢‘æ•°æ®ï¼Œç”¨äºéŸ³é¢‘å¤„ç† &quot;&quot;&quot; return self.unet_model(x, t, c, *w) ... æ•´ä¸ªç½‘ç»œçš„ç»“æ„éµå¾ªUNetçš„å…¸å‹ç¼–ç å™¨-è§£ç å™¨ç»“æ„ï¼Œé€šè¿‡é€æ¸å¢åŠ å’Œå‡å°‘ç‰¹å¾å›¾çš„å°ºå¯¸æ¥å­¦ä¹ ä¸°å¯Œçš„ç‰¹å¾è¡¨ç¤ºï¼Œæœ€ç»ˆè¾“å‡ºä¸è¾“å…¥ç›¸åŒå°ºå¯¸çš„å¼ é‡ã€‚ U-Netæ¨¡ä»¿äº†Stable Diffusionä¸­çš„U-Netç»“æ„ï¼ŒåŒ…æ‹¬æ³¨æ„åŠ›å±‚ç­‰ï¼Œä½†æ˜¯åšäº†ä¸€äº›æ”¹åŠ¨ï¼Œä¸»è¦æ˜¯ä¸ºäº†é€‚åº”ã€éŸ³é¢‘æ•°æ®å…·æœ‰å¤©ç„¶çš„æ—¶åºæ€§ã€‘ã€‚ Stable Diffusion U-Netçš„ç»“æ„å‚è§ï¼ˆå›¾æºæ°´å°ï¼‰ï¼š å› æ­¤ï¼ŒU-Netæ¨¡å‹ä¸­å¯ä»¥é€‰æ‹©åŠ å…¥ä¸‹é¢çš„éƒ¨åˆ†æ¥å¢å¼ºæ¨¡å‹å¤„ç†åºåˆ—æ•°æ®çš„èƒ½åŠ›ã€‚ LSTMå±‚ï¼Œä½¿ç”¨LSTMæ¨¡å‹å¤„ç†æ—¶åºä¿¡æ¯ï¼Œè¿™ä¹Ÿæ˜¯å‚è€ƒå·²æœ‰ç”Ÿæˆè°±é¢çš„å·¥ä½œï¼Œå¤§å¤šé‡‡ç”¨äº†LSTMå—æ¥è®¾è®¡ç½‘ç»œã€‚ S4å±‚ï¼šä½¿ç”¨Structured State Spaceï¼ˆS4ï¼‰æ¨¡å‹ï¼Œæ˜¯ä¸€ç§åŸºäºçŠ¶æ€ç©ºé—´æ¨¡å‹ï¼ˆSSMï¼‰çš„æ–°å‹åºåˆ—å»ºæ¨¡æ–¹æ³•ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯è¿ç»­æ—¶é—´çš„ï¼Œå¹¶ä¸”åœ¨å»ºæ¨¡æ•°æ®ä¸­çš„é•¿æœŸä¾èµ–æ€§æ–¹é¢è¡¨ç°å‡ºè‰²ã€‚ æ¨¡å‹ç»“æ„æµç¨‹æè¿°ï¼š [ i ] é¦–å…ˆè¿›è¡Œä¸€ä¸ªå·ç§¯ï¼Œå°†è¾“å…¥å¼ é‡æ•°æ®ï¼ˆè°±é¢noteæ•°æ®ï¼‰çš„é€šé“æ•°è½¬æ¢ä¸ºmodel_channels ï¼ˆmodel_channelsæ˜¯é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„å‚æ•°(128)ï¼Œä»£è¡¨æ¨¡å‹çš„é€šé“æ•°ï¼‰ã€‚ [ ii ] Downstampsï¼ˆinput_blocksï¼‰ ä¸‹é‡‡æ ·:&quot;Uâ€œå½¢çŠ¶çš„å·¦åŠè¾¹ï¼Œæ¯æ¬¡é€šè¿‡ä¸¤ä¸ªç½‘ç»œæ¨¡å—ï¼š 1ã€AudioConcatBlockï¼Œå°†å½“å‰åˆ†è¾¨ç‡ç­‰çº§çš„éŸ³é¢‘é€šé“æ•°ç›´æ¥åŠ åˆ°åˆ°æ¨¡å‹çš„é€šé“æ•°ä¸­ï¼Œå¹¶è¿æ¥éŸ³é¢‘æ•°æ®å’Œè¾“å…¥æ•°æ®ã€‚ éŸ³é¢‘é€šé“æ•°å¯¹äºä¸åŒçš„é‡‡æ ·åˆ†è¾¨ç‡åˆ†åˆ«æ˜¯[256,512,512,512] 2ã€ä¸€ä¸ªResBlockï¼ˆæ®‹å·®å—ï¼‰ï¼Œå…¶ä¸­åŒ…å«ä¸‰å±‚ï¼š ç¬¬ä¸€ TimestepResBlockï¼Œå’ŒStable Diffusionçš„æ–¹æ³•ä¸€æ ·ï¼Œå°†æ—¶é—´æ­¥æ•°æ®åµŒå…¥åˆ°æ®‹å·®å—ä¸­ï¼ˆæ²¡ç»†çœ‹ï¼Œä¸çŸ¥é“è¿™é‡Œæœ‰æ²¡æœ‰é­”æ”¹â€¦â€¦ ç¬¬äºŒ ContextualTransformerï¼ˆè‡ªå®šä¹‰æ³¨æ„åŠ›å±‚ï¼‰ï¼Œ ç¬¬ä¸‰ï¼šæŒ‰ç…§é…ç½®ä¸­çš„æŒ‡å®šï¼Œåœ¨æ³¨æ„åŠ›å±‚ä¸­åé¢é¢å¤–æ·»åŠ ä¸€ä¸ªLSTMå±‚æˆ–S4å±‚ã€‚ æ¯ä¸ªTimestepResBlockéƒ½ä¼šä»å¤–éƒ¨è¿æ¥ä¸€ä¸ªtimestep_embï¼Œä½œä¸ºæ—¶é—´ä¿¡æ¯çš„ç¼–ç ã€‚è¿™é‡Œé‡‡ç”¨äº†å’ŒStable Diffusionä¸€æ ·çš„ç­–ç•¥ï¼Œ timestep_embçš„é•¿åº¦ä¸ºmodel_channelsçš„4å€ã€‚ æ¯ä¸ªContextualTransformerå±‚éƒ½ä¼šä»å¤–éƒ¨è¿æ¥ä¸€ä¸ªç›¸åŒçš„contextå¼ é‡ï¼Œè¿™ä¸ªå°±æ˜¯ä¹‹å‰ä¼ å…¥çš„cï¼Œä»BeatmapFeatureEmbedderè·å¾—çš„è°±é¢ç‰¹å¾æç¤ºæ•°æ® åœ¨åŸç‰ˆStable Diffusioné‡Œï¼Œæ³¨æ„åŠ›å—åç§°æ˜¯SpatialTransformerï¼Œå› ä¸ºç”Ÿæˆå›¾åƒçš„æ–‡æœ¬æç¤ºcontexæ˜¯ä¸å®šé•¿çš„ï¼Œè€Œè¿™é‡Œç”Ÿæˆè°±é¢çš„æç¤ºæ˜¯å®šé•¿çš„ï¼Œ ä¸”ä¸éœ€è¦è¿›è¡Œ2Då·ç§¯ã€‚å› æ­¤è¿™é‡Œé‡æ–°å†™äº†ä¸€ä¸ªContextualTransformerï¼ŒäºŒè€…éƒ½æ˜¯ä»BasicTransformerBlockç»§æ‰¿è€Œæ¥ã€‚ æ¯æ¬¡é€šè¿‡å®Œæ•´çš„input_blockä»¥åï¼Œè¿›è¡Œä¸€æ¬¡ä¸‹é‡‡æ ·ï¼Œå€å¢æ¨¡å‹çš„é€šé“æ•°ï¼ˆæŒ‰ç…§é…ç½®ï¼Œå€ç‡ä¸º[ 1,2,4,4 ]ï¼‰ï¼Œå‹ç¼©æ•°æ®çš„ç»´åº¦å’Œæ³¨æ„åŠ›å±‚çš„åˆ†è¾¨ç‡ [ iii ] middle_block: &quot;U&quot;å½¢çŠ¶çš„åº•éƒ¨ï¼Œä¹Ÿæ˜¯æ¨¡å‹çš„ä¸­é—´å±‚ï¼Œä¸Stable Diffusionçš„ç»“æ„ä»ç„¶ç›¸åŒï¼Œé€šè¿‡äº†ä¸€ä¸ªä¸‰æ˜æ²»å½¢çŠ¶çš„TimestepResBlock-ContextualTransformer-TimestepResBlockç½‘ç»œå—ã€‚ [ iv ] Upstampsï¼ˆoutput_blocksï¼‰ ä¸Šé‡‡æ ·ï¼š&quot;U&quot;å½¢çŠ¶çš„å³åŠè¾¹ï¼Œè€æ ·å­ï¼Œä¸ä¸‹é‡‡æ ·ç›¸åå³å¯ï¼Œæ¯æ¬¡é€šè¿‡ç›¸åŒçš„TimestepResBlock-ContextualTransformer-LSTM/S4å±‚åè¿›è¡Œä¸€æ¬¡ä¸Šé‡‡æ ·ã€‚ [ v ] è¾“å‡ºå±‚ï¼šä¸Šé‡‡æ ·ç»“æœå…ˆé€šè¿‡ä¸€ä¸ªå½’ä¸€åŒ–å±‚å’Œä¸€ä¸ªSiLUæ¿€æ´»å‡½æ•°ï¼Œç„¶åæœ€åé€šè¿‡ä¸€ä¸ªå·ç§¯å±‚å°†ç‰¹å¾æ˜ å°„åˆ°ç›®æ ‡è¾“å‡ºé€šé“æ•°ï¼Œoverã€‚ å¥½å¥‡ï¼šè¿™é‡Œå’ŒåŸç‰ˆSDä¸€æ ·ï¼Œç”¨äº†ä¸ªzero_moduleæ¥åˆå§‹åŒ–å·ç§¯å±‚ï¼Œä¸çŸ¥æ˜¯ä»€ä¹ˆä¼˜åŒ–æŠ€å·§â€¦â€¦ å„ä¸ªæ¨¡å‹çš„input sizeå’ŒOutput sizeï¼š ä¸‹è¡¨é»˜è®¤çœç•¥äº†batch sizeï¼Œå³åº”è¯¥æ·»åŠ åœ¨å„ä¸ªinput sizeå‰é¢çš„æ‰¹é‡ç»´åº¦B æ¨¡å‹ Input size Output size å¤‡æ³¨ (VAE)Encoder (16, 4096) (64, 128) 16æ˜¯è°±é¢noteæ•°æ®çš„è¾“å…¥é€šé“æ•°ï¼Œå®ƒæ˜¯ç”±â€œ4Kâ€æŒ‰é”®çš„å››ä¸ªä½ç½®ï¼Œæ¯ä¸ªä½ç½®åˆ†é…4ä¸ªé€šé“æ„æˆçš„ã€‚ç»è¿‡å¤šæ¬¡ä¸‹é‡‡æ ·åå¾—åˆ°å½¢çŠ¶256*128ï¼Œç„¶åé€šè¿‡å·ç§¯å‹ç¼©åˆ°æ½œç©ºé—´çš„å½¢çŠ¶ä¸º64*128 (VAE)Decoder (64, 128) (16, 4096) ä¸ä¸Šé¢ç›¸åï¼Œå¤šæ¬¡ä¸Šé‡‡æ ·åå¾—åˆ°å½¢çŠ¶64*4096, ç„¶åé€šè¿‡å·ç§¯æ¢å¤åˆ°è°±é¢å½¢çŠ¶16*4096 BeatmapFeatureEmbedder (f) (f, 128) fæ˜¯featureçš„æ•°é‡ï¼Ÿï¼ˆæ•°æ®é›†ä¸­ä¸€ä¸ªè°±é¢çš„featureé•¿åº¦ä¸º21ï¼‰ MelspectrogramScaleEncoder1D (128, 32768) (512, 64) 32768ä»£è¡¨æœ€å¤§çš„åºåˆ—é•¿åº¦ï¼ˆæ¢…å°”é¢‘è°±å›¾çš„é•¿åº¦ï¼‰ï¼Œå’Œä¸‹é¢çš„å‚…é‡Œå¶å˜æ¢ç›¸æ¯”ï¼Œæ˜¯å°†ä¸¤ä¸ªéŸ³é¢‘é€šé“æ··åˆåˆ°ä¸€èµ·ï¼Œæ•°é‡*2 STFTEncoder (2, 1025, 16384) (32, 256) 2=è¾“å…¥é€šæ•°é“ï¼ˆå¯¹åº”å¤æ•°çš„å®éƒ¨å’Œè™šéƒ¨ï¼‰ï¼Œ1025=é¢‘ç‡åˆ†è¾¨ç‡ï¼Œ16384=æœ€å¤§çš„åºåˆ—é•¿åº¦ï¼Œè¾“å‡ºå½¢çŠ¶ä¸­çš„32æ˜¯è¾“å‡ºé€šé“æ•° U-Net(ä½¿ç”¨STFT) (544, 4096) (32, 4096) åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼ŒéŸ³é¢‘é€šé“å’Œè¾“å…¥é€šé“ï¼ˆ32ï¼‰ä¸€å¼€å§‹å°±é€šè¿‡ç›´æ¥è¿æ¥åˆå¹¶åˆ°ä¸€èµ·ï¼Œ544 = 512+32 (æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆä½¿ç”¨STFTçš„é€šé“æ•°å¤šä¸€å€ï¼Œå¯¹ä¸èµ·æˆ‘æ²¡å­¦è¿‡ä¿¡å·å¤„ç†QAQ) U-Net(ä½¿ç”¨MelScaleEncoder1D) (16, 4096) (16, 4096) xæ˜¯ä»å™ªå£°åˆ†å¸ƒä¸­é‡‡æ ·çš„ï¼Œä¸è°±é¢noteæ•°æ®å½¢çŠ¶ç›¸åŒçš„éšæœºè¾“å…¥ã€‚ è€Œæç¤ºæ•°æ®ã€æ—¶é—´æ­¥æ•°æ®å’ŒéŸ³é¢‘æ•°æ®éƒ½æ˜¯ä»å¤–éƒ¨åµŒå…¥çš„ã€‚ ddim.py - DDIMæ¨¡å‹ DDIMæ˜¯DDPMçš„ä¸€ä¸ªæ”¹è¿›æ¨¡å‹ï¼Œç”¨äºæ¨ç†æ—¶å¿«é€Ÿé‡‡æ ·xï¼Œè²Œä¼¼è®­ç»ƒæ—¶æ²¡æœ‰ç”¨åˆ°ã€‚ è®­ç»ƒå…¥å£[main.py] åŠ è½½æ¨¡å‹ï¼šmodel = instantiate_from_config(config.model),configé‡Œé…ç½®çš„æ¨¡å‹å³ä¸ºDDPMæ¨¡å‹ åŠ è½½æ•°æ®ï¼š 123456data = instantiate_from_config(config.data)data.prepare_data()data.setup()print(&quot;#### Data #####&quot;)for k in data.datasets: print(f&quot;&#123;k&#125;, &#123;data.datasets[k].__class__.__name__&#125;, &#123;len(data.datasets[k])&#125;&quot;) å¼€å§‹è®­ç»ƒï¼Œä½¿ç”¨trainer.fit()å‡½æ•°ï¼Œä¼ å…¥æ¨¡å‹å’Œæ•°æ®é›† 12345678if opt.train: try: trainer.fit(model, data) except Exception: melk() raiseif not opt.no_test and not trainer.interrupted: trainer.test(model, data) ï¼ˆ4ï¼‰WebUIå’Œæ¨ç†éƒ¨åˆ† äº¤äº’å¼æ¨ç†å…¥å£[webui.py] TODO"},{"title":"ç”Ÿæˆæ¨¡å‹åŸºç¡€ä¸åº”ç”¨ç¬”è®°-ç¬¬4ç« ","path":"/2023/12/19/ç”Ÿæˆæ¨¡å‹åŸºç¡€ä¸åº”ç”¨ç¬”è®°-ç¬¬4ç« /","content":"C4 è¿ç»­æ•°æ®çš„ç”Ÿæˆæ¨¡å‹ æœ¬æ–‡çš„éƒ¨åˆ†å…¬å¼æ ¼å¼æœªæ ¡å¯¹ï¼Œæ­£åœ¨æ–½å·¥ä¸­â€¦â€¦ C4 è¿ç»­æ•°æ®çš„ç”Ÿæˆæ¨¡å‹ ç”Ÿæˆåˆ†ç±»å™¨ åœ¨C2ä¸­ï¼Œæˆ‘ä»¬æåˆ°ï¼Œç”Ÿæˆæ¨¡å‹ä¹Ÿæ˜¯ä¸€ä¸ªåˆ†ç±»æ¨¡å‹ï¼Œé€šè¿‡å¯¹ç¦»æ•£å˜é‡çš„è´å¶æ–¯å»ºæ¨¡ï¼Œå¯ä»¥å¾—åˆ° æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ï¼ˆNBCï¼‰ï¼Œäº‹å®ä¸Šï¼Œè¿™ä¸€ç‚¹ä¹Ÿå¯ä»¥æ¨å¹¿åˆ°è¿ç»­æ•°æ®ã€‚åªéœ€å°†æ¦‚ç‡å»ºæ¨¡æ”¹ä¸ºâ€œç±»æ¡ä»¶å¯†åº¦å‡½æ•°â€ï¼š è®°å¥½è¿™ä¸ªç»“è®ºï¼Œåœ¨åé¢ä¸¤èŠ‚æˆ‘ä»¬ä¼šä½¿ç”¨å…¶æ¥è®­ç»ƒä¸€ä¸ª** å¤šå…ƒé«˜æ–¯åˆ†å¸ƒ** åˆ†ç±»å™¨ å•ä¸€æ­£æ€åˆ†å¸ƒçš„é«˜æ–¯æ¨¡å‹ è¿™ä¸€èŠ‚æˆ‘ä»¬ä¸“æ³¨äºé«˜æ–¯åˆ†å¸ƒï¼ˆæ­£æ€åˆ†å¸ƒï¼‰ï¼Œå› ä¸ºå®ƒæ˜¯è¿ç»­å˜é‡ä¸­çš„æœ€å¸¸è§çš„å»ºæ¨¡ã€‚ æˆ‘ä»¬å…ˆä¸€å¥å¸¦è¿‡ ä¸€å…ƒæ­£æ€åˆ†å¸ƒï¼Œå¯¹æ²¡é”™å°±æ˜¯è¿™ä¸ªï¼š å®ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°æ˜¯N(xâˆ£Î¼,Ïƒ2)=12Î¼Ïƒ2eâˆ’(xâˆ’Î¼)22Ïƒ2N(x|\\mu,\\sigma^2) = \\frac{1}{\\sqrt{2\\mu\\sigma^2}}e^{-\\frac{(x-\\mu)^2}{2\\sigma^2}}N(xâˆ£Î¼,Ïƒ2)=2Î¼Ïƒ2â€‹1â€‹eâˆ’2Ïƒ2(xâˆ’Î¼)2â€‹ï¼Œå¤§å®¶åº”è¯¥éƒ½çŸ¥é“å§ã€‚ å®é™…ä¸Šï¼Œå¤šå…ƒè¿ç»­å˜é‡ä¹Ÿæ˜¯å…·æœ‰æ­£æ€åˆ†å¸ƒçš„ï¼ˆæ¦‚ç‡è®ºé‡Œå…¶å®ä¹Ÿå­¦è¿‡ï¼Œä¸è¿‡å¤§æ¦‚å¤§å®¶éƒ½å¿˜äº†ï¼‰ï¼š å…¶ä¸­ï¼Œæˆ‘ä»¬æŠŠ (xâˆ’Î¼)TÎ£âˆ’1(xâˆ’Î¼)(x-\\mu)^T\\bold \\Sigma^{-1}(x-\\mu)(xâˆ’Î¼)TÎ£âˆ’1(xâˆ’Î¼) ç§°ä¸º** é©¬æ°è·ç¦» DMD_MDMâ€‹ï¼Œè¿™æ˜¯æ¬§å¼è·ç¦»åœ¨å¤šå…ƒç©ºé—´ä¸­çš„æ¨å¹¿ï¼š** DM=(xâˆ’Î¼)TÎ£âˆ’1(xâˆ’Î¼)D_M = (\\bold x-\\mu)^T\\Sigma^{-1}(\\bold x-\\mu)DMâ€‹=(xâˆ’Î¼)TÎ£âˆ’1(xâˆ’Î¼) ä¸‹é¢æˆ‘ä»¬æè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šç»™å®šNä¸ªç‹¬ç«‹åŒåˆ†å¸ƒçš„æ ·æœ¬xiâˆ¼N(Î¼,Î£)\\bold x_i \\sim N(\\bold \\mu, \\bold \\Sigma)xiâ€‹âˆ¼N(Î¼,Î£)ï¼Œå¦‚ä½•ä¼°è®¡è¯¥å¤šå…ƒé«˜æ–¯åˆ†å¸ƒçš„å‚æ•°å‘¢ï¼Ÿ åŒæ ·ï¼Œå¯ä»¥ä½¿ç”¨MLEå’ŒMAPä¸¤ç§ä¼°è®¡æ–¹æ³•ã€‚ æå¤§ä¼¼ç„¶ä¼°è®¡ ä¼¼ç„¶å‡½æ•°ï¼š L(Î¼,Î£)=logP(xâˆ£Î¼,Î£)=âˆ‘i=1NlogP(xiâˆ£Î¼,Î£)=âˆ‘i=1Nlog1(2Ï€)D/26âˆ£Î£âˆ£1/2eâˆ’12âˆ‘i=1NDM(xi)L(\\mu,\\Sigma) = log P(\\bold x|\\mu,\\Sigma) \\\\ = \\sum_{i=1}^NlogP(\\bold x_i|\\mu,\\Sigma) \\\\ = \\sum_{i=1}^Nlog\\frac{1}{(2\\pi)^{D/2}6|\\Sigma|^{1/2}}e^{-\\frac{1}{2}\\sum_{i=1}^N D_M(x_i)}L(Î¼,Î£)=logP(xâˆ£Î¼,Î£)=âˆ‘i=1Nâ€‹logP(xiâ€‹âˆ£Î¼,Î£)=âˆ‘i=1Nâ€‹log(2Ï€)D/26âˆ£Î£âˆ£1/21â€‹eâˆ’21â€‹âˆ‘i=1Nâ€‹DMâ€‹(xiâ€‹) æœ€å¤§åŒ–æ—¶çš„å‚æ•°ç»“è®ºï¼š æœ€å¤§åéªŒæ¦‚ç‡ä¼°è®¡ ä¼¼ç„¶å‡½æ•° L(Î¼,Î£)=logP(xâˆ£Î¼,Î£)=(2Ï€)âˆ’ND2âˆ£Î£âˆ£âˆ’N2eâˆ’12âˆ‘i=1NDM(xi)L(\\mu,\\Sigma) = log P(\\bold x|\\mu,\\Sigma) = (2\\pi)^{-\\frac{ND}{2}}|\\Sigma|^{-\\frac{N}{2}}e^{-\\frac{1}{2}\\sum_{i=1}^N D_M(x_i)}L(Î¼,Î£)=logP(xâˆ£Î¼,Î£)=(2Ï€)âˆ’2NDâ€‹âˆ£Î£âˆ£âˆ’2Nâ€‹eâˆ’21â€‹âˆ‘i=1Nâ€‹DMâ€‹(xiâ€‹) å…¶ä¸­ï¼Œå¯¹äºâˆ‘i=1NDM(xi)=âˆ‘i=1N(xiâˆ’Î¼)TÎ£âˆ’1(xiâˆ’Î¼)\\sum_{i=1}^N D_M(x_i) = \\sum_{i=1}^N (x_i-\\mu)^T\\Sigma^{-1}(x_i-\\mu)âˆ‘i=1Nâ€‹DMâ€‹(xiâ€‹)=âˆ‘i=1Nâ€‹(xiâ€‹âˆ’Î¼)TÎ£âˆ’1(xiâ€‹âˆ’Î¼)ï¼Œå¯ä»¥ç”¨é‡‡æ ·æ•°æ®xçš„å‡å€¼xË‰\\bar xxË‰å’Œæ•£åº¦SxË‰S_{\\bar x}SxË‰â€‹è¡¨ç¤ºä¸ºï¼š âˆ‘i=1NDM(xi)=tr(Î£âˆ’1SxË‰)+N(xË‰âˆ’Î¼)TÎ£âˆ’1(xË‰âˆ’Î¼)\\sum_{i=1}^N D_M(x_i) = tr(\\Sigma^{-1}S_{\\bar x}) + N(\\bar x - \\mu)^T \\Sigma^{-1} (\\bar x - \\mu)âˆ‘i=1Nâ€‹DMâ€‹(xiâ€‹)=tr(Î£âˆ’1SxË‰â€‹)+N(xË‰âˆ’Î¼)TÎ£âˆ’1(xË‰âˆ’Î¼) ,å…¶ä¸­SxË‰=âˆ‘i=1N(xiâˆ’xË‰)(xiâˆ’xË‰)TS_{\\bar x} = \\sum_{i=1}^N(x_i - \\bar x)(x_i - \\bar x)^TSxË‰â€‹=âˆ‘i=1Nâ€‹(xiâ€‹âˆ’xË‰)(xiâ€‹âˆ’xË‰)T æœ€å¤§åŒ–æ—¶çš„å‚æ•°ç»“è®ºï¼š å› ä¸ºæ˜¯MAPï¼Œéœ€è¦å¼•å…¥å…ˆéªŒçš„å‚æ•°ï¼š m0=xË‰\\bold m_0 = \\bar xm0â€‹=xË‰ï¼Œå³å…ˆéªŒå‡å€¼ k0k_0k0â€‹ï¼šå¯¹m0\\bold m_0m0â€‹çš„ä¿¡ä»»ç¨‹åº¦ ï¼Œä¸º0æˆ–ä¸€ä¸ªæå°å€¼ S0=diag(SxË‰)N\\bold S_0 = \\frac{diag(S_{\\bar x})}{N}S0â€‹=Ndiag(SxË‰â€‹)â€‹ï¼Œåæ–¹å·®çš„å…ˆéªŒï¼Œå¹¶å–å¹³å‡ v0v_0v0â€‹ï¼šå¯¹S0\\bold S_0S0â€‹çš„ä¿¡ä»»ç¨‹åº¦ ï¼Œv0=D+2v_0 = D+2v0â€‹=D+2ï¼ŒDæ˜¯ç»´åº¦ ç„¶åå¯¹å…ˆéªŒå‡å€¼å’Œæå¤§ä¼¼ç„¶ä¼°è®¡çš„ç»“æœåš** å‡¸ç»„åˆ ï¼Œå®šä¹‰ï¼š** \\bold m_N = \\frac{k_0}{k_0+N}\\bold m_0 + \\frac{N}{k_0+N}\\bar x \\\\ \\ \\\\ \\bold S_N = \\bold S_0 + S_{\\bar x} + \\frac{k_0 N}{k_0+N}(\\bar x - \\bold m_0)(\\bar x - \\bold m_0)^T \\\\ = \\bold S_0 + S_{\\bar x} + k_0\\bold m_0\\bold m_0^T-K_N \\bold m_N\\bold m_N^T \\\\ \\ \\\\ å…¶ä¸­ï¼š k_N = k_0 + N \\\\ v_N = v_0 + N åˆ™ä¼°è®¡ç»“æœä¸ºï¼š - &#123;% image https://cdn.nlark.com/yuque/0/2023/png/23169257/1699340522524-968b4f6e-de54-4446-a436-bef4db536cf0.png#averageHue=%23fbf8f7&clientId=u0e63a603-818a-4&from=paste&height=246&id=u220176e4&originHeight=472&originWidth=919&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=165465&status=done&style=none&taskId=u9c62d9f6-5344-4492-a011-0e9d87c8828&title=&width=479.66668701171875 %&#125; é«˜æ–¯åˆ¤åˆ«åˆ†æ ä¸Šä¸€èŠ‚æˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚ä½•ä»¥ å¤šå…ƒé«˜æ–¯åˆ†å¸ƒ ä¸ºéšæœºå˜é‡å»ºæ¨¡è´å¶æ–¯ç”Ÿæˆæ¨¡å‹ï¼Œç»“åˆç¬¬ä¸€èŠ‚æ‰€è¯´ï¼Œä¸‹é¢æˆ‘ä»¬å°è¯•åˆ©ç”¨å…¶ç”Ÿæˆä¸€ä¸ªåˆ†ç±»å™¨ã€‚ å‡è®¾æˆ‘ä»¬æœ‰å¤šä¸ªè®­ç»ƒæ ·æœ¬æ•°æ®x1,x2,...x_1,x_2,...x1â€‹,x2â€‹,...ï¼Œå®ƒä»¬å¯¹å¯¹åº”çš„ç±»åˆ«åˆ†åˆ«æ˜¯ y=1,2,...Cy=1,2,...Cy=1,2,...C é‚£ä¹ˆå¯ä»¥å®šä¹‰å½“æ¡ä»¶ä¸ºâ€œéšæœºå˜é‡è¢«åˆ†ä¸ºç±»åˆ«câ€çš„æ¡ä»¶å¯†åº¦å‡½æ•°ï¼š p(xâˆ£y=c,Î¸)=N(xâˆ£Î¼c,Î£c)p(\\bold x|y=c, \\theta) = N(\\bold x |\\mu_c, \\Sigma_c)p(xâˆ£y=c,Î¸)=N(xâˆ£Î¼câ€‹,Î£câ€‹) å…¶ä¸­Î¼c,Î£c\\mu_c, \\Sigma_cÎ¼câ€‹,Î£câ€‹æ˜¯ æ‰€æœ‰è¢«åˆ†ä¸ºç±»åˆ«cçš„è®­ç»ƒæ ·æœ¬æ•°æ®æ„æˆçš„å¤šå…ƒé«˜æ–¯åˆ†å¸ƒ çš„ å‡å€¼ å’Œ åæ–¹å·®çŸ©é˜µ æŒ‰ç…§ç”Ÿæˆåˆ†ç±»å™¨çš„ åéªŒä¼°è®¡æœ€å¤§ ä¸ºåŸåˆ™ï¼Œå’Œç¦»æ•£ç”Ÿæˆåˆ†ç±»å™¨çš„è¾“å‡ºç±»ä¼¼ï¼Œå¯ä»¥å¾—åˆ°åˆ†ç±»çš„è®¡ç®—å…¬å¼ï¼š å…¶ä¸­ï¼ŒÏ€\\piÏ€æ˜¯åˆ†ç±»å…ˆéªŒçš„åˆ†å¸ƒ å¦‚æœå¯¹äºç±»åˆ«cï¼Œå…ˆéªŒåˆ†å¸ƒÏ€c\\pi_cÏ€câ€‹æ˜¯å‡åŒ€çš„ ï¼Œåˆ™æ¨å¯¼å…¬å¼ä¸ºï¼š å¦‚æœ x æ˜¯äºŒå…ƒå˜é‡ï¼Œé‚£ä¹ˆy(x)çš„åˆ†ç±»ç»“æœï¼ˆå†³ç­–è¾¹ç•Œï¼‰åœ¨å¹³é¢å›¾ä¸Šä¼šå‘ˆç°ä¸€æ¡äºŒæ¬¡æ›²çº¿ï¼Œå› æ­¤ï¼Œä¹Ÿå°†è¿™ç§æ–¹æ³•ç§°ä¸ºâ€œäºŒæ¬¡åˆ¤åˆ«åˆ†æâ€ï¼‰ä¸‹å›¾æ˜¯ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼š åœ¨è¿™ä¸ªå›¾ç¤ºä¸­ï¼Œæ ·æœ¬å˜é‡xæ˜¯ä¸€ä¸ªäºŒå…ƒçš„å˜é‡ï¼Œå› æ­¤è¢«ç»˜åˆ¶åœ¨å¹³é¢ä¸Šï¼Œæ¯ä¸ªç‚¹è¿˜å¯¹åº”ä¸€ä¸ªyå€¼ï¼Œå›¾ä¸­çš„åœ†åœˆè¡¨ç¤ºçš„æ˜¯yå€¼çš„ç­‰é«˜çº¿ã€‚ xç›¸å¯¹yçš„å€¼æœä»æ­£æ€åˆ†å¸ƒï¼Œç›´è§‚åœ°ç»˜åˆ¶å‡ºä¸‰ç»´å’ŒäºŒç»´çš„å¯¹æ¯”å›¾ï¼Œå…¶å®æ˜¯è¿™æ ·çš„ï¼š å¦‚æœå¯¹äºä»»æ„çš„ç±»åˆ«cï¼Œæœ‰Î£c=Î£\\Sigma_c = \\SigmaÎ£câ€‹=Î£ï¼Œåˆ™å†³ç­–è¾¹ç•Œæ°å¥½æ˜¯ä¸€æ¡ç›´çº¿ï¼Œæ­¤æ—¶â€œäºŒæ¬¡åˆ¤åˆ«åˆ†æâ€é€€åŒ–ä¸ºâ€œ çº¿æ€§åˆ¤åˆ«åˆ†æ â€,å¯ä»¥ç›´æ¥å†™å‡ºå†³ç­–çº¿çš„è¡¨è¾¾å¼ï¼š logP(y=câˆ£x,Î¸)âˆÎ²cx+Î³clogP(y=c|\\bold x,\\theta) \\propto \\beta_c \\bold x + \\gamma_clogP(y=câˆ£x,Î¸)âˆÎ²câ€‹x+Î³câ€‹ å…¶ä¸­å‚æ•°çŸ©é˜µÎ²c=(Î£âˆ’1Î¼c)T\\beta_c = (\\Sigma^{-1}\\mu_c)^TÎ²câ€‹=(Î£âˆ’1Î¼câ€‹)T,Î³c=âˆ’12Î¼cTÎ£âˆ’1Î¼c+logÏ€c\\gamma_c = -\\frac{1}{2}\\mu_c^T\\Sigma^{-1}\\mu_c+log\\pi_cÎ³câ€‹=âˆ’21â€‹Î¼cTâ€‹Î£âˆ’1Î¼câ€‹+logÏ€câ€‹ï¼Œä¸‹å›¾æ˜¯ä¸€ä¸ªè¿™æ ·çš„äºŒå…ƒå˜é‡çº¿æ€§åˆ†ç±»çš„ä¾‹å­ï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¤šå…ƒé«˜æ–¯åˆ†å¸ƒåˆ†ç±»å™¨ï¼ˆåˆ¤åˆ«å™¨ï¼‰çš„æ¨¡å‹å‚æ•°å°±æ˜¯é«˜æ–¯åˆ†å¸ƒçš„å‚æ•°ï¼š Î¸c=(Î¼c,Î£c)\\theta_c = (\\mu_c, \\Sigma_c)Î¸câ€‹=(Î¼câ€‹,Î£câ€‹)ï¼ŒåŸºäºä¸Šä¸€èŠ‚çš„ç»“è®ºï¼Œç›´æ¥ä½¿ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡æ¥è®¡ç®—å‚æ•°ã€‚ å…ˆè®¡ç®—å¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼Œå…¶å³æ˜¯ å¯¹æ¯ä¸ªåˆ†ç±»çš„å¤šå…ƒé«˜æ–¯åˆ†å¸ƒ åš åŠ æƒå¹³å‡ï¼ˆæ²¡é”™è¿™å’Œç¦»æ•£æƒ…å†µçš„ä¸‹çš„è´å¶æ–¯åˆ†ç±»å™¨å…¶å®æ˜¯ä¸€æ ·çš„ï¼‰ï¼š logP(Dâˆ£Î¸)=âˆ‘i=1Nâˆ‘c=1C(logÏ€c)if(Yi=c)+âˆ‘c=1C[âˆ‘i:yi=clogÂ N(xâˆ£Î¼c,Î£c)]log P(D|\\theta) = \\sum_{i=1}^N \\sum_{c=1}^C (log \\pi_c)^{if(Y_i =c)} + \\sum_{c=1}^C[\\sum_{i: y_i=c}log \\ N(\\bold x| \\mu_c, \\Sigma_c)]logP(Dâˆ£Î¸)=âˆ‘i=1Nâ€‹âˆ‘c=1Câ€‹(logÏ€câ€‹)if(Yiâ€‹=c)+âˆ‘c=1Câ€‹[âˆ‘i:yiâ€‹=câ€‹logÂ N(xâˆ£Î¼câ€‹,Î£câ€‹)] å³ä¾§çš„Nå³ä¸ºç±»åˆ«cå¯¹åº”çš„å¤šå…ƒé«˜æ–¯åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°ã€‚ è€ŒÏ€c\\pi_cÏ€câ€‹è¡¨ç¤ºç¬¬cä¸ªç±»çš„å…ˆéªŒï¼Œå…¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š 0â‰¤Ï€câ‰¤1,Â âˆ‘c=1CÏ€c=10 \\leq \\pi_c \\leq 1, \\ \\sum_{c=1}^C \\pi_c = 10â‰¤Ï€câ€‹â‰¤1,Â âˆ‘c=1Câ€‹Ï€câ€‹=1 åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œå¾€å¾€ä»¥æ¯ä¸ªç±»cåœ¨æ•°æ®é›†ä¸­çš„ç»Ÿè®¡é¢‘ç‡ç»“æœä½œä¸ºå…ˆéªŒï¼Œå¸¦å…¥æå¤§ä¼¼ç„¶ä¼°è®¡å¯ä»¥å¾—åˆ°ï¼Œç¬¬cä¸ªç±»çš„å¤šå…ƒé«˜æ–¯åˆ¤åˆ«å™¨å‚æ•°ä¸ºï¼š Î¼^c=1Ncâˆ‘i:yi=cxi\\hat \\mu_c = \\frac{1}{N_c} \\sum_{i: y_i=c} \\bold x_iÎ¼^â€‹câ€‹=Ncâ€‹1â€‹âˆ‘i:yiâ€‹=câ€‹xiâ€‹ Î£^c=1Ncâˆ‘i:yi=c(xiâˆ’Î¼^c)(xiâˆ’Î¼^c)T\\hat \\Sigma_c = \\frac{1}{N_c} \\sum_{i: y_i=c} (\\bold x_i - \\hat \\mu_c)(\\bold x_i - \\hat \\mu_c)^TÎ£^câ€‹=Ncâ€‹1â€‹âˆ‘i:yiâ€‹=câ€‹(xiâ€‹âˆ’Î¼^â€‹câ€‹)(xiâ€‹âˆ’Î¼^â€‹câ€‹)T å…¶ä¸­ï¼ŒNcN_cNcâ€‹æ˜¯ç±»åˆ«cçš„æ ·æœ¬åœ¨æ•°æ®é›†ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚ å¤šä¸ªæ­£æ€åˆ†å¸ƒçš„é«˜æ–¯æ··åˆæ¨¡å‹ ä¸Šé¢çš„å•ä¸€æ­£æ€åˆ†å¸ƒæ¨¡å‹ï¼Œçœ‹èµ·æ¥å¾ˆç¾å¥½ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬å‡å®šäº†ä»»ä½•ä¸€ä¸ªç±»åˆ«cçš„æ•°æ®éƒ½åªæœä»ä¸€ä¸ªå•ä¸€çš„æ­£æ€åˆ†å¸ƒ äº‹å®ä¸Šï¼Œæˆ‘ä»¬æ— æ³•å‡è®¾ä»»ä½•è¦æ‹Ÿåˆçš„è¿ç»­æ•°æ®éƒ½çœŸçš„åªæœä»ä¸€ä¸ªæ­£æ€åˆ†å¸ƒã€‚ å®é™…å¾ˆå¤šæƒ…å†µä¸‹ï¼Œ çœŸå®çš„æ•°æ®æ˜¯ å¤šä¸ªä¸åŒæ­£æ€åˆ†å¸ƒçš„å åŠ ã€‚ å› æ­¤ï¼Œæˆ‘å“¦ä»¬éœ€è¦â€”â€”é«˜æ–¯æ··åˆæ¨¡å‹ï¼š ç†è®ºä¸Šæ¥è¯´ï¼Œé«˜æ–¯æ··åˆæ¨¡å‹å¯ä»¥æ¨¡æ‹Ÿä»»æ„çš„åˆ†å¸ƒå‡½æ•°ã€‚ ä¸ºäº†èƒ½å¯¹æ•°æ®è¿›è¡Œ â€œæ··åˆé«˜æ–¯å»ºæ¨¡â€ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“è¦å»ºæ¨¡çš„æ•°æ®ç©ºé—´åˆ°åº•éœ€è¦å‡ ä¸ªæ­£æ€åˆ†å¸ƒçš„ç±»ã€‚ æ²¡é”™ï¼Œæ‰€ä»¥å»ºç«‹é«˜æ–¯æ··åˆæ¨¡å‹çš„ç¬¬ä¸€æ­¥ï¼Œæ˜¯èšç±»ï¼ˆclusteringï¼‰ã€‚ è¿™å°±å’Œä¸Šä¸€èŠ‚çš„ç”Ÿæˆåˆ†ç±»å™¨å¾ˆä¸ä¸€æ ·ï¼Œå‰è€…æˆ‘ä»¬å·²çŸ¥ï¼ˆå‡è®¾äº†ï¼‰æ¯ä¸ªç±»åˆ«å¯¹åº”ä¸€ä¸ªæ­£æ€åˆ†å¸ƒã€‚è€Œåœ¨è¿™é‡Œæ˜¯ä¸åŒçš„ï¼Œæˆ‘ä»¬ä¸èƒ½ç›¸ä¿¡æ ‡ç­¾é‡Œçš„ç±»åˆ«ä¿¡æ¯ï¼Œåªèƒ½å°†æœ€ç»ˆæ¯ä¸ªç±»åˆ«éœ€è¦æ··åˆçš„æ­£æ€åˆ†å¸ƒçš„æ•°é‡è§†ä¸ºéšå˜é‡ã€‚ EMç®—æ³• ä¼°è®¡é«˜æ–¯æ··åˆæ¨¡å‹ æˆ‘ä»¬ä¾ç„¶å¯ä»¥å†™å‡ºMLEæ–¹æ³•å’ŒMAPæ–¹æ³•å¯¹æ··åˆé«˜æ–¯æ¨¡å‹çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼š æœ€å¤§çš„é—®é¢˜åœ¨äºï¼šæˆ‘ä»¬ä¸çŸ¥é“éšå˜é‡zï¼ˆå³çœŸå®æ­£æ€åˆ†å¸ƒçš„åˆ†ç±»æ•°é‡ï¼‰çš„ç»´åº¦ï¼Œå› æ­¤å‚æ•°çš„è§£ä¹Ÿæ˜¯ä¸å”¯ä¸€çš„ã€‚ å¦‚æœæˆ‘ä»¬å‡è®¾æœ‰kä¸ªç»´åº¦ï¼ˆå³æ¯ä¸ªåˆ†ç±»ç”¨kä¸ªæ­£æ€åˆ†å¸ƒæ··åˆè¡¨ç¤ºï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰k!ç§ä¸åŒçš„è§£ã€‚ æŠŠkä¹ŸåŠ å…¥æ¨¡å‹çš„å‚æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨C4ä¸­æåˆ°å˜åˆ†EMç®—æ³•æ¥è¿›è¡Œæœ€å¤§ä¼¼ç„¶ä¼°è®¡ã€‚ å…¬å¼çš„æ¨å¯¼å¾ˆé•¿ï¼Œå¦‚ä½•ä»¥åæœ‰æœºä¼šçš„è¯æˆ‘æŠŠå®ƒæ•´ç†ä¸€ä¸‹æ”¾åˆ°å¦ä¸€ä¸ªé“¾æ¥é‡Œâ€¦â€¦ è¿™é‡Œæˆ‘ä»¬ç®€å•å›é¡¾ä¸€ä¸‹è¿‡ç¨‹å§ï¼š 1ã€å®šä¹‰Qå‡½æ•°ï¼Œæ­¥æ•°t=0ï¼Œå®šä¹‰ä¸€ä¸ªåˆå§‹å…ˆéªŒã€‚ç„¶åæ¯ä¸€æ­¥è¿­ä»£æ¨å¯¼éšå˜é‡zi=kz_i= kziâ€‹=kçš„æ¡ä»¶æ¦‚ç‡ 2ã€Eæ­¥ï¼šè®¡ç®—t-1æ­¥ä¸­ï¼Œå°†Qå‡½æ•°è¡¨ç¤ºä¸ºå¤šå…ƒæ­£æ€åˆ†å¸ƒçš„å‚æ•° 3ã€Mæ­¥ï¼šæœ€å¤§åŒ–Qå‡½æ•°å€¼ï¼Œç»“æœä½œä¸ºä¸‹ä¸€æ¬¡è¿­ä»£çš„å‚æ•°ã€‚ 4ã€é‡å¤2-3æ­¥ ä¸‹å›¾æ˜¯ä¸€ä¸ªå®é™…è¿­ä»£è¿‡ç¨‹çš„å¯è§†åŒ–ä¸¾ä¾‹ï¼š K-meansç®—æ³• ä¼°è®¡é«˜æ–¯æ··åˆæ¨¡å‹ ä½ ä»¬å¯èƒ½åœ¨æ•°æ®åˆ†ææˆ–è€…æ•°æ®æŒ–æ˜è¯¾ä¸Šå­¦åˆ°è¿‡K-meansç®—æ³•ï¼Œä½ ä»¬æœ‰æ²¡æœ‰å¥½å¥‡è¿‡ï¼Œè¿™ä¸ªç®—æ³•çš„åŸç†åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ å¤©å“ªå¦‚æœä½ åªçœ‹ä¸Šä¸€èŠ‚å°±æ•é”åœ°å‘ç°äº†å…¶å®K-meansç®—æ³•å°±æ˜¯EMç®—æ³•çš„è¿‘ä¼¼å˜å½¢çš„è¯é‚£ä½ å¯å¤ªNBï¼ˆæœ´ç´ è´å¶æ–¯ï¼‰äº†ï¼Œæˆ‘ä¸Šè¯¾çš„æ—¶å€™æ˜¯ä¸€ç‚¹æ²¡å¬æ‡‚ï¼Œæ„Ÿè§‰è¿™è¿˜æ˜¯å…«ç«¿å­æ‰“ä¸ç€çš„ä¸¤ä¸ªé—®é¢˜â€¦â€¦ K-meansç®—æ³•å…¶å®æ˜¯ä¸Šè¿° æ··åˆé«˜æ–¯æ¨¡å‹ä¼°è®¡çš„ ä¸€ä¸ªè¿‘ä¼¼ç‰¹ä¾‹ã€‚ ç›´è§‚åœ°è¯´è¿™ä¹ˆè§£é‡Šï¼šå®ƒä»¬åœ¨èšç±»çš„æ—¶å€™å…¶å®éƒ½æ˜¯ä¸€å¼€å§‹æœªçŸ¥ç±»åˆ«çš„æ•°é‡kï¼Œç„¶åé€šè¿‡è®¡ç®—ä¸æ–­æ”¶æ•›çš„ã€‚ å®ƒåšäº†ä¸¤ä¸ªå‡è®¾ï¼š æ¯ä¸ªè¦æ··åˆçš„æ­£æ€åˆ†å¸ƒçš„ åæ–¹å·®çŸ©é˜µ å·²çŸ¥ ï¼ˆå‡è®¾å®ƒä»¬éƒ½ç­‰äºæ ‡å‡†çš„æ–¹å·®ï¼‰ æ¯ä¸ªè¦æ··åˆçš„ç±»åˆ«çš„ å…ˆéªŒ å·²çŸ¥ï¼ˆå‡è®¾å®ƒä»¬éƒ½ç›¸ç­‰ï¼Œå³ä¸º1/kï¼‰ å› æ­¤ï¼Œåœ¨K-meansç®—æ³•ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦è®¡ç®—æ ·æœ¬ç›¸å¯¹äºæ¯ä¸ªå…ˆéªŒç‚¹çš„å‡å€¼ï¼Œå¹¶ä»¥æ­¤æ¥è¿­ä»£ä¼°è®¡å‡ºæ¯ä¸ªç±»åˆ«çš„åˆ†å¸ƒï¼š å¥½å¤„æ˜¾è€Œæ˜“è§ï¼šè®¡ç®—éå¸¸æ–¹ä¾¿å¿«æ·ï¼Œèƒ½åœ¨æœ€çŸ­çš„æ—¶é—´å¾—åˆ°æ”¶æ•›çš„èšç±»ã€‚ ä½†æ˜¯ï¼Œå› ä¸ºåšå‡ºäº†åæ–¹å·®å’Œå…ˆéªŒçš„å‡è®¾ï¼Œæœ€åå¾—åˆ°çš„é«˜æ–¯åˆ†å¸ƒå°±å†ä¹Ÿä¸èƒ½ç”¨äºè¿›è¡Œæ¦‚ç‡å¯†åº¦ä¼°è®¡äº†ã€‚å› æ­¤K-meansç›¸å¯¹äºç›´æ¥å»ºæ¨¡æ··åˆé«˜æ–¯åˆ†å¸ƒæœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š æ— æ³•è®¡ç®—æŸä¸€ä¸ªæ ·æœ¬ç‚¹å±äºæŸä¸ªé«˜æ–¯åˆ†å¸ƒç±»çš„æ¦‚ç‡å€¼ å› æ­¤ï¼Œä¹Ÿå°±æ— æ³•ç”Ÿæˆæ–°çš„æ ·æœ¬ç‚¹ ç»¼ä¸Šï¼ŒK-meansç®—æ³•åœ¨æ•°æ®åˆ†æä¸­éå¸¸å¸¸ç”¨ï¼Œä½†æ˜¯å®ƒä¸èƒ½ä½œä¸ºä¸€ä¸ªç”Ÿæˆæ¨¡å‹æ¥ä½¿ç”¨ã€‚é—æ†¾é€€åœºã€‚ éšé©¬å°”å¯å¤«æ¨¡å‹ éšé©¬å°”å¯å¤«æ¨¡å‹æ˜¯å…³äº æ—¶åº çš„æ¦‚ç‡æ¨¡å‹ ã€‚ ä¸ºæ­¤ï¼Œé¦–å…ˆä½ éœ€è¦çŸ¥é“ é©¬å°”å¯å¤«è¿‡ç¨‹ å’Œ é©¬å°”å¯å¤«é“¾ çš„åŸºæœ¬å®šä¹‰ã€‚æˆ‘å‡å®šä½ å·²ç»å­¦è¿‡äº†ã€Šéšæœºè¿‡ç¨‹ã€‹â€¦â€¦ ä»€ä¹ˆï¼Œä½ æ²¡æœ‰å­¦è¿‡ï¼Ÿï¼è¿™ä¸‹å¯ä¸å¥½åŠäº†â€¦â€¦å’³å’³â€¦â€¦ é—®é¢˜ä¸å¤§ï¼Œä½ åªéœ€è¦å…ˆè®°å¥½è¿™ä¸¤ç‚¹ï¼š é©¬å°”å¯å¤«è¿‡ç¨‹ æ˜¯åŸºäºæ—¶åºçš„ï¼Œå®ƒå‡å®šéšæœºå˜é‡çš„æ¯ä¸ªå–å€¼éƒ½éš **æ—¶é—´ **è€Œå˜ã€‚ é½æ¬¡é©¬å°”å¯å¤«è¿‡ç¨‹ å‡å®š æ¯ä¸€ä¸ªæ—¶åˆ» éšæœºå˜é‡çš„æ¦‚ç‡å–å€¼ åªä¸ ä¸Šä¸€ä¸ªæ—¶åˆ»çš„éšæœºå˜é‡æœ‰å…³ã€‚ ä½ ä¸è¶³éœ€è¦çŸ¥é“ é½æ¬¡ æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæ€»ä¹‹åœ¨æœ¬ç¯‡çš„åº”ç”¨èŒƒå›´å†…ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºé©¬å°”å¯å¤«è¿‡ç¨‹éƒ½æ˜¯é½æ¬¡çš„ã€‚ è¿™æ ·çš„ä¸€ä¸ªè¿‡ç¨‹ä¸­ï¼ŒçŠ¶æ€ç»„æˆçš„åºåˆ—è¢«ç§°ä¸ºé©¬å°”å¯å¤«é“¾ï¼Œå› ä¸ºæ¯ä¸€ä¸ªæ—¶åˆ»éƒ½æ˜¯å¯ä»¥å’Œä¸Šä¸€ä¸ªæ—¶åˆ»é€šè¿‡æ¦‚ç‡ç›¸è¿çš„ã€‚ è€Œåœ¨éšé©¬å°”å¯å¤«æ¨¡å‹ä¸­ï¼Œ çŠ¶æ€åºåˆ—(state sequence)æ˜¯éšè—çš„ï¼Œä»å¤–éƒ¨æ•°æ®æ— æ³•è§‚æµ‹ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¢«ç§°ä¸ºéšé©¬å°”å¯å¤«é“¾ã€‚ é‚£ä¹ˆå¤–éƒ¨è§‚æµ‹çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬åªçŸ¥é“å®ƒå’Œå½“å‰æ—¶åˆ»çš„é‚£ä¸ªéšè—çŠ¶æ€æœ‰å…³ã€‚æˆ‘ä»¬æŠŠæ¯ä¸ªæ—¶åˆ»ä¸­è§‚æµ‹åˆ°çš„æ•°æ®ä¹Ÿç»„æˆä¸€ä¸ªåºåˆ—ï¼Œç§°ä¸ºè§‚æµ‹éšæœºåºåˆ— (observation sequence ) è¿™æ ·ä¸€å®šå¾ˆä¸å¥½ç†è§£ï¼Œé—®é¢˜ä¸å¤§ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªä¾‹å­ï¼š éª°å­æ¸¸æˆ å‡è®¾æœ‰ä¸‰ä¸ªä¸åŒçš„éª°å­ï¼šD6ã€D4ã€D8 ï¼ˆå…­é¢ã€å››é¢å’Œå…«é¢éª°å­ï¼‰ã€‚ ï¼ˆâ€”â€”ä¸ºä»€ä¹ˆæ²¡æœ‰D100ï¼Ÿï¼â€”â€”å…„å¼Ÿä½ èµ°é”™ç‰‡åœºäº†ï¼Œè¿™é‡Œç©çš„æ˜¯DNDï¼‰ æ¯æ¬¡æŠ•æ·å‰ï¼Œå…ˆç­‰æ¦‚ç‡åœ°éšæœºä»ä¸‰ä¸ªéª°å­ä¸­é€‰å–ä¸€ä¸ªã€‚ ç„¶åæŠ•æ·é€‰åˆ°çš„éª°å­ï¼Œéª°å­éšæœºåœ°äº§ç”Ÿä¸€ä¸ªæ•°å­—ã€‚ å¦‚æœæˆ‘ä»¬æ¯æ¬¡è®°å½•ä¸‹æ¯æ¬¡å¾—åˆ°çš„æ•°å­—ï¼Œé‚£ä¹ˆå®ƒä»¬å°±ç»„æˆä¸€ä¸ªè§‚æµ‹åºåˆ—ã€‚ éšè—åºåˆ—æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯æˆ‘ä»¬æ¯ä¸€æ¬¡æŠ•çš„æ˜¯å“ªä¸€ä¸ªéª°å­ã€‚ åŠ å…¥æˆ‘åªå‘Šè¯‰ä½ å‰é¢å‡ æ¬¡æŠ•æ·çš„ç»“æœæ˜¯ï¼š1 6 3 5 2 7 3 5 2 4 ï¼Œè¦ä¼°è®¡ä¸‹ä¸€æ¬¡æŠ•æ·çš„ç»“æœï¼Œé‚£ä¹ˆéšè—çŠ¶æ€å¿…ç„¶æ˜¯çŒœæµ‹ä¸‹ä¸€æ¬¡éª°çš„æ˜¯å“ªä¸€ä¸ªéª°å­ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»¥è¿™ä¸ªâ€œç”Ÿæˆéª°å­æ¸¸æˆç‚¹æ•°â€çš„æ¨¡å‹ä¸ºä¾‹å­ï¼Œæ¥ä»‹ç»éšé©¬å°”å¯å¤«æ¨¡å‹ã€‚ éšé©¬å°”å¯å¤«æ¨¡å‹ æœ‰ä¸‰ä¸ªè¦ç´ ï¼š åˆå§‹æ¦‚ç‡åˆ†å¸ƒ Ï€\\piÏ€ï¼šå³ç¬¬ä¸€æ¬¡ï¼ˆ0æ—¶åˆ»ï¼‰è§‚æµ‹å˜é‡çš„æ¦‚ç‡åˆ†å¸ƒ å¦‚éª°å­æ¸¸æˆä¸­ï¼Œç¬¬ä¸€æ¬¡è¯•éªŒå¯èƒ½å¾—åˆ°1-8ä¸­çš„ä¸€ä¸ªæ•°å­—ï¼Œå¯ä»¥é€šè¿‡ç»„åˆæ–¹æ³•è®¡ç®—å‡ºåˆå§‹åˆ†å¸ƒã€‚ æ¯”å¦‚ï¼Œç¬¬ä¸€æ¬¡è¯•éªŒäº§ç”Ÿæ•°å­—1çš„æ¦‚ç‡=13(16+14+18)=1372=\\frac{1}{3}(\\frac{1}{6}+\\frac{1}{4}+\\frac{1}{8})=\\frac{13}{72}=31â€‹(61â€‹+41â€‹+81â€‹)=7213â€‹ çŠ¶æ€è½¬ç§»çŸ©é˜µAAAï¼šæ¯ä¸ªéšè—çŠ¶æ€åœ¨ä¸‹ä¸€æ—¶åˆ»å¯èƒ½è½¬æ¢ä¸ºå¦ä¸€ä¸ªéšè—çŠ¶æ€çš„æ¦‚ç‡ï¼šA(i,j)=p(zt=jÂ âˆ£Â ztâˆ’1=i)A(i,j) = p(z_t = j\\ | \\ z_{t-1}=i)A(i,j)=p(ztâ€‹=jÂ âˆ£Â ztâˆ’1â€‹=i) åœ¨éª°å­æ¸¸æˆä¸­ï¼Œä¸‰ä¸ªéª°å­è¢«è§†ä¸ºä¸‰ä¸ªéšè—çŠ¶æ€ã€‚ å…¶ä¸­ï¼Œæ¯ä¸ªçŠ¶æ€åœ¨ä¸‹ä¸€æ—¶åˆ»éƒ½æœ‰ç­‰æ¦‚ç‡ï¼ˆ1/3ï¼‰è½¬å˜ä¸ºä»»æ„çš„ä¸‰ä¸ªçŠ¶æ€ï¼ˆåŒ…æ‹¬å®ƒè‡ªå·±ï¼‰ è§‚æµ‹æ¦‚ç‡çŸ©é˜µ BBBï¼šä»æ¯ä¸ªå·²çŸ¥éšè—çŠ¶æ€åˆ°è§‚æµ‹çŠ¶æ€çš„æ¦‚ç‡ Bt(j)=p(xtÂ âˆ£Â zt=j)B_t(j) = p(\\bold x_t \\ | \\ z_t=j)Btâ€‹(j)=p(xtâ€‹Â âˆ£Â ztâ€‹=j) åœ¨éª°å­æ¸¸æˆä¸­ï¼Œ_ï¼ˆå¦‚æœt=0ï¼‰_å¯¹äºD4ï¼Œæ¯ä¸ªè§‚æµ‹çŠ¶æ€ï¼ˆ1-4ï¼‰çš„æ¦‚ç‡æ˜¯25%ï¼Œå…¶ä»–ä¸‰ä¸ªéª°å­ç±»ä¼¼ã€‚ å°†é©¬å°”å¯å¤«è¿‡ç¨‹çš„å‡è®¾å†™æˆæ•°å­¦å…¬å¼ï¼Œå°±æ˜¯ï¼š 1ã€é½æ¬¡é©¬å°”å¯å¤«æ€§å‡è®¾ éšé©¬å°”å¯å¤«é“¾ ttt**æ—¶åˆ»çš„çŠ¶æ€ åªå’Œ **tâˆ’1t-1tâˆ’1æ—¶åˆ»çš„çŠ¶æ€ æœ‰å…³ï¼Œ ä¸å…¶ä»–æ—¶åˆ»çš„çŠ¶æ€åŠè§‚æµ‹æ— å…³ï¼Œä¹Ÿä¸æ—¶åˆ»tttæ— å…³ ï¼š p(z1:T)=p(z1)p(z2âˆ£z1)p(z3âˆ£z1,z2)....p(zTâˆ£z1,z2,...,zTâˆ’1)=p(z1)p(z2âˆ£z1)p(z3âˆ£z2)....p(zTâˆ£zTâˆ’1)p(z_{1:T}) = p(z_1)p(z_2|z_1)p(z_3|z_1,z_2) .... p(z_T|z_1,z_2,...,z_{T-1}) \\\\ =p(z_1)p(z_2|z_1)p(z_3|z_2)....p(z_T|z_{T-1})p(z1:Tâ€‹)=p(z1â€‹)p(z2â€‹âˆ£z1â€‹)p(z3â€‹âˆ£z1â€‹,z2â€‹)....p(zTâ€‹âˆ£z1â€‹,z2â€‹,...,zTâˆ’1â€‹)=p(z1â€‹)p(z2â€‹âˆ£z1â€‹)p(z3â€‹âˆ£z2â€‹)....p(zTâ€‹âˆ£zTâˆ’1â€‹) 2ã€ è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾ è§‚æµ‹å˜é‡åªå’Œå½“å‰æ—¶åˆ»çš„çŠ¶æ€æœ‰å…³ï¼Œä¸å…¶ä»–æ—¶åˆ»çš„ è§‚æµ‹å’ŒçŠ¶æ€å‡æ— å…³ p(x1:Tâˆ£z1:T)=p(x1âˆ£z1)p(x2âˆ£z2)p(x3âˆ£z3)....p(xTâˆ£zT)p(x_{1:T}|z_{1:T}) = p(x_1|z_1)p(x_2|z_2)p(x_3|z_3)....p(x_T|z_T)p(x1:Tâ€‹âˆ£z1:Tâ€‹)=p(x1â€‹âˆ£z1â€‹)p(x2â€‹âˆ£z2â€‹)p(x3â€‹âˆ£z3â€‹)....p(xTâ€‹âˆ£zTâ€‹) åœ¨éª°å­æ¸¸æˆä¸­ï¼Œè§‚æµ‹å˜é‡æ˜¯ç¦»æ•£çš„ï¼Œå› æ­¤æ¨¡å‹å‚æ•°å¯ä»¥ä½¿ç”¨å¤šé¡¹åˆ†å¸ƒæˆ–è´å¡”åˆ†å¸ƒï¼Œå¦‚æœè§‚æµ‹å˜é‡æ˜¯è¿ç»­çš„ï¼ˆå¦‚è¯­éŸ³æˆ–æ–‡æœ¬ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šé¢å‡ èŠ‚ä»‹ç»çš„å¤šå…ƒé«˜æ–¯åˆ†å¸ƒæ¥å»ºæ¨¡ã€‚ ä½†æ˜¯ **çŠ¶æ€ç©ºé—´ **åœ¨éšé©¬å°”å¯å¤«æ¨¡å‹ä¸­ ä¸€å®šæ˜¯ç¦»æ•£çš„ æ ¹æ®ä»»åŠ¡çš„ä¸åŒï¼Œéšé©¬å°”å¯å¤«æ¨¡å‹è¦æ±‚è§£çš„é—®é¢˜å¯ä»¥è¢«åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š å­¦ä¹ ï¼šå·²çŸ¥è§‚æµ‹åºåˆ—x1:Tx_{1:T}x1:Tâ€‹ï¼Œå­¦ä¹ æ¨¡å‹å‚æ•°Î¸\\thetaÎ¸,ä½¿å¾—ç”Ÿæˆè¯¥è§‚æµ‹åºåˆ—çš„æ¦‚ç‡pæœ€å¤§ è§£ç ï¼ˆé¢„æµ‹éšç©ºé—´ï¼‰ï¼šç»™å®šæ¨¡å‹å‚æ•°Î¸\\thetaÎ¸å’Œè§‚æµ‹åºåˆ—x1:Tx_{1:T}x1:Tâ€‹ï¼Œæ±‚æœ€æœ‰å¯èƒ½çš„éšè—çŠ¶æ€åºåˆ—z1:Tz_{1:T}z1:Tâ€‹ è®¡ç®—ï¼ˆé¢„æµ‹è§‚æµ‹ç»“æœï¼‰ï¼šç»™å®šæ¨¡å‹å‚æ•°Î¸\\thetaÎ¸å’Œè§‚æµ‹åºåˆ—x1:Tx_{1:T}x1:Tâ€‹ï¼Œæ±‚è¯¥è§‚æµ‹åºåˆ—x1:Tx_{1:T}x1:Tâ€‹ç”Ÿæˆçš„æ¦‚ç‡ã€‚æŒ‰ç…§æ˜¯å¦å·²çŸ¥æ•´ä¸ªåºåˆ—çš„æ•°æ®ï¼Œè¿˜å¯ä»¥åˆ†ä¸ºï¼š å‰å‘ç®—æ³•ï¼ˆåœ¨çº¿å­¦ä¹ ï¼‰ï¼šå·²çŸ¥ä¸­é—´è§‚æµ‹åºåˆ—1-tï¼Œæ±‚ç”Ÿæˆåˆ°è¯¥åºåˆ—çš„æ¦‚ç‡ï¼šp(ztâˆ£x1:t)p(z_{t}|x_{1:t})p(ztâ€‹âˆ£x1:tâ€‹) åå‘ç®—æ³•ï¼ˆç¦»çº¿å­¦ä¹ ï¼‰ï¼šå·²çŸ¥æ•´ä¸ªè§‚æµ‹åºåˆ—1-Tï¼Œæ±‚p(ztâˆ£x1:T)p(z_{t}|x_{1:T})p(ztâ€‹âˆ£x1:Tâ€‹) å¯è§‚æµ‹éšå˜é‡å­¦ä¹  åœ¨éª°å­æ¸¸æˆè¿™ä¸ªä¾‹å­ä¸­ï¼Œè™½ç„¶ä»ç»™å®šçš„è§‚æµ‹åºåˆ—x1:Tx_{1:T}x1:Tâ€‹ä¸­æˆ‘ä»¬æ— æ³•çŸ¥é“éšå˜é‡çš„åˆ†å¸ƒ**ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“éšå˜é‡å®šä¹‰ä¸ºä¸‰ç§éª°å­çš„éšæœºé€‰å–ï¼Œå®ƒæœä»æŸç§ç‰¹å®šçš„è§„åˆ™ã€‚** ç±»ä¼¼è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä»ä¸ºéšå˜é‡zä»ç„¶æ˜¯å¯è§‚æµ‹çš„ï¼Œå› æ­¤ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡æ³•æ¥ä¼°è®¡éšé©¬å°”å¯å¤«æ¨¡å‹å‚æ•° ã€‚ å¯¹äºNä¸ªçŠ¶æ€åºåˆ—çš„ç¦»æ•£å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šé¡¹åˆ†å¸ƒå»ºæ¨¡ï¼š å‡è®¾è§‚æµ‹å˜é‡xæœä»å¤šé¡¹åˆ†å¸ƒï¼Œå…¶ä¸­kè¡¨ç¤ºéšè—çŠ¶æ€ï¼Œlè¡¨ç¤ºè§‚æµ‹åˆ°çš„åºåˆ—ï¼š B(k,l)=p(xt=lâˆ£zt=k,Î¸),Â K=1,2,..,k,Â l=1,2,...,LB(k,l) = p(x_t =l|z_t=k,\\theta),\\ K=1,2,..,k,\\ l=1,2,...,LB(k,l)=p(xtâ€‹=lâˆ£ztâ€‹=k,Î¸),Â K=1,2,..,k,Â l=1,2,...,L æˆ‘ä»¬åœ¨C2ç« å·²ç»ä¸¾è¿‡ä¾‹å­äº†ï¼Œä¸å¦‚æ¨å¯¼ç•™ç»™ä½ ä»¬ï¼Œè¿™é‡Œæ˜¯å‚æ•°Ï€\\piÏ€å’Œ A çš„ä¼°è®¡ç»“æœï¼š è€Œå‚æ•°çŸ©é˜µBåˆ™ä½¿ç”¨ç»Ÿè®¡æ–¹æ³•è®¡ç®—ï¼š å¦‚æœ è§‚æµ‹å˜é‡xæœä»æ­£æ€åˆ†å¸ƒï¼Œé‚£å°±å¦‚åŒå‰é¢å‡ èŠ‚çš„æ–¹æ³•ï¼Œå¦‚æ³•ç‚®åˆ¶ï¼Œ åœ¨è®¡ç®—è§‚æµ‹æ¦‚ç‡Bæ—¶ï¼Œå°†åˆ†å­åˆ†æ¯æ›¿æ¢ä¸º å‡å€¼ å’Œ åæ–¹å·® çŸ©é˜µå³å¯ã€‚ ä¸å¯è§‚æµ‹éšå˜é‡å­¦ä¹  é‚£ä¹ˆï¼Œæ›´å¤šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç¡®å®æ— æ³•è§‚æµ‹éšå˜é‡zï¼Œæˆ–è€…æ— æ³•å¾—çŸ¥å…¶çš„ç”Ÿæˆè§„å¾‹ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦ä¸€ç§ éç›‘ç£çš„å­¦ä¹ æ–¹æ³• Baum-Welchç®—æ³• ï¼šä¸€ç§æ”¹è¿›çš„EMç®—æ³•ï¼Œç”¨æ¥è§£å†³éšé©¬å°”å¯å¤«æ¨¡å‹çš„å‚æ•°ä¼°è®¡ã€‚ è€ä¸‰æ ·ï¼š Qå‡½æ•°ï¼š è¿™é‡Œå› ä¸ºç¬¦å·tå·²ç»è¢«ç”¨æ¥æ ‡è®°é©¬å°”å¯å¤«è¿‡ç¨‹çš„æ—¶åˆ»ï¼Œæˆ‘ä»¬ç”¨oldä¸Šè¡¨æ ‡è®°å‚æ•°çš„ä¸Šä¸€æ¬¡è¿­ä»£ã€‚ Eæ­¥ï¼šåœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦è®¡ç®—æ•°æ®é›†ä¸­å·²çŸ¥çš„åºåˆ—åœ¨å½“å‰å‚æ•°ä¸‹çš„ç”Ÿæˆæ¦‚ç‡ï¼Œå…·ä½“æ–¹æ³•å‚è§åé¢çš„â€œè®¡ç®—é—®é¢˜â€å°èŠ‚ã€‚ Mæ­¥ï¼š è®¡ç®—é—®é¢˜ å‰å‘ç®—æ³• ï¼šä»ç¬¬0æ­¥å¼€å§‹ï¼Œç®—å‡ºä¸‹ä¸€æ­¥çš„æ¦‚ç‡å¯†åº¦ æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œtæ—¶åˆ»çš„éšè—çŠ¶æ€ä¾èµ–äºt-1æ—¶åˆ»çš„éšè—çŠ¶æ€ï¼Œåˆ©ç”¨é©¬å°”å¯å¤«é“¾çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸‹é¢çš„ä¸¤ä¸ªè½¬ç§»å‡½æ•°ï¼Œå…¶ä¸­iï¼Œjéƒ½æ˜¯æŸä¸€ä¸ªéšçŠ¶æ€ï¼š Ï•t(j)=p(xtâˆ£zt=j,Î¸)\\phi_t(j) = p(x_t|z_t=j,\\theta)Ï•tâ€‹(j)=p(xtâ€‹âˆ£ztâ€‹=j,Î¸) Ïˆ(i,j)=p(zt=jâˆ£ztâˆ’1=i,Î¸)\\psi(i,j) = p(z_t=j|z_{t-1}=i,\\theta)Ïˆ(i,j)=p(ztâ€‹=jâˆ£ztâˆ’1â€‹=i,Î¸) å®šä¹‰tæ—¶åˆ»çš„ ä¿¡å¿µçŠ¶æ€ ï¼ˆbelief stateï¼‰ï¼š äºæ˜¯æˆ‘ä»¬å¾—åˆ°ï¼šÎ±tâˆÏ•t(j)(Î¨TÎ±tâˆ’1)\\alpha_t \\propto \\phi_t(j)(\\Psi^T\\alpha_{t-1})Î±tâ€‹âˆÏ•tâ€‹(j)(Î¨TÎ±tâˆ’1â€‹)å…¶ä¸­Î¨\\PsiÎ¨æ˜¯æ‰€æœ‰è½¬ç§»å‡½æ•°Ïˆ(i,j)\\psi(i,j)Ïˆ(i,j)ç»„æˆçš„çŸ©é˜µï¼Œå¹¶ç”±æ­¤å¯ä»¥ä»t=1å¼€å§‹è®¡ç®—ä¿¡å¿µçŠ¶æ€ï¼Œä»è€Œå¾—åˆ°æœ€ä¸­çš„æ¦‚ç‡å¯†åº¦é“¾ åå‘ç®—æ³•ï¼š ä¸å‰å‘è®¡ç®—ç›¸åï¼Œä½¿ç”¨ æ¡ä»¶ä¼¼ç„¶å‡½æ•° ä»æœ€ç»ˆæ—¶é—´Tï¼ˆå‰æï¼šæˆ‘ä»¬çŸ¥é“æ•´ä¸ªåºåˆ—ï¼‰åå‘æ¨å¯¼æ¯ä¸ªæ—¶é—´ç‚¹çš„åºåˆ—æ¦‚ç‡ã€‚ é¢„æµ‹é—®é¢˜ å‡è®¾æˆ‘ä»¬å·²ç»çŸ¥é“äº†æ¨¡å‹å‚æ•°å’Œè§‚æµ‹å¾—åˆ°çš„åºåˆ—æ•°æ®ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬æƒ³è¦æ¨æ–­æœ€æœ‰å¯èƒ½çš„éšçŠ¶æ€åºåˆ—ï¼š zâˆ—=argmaxz1:Tp(z1:Tâˆ£x1:T)z* = argmax_{z_{1:T}}p(z_{1:T}|x_{1:T})zâˆ—=argmaxz1:Tâ€‹â€‹p(z1:Tâ€‹âˆ£x1:Tâ€‹) æˆ‘ä»¬å¯ä»¥ä»ç¬¬ä¸€ä¸ªæ—¶åˆ»èµ·ï¼Œæ¯ä¸ªæ—¶åˆ»å–çš„éšçŠ¶æ€zæ ‡è®°ä¸€ä¸ªä»£ä»·ï¼šå³ å‰é¢æ‰€æœ‰æ­¥éª¤çš„è®¡ç®—æ¦‚ç‡æ˜¯å¦æœ€å¤§ï¼š è¿™æ ·ï¼Œæˆ‘ä»¬å°±å°†æ±‚éšçŠ¶æ€åºåˆ—è½¬æ¢ä¸ºä¸€ä¸ª æœ€å¤§ï¼ˆä¼˜ï¼‰è·¯å¾„é—®é¢˜ã€‚ ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¡ç®—æœºç®—æ³•æ¥æ±‚è§£ï¼Œä¾‹å¦‚è´ªå¿ƒç®—æ³•ã€‚ ä¸‹é¢ä»‹ç»ä¸€ä¸ªç§°ä¸º ç»´ç‰¹æ¯”ç®—æ³• çš„æ–¹æ³•ï¼Œå®ƒçš„æ€æƒ³æ˜¯ç”¨ åŠ¨æ€è§„åˆ’ è§£æœ€å¤§è·¯å¾„é—®é¢˜ï¼š ä»ç»ˆç»“ç‚¹å¼€å§‹ï¼Œç”± åå‘å‰é€æ­¥æ±‚å¾—ç»“ç‚¹ zTâˆ—,zTâˆ’1âˆ—,...,z1âˆ—z^*_{T}, z^*_{T-1},...,z^*_{1}zTâˆ—â€‹,zTâˆ’1âˆ—â€‹,...,z1âˆ—â€‹ï¼Œå¾—åˆ°æœ€ä¼˜è·¯å¾„","tags":["ç”Ÿæˆæ¨¡å‹","ç¬”è®°"]},{"title":"ã€ç¬”è®°ã€‘ç”Ÿæˆæ¨¡å‹åŸºç¡€ä¸åº”ç”¨ - ç¬¬3ç« ","path":"/2023/11/27/ç”Ÿæˆæ¨¡å‹åŸºç¡€ä¸åº”ç”¨ç¬”è®°-ç¬¬3ç« /","content":"C3 ä¸»é¢˜æ¨¡å‹ï¼šä¸»é¢˜æ¨¡å‹æ˜¯ä¸€ç±»ç”¨äºæ–‡æœ¬åˆ†æçš„éç›‘ç£å­¦ä¹ æ–¹æ³•ï¼Œæ—¨åœ¨ä»æ–‡æœ¬æ•°æ®ä¸­å‘ç°éšè—çš„ä¸»é¢˜ç»“æ„â€¦ C3 ä¸»é¢˜æ¨¡å‹ Topic modelsï¼šä»¥éç›‘ç£å­¦ä¹ çš„æ–¹å¼å¯¹æ–‡æœ¬çš„éšå«ç»“æ„è¿›è¡Œå‘ç°æˆ–ç”Ÿæˆçš„æ¨¡å‹ ä¸»é¢˜æ¨¡å‹æ˜¯ä¸€ç±»ç”¨äºæ–‡æœ¬åˆ†æçš„éç›‘ç£å­¦ä¹ æ–¹æ³•ï¼Œæ—¨åœ¨ä»æ–‡æœ¬æ•°æ®ä¸­å‘ç°éšè—çš„ä¸»é¢˜ç»“æ„ã€‚è¿™äº›ä¸»é¢˜æ¨¡å‹çš„ç›®æ ‡æ˜¯è¯†åˆ«æ–‡æœ¬é›†åˆä¸­çš„ä¸»é¢˜ï¼Œè€Œæ— éœ€äº‹å…ˆæ ‡è®°çš„ä¸»é¢˜æ ‡ç­¾æˆ–ç›‘ç£ä¿¡æ¯ã€‚ä¸»é¢˜æ¨¡å‹æœ€å¸¸è§çš„åº”ç”¨ä¹‹ä¸€æ˜¯ç”¨äºæ–‡æœ¬æ•°æ®çš„ä¸»é¢˜å»ºæ¨¡ï¼Œå…¶ä¸­æ–‡æ¡£è¢«çœ‹ä½œæ˜¯å¤šä¸ªä¸»é¢˜çš„æ··åˆï¼Œè€Œæ¯ä¸ªä¸»é¢˜åˆç”±ä¸€ç»„è¯æ±‡è¡¨ç¤ºã€‚ ä¸»é¢˜æ¨¡å‹çš„å‘å±•ï¼š LSA PLSA LDA 2003 HDP 2005 å•è¯å‘é‡ç©ºé—´ å°†æ–‡æ¡£ä¸­æ¯ä¸ªå•è¯çš„å‡ºç°çš„é¢‘æ•°ï¼ˆæˆ–åŠ æƒçš„é¢‘æ•°ï¼‰è¡¨ç¤ºä¸ºå‘é‡ å¯ä»¥äº‹å…ˆå®šä¹‰ æœ‰æ•ˆå•è¯çš„ è¯­æ–™åº“ï¼Œåªæå–æ–‡æ¡£ä¸­æœ‰æ•ˆå•è¯çš„å‡ºç°é¢‘ç‡ç”Ÿæˆå‘é‡ï¼ˆä¹Ÿå¯ä»¥è§†ä¸ºä¸åœ¨è¯­æ–™åº“ä¸­çš„å•è¯å…¶æƒå€¼ä¸º0ï¼‰ï¼Œæ‰€æœ‰çš„è¯­æ–™åº“ä¸­çš„æœ‰æ•ˆå•è¯ç”¨é›†åˆWè¡¨ç¤º ä¸€ä¸ªæ–‡æ¡£å°±è¡¨ç¤ºæˆï¼šd=(fw1,fw2,....,fwN)d=(f_{w_1},f_{w_2},....,f_{w_N})d=(fw1â€‹â€‹,fw2â€‹â€‹,....,fwNâ€‹â€‹)ï¼Œæ¯ä¸ªfif_ifiâ€‹éƒ½æ˜¯æœ‰æ•ˆå•è¯iiiå‡ºç°çš„æ¬¡æ•° ä¸€ä¸ªæ–‡æ¡£é›†ä¸­çš„æ‰€æœ‰æ–‡æ¡£ï¼ˆè®¾ä¸€å…±æœ‰Nä¸ªæ–‡æ¡£ç»„æˆäº†é›†åˆDï¼‰ç»„æˆäº†ä¸€ä¸ªå‘é‡é›†åˆï¼Œå³ å•è¯å‘é‡ç©ºé—´ å¯¹äºä¸¤ä¸ªä¸åŒçš„æ–‡æ¡£di,Â djd_i,\\ d_jdiâ€‹,Â djâ€‹ï¼Œå¯ä»¥ä½¿ç”¨å®ƒä»¬ä¹‹é—´çš„æ•°å­¦åº¦é‡ï¼Œæ¥è¡¨ç¤ºæ–‡æœ¬ä¹‹é—´çš„è¯­ä¹‰ç›¸ä¼¼åº¦ï¼š è®¡ç®—æ–¹æ³•å¯ä»¥ä¸º æ–‡æ¡£å‘é‡çš„ å†…ç§¯ æˆ– æ ‡å‡†åŒ–å†…ç§¯ å•è¯å‘é‡ç©ºé—´çš„è¡¨ç¤ºæ–¹æ³•ï¼š 1ã€å•è¯-æ–‡æœ¬çŸ©é˜µï¼šå°†å•è¯åœ¨æ¯ä¸ªæ–‡æ¡£çš„å‡ºç°é¢‘ç‡å‘é‡ä½œä¸ºåˆ—å‘é‡ï¼Œç»„æˆçš„çŸ©é˜µã€‚é€šå¸¸ä¸ºç¨€ç–çŸ©é˜µ å•è¯-æ–‡æœ¬çŸ©é˜µçš„ä¾‹å­ï¼š - è®¡ç®—æœºå¤„ç†ç¨€ç–çŸ©é˜µï¼Œéå¸¸æµªè´¹ç®—åŠ›ï¼Œå› æ­¤ï¼Œéœ€è¦ä¸€ä¸ªç­‰ä»·çš„æ•°æ®ç»“æ„æ¥è¡¨ç¤ºç›¸åŒç»™ä¿¡æ¯ï¼Œäºæ˜¯æå‡ºäº†ä¸‹é¢è¿™ç§è¡¨ç¤ºæ–¹æ³•ã€‚ 2ã€å•è¯é¢‘ç‡-é€†æ–‡æœ¬é¢‘ç‡ï¼ˆTF-IDFï¼‰ï¼š ç»Ÿè®¡å•è¯wiw_iwiâ€‹åœ¨æ–‡æœ¬dkd_kdkâ€‹ä¸­å‡ºç°çš„æƒå€¼ ï¼š TFâˆ’IDF(wi,dk)=f(wi,dk)len(dk)logNdf(wi)TF-IDF(w_i,d_k) = \\frac{f(w_i,d_k)}{len(d_k)}log\\frac{N}{df(w_i)}TFâˆ’IDF(wiâ€‹,dkâ€‹)=len(dkâ€‹)f(wiâ€‹,dkâ€‹)â€‹logdf(wiâ€‹)Nâ€‹ - tf(w,b)ï¼šå•è¯wåœ¨æ–‡æœ¬bä¸­çš„å‡ºç°é¢‘æ•° - len(b)ï¼šæ–‡æœ¬bä¸­çš„å•è¯æ€»æ•° - df(w)ï¼šæ•´ä¸ªæ–‡æœ¬é›†åˆä¸­ï¼Œå«æœ‰å•è¯wçš„æ–‡æœ¬æ•° - Nï¼šæ•´ä¸ªæ–‡æœ¬é›†åˆçš„å¤§å°ï¼ˆå«æœ‰çš„æ–‡æœ¬æ•°é‡ï¼‰ å•è¯å‘é‡ç©ºé—´çš„ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼šæ¨¡å‹ç®€å•ã€è®¡ç®—æ•ˆç‡é«˜ç¼ºç‚¹ï¼šå†…ç§¯è®¡ç®—çš„ç›¸ä¼¼åº¦ä¸ä¸€å®šèƒ½å‡†ç¡®è¡¨è¾¾ä¸¤ä¸ªæ–‡æ¡£é—´çš„ç›¸ä¼¼åº¦ è¯é¢˜å‘é‡ç©ºé—´ å®šä¹‰è¯é¢˜ï¼šå‡è®¾æ‰€æœ‰çš„æ–‡æœ¬ä¸­ä¸€å…±å«æœ‰Kä¸ªè¯é¢˜ å‡è®¾æ¯ä¸ªè¯é¢˜éƒ½æ˜¯ä¸€ä¸ªMç»´åº¦çš„å‘é‡tttï¼Œtttç”±è¯­æ–™åº“ï¼ˆé›†åˆWï¼‰ä¸­çš„Mä¸ªå•è¯ç»„æˆã€‚ t=(w1,w2,...,wM)Tt = (w_1,w_2,...,w_M)^T t=(w1â€‹,w2â€‹,...,wMâ€‹)T è¿™æ ·ï¼Œä¸€å…±Kä¸ªè¯é¢˜å°±ç»„æˆäº†ä¸€ä¸ªè¯é¢˜å‘é‡ç©ºé—´ï¼Œè®°ä¸ºT=[t1,t2,...,tk]=[w11Â w12...Â wMK]T = [t_1,t_2,...,t_k]=[w_{11}\\ w_{12} ... \\ w_{MK}]T=[t1â€‹,t2â€‹,...,tkâ€‹]=[w11â€‹Â w12â€‹...Â wMKâ€‹]ã€å•è¯-è¯é¢˜çŸ©é˜µã€‘ æ ¹æ®å•è¯å‘é‡ç©ºé—´çš„å®šä¹‰ï¼Œå¯ä»¥æ¨å¯¼å‡ºï¼š å‡è®¾ä¸€ç¯‡æ–‡æœ¬xxxåœ¨å•è¯å‘é‡ç©ºé—´ä¸­è¢«è¡¨ç¤ºä¸ºï¼šx=(fw1,fw2,....,fwN)x = (f_{w_1},f_{w_2},....,f_{w_N})x=(fw1â€‹â€‹,fw2â€‹â€‹,....,fwNâ€‹â€‹)ï¼Œè€Œåœ¨è¯é¢˜ç©ºé—´ä¸­è¢«è¡¨ç¤ºä¸ºï¼š$$y = g(x) = (f_{t_1},f_{t_2},â€¦,f_{t_k})$$ ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å°†è¯é¢˜çš„å‡ºç°é¢‘ç‡ è®°ä¸ºft1=y1,ft2=y2...f_{t_1} = y_1, f_{t_2} = y_2...ft1â€‹â€‹=y1â€‹,ft2â€‹â€‹=y2â€‹...è¿™æ ·ï¼Œä¸€ä¸ªæ–‡æ¡£xï¼Œå®ƒå¯ä»¥è¡¨ç¤ºä¸ºæ‰€æœ‰è¯é¢˜å’Œå•è¯çš„çº¿æ€§ç»„åˆï¼š x=t1y1+t2y2+...tkykx = t_1y_1 + t_2y_2 + ... t_ky_k x=t1â€‹y1â€‹+t2â€‹y2â€‹+...tkâ€‹ykâ€‹ å¦‚æœæˆ‘ä»¬å®šä¹‰è¯é¢˜-æ–‡æœ¬çŸ©é˜µYï¼Œå³å°†æ¯ä¸ªè¯é¢˜è¡¨ç¤ºçš„æ–‡æœ¬yyyç»„åˆèµ·æ¥ï¼Œåˆ™ç”±ä¸Šè¿°çš„çº¿æ€§ç»„åˆå…³ç³»ï¼Œå¯¹æ•´ä¸ªæ–‡æ¡£é›†åˆDï¼Œå³å¯ç”±è¯é¢˜å‘é‡ç©ºé—´çš„ è¯é¢˜çŸ©é˜µT æ¥è¡¨ç¤ºã€‚ å› æ­¤ï¼Œå•è¯-æ–‡æœ¬çŸ©é˜µã€å•è¯-è¯é¢˜çŸ©é˜µå’Œè¯é¢˜-æ–‡æœ¬çŸ©é˜µå…·æœ‰å¦‚ä¸‹çš„å…³ç³»ï¼š XMN=TMKYKNX_{MN} = T_{MK}Y_{KN} XMNâ€‹=TMKâ€‹YKNâ€‹ æ½œåœ¨è¯­ä¹‰åˆ†æå³æ˜¯ å°†æ–‡æœ¬åœ¨ å•è¯å‘é‡ç©ºé—´çš„è¡¨ç¤º é€šè¿‡ çº¿æ€§å˜æ¢ è½¬æ¢ä¸º** åœ¨è¯é¢˜å‘é‡ç©ºé—´ä¸­çš„è¡¨ç¤º**çš„æ–¹æ³• æœŸæœ›æœ€å¤§åŒ–ç®—æ³• åœ¨è®²æ½œåœ¨è¯­ä¹‰åˆ†æä¹‹å‰ï¼Œå¿…é¡»è¦äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯è´å¶æ–¯æ¦‚ç‡æ¨¡å‹çš„æ½œå˜é‡ï¼Œä»¥åŠå¯¹æ½œå˜é‡æ¨¡å‹çš„ä¼°è®¡ç®—æ³•ã€‚æœŸæœ›æœ€å¤§åŒ–ç®—æ³•ï¼ˆException Maximization Algorithmï¼Œç®€ç§°EMç®—æ³•ï¼‰æ˜¯ä¸€ç§å¯å‘å¼çš„è¿­ä»£ç®—æ³•ï¼Œç”¨äºå¯¹å«æœ‰éšå˜é‡çš„æ¦‚ç‡æ¨¡å‹ çš„å‚æ•°åš æå¤§ä¼¼ç„¶ä¼°è®¡ å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªæ¦‚ç‡æ¨¡å‹ï¼š æœ‰ä¸‰æšç¡¬å¸A,B,CA,B,CA,B,Cï¼ŒæŠ›æ·å®ƒä»¬æ­£é¢æœä¸Šçš„æ¦‚ç‡ä¸åŒï¼Œè®°ä¸ºr,p,qr,p,qr,p,q é‡å¤æ‰§è¡Œä»¥ä¸‹è¯•éªŒï¼ˆEx(X)è¡¨ç¤ºå¯¹äº‹ä»¶Xåšä¸€æ¬¡å®éªŒï¼Œ1è¡¨ç¤ºæ­£é¢å‘ä¸Šï¼Œ0è¡¨ç¤ºåé¢å‘ä¸Šï¼‰ï¼š Ex(Y)=Ex(B)Â ifÂ Ex(A)==1Â elseÂ Ex(C)Ex(Y)= Ex(B) \\ if \\ Ex(A)==1 \\ else \\ Ex(C) Ex(Y)=Ex(B)Â ifÂ Ex(A)==1Â elseÂ Ex(C) å³æŠ›ç¡¬å¸Aï¼Œå¦‚æœæ˜¯æ­£é¢æŠ›ç¡¬å¸Bï¼Œå¦åˆ™æŠ›ç¡¬å¸Cï¼Œä½ åªèƒ½è§‚æµ‹åˆ°æœ€åä¸€æ¬¡æŠ›æ·ç¡¬å¸çš„ç»“æœã€‚ é‚£ä¹ˆå¦‚ä½•ä¼°è®¡ä¸‰ä¸ªå‚æ•°r,p,qr,p,qr,p,qå‘¢ï¼Ÿ å› ä¸ºè¿™ä¸ªéšæœºäº‹ä»¶åŒ…å«ä¸¤ä¸ªæ¦‚ç‡æ¨¡å‹çš„ å¤åˆã€‚å› æ­¤æˆ‘ä»¬æ— æ³•ç›´æ¥å¯¹ç»“æœå»ºæ¨¡ï¼Œæ•°å­¦å®¶ä»¬ç”±æ­¤æå‡ºï¼Œèƒ½å¦åŠ å…¥â€œéšå˜é‡â€ZZZï¼š ç”¨å®ƒæ¥è¡¨ç¤ºè¯•éªŒä¸­æŠ›æ·Aç¡¬å¸çš„ä¸­é—´ç»“æœï¼ˆè™½ç„¶æˆ‘ä»¬å¹¶ä¸èƒ½ç›´æ¥è§‚æµ‹åˆ°ï¼‰ï¼Œå‡è®¾å…±æŠ›äº†næ¬¡ï¼Œç¬¬iæ¬¡è§‚æµ‹ç»“æœçš„å€¼è®°ä½œziz_iziâ€‹ -å‡è®¾æˆ‘ä»¬åªçœ‹æœ€ç»ˆç»“æœYï¼Œå°†å‚æ•°è¡¨ç¤ºä¸ºå‘é‡Î¸=(r,p,q)\\theta = (r,p,q)Î¸=(r,p,q)ï¼Œåˆ™å®é™…è¦è§‚æµ‹çš„äº‹ä»¶Yçš„ä¼¼ç„¶å¯ä»¥è¡¨ç¤ºä¸ºï¼š P(Yâˆ£Î¸)=P(Y,Zâˆ£Î¸)=âˆ‘i=1nP(yi,ziâˆ£Î¸)=âˆ‘i=1nP(ziâˆ£Î¸)P(yiâˆ£zi,Î¸)=rpâˆ‘(yi=1)(1âˆ’p)âˆ‘(yi=0)+(1âˆ’r)qâˆ‘(yi=1)(1âˆ’q)âˆ‘(yi=0)P(Y|\\theta) = P(Y,Z|\\theta)= \\sum_{i=1}^{n}P(y_i,z_i|\\theta) = \\sum_{i=1}^{n}P(z_i|\\theta)P(y_i|z_i,\\theta) \\\\= rp^{\\sum(y_i=1)}(1-p)^{\\sum(y_i=0)}+(1-r)q^{\\sum(y_i=1)}(1-q)^{\\sum(y_i=0)} P(Yâˆ£Î¸)=P(Y,Zâˆ£Î¸)=i=1âˆ‘nâ€‹P(yiâ€‹,ziâ€‹âˆ£Î¸)=i=1âˆ‘nâ€‹P(ziâ€‹âˆ£Î¸)P(yiâ€‹âˆ£ziâ€‹,Î¸)=rpâˆ‘(yiâ€‹=1)(1âˆ’p)âˆ‘(yiâ€‹=0)+(1âˆ’r)qâˆ‘(yiâ€‹=1)(1âˆ’q)âˆ‘(yiâ€‹=0) ç›´æ¥ä½¿ç”¨MLEä¼°è®¡è¿™ä¸ªä¼¼ç„¶å‡½æ•°ï¼Ÿä¸è¡Œï¼ŒåŒ…å«ä¸‰ä¸ªæœªçŸ¥å˜é‡ï¼Œä¸”éœ€è¦æ±‚logå’Œçš„æå¤§å€¼ï¼Œç®—ä¸å‡ºè§£æè§£ã€‚ æ—¢ç„¶æ²¡æœ‰å‡†ç¡®çš„è§£æè§£ï¼Œæ•°å­¦å®¶äºæ˜¯æå‡ºäº†ç”¨è¿­ä»£æ³•é€¼è¿‘æœ€å¤§å€¼çš„æ±‚è§£åŠæ³•ï¼Œè¿™å°±æ˜¯EMç®—æ³•ã€‚æˆ‘ä»¬å…ˆå®šä¹‰å¥½ä¸¤ç§æƒ…å†µçš„ä¼¼ç„¶å‡½æ•°ï¼Œæ—¢ç„¶è¦æ±‚æå¤§ä¼¼ç„¶ï¼Œæˆ‘ä»¬å¯¹ä¼¼ç„¶å‡½æ•°ç›´æ¥å–logï¼Œå®šä¹‰å¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼š ä¸å°†éšå˜é‡Zè§†ä¸ºéšæœºå˜é‡çš„æƒ…å†µã€ç§°ä¸ºï¼šä¸å®Œå…¨æ•°æ®ã€‘ LY(Î¸)=log[âˆi=1nP(yiâˆ£Î¸)]=âˆ‘i=1nlog[âˆ‘ziâˆˆÂ Ex(Z)P(yi,ziâˆ£Î¸)]L_Y(\\theta) = log[\\prod_{i=1}^nP(y_i|\\theta)] = \\sum_{i=1}^nlog[\\sum_{z_i \\in \\ Ex(Z)}P(y_i,z_i|\\theta)] LYâ€‹(Î¸)=log[i=1âˆnâ€‹P(yiâ€‹âˆ£Î¸)]=i=1âˆ‘nâ€‹log[ziâ€‹âˆˆÂ Ex(Z)âˆ‘â€‹P(yiâ€‹,ziâ€‹âˆ£Î¸)] å°†éšå˜é‡Zè§†ä¸ºéšæœºå˜é‡çš„æƒ…å†µã€ç§°ä¸ºï¼šå®Œå…¨æ•°æ®ã€‘ LY,Z(Î¸)=log[âˆi=1nP(yi,ziâˆ£Î¸)]=âˆ‘i=1nlog[P(yi,ziâˆ£Î¸)]L_{Y,Z}(\\theta) = log[\\prod_{i=1}^nP(y_i,z_i|\\theta)] = \\sum_{i=1}^nlog[P(y_i,z_i|\\theta)] LY,Zâ€‹(Î¸)=log[i=1âˆnâ€‹P(yiâ€‹,ziâ€‹âˆ£Î¸)]=i=1âˆ‘nâ€‹log[P(yiâ€‹,ziâ€‹âˆ£Î¸)] æˆ‘ä»¬å‡è®¾Î¸\\thetaÎ¸ä»ä¸€ä¸ªåˆå§‹å€¼Î¸0\\theta_0Î¸0â€‹å¼€å§‹ï¼Œæ¯æ¬¡è¿­ä»£çš„æ—¶å€™æ›´æ–°ï¼ˆä¸‹æ ‡+1ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¸Œæœ› åœ¨å·²çŸ¥è§‚æµ‹ç»“æœYçš„æƒ…å†µä¸‹ï¼Œè®©å®Œå…¨æ•°æ®çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°LY,Z(Î¸)L_{Y,Z}(\\theta)LY,Zâ€‹(Î¸)å°½å¯èƒ½å–å¾—æœ€å¤§çš„æœŸæœ›ï¼Œç”±æ­¤å®šä¹‰Qå‡½æ•°ï¼š Q(Î¸,Î¸t)=E[LY,Z(Î¸)âˆ£Y,Î¸t]=âˆ‘ziâˆˆÂ Ex(Z)P(Zâˆ£Y,Î¸t)log[P(Y,Zâˆ£Î¸)]Q(\\theta,\\theta_t) = E[L_{Y,Z}(\\theta)|Y,\\theta_t] = \\sum_{z_i \\in \\ Ex(Z)}{P(Z|Y,\\theta_t)log[P(Y,Z|\\theta)]} Q(Î¸,Î¸tâ€‹)=E[LY,Zâ€‹(Î¸)âˆ£Y,Î¸tâ€‹]=ziâ€‹âˆˆÂ Ex(Z)âˆ‘â€‹P(Zâˆ£Y,Î¸tâ€‹)log[P(Y,Zâˆ£Î¸)] å…¶ä¸­ï¼ŒÎ¸t\\theta_tÎ¸tâ€‹æ˜¯ç¬¬tæ­¥æ›´æ–°çš„å‚æ•°ï¼ŒQæ˜¯å…³äºÎ¸\\thetaÎ¸çš„å‡½æ•°ï¼Œè®©å®ƒæœ€å¤§ï¼Œåˆ™éœ€è¦å¯¹Î¸\\thetaÎ¸æ±‚åå¯¼ï¼Œå¹¶å–å¯¼æ•°ä¸º0ã€‚æ­¤æ—¶Î¸t\\theta_tÎ¸tâ€‹å–ä¸€ä¸ªæ–°å€¼ï¼Œå³ï¼š \\theta_{t+1} = argmax_\\theta{Q(\\theta,\\theta_t)} $$ã€MLEã€‘ è¿™æ˜¯é‡‡ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡çš„æ–¹æ³•ï¼Œå¦‚æœä½ è¯´è¦è€ƒè™‘å…ˆéªŒæ¦‚ç‡ï¼ˆå³MAPæ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆæ¯æ¬¡æ›´æ–°æ˜¯éœ€è¦åŠ ä¸Šå…ˆéªŒå‡½æ•°çš„å¯¹æ•°å€¼ï¼š \\theta_{t+1} = argmax_\\theta{Q(\\theta,\\theta_t)} + logP(\\theta) ã€MAPã€‘ &gt; ç°åœ¨æˆ‘ä»¬è¯•ç€å¯¹åˆšæ‰çš„é—®é¢˜åº”ç”¨EMç®—æ³•ï¼š &gt; - å…ˆå‡è®¾$\\theta^{(0)} = (0.5,0.5,0.5)$ï¼ˆä¸ºäº†ä¸‹æ ‡ä¸æ‰“æ¶ï¼Œæˆ‘ä»¬ç”¨ä¸Šæ‹¬å·æ ‡è®°æ­¥æ•°tï¼‰ &gt; - åˆ™$P(Z|Y,\\theta_t)$è¡¨ç¤ºï¼š &gt; - å‡è®¾ç¬¬$i$æ¬¡çš„æœ€ç»ˆ**è§‚æµ‹ç»“æœæ˜¯**$y_i(=1 \\ or\\ 0)$**ï¼Œè¿™ä¸ªç»“æœæ˜¯ç”± æŠ›ç¡¬å¸B**$(z_i=1)$** è¿˜æ˜¯ æŠ›ç¡¬å¸C**$(z_i=0)$** å¾—åˆ°çš„æ¦‚ç‡ï¼Œå°†å…¶è®°ä¸º**$p_i$**ï¼Œ**æˆ‘ä»¬å¯ç”¨ç›´æ¥ä»¥ä¼¯åŠªåˆ©å®éªŒçš„ç»“æœè®¡ç®—ï¼š &gt; $p_i = \\frac{P(y_i,z_i=1)}{P(y_i,z_i=0)+P(y_i,z_i=1)}=\\frac{rp}{rp+(1-r)q}(y_i=1) \\ or \\ \\frac{r(1-p)}{r(1-p)+(1-r)(1-q)}(y_i=0)$**ã€å¯¹äºæ¯ä¸€æ­¥iã€‘** &gt; - **ç„¶åæ±‚å…¶å…³äºZçš„æœŸæœ›ï¼Œå³ï¼š** &gt; $$Q(\\theta) = \\sum_{i=1}^{n}p_i\\log[P(y_i=1,Z|\\theta)] + (1-p_i)\\log[P(y_i=0,Z|\\theta)] æ³¨æ„ï¼špip_ipiâ€‹ä¸æ¯ä¸€æ­¥è¦æ›´æ–°çš„Î¸t\\theta_tÎ¸tâ€‹æœ‰å…³ï¼Œå› æ­¤å…¶è¡¨ç¤ºä¸ºçš„r,p,qr,p,qr,p,q**ä¹Ÿéœ€è¦æ¯ä¸€æ­¥æ›´æ–°ã€‚**è€Œlog[P(Y,Zâˆ£Î¸)]log[P(Y,Z|\\theta)]log[P(Y,Zâˆ£Î¸)]åˆ™ç›´æ¥è¡¨ç¤ºä¸ºä¸Šè¿°çš„ä¼¼ç„¶å‡½æ•°ï¼Œæ³¨æ„å®ƒä¸è¦é€¼è¿‘çš„Î¸t\\theta_tÎ¸tâ€‹æ— å…³ï¼Œå¯ä»¥ç›´æ¥è¡¨ç¤ºä¸ºr,p,qr,p,qr,p,qçš„å¼å­ï¼Œæ•…ï¼š Q(Î¸,Î¸t)=âˆ‘i=1npi(tâˆ’1)logâ¡[rpyi(1âˆ’p)1âˆ’yi]+(1âˆ’pi(tâˆ’1))logâ¡[(1âˆ’r)qyi(1âˆ’q)1âˆ’yi]Q(\\theta,\\theta_t)=\\sum_{i=1}^{n}p_i^{(t-1)}\\log[rp^{y_i}(1-p)^{1-y_i}] + (1-p_i^{(t-1)})\\log[(1-r)q^{y_i}(1-q)^{1-y_i}] Q(Î¸,Î¸tâ€‹)=i=1âˆ‘nâ€‹pi(tâˆ’1)â€‹log[rpyiâ€‹(1âˆ’p)1âˆ’yiâ€‹]+(1âˆ’pi(tâˆ’1)â€‹)log[(1âˆ’r)qyiâ€‹(1âˆ’q)1âˆ’yiâ€‹] å¯¹è¯¥å‡½æ•°çš„r,p,qr,p,qr,p,qåˆ†åˆ«æ±‚åå¯¼ï¼Œå³å¯å¾—åˆ°ï¼š r(t+1)=âˆ‘i=1npi(t)nr^{(t+1)} = \\frac{\\sum_{i=1}^{n}p_i^{(t)}}{n} r(t+1)=nâˆ‘i=1nâ€‹pi(t)â€‹â€‹ p(t+1)=âˆ‘i=1npi(t)yiâˆ‘i=1npi(t)p^{(t+1)} = \\frac{\\sum_{i=1}^{n}p_i^{(t)}y_i}{\\sum_{i=1}^{n}p_i^{(t)}} p(t+1)=âˆ‘i=1nâ€‹pi(t)â€‹âˆ‘i=1nâ€‹pi(t)â€‹yiâ€‹â€‹ q(t+1)=âˆ‘i=1n(1âˆ’pi(t))yiâˆ‘i=1n(1âˆ’pi(t))q^{(t+1)} = \\frac{\\sum_{i=1}^{n}(1-p_i^{(t)})y_i}{\\sum_{i=1}^{n}(1-p_i^{(t)})} q(t+1)=âˆ‘i=1nâ€‹(1âˆ’pi(t)â€‹)âˆ‘i=1nâ€‹(1âˆ’pi(t)â€‹)yiâ€‹â€‹ é—®é¢˜ï¼š ä¸ºä»€ä¹ˆEMç®—æ³•èƒ½è¿‘ä¼¼å®ç°å¯¹è§‚æµ‹æ•°æ® çš„æå¤§ä¼¼ç„¶ä¼°è®¡ï¼Ÿ ç­”ï¼šå¯ä»¥é€šè¿‡æ•°å­¦è¯æ˜ï¼šå¯ä»¥é€šè¿‡L(Î¸)L(\\theta)L(Î¸)å‡½æ•°æ„é€ Qå‡½æ•°ï¼Œå½“ä½œä¸ºä¸­é—´å‡½æ•°æ—¶ï¼Œå¯ä»¥è¯æ˜åœ¨è¿­ä»£è¿‡ç¨‹ä¸­æå¤§å¯¹æ•°ä¼¼ç„¶å‡½æ•°L(Î¸)L(\\theta)L(Î¸)çš„ä¸‹ç•Œå•è°ƒå¢åŠ ï¼Œå³ï¼šL(Î¸t+1)â‰¥L(Î¸t)L(\\theta_{t+1}) \\geq L(\\theta_t)L(Î¸t+1â€‹)â‰¥L(Î¸tâ€‹) è¯æ˜å°±çœç•¥å•¦~ æ¦‚ç‡æ½œåœ¨è¯­ä¹‰åˆ†æï¼ˆPLSAï¼‰ æ˜¯ä¸€ç§åˆ©ç”¨æ¦‚ç‡ç”Ÿæˆæ¨¡å‹ å¯¹ æ–‡æœ¬é›†åˆè¿›è¡Œè¯é¢˜åˆ†æçš„ æ— ç›‘ç£å­¦ä¹ æ–¹æ³• å‡è®¾ï¼š æ¯ä¸ªæ–‡æœ¬ç”±ä¸€ä¸ªè¯é¢˜çš„åˆ†å¸ƒå†³å®š æ¯ä¸ªè¯é¢˜ç”±ä¸€ä¸ªå•è¯çš„åˆ†å¸ƒå†³å®š å› æ­¤ï¼Œä»ç»™å®šæ–‡æœ¬çš„è¡¨ç¤ºåˆ°ç”Ÿæˆå•è¯ï¼Œå°±æ˜¯ä¸€ä¸ªæ¦‚ç‡æ¨¡å‹ï¼Œå…¶ä¸­è¯é¢˜æ˜¯éšå˜é‡ ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾ä¸€ä¸ªç¦»æ•£ç©ºé—´ä¸­ï¼Œã€è¯é¢˜ã€‘å’Œå…¶å¯¹åº”çš„å•è¯çš„æ¦‚ç‡åˆ†å¸ƒå¦‚ä¸‹ï¼š ã€æ•™è‚²ã€‘ = {å¤§å­¦ï¼š0.5ï¼Œè€å¸ˆï¼š0.3ï¼Œè¯¾ç¨‹ï¼š0.2 } ã€ç»æµã€‘ = {å¸‚åœºï¼š0.4ï¼Œä¼ä¸šï¼š0.2ï¼Œé‡‘èï¼š0.4} ã€äº¤é€šã€‘ = {é«˜é“ï¼š0.5ï¼Œæ±½è½¦ï¼š0.2ï¼Œé£æœºï¼š0.3} è€Œå¯¹äºä¸€ä¸ªæŒ–äº†ç©ºä½çš„æ–‡æœ¬ï¼Œå…¶æ¯ä¸ªä½ç½®å¯¹åº”è¯é¢˜çš„æ¦‚ç‡åˆ†å¸ƒå¦‚ä¸‹ï¼š D(xxåœºæ™¯ä¸‹å¦‚ä½•çœ‹å¾…xxå’Œxxçš„å…³ç³») = {æ•™è‚²ï¼š0.5ï¼Œç»æµï¼š0.3ï¼Œäº¤é€šï¼š0.2} é‚£ä¹ˆï¼Œç”Ÿæˆ â€œå¤§å­¦åœºæ™¯ä¸‹å¦‚ä½•çœ‹å¾…å¤§å­¦ä¸ä¼ä¸šçš„å…³ç³»â€çš„æ¦‚ç‡ æ˜¯ï¼š [P(t=æ•™è‚²)P(w=å¤§å­¦âˆ£t=æ•™è‚²)]2Ã—P(t=ç»æµ)P(w=ä¼ä¸šâˆ£t=ç»æµ)=0.00375[P( t = æ•™è‚² )P(w = å¤§å­¦|t = æ•™è‚²) ]^2Ã— \\\\P(t = ç»æµ) P(w = ä¼ä¸š |t = ç»æµ ) =0.00375[P(t=æ•™è‚²)P(w=å¤§å­¦âˆ£t=æ•™è‚²)]2Ã—P(t=ç»æµ)P(w=ä¼ä¸šâˆ£t=ç»æµ)=0.00375 å‡è®¾æ–‡æœ¬çš„é›†åˆæ˜¯D={d1,d2,...,dN}D=\\{d_1,d_2,...,d_N\\}D={d1â€‹,d2â€‹,...,dNâ€‹}å•è¯çš„é›†åˆæ˜¯ï¼šW={w1,w2,...,wM}W=\\{w_1,w_2,...,w_M\\}W={w1â€‹,w2â€‹,...,wMâ€‹}è¯é¢˜çš„é›†åˆæ˜¯ï¼šZ={z1,z2,...,zK}Z=\\{z_1,z_2,...,z_K\\}Z={z1â€‹,z2â€‹,...,zKâ€‹}æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ±‚æ–‡æœ¬çš„ç”Ÿæˆåˆ†å¸ƒæ—¶ï¼Œæ¶‰åŠåˆ°ä»¥ä¸‹çš„æ¡ä»¶æ¦‚ç‡ï¼šP(zâˆ£d)P(z|d)P(zâˆ£d): å·²çŸ¥æ–‡æœ¬dï¼Œç”Ÿæˆè¯é¢˜zçš„æ¦‚ç‡ï¼Œæ˜¯ä¸€ä¸ªå¤šé¡¹åˆ†å¸ƒP(wâˆ£z)P(w|z)P(wâˆ£z): å·²çŸ¥è¯é¢˜zï¼Œç”Ÿæˆå•è¯wçš„æ¦‚ç‡ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¤šé¡¹åˆ†å¸ƒè€ŒP(d)P(d)P(d)è¡¨ç¤ºä»æ‰€æœ‰æ–‡æœ¬é›†åˆä¸­ï¼Œéšæœºé€‰å–ä¸€ä¸ªæ–‡æœ¬çš„dçš„æ¦‚ç‡ ç°åœ¨æˆ‘ä»¬å¸Œæœ›çŸ¥é“ï¼Œç»™å®š(å•è¯ï¼Œæ–‡æœ¬)å¯¹ï¼Œå®ƒåœ¨è¿™ä¸ªç©ºé—´ä¸­çš„ç”Ÿæˆçš„æ¦‚ç‡ï¼Œå³ï¼š P(X)=âˆ(w,d)Â âˆˆÂ WÃ—DP(w,d)cnt(w,d)P(X) = \\prod_{(w,d)\\ \\in \\ WÃ—D} P(w,d)^{cnt(w,d)} P(X)=(w,d)Â âˆˆÂ WÃ—Dâˆâ€‹P(w,d)cnt(w,d) ï¼Œå…¶ä¸­æ‰€æœ‰çš„(w,d)(w,d)(w,d)å¯¹åº”è¯¥æœ‰NÃ—Lï¼ˆæ–‡æœ¬æ•°Ã—æ¯ä¸ªæ–‡æœ¬ä¸­è¦å¡«ç©ºçš„å•è¯æ•°ï¼‰ä¸ªæ ¹æ®ä¸Šé¢ä¾‹å­çš„æ€æƒ³ï¼Œå¯¹äºæ¯ä¸ª(w,d)(w,d)(w,d)å¯¹ï¼Œå…¶ç”Ÿæˆæ¦‚ç‡åˆå¯ä»¥ç”¨éšå˜é‡å†™ä¸ºï¼š P(w,d)=P(d)P(wâˆ£d)=P(d)âˆ‘zÂ âˆˆÂ ZP(w,zâˆ£d)=P(d)âˆ‘zÂ âˆˆÂ ZP(zâˆ£d)P(wâˆ£z)P(w,d) = P(d)P(w|d) = P(d) \\sum_{z\\ \\in \\ Z}P(w,z|d) = P(d) \\sum_{z \\ \\in \\ Z}P(z|d)P(w|z) P(w,d)=P(d)P(wâˆ£d)=P(d)zÂ âˆˆÂ Zâˆ‘â€‹P(w,zâˆ£d)=P(d)zÂ âˆˆÂ Zâˆ‘â€‹P(zâˆ£d)P(wâˆ£z) äºæ˜¯æˆ‘ä»¬å¯ä»¥å»ºç«‹æ¨¡å‹ï¼Œå¯¹P(zâˆ£d)P(z|d)P(zâˆ£d)å’ŒP(wâˆ£z)P(w|z)P(wâˆ£z)åˆ†åˆ«è¿›è¡Œä¼°è®¡ï¼Œå¾—åˆ°äº†è¿™æ ·çš„å•å±‚éšå˜é‡ç½‘ç»œï¼Œå³PLSAï¼šå…¶ä¸­å·¦ä¾§çš„å‚æ•°é‡æ˜¯ NKï¼Œå³ä¾§ä¸ºMK ç°å®ä¸­Kè¿œå°äºMï¼Œæ‰€ä»¥PLSAé€šè¿‡è¯é¢˜ å¯¹æ•°æ®è¿›è¡Œäº†æ›´ç®€æ´åœ°è¡¨ç¤ºï¼Œå‡å°‘äº†å­¦ä¹ è¿‡ç¨‹ä¸­è¿‡æ‹Ÿåˆçš„å¯èƒ½æ€§ ç»§ç»­ä½¿ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡çš„æ–¹æ³•ï¼Œè¯•å›¾æ±‚å‡ºè®©P(X)æœ€å¤§æ—¶çš„å‚æ•°ï¼Œå–å¯¹æ•°ä¼¼ç„¶ï¼ˆä¸‹é¢çš„å…¬å¼æ¨å¯¼ä¸­ï¼Œæˆ‘ä»¬çœç•¥äº†é•¿åº¦æ˜¯O(NK+MK)O(NK+MK)O(NK+MK)çš„å‚æ•°å‘é‡Î¸ï¼Œä¸ç„¶å°±å¤ªé•¿äº†å¤ªéš¾è¯»äº†QAQï¼‰ï¼š LW,Z,D=logâˆ(w,d)Â âˆˆÂ WÃ—DP(w,d)cnt(w,d)=logâˆi=1Mâˆj=1NP(wi,dj)cnt(wi,dj)=âˆ‘i=1Mâˆ‘j=1Ncnt(wi,dj)logP(wi,dj)=âˆ‘i=1Mâˆ‘j=1Ncnt(wi,dj)[logP(dj)+logâˆ‘k=1KP(wiâˆ£zk)P(zkâˆ£dj)]L_{W,Z,D} = log\\prod_{(w,d)\\ \\in \\ WÃ—D} P(w,d)^{cnt(w,d)} \\\\ = log \\prod_{i=1}^M \\prod_{j=1}^NP(w_i,d_j)^{cnt(w_i,d_j)} \\\\ = \\sum_{i=1}^M\\sum_{j=1}^Ncnt(w_i,d_j)logP(w_i,d_j) \\\\ = \\sum_{i=1}^M\\sum_{j=1}^Ncnt(w_i,d_j)[logP(d_j) + log \\sum_{k=1}^KP(w_i|z_k)P(z_k|d_j)] LW,Z,Dâ€‹=log(w,d)Â âˆˆÂ WÃ—Dâˆâ€‹P(w,d)cnt(w,d)=logi=1âˆMâ€‹j=1âˆNâ€‹P(wiâ€‹,djâ€‹)cnt(wiâ€‹,djâ€‹)=i=1âˆ‘Mâ€‹j=1âˆ‘Nâ€‹cnt(wiâ€‹,djâ€‹)logP(wiâ€‹,djâ€‹)=i=1âˆ‘Mâ€‹j=1âˆ‘Nâ€‹cnt(wiâ€‹,djâ€‹)[logP(djâ€‹)+logk=1âˆ‘Kâ€‹P(wiâ€‹âˆ£zkâ€‹)P(zkâ€‹âˆ£djâ€‹)] ä»ç„¶æ˜¯éå¸¸éš¾è®¡ç®—ï¼Œå› æ­¤è¦ä½¿ç”¨ä¸Šä¸€èŠ‚ä»‹ç»çš„EMä¼°è®¡ç®—æ³•ï¼Œä¸ºæ­¤æˆ‘ä»¬è®¡ç®—Qå‡½æ•°ã€‚ä¸Šé¢çš„ä¼¼ç„¶å‡½æ•°LW,Z,DL_{W,Z,D}LW,Z,Dâ€‹å·²ç»æ˜¯ä¸€ä¸ªã€å®Œå…¨æ•°æ®ã€‘ï¼Œéšè—å˜é‡Zè¢«è§†ä¸ºä¸W,Då¹¶åˆ—çš„éšæœºå˜é‡ã€‚å› æ­¤Qå‡½æ•°æ˜¯æ¯ä¸ª(w,d)(w,d)(w,d)å¯¹ä¸ºæ¡ä»¶ä¸‹ï¼ŒLW,Z,DL_{W,Z,D}LW,Z,Dâ€‹çš„æœŸæœ›ï¼Œå³ï¼š Q=P(zkâˆ£wi,dj)[âˆ‘k=1Kâˆ‘i=1Mâˆ‘j=1Ncnt(wi,dj)logP(wi,dj,zk)]Q = P(z_k|w_i,d_j)[\\sum_{k=1}^K\\sum_{i=1}^M\\sum_{j=1}^Ncnt(w_i,d_j)logP(w_i,d_j,z_k)] Q=P(zkâ€‹âˆ£wiâ€‹,djâ€‹)[k=1âˆ‘Kâ€‹i=1âˆ‘Mâ€‹j=1âˆ‘Nâ€‹cnt(wiâ€‹,djâ€‹)logP(wiâ€‹,djâ€‹,zkâ€‹)] å…¶ä¸­ï¼Œ$$P(w_i,d_j,z_k) = P(d_j)P(w_i|z_k)P(z_k|d_j)$$ å°±æ˜¯æŒ‰ç…§â€œé“¾å¼æ³•åˆ™â€ç”Ÿæˆä¸€å †å•è¯æ–‡æœ¬çš„è”åˆæ¦‚ç‡ï¼Œè€ŒP(zkâˆ£wi,dj)P(z_k|w_i,d_j)P(zkâ€‹âˆ£wiâ€‹,djâ€‹)åˆ™æ˜¯éšè—å˜é‡Zä¸è¢«è§†ä¸ºæ¡ä»¶çš„åˆ†å¸ƒæ¦‚ç‡ã€ä¸å®Œå…¨æ•°æ®ã€‘ï¼Œå³ï¼š P(zkâˆ£wi,dj)=P(wiâˆ£zk)P(zkâˆ£dj)âˆ‘k=1KP(wiâˆ£zk)P(zkâˆ£dj)P(z_k|w_i,d_j) = \\frac{P(w_i|z_k)P(z_k|d_j)}{\\sum_{k=1}^KP(w_i|z_k)P(z_k|d_j)} P(zkâ€‹âˆ£wiâ€‹,djâ€‹)=âˆ‘k=1Kâ€‹P(wiâ€‹âˆ£zkâ€‹)P(zkâ€‹âˆ£djâ€‹)P(wiâ€‹âˆ£zkâ€‹)P(zkâ€‹âˆ£djâ€‹)â€‹ è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¦æ¯ä¸€æ­¥æ›´æ–°çš„å‚æ•°å…¶å®æ˜¯P(wiâˆ£zk)P(w_i|z_k)P(wiâ€‹âˆ£zkâ€‹)å’ŒP(zkâˆ£dj)P(z_k|d_j)P(zkâ€‹âˆ£djâ€‹) å› ä¸ºæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªæ•°æ®é›†ï¼ŒP(dj)P(d_j)P(djâ€‹)çš„å€¼ï¼ˆå³å…ˆéªŒï¼‰å¯ä»¥ç›´æ¥ç”±ç»Ÿè®¡æ–¹æ³•ä¼°è®¡å‡ºæ¥ï¼Œcntå‡½æ•°ï¼ˆå³å“ªäº›å¯¹å®é™…åœ¨æ•°æ®é›†ä¸­åŒæ—¶å‡ºç°äº†ä¹Ÿæ˜¯å¯ä»¥ç»Ÿè®¡çš„å·²çŸ¥é‡ï¼‰ã€‚å› æ­¤ï¼ŒEMè¿‘ä¼¼çš„æ­¥éª¤ä¸ºï¼š å¯¹äºæ¯ä¸ªä¸‹æ ‡å¯¹(i,k)å’Œ(k,j)ï¼Œåˆ†åˆ«æ±‚P(wiâˆ£zk)P(w_i|z_k)P(wiâ€‹âˆ£zkâ€‹)å’ŒP(zkâˆ£dj)P(z_k|d_j)P(zkâ€‹âˆ£djâ€‹)çš„åå¯¼æ•°ï¼ˆç¬¬ä¸€æ­¥æ—¶ä¸ºæ¯ä¸ªæ¦‚ç‡å–åˆå§‹å€¼ï¼ˆå¦‚å‡åŒ€åˆ†å¸ƒï¼‰ï¼Œåªè¦æ»¡è¶³æ¦‚ç‡å’Œä¸º1å³å¯ï¼‰ ç„¶åå°†å¯¼æ•°ä¸º0çš„å€¼æ±‚å‡ºæ¥ï¼Œæ›´æ–°(i,k)å’Œ(k,j)å¯¹åº”å‚æ•°å‘é‡çš„å…ƒç´  å– k=k+1ï¼Œæ±‚ä¸‹ä¸€æ­¥çš„ä¸å®Œå…¨æ•°æ®ï¼Œç›´åˆ°æ”¶æ•› åœ¨ç”¨ç»Ÿè®¡ä¼°è®¡P(dj)P(d_j)P(djâ€‹)åï¼Œå±€éƒ¨æœ€ä¼˜è§£çš„ç»“æœç»è¿‡æ¨å¯¼æ˜¯ï¼šPLSAçš„æ–¹æ³•ä»ç„¶èƒœåœ¨ç¦»æ•£ç©ºé—´ï¼Œè®¡ç®—å¤æ‚åº¦ä½ï¼Œå¯ä»¥å¿«é€Ÿè¿­ä»£ï¼Œä½†å­˜åœ¨ä¸€ä¸ªå¾ˆé‡è¦çš„ç¼ºç‚¹ï¼šå› ä¸ºæ‰€å­¦ä¹ çš„å‚æ•°ä¸ä»…ä¾èµ–äºå•è¯åº“Wï¼Œè¿˜ä¾èµ–äºæ–‡æ¡£æ•°æ®é›†Dï¼Œæ‰€æœ‰å…¶å¯ä»¥ç”Ÿæˆå…¶æ‰€åœ¨æ•°æ®é›†çš„æ–‡æ¡£çš„æ¨¡å‹ï¼Œä½†å´ä¸èƒ½ç”Ÿæˆæ–°æ–‡æ¡£çš„æ¨¡å‹ æ½œåœ¨ç‹„åˆ©å…‹é›·åˆ†å¸ƒï¼ˆLDAï¼‰ åœ¨å¯¹PLSAå»ºæ¨¡æ—¶ï¼Œæˆ‘ä»¬å‘ç°ä¸€ä¸ªè§„å¾‹ï¼š æ–‡æœ¬ç”±è¯é¢˜çš„ä¸€ä¸ªå¤šé¡¹åˆ†å¸ƒè¡¨ç¤º ï¼Œ è¯é¢˜ä¹Ÿç”±å•è¯çš„ä¸€ä¸ªå¤šé¡¹åˆ†å¸ƒè¡¨ç¤º ä»¥é˜²ä½ å¿˜äº†æˆ‘ä»¬åœ¨C1ä¸­ä»‹ç»çš„å¤šé¡¹åˆ†å¸ƒï¼Œè¡¥å……ä¸€ä¸‹å®Œæ•´å®šä¹‰ï¼š è¿™ä¸å·§äº†å˜›ï¼Œæˆ‘ä»¬åœ¨C2ä¸­æåˆ°ï¼Œå¤šé¡¹åˆ†å¸ƒçš„è´å¶æ–¯ç”Ÿæˆæ¨¡å‹ï¼Œå¯ä»¥ç”¨ ç‹„åˆ©å…‹é›·åˆ†å¸ƒ ä½œä¸ºå…ˆéªŒã€‚å› æ­¤ï¼Œå¯ä»¥å‡è®¾ è¯é¢˜åˆ†å¸ƒ å’Œ å•è¯åˆ†å¸ƒ çš„å…ˆéªŒéƒ½æ˜¯ ç‹„åˆ©å…‹é›·åˆ†å¸ƒï¼š å¯¹äºæ¯ä¸ªæ–‡æœ¬dmd_mdmâ€‹ï¼Œå‡è®¾dä¸­åŒ…å«çš„å•è¯ç»„æˆäº†å‘é‡dm=wmÂ (m=1,2,...,M)d_m = \\bold w_m \\ (m=1,2,...,M)dmâ€‹=wmâ€‹Â (m=1,2,...,M),è®¤ä¸ºç”Ÿæˆè¯¥æ–‡æœ¬è¯é¢˜çš„æ¦‚ç‡P(zâˆ£wm)=Î¸mâˆ¼Dir(Î±)P(z|\\bold w_m) = \\theta_m \\sim Dir(\\alpha)P(zâˆ£wmâ€‹)=Î¸mâ€‹âˆ¼Dir(Î±) Î¸m\\theta_mÎ¸mâ€‹å‚æ•°å‘é‡æœ‰Kä¸ªå€¼ï¼Œæ¯ä¸ªå€¼è¡¨ç¤ºæ–‡æœ¬dmd_mdmâ€‹èƒ½ç”Ÿæˆå¯¹åº”è¯é¢˜z1,z2,...,zkz_1,z_2,...,z_kz1â€‹,z2â€‹,...,zkâ€‹çš„æ¦‚ç‡ å› æ­¤ï¼Œè¶…å‚æ•°Î±\\alphaÎ±ä¹Ÿæ˜¯ä¸€ä¸ªKç»´å‘é‡ æ³¨æ„ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¸ºäº†å¯¹æ¯ä¸ªå•è¯å†™å‡ºä¸€ä¸ªè¯é¢˜åˆ†å¸ƒï¼Œå°†æ–‡æœ¬çš„å®šä¹‰æ”¹æˆäº†å•è¯ç»„æˆçš„å‘é‡ã€‚å› æ­¤ä»£è¡¨æ–‡æœ¬é›†ä¸­çš„æ–‡æœ¬æ•°é‡çš„å¸¸é‡ä¸å†æ˜¯NNNï¼Œè€Œæ˜¯MMMã€‚ç”¨Ni(i=1,2,...,M)N_i(i=1,2,...,M)Niâ€‹(i=1,2,...,M)æ¥è¡¨ç¤ºä¸€ä¸ªæ–‡æœ¬ä¸­çš„å•è¯æ€»æ•°ã€‚è€Œä¸‹é¢çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æ•´ä¸ªå•è¯åº“ä¸­çš„å•è¯æ€»æ•°æ˜¯VVV å¯¹äºæ¯ä¸ªè¯é¢˜zkÂ (k=1,2,...,K)z_k\\ (k=1,2,...,K)zkâ€‹Â (k=1,2,...,K)ï¼Œè®¤ä¸ºç”Ÿæˆç›¸åº”å•è¯çš„æ¦‚ç‡P(wâˆ£zk)=Ï•kâˆ¼Dir(Î²)P(w|z_k) = \\phi_k \\sim Dir(\\beta)P(wâˆ£zkâ€‹)=Ï•kâ€‹âˆ¼Dir(Î²) è€Œå¯¹äºæ¯ä¸ªå•è¯wm[n]âˆˆwmÂ (n=1,2,...,Nm)w_m[n] \\in \\bold w_m \\ (n=1,2,...,N_m)wmâ€‹[n]âˆˆwmâ€‹Â (n=1,2,...,Nmâ€‹)ï¼Œå…¶å¯¹åº”çš„è¯é¢˜å’Œå•è¯éƒ½é“¾å¼åœ°æœä»å¤šé¡¹åˆ†å¸ƒï¼š zm[n]âˆ¼Mult(Î¸m)z_m[n] \\sim Mult(\\theta_m)zmâ€‹[n]âˆ¼Mult(Î¸mâ€‹)ï¼šå…ˆéšæœºæ ¹æ®æ¦‚ç‡ç”Ÿæˆä¸€ä¸ªè¯é¢˜åºåˆ— wm[n]âˆ¼Mult(Ï•zm[n])w_m[n] \\sim Mult(\\phi_{z_m[n]})wmâ€‹[n]âˆ¼Mult(Ï•zmâ€‹[n]â€‹)ï¼Œå†å¯¹æ¯ä¸ªè¯é¢˜ï¼Œéšæœºç”Ÿæˆä¸€ä¸ªå•è¯åºåˆ—ï¼Œå…±ç”Ÿæˆmä¸ª åœ¨è¿™ä¸ªå®šä¹‰ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¾—åˆ°æ‰€æœ‰å…ˆéªŒçš„è¡¨ç¤ºï¼Œå› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨æœ€å¤§åéªŒæ¦‚ç‡ä¼°è®¡MAPæ¥æ±‚è§£å‚æ•°ï¼Œè®°ä½åœ¨è¿™é‡Œwæ˜¯è§‚æµ‹é‡ï¼Œzæ˜¯éšå˜é‡ï¼Œå› æ­¤åéªŒæ˜¯å·²çŸ¥è§‚æµ‹é‡ç®—éšå˜é‡çš„æ¦‚ç‡ï¼šæ–‡æœ¬wçš„åéªŒ=P(Î¸,zâˆ£w,Î±,Î²)=P(w,z,Î¸,Ï•âˆ£Î±,Î²)P(wâˆ£Î±,Î²)æ–‡æœ¬wçš„åéªŒ=P(\\bold{\\theta}, \\bold z|\\bold w, \\alpha,\\beta) = \\frac{P(\\bold w,\\bold z,\\theta,\\phi|\\alpha,\\beta)}{P(\\bold w|\\alpha,\\beta)}æ–‡æœ¬wçš„åéªŒ=P(Î¸,zâˆ£w,Î±,Î²)=P(wâˆ£Î±,Î²)P(w,z,Î¸,Ï•âˆ£Î±,Î²)â€‹ç„¶åï¼Œå°±åƒPLSAæ–¹æ³•ä¸€æ ·ï¼Œæ ¹æ®å‘é‡çš„åµŒå¥—å®šä¹‰æŠŠæ¦‚ç‡è®¡ç®—æ‹†æˆæ¯ä¸ªå…ƒç´ æ¦‚ç‡çš„ä¹˜ç§¯ï¼Œå¼å­å¾ˆé•¿ï¼Œç›´æ¥è´´ä¸€ä¸‹ç»“æœå§ï¼šè‡ªç„¶ï¼Œæƒ³å¯¹è¿™ç§ç©æ„æ±‚è§£ææœ€å¤§å€¼ï¼Œå’Œè‡ªæ€æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚ä¸è¿‡ï¼Œæ—¢ç„¶è¿™æ¬¡æˆ‘ä»¬ä¼°è®¡çš„æ˜¯åéªŒæ¦‚ç‡åˆ†å¸ƒï¼Œæ¦‚ç‡è®ºä¸­å¯ä»¥ä»¥ å˜åˆ†æ¨æ–­ çš„æ–¹æ³•æ¥å¤„ç† å˜åˆ†æ¨æ–­ æ‰€è°“å˜åˆ†æ¨æ–­ï¼Œæ˜¯å–ä¸€ä¸ªç”¨éšå˜é‡zçš„åˆ†å¸ƒq(z)q(z)q(z)æ¥è¿‘ä¼¼åéªŒæ¦‚ç‡çš„æ¡ä»¶åˆ†å¸ƒp(zâˆ£x)p(z|x)p(zâˆ£x)çš„æ–¹æ³•ã€‚ä¸ºäº†æ¯”è¾ƒäºŒè€…çš„åˆ†å¸ƒç›¸ä¼¼åº¦ï¼Œä½¿ç”¨KLæ•£åº¦æ¥è®¡é‡ï¼š å¦‚æœèƒ½æ‰¾åˆ°ä¸p(zâˆ£x)p(z|x)p(zâˆ£x)åœ¨KLæ•£åº¦æ„ä¹‰ä¸‹æœ€è¿‘çš„åˆ†å¸ƒ q^(z)\\hat q(z)q^â€‹(z)ï¼Œåˆ™å¯ä»¥ç”¨è¿™ä¸ªåˆ†å¸ƒè¿‘ä¼¼åéªŒæ¦‚ç‡åˆ†å¸ƒ å¸¦å…¥KLæ•£åº¦çš„å…¬å¼ï¼š åˆ™ï¼Œå¦‚æœæƒ³è¦KLæ•£åº¦æ›´å°ï¼Œå¿…æœ‰ logÂ p(x)â‰¥Eq[logÂ p(x,z)]âˆ’Eq[logÂ q(z)]log\\ p(x) \\geq E_q[log\\ p(x,z)] - E_q[log\\ q(z)] logÂ p(x)â‰¥Eqâ€‹[logÂ p(x,z)]âˆ’Eqâ€‹[logÂ q(z)] å› ä¸ºå…ˆéªŒxçš„åˆ†å¸ƒlogÂ p(x)log\\ p(x)logÂ p(x)å¯ä»¥è¢«è§†ä¸ºå¸¸é‡ï¼Œå› æ­¤å³ä¾§å…³äºqåˆ†å¸ƒçš„æœŸæœ›å¼è¶Šå¤§ï¼ŒKLæ•£åº¦å°±è¶Šå°ã€‚æ•°å­¦ä¸ŠæŠŠå³ä¾§ç§°ä¸ºè¯æ®ä¸‹ç•Œã€‚å› æ­¤ï¼Œä¸‹é¢é—®é¢˜å°±å˜ä¸ºæ±‚è¯æ®ä¸‹ç•Œçš„æœ€å¤§åŒ–ã€‚è¿˜æœ‰ä¸€ä¸ªå‡è®¾ï¼Œæ˜¯å¯¹äºéšå˜é‡zï¼ˆå‘é‡ï¼‰ï¼Œå‡è®¾åˆ†å¸ƒq(z)q(z)q(z)å¯¹ z çš„æ‰€æœ‰åˆ†é‡éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå³ï¼š q(z)=q(z1)q(z2),...,q(zm)q(z) = q(z_1)q(z_2),...,q(z_m) q(z)=q(z1â€‹)q(z2â€‹),...,q(zmâ€‹) ç§°å…¶ä¸ºå¹³å‡åœºã€‚ ç°åœ¨è®©æˆ‘ä»¬å›åˆ°LDAæ¨¡å‹çš„æœ€å¤§åéªŒæ¦‚ç‡ä¼°è®¡ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†å˜åˆ†æ¨æ–­ç®—æ³•ï¼Œå¯ä»¥å®šä¹‰â€œæ–‡æœ¬wçš„åéªŒâ€ çš„è¯æ®ä¸‹ç•Œï¼š L(r,t,Î±,Ï•)=Eq[logÂ p(z,w)]âˆ’Eq[logÂ q(z)]=Eq[logÂ p(Î¸,z,wâˆ£Î±,Ï•)]âˆ’Eq[logÂ q(Î¸,zâˆ£r,t)]L(r,t,\\alpha,\\phi) = E_q[log\\ p(\\bold z, \\bold w)] -E_q[log\\ q(\\bold z)]\\\\ = E_q[log\\ p(\\theta,\\bold z, \\bold w| \\alpha,\\phi)] -E_q[log\\ q(\\theta,\\bold z|r,t)] L(r,t,Î±,Ï•)=Eqâ€‹[logÂ p(z,w)]âˆ’Eqâ€‹[logÂ q(z)]=Eqâ€‹[logÂ p(Î¸,z,wâˆ£Î±,Ï•)]âˆ’Eqâ€‹[logÂ q(Î¸,zâˆ£r,t)] å…¶ä¸­ï¼Œå‘é‡rå’Œtæ˜¯å˜åˆ†å‚æ•°ï¼Œræ¥ä¼°è®¡éšå˜é‡zåœ¨å•è¯å‘é‡ä¸­çš„åˆ†å¸ƒå‚æ•°Î¸\\thetaÎ¸ï¼Œtæ¥ä¼°è®¡è¯é¢˜å‘é‡ä¸­çš„åˆ†å¸ƒå‚æ•°(z1,z2,...,zn)(z_1,z_2,...,z_n)(z1â€‹,z2â€‹,...,znâ€‹)æœ‰äº†å¹³å‡åœºå‡è®¾ï¼Œå°±å¯ä»¥å¯¹æ¯ä¸ªæ–‡æœ¬åˆ†æ¥è®¡ç®—ï¼Œå¾—åˆ°æ‰€æœ‰æ–‡æœ¬çš„è¯æ®ä¸‹ç•Œï¼š Lâ€²(r,t,Î±,Ï•)=âˆ‘m=1MEq[logÂ p(Î¸m,zm,wmâˆ£Î±m,Ï•m)]âˆ’Eq[logÂ q(Î¸m,zmâˆ£rm,tm)]L&#x27;(r,t,\\alpha,\\phi) =\\sum_{m=1}^M{ E_q[log\\ p(\\theta_m,\\bold z_m, \\bold w_m| \\alpha_m,\\phi_m)] -E_q[log\\ q(\\theta_m,\\bold z_m|r_m,t_m)]} Lâ€²(r,t,Î±,Ï•)=m=1âˆ‘Mâ€‹Eqâ€‹[logÂ p(Î¸mâ€‹,zmâ€‹,wmâ€‹âˆ£Î±mâ€‹,Ï•mâ€‹)]âˆ’Eqâ€‹[logÂ q(Î¸mâ€‹,zmâ€‹âˆ£rmâ€‹,tmâ€‹)] æ­¤æ—¶æˆ‘ä»¬å‘ç°å®ƒä¹Ÿæ˜¯ä¸€ä¸ª ç¦»æ•£çš„æœŸæœ›æœ€å¤§åŒ–ä¼°è®¡ é—®é¢˜äº†ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬äºŒèŠ‚æåˆ°çš„ EMç®—æ³•æ¥è¿­ä»£æ›´æ–°å‚æ•°ï¼Œæ­¤æ—¶æœ‰å››ä¸ªå‚æ•°å‘é‡ï¼Œä¸¤ä¸ªæ˜¯ä¸ºäº†å˜åˆ†æ¨æ–­å¼•å…¥çš„ï¼Œå¦å¤–ä¸¤ä¸ªåˆ™ä¸ºæ¨¡å‹å»ºç«‹çš„ç‹„åˆ©å…‹é›·åˆ†å¸ƒå‚æ•°ã€‚ æ³¨æ„ï¼Œå®é™…ä¸Šç‹„åˆ©å…‹é›·åˆ†å¸ƒçš„å‚æ•°æ˜¯Î±ã€Î²\\alpha ã€\\betaÎ±ã€Î²ï¼Œä¸è¿‡å› ä¸ºè¯é¢˜çš„åˆ†å¸ƒå‚æ•°Ï•\\phiÏ•å¯ä»¥ç›´æ¥ç”±å‚æ•°Î²\\betaÎ²æ ¹æ®è¯é¢˜æ•° k å¾—åˆ°ï¼Œå› æ­¤è¿™é‡Œç®€åŒ–ä¸€ä¸‹æ¨¡å‹ï¼Œç›´æ¥ä¼°è®¡å‚æ•°å‘é‡Ï•\\phiÏ• è¿™ç§æ–¹æ³•è¢«ç»¼åˆç§°ä¸º **å˜åˆ†EMç®—æ³•** LDAå’ŒPLSAçš„æ¯”è¾ƒ ç›¸åŒç‚¹ï¼šéƒ½å°† è¯é¢˜å»ºæ¨¡ä¸ºå•è¯çš„å¤šé¡¹åˆ†å¸ƒï¼Œæ–‡æœ¬å»ºæ¨¡ä¸ºè¯é¢˜çš„å¤šé¡¹åˆ†å¸ƒ ä¸åŒç‚¹ï¼š PLSAæ²¡æœ‰ä½¿ç”¨å…ˆéªŒåˆ†å¸ƒï¼ˆ æˆ–è€…è¯´å‡è®¾å…ˆéªŒåˆ†å¸ƒæ˜¯å‡åŒ€åˆ†å¸ƒ ï¼‰ï¼Œä½¿ç”¨MLEä¼°è®¡ã€‚ è€ŒLDAå‡è®¾äº†ç‹„åˆ©å…‹é›·åˆ†å¸ƒä½œä¸ºå…ˆéªŒåˆ†å¸ƒï¼Œä¸”ä½¿ç”¨MAPä¼°è®¡ã€‚ æœ‰å…ˆéªŒåˆ†å¸ƒçš„å¥½å¤„å’ŒC2ä¸­æåˆ°çš„ä¸€æ ·ï¼Œå¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆé—®é¢˜","tags":["ç”Ÿæˆæ¨¡å‹","ç¬”è®°"]},{"title":"ã€ç¬”è®°ã€‘ç”Ÿæˆæ¨¡å‹åŸºç¡€ä¸åº”ç”¨ - ç¬¬2ç« ","path":"/2023/11/27/ç”Ÿæˆæ¨¡å‹åŸºç¡€ä¸åº”ç”¨ç¬”è®°-ç¬¬2ç« /","content":"C2 ç¦»æ•£æ•°æ®çš„ç”Ÿæˆæ¨¡å‹ C2 ç¦»æ•£æ•°æ®çš„ç”Ÿæˆæ¨¡å‹ ç”Ÿæˆæ¨¡å‹çš„ç›®çš„ï¼šå­¦ä¹ è”åˆæ¦‚ç‡åˆ†å¸ƒ P(X,Y)ç»“åˆç¬¬ä¸€èŠ‚è¯¾çš„çŸ¥è¯†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šä»‹ç»ä¸€äº›æ¯”è¾ƒä¼ ç»Ÿçš„ç”Ÿæˆæ¨¡å‹ï¼Œå®ƒä»¬ä¸ä¼šæ¶‰åŠDLå’Œç¥ç»ç½‘ç»œï¼Œä½†æ˜¯æ˜¯åç»­ç”Ÿæˆæ¨¡å‹çš„æ•°å­¦åŸºç¡€ã€‚ è´å¶æ–¯æ¦‚å¿µå­¦ä¹ ï¼ˆä»¥ç¦»æ•£æ¨¡å‹ä¸¾ä¾‹ï¼‰ åªæä¾›æ­£å‘çš„æ ·æœ¬ï¼Œè®©æ¨¡å‹å­¦ä¹ æ­£å‘çš„ç‰¹å¾ï¼Œç„¶ååˆ¤æ–­è¾“å…¥æ˜¯å¦å±äºè¦è®­ç»ƒçš„ç±»åˆ«ï¼ˆæ¦‚å¿µï¼‰ ä¸äºŒåˆ†ç±»ä»»åŠ¡çš„åŸç†ç›¸åŒï¼Œä½†æ˜¯è®­ç»ƒäºŒåˆ†ç±»æ¨¡å‹ä¼šæä¾› both æ­£å‘æ ·æœ¬å’Œè´Ÿå‘æ ·æœ¬ **ä»¥å­¦ä¹ ä¸€ä¸ªçŒœæ•°å­—çš„æ¨¡å‹ä¸ºä¾‹ï¼š**é—®é¢˜ï¼šæœ‰ä¸€ä¸ªç”±æ•°å­—ç»„æˆçš„æ•°æ®é›†D\\mathcal {D}Dï¼Œé—®å¦‚ä½•å­¦ä¹ ä¸€ä¸ªæ¦‚å¿µCï¼ˆCæ˜¯æœªçŸ¥çš„ï¼Œæè¿°æ•°æ®é›†D\\mathcal {D}Dä¸­æ•°å­—åº”è¯¥æœä»çš„åˆ†å¸ƒï¼‰ï¼Œè¿™é‡Œçš„æ•°å­—éƒ½åœ¨0-100ä¹‹é—´ã€‚ å‡è®¾ç©ºé—´ï¼šäººä¸ºåœ°æå‡ºâ€œå‡è®¾â€ï¼Œç”¨æ¥çŒœæµ‹æ¦‚å¿µCã€‚æ ¹æ®æŸä¸€ä¸ªæ¦‚å¿µå‡è®¾ï¼ˆå¦‚â€œå¶æ•°â€ï¼‰ï¼Œæ‰€æœ‰å¯èƒ½ç”Ÿæˆçš„å…ƒç´ ç»„æˆhçš„é›†åˆã€‚æ¯”å¦‚â€œå¶æ•°â€ï¼Œåˆ™å¯¹åº”çš„å‡è®¾æ•°æ®é›†h={2,4,6,...,100}h=\\{2,4,6,...,100\\}h={2,4,6,...,100}ã€‚æ‰€æœ‰å¯ä»¥æå‡ºå‡è®¾ç»„æˆå‡è®¾ç©ºé—´ ç‰ˆæœ¬ç©ºé—´ï¼šå³æ‰€ä»¥â€œæœ‰æ•ˆçš„â€å‡è®¾ç»„æˆçš„ç©ºé—´ã€‚å³æ»¡è¶³ï¼šæ•°æ®é›†Dä¸­çš„æ‰€æœ‰å…ƒç´ åœ¨å‡è®¾çš„é›†åˆhä¸­ï¼Œè¿™äº›å‡è®¾ç»„æˆçš„ç©ºé—´ã€‚ æ³¨æ„ï¼šä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®é›†Dä¸­åŒ…å«çš„å…ƒç´ æ•°é‡è¶Šå¤šï¼Œç‰ˆæœ¬ç©ºé—´å°±ä¼šè¶Šå°ï¼Œå› ä¸ºä¼šæœ‰å¾ˆå¤šå‡è®¾è¿æ•°æ®é›†ä¸­çš„é‡‡æ ·æ•°æ®éƒ½è¿‡ä¸äº†å…³ï¼Œå°±è¢«ç­›é™¤äº†ã€‚ ä¼¼ç„¶ï¼ˆlikehoodï¼‰ï¼šä»hä¸­ç‹¬ç«‹é‡‡æ ·Næ¬¡ï¼Œä»å‡è®¾èƒ½ç”Ÿæˆ æ•°æ®é›†Dä¸­æ•°æ®çš„æ¦‚ç‡ P(Dâˆ£h)P(\\mathcal {D}|h)P(Dâˆ£h) P(Dâˆ£h)=[1âˆ£hâˆ£]NP(\\mathcal {D}|h) = [\\frac{1}{|h|}]^NP(Dâˆ£h)=[âˆ£hâˆ£1â€‹]N, è¿™é‡Œ|h|è¡¨ç¤ºhçš„é›†åˆå¤§å° è€ƒè™‘å‡è®¾1ï¼šh=â€œå¶æ•°â€ï¼Œå‡è®¾2ï¼šh=â€œ2çš„å¹‚â€ è‹¥ D = {16}ï¼Œåˆ™å‡è®¾1çš„æ¦‚ç‡P(D|h) = 1/6ï¼Œåˆ™å‡è®¾2çš„æ¦‚ç‡P(D|h) = 1/50 è‹¥ D = {2,8,16,64} æ­¤æ—¶ï¼Œå‡è®¾2 çš„ ä¼¼ç„¶æ¦‚ç‡æ˜¯ å‡è®¾1 çš„4812.5å€ å¥¥å¡å§†å‰ƒåˆ€åŸåˆ™ï¼šé€‰æ‹©ä¼¼ç„¶ç›¸è¿‘çš„å‡è®¾æ—¶ï¼Œå‡è®¾hä¸­åŒ…å«çš„æ•°æ®æ•°é‡è¶Šå°‘è¶Šå¥½ å…ˆéªŒæ¦‚ç‡ï¼šå½“æå‡ºå‡è®¾æ—¶ï¼Œä¸ºå…¶ä¸­çš„æ•°æ®èµ‹äºˆå…ˆéªŒæ¦‚ç‡P(h)P(h)P(h) ã€‚å½“æå‡ºçš„å‡è®¾åœ¨æ•°æ®é›†ä¸­å¯¹åº”çš„å®é™…æ„ä¹‰ä¸å¤ªè‡ªç„¶æ—¶ï¼Œä¸ºå…¶èµ‹äºˆä½çš„å…ˆéªŒæ¦‚ç‡ æ¯”å¦‚ï¼ŒD = {50,60,70,90}ï¼Œç»™ä¸ä¸¤ä¸ªå‡è®¾ï¼Œåˆ†åˆ«åŒ…å«æ•°æ® 67 å’Œ 210 å¦‚æœæ•°æ®é›†æè¿°çš„æ˜¯è‡ªç„¶æ•°ï¼Œé‚£ä¹ˆåŒ…å«210çš„å‡è®¾æ‹¥æœ‰æ›´é«˜çš„P(h) ï¼Œå› ä¸º210å’ŒDä¸­æ•°æ®éƒ½æ˜¯10çš„å€æ•° å¦‚æœæ•°æ®é›†æè¿°çš„äººçš„ä½“é‡æ•°æ®(kg)ï¼Œé‚£ä¹ˆåŒ…å«67çš„å‡è®¾æ‹¥æœ‰æ›´é«˜çš„P(h)ï¼Œå› ä¸º210åœ¨ä¸å¤ªå¯èƒ½æ˜¯ç¬¦åˆæ¦‚å¿µçš„æ•°æ® åéªŒï¼šåˆ¤æ–­ç‰ˆæœ¬ç©ºé—´ä¸­çš„æ¦‚å¿µè°æ›´æ¥è¿‘è¦å­¦ä¹ çš„æ¦‚å¿µã€‚æ ¹æ®è´å¶æ–¯å…¬å¼ï¼ŒåéªŒæ¦‚ç‡ä¸ å…ˆéªŒæ¦‚ç‡å’Œä¼¼ç„¶çš„ä¹˜ç§¯æˆæ­£æ¯”ï¼š$$P(h|\\mathcal {D}) \\propto P(\\mathcal {D}|h) P(h)$$ï¼ŒåéªŒæ¦‚ç‡æœ€å¤§çš„å‡è®¾å¯ä»¥è¢«è®¤ä¸ºæ˜¯æœ€ä¼˜å‡è®¾ã€‚ å¦‚æœç”¨Hæ ‡è®°å‡è®¾ç©ºé—´ä¸­æ‰€æœ‰å‡è®¾iç»„æˆçš„é›†åˆï¼Œé‚£ä¹ˆå°†æ•°æ®é›†Dä¸æ¯ç§å‡è®¾çš„è”åˆæ¦‚ç‡æ±‚å’Œï¼Œå°±æ˜¯åéªŒæ¦‚ç‡çš„åŸºæ•°äº†ï¼Œå³ï¼š P(hâˆ£D)=P(Dâˆ£h)P(h)âˆ‘iâˆˆHP(D,i)P(h|\\mathcal {D}) = \\frac{P(\\mathcal {D}|h)P(h)}{\\sum_{i \\in H}P(\\mathcal {D},i)} P(hâˆ£D)=âˆ‘iâˆˆHâ€‹P(D,i)P(Dâˆ£h)P(h)â€‹ æ³¨æ„ï¼šé¢„å…ˆå®šä¹‰çš„å‡è®¾ç©ºé—´ä¸ä¸€å®šæ˜¯å®Œå¤‡çš„ï¼ŒçœŸÂ·æ¦‚å¿µCä¸ä¸€å®šåœ¨ä½ çš„ç©ºé—´ä¸­ï¼Œå¦‚æœè¿™æ ·ï¼ˆç°å®ä¸­å¤§å¤šæ•°æƒ…å†µä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ï¼Œæ‰¾åˆ°çš„æœ€ä¼˜å‡è®¾åªèƒ½è¯´æ˜¯æœ€æ¥è¿‘Cçš„ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ç›´æ¥ç”¨æ•°å­¦æ¨å¯¼å‡ºæ±‚æœ€å¤§åéªŒæ¦‚ç‡çš„å…¬å¼ï¼š æœ€å¤§åéªŒæ¦‚ç‡ä¼°è®¡ MAP æˆ‘ä»¬è¦æ±‚ä¸€ä¸ªhï¼Œå…¶ä¼šä½¿å¾—åéªŒæ¦‚ç‡æœ€å¤§ï¼Œæ•°å­¦ä¸­æˆ‘ä»¬ç”¨argmaxå‡½æ•°æ¥æè¿°ä½¿å¾—ä¸€ä¸ªå‡½æ•°å–æœ€å¤§å€¼æ—¶ï¼Œè‡ªå˜é‡çš„å€¼ï¼Œå› æ­¤ï¼š h^map=argmaxh(P(hâˆ£D))=argmaxh(P(Dâˆ£h)P(h)âˆ‘iâˆˆHP(D,i))\\hat h^{map} = argmax_h(P(h|D)) = argmax_h(\\frac{P(\\mathcal {D}|h)P(h)}{\\sum_{i \\in H}P(\\mathcal {D},i)}) h^map=argmaxhâ€‹(P(hâˆ£D))=argmaxhâ€‹(âˆ‘iâˆˆHâ€‹P(D,i)P(Dâˆ£h)P(h)â€‹) åˆ†æ¯å¯¹æ‰€æœ‰å‡è®¾çš„è”åˆæ¦‚ç‡æ±‚å’Œï¼Œè¿™ä¸hæ— å…³ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼šh^map=argmaxhP(Dâˆ£h)P(h)=argmaxh[log([1âˆ£hâˆ£]N)+log(P(h))]\\hat{h}^{map} = argmax_h P(\\mathcal {D}|h)P(h) = argmax_h [log([\\frac{1}{|h|}]^N) + log(P(h))]h^map=argmaxhâ€‹P(Dâˆ£h)P(h)=argmaxhâ€‹[log([âˆ£hâˆ£1â€‹]N)+log(P(h))] å³è¾¹æˆ‘ä»¬å–å¯¹æ•°ï¼Œåœ¨ä¸ç ´åå‡½æ•°çš„å•è°ƒæ€§çš„åŒæ—¶å°†ä¹˜ç§¯çš„æ¦‚ç‡å˜ä¸ºåŠ æ³•ï¼Œç„¶åæˆ‘ä»¬ä¼šå‘ç°ï¼š å¸¸é‡Nä¼šå½±å“æœ€å¤§å‡½æ•°çš„å–å€¼ å½“Nè¶Šå¤§ï¼Œå³æ•°æ®è¶³å¤Ÿå¤šæ—¶ï¼ŒP(Dâˆ£h)P(\\mathcal {D}|h)P(Dâˆ£h)å³log([1âˆ£hâˆ£]N)log([\\frac{1}{|h|}]^N)log([âˆ£hâˆ£1â€‹]N)çš„å¯¹æ•°å¢é•¿é€Ÿç‡è¿œå¤§äºP(h)P(h)P(h) å› æ­¤åœ¨è®¡ç®—å‡ºæœ€å¤§æ¦‚ç‡çš„hæ—¶ï¼Œåè€…å½±å“è¶Šæ¥è¶Šå°ï¼Œç›´åˆ°å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œå› æ­¤ï¼Œåœ¨å®é™…å»ºæ¨¡ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸åªä¼°è®¡ä¼¼ç„¶P(Dâˆ£h)P(\\mathcal {D}|h)P(Dâˆ£h)ï¼Œæˆ‘ä»¬å°†è¿™ç§è¿‘ä¼¼çš„æ–¹æ³•ç§°ä¸ºï¼šæå¤§ä¼¼ç„¶ä¼°è®¡ MLE : \\hat{h}^{mle}\\ \\~= \\ argmax_h \\ P(\\mathcal {D}|h) = argmax_h \\ log([\\frac{1}{|h|}]^N) äºæ˜¯ï¼Œå½“Nè¶³å¤Ÿå¤§æ—¶ï¼Œå°†æ¯ä¸ªHç©ºé—´ä¸­çš„å‡è®¾hä»£å…¥ä¸Šå¼ï¼Œä½¿å¾—å‡½æ•°å–å€¼æœ€å¤§çš„hå¯ä»¥è¢«è§†ä¸ºæœ€ä¼˜å‡è®¾ã€‚ ç”Ÿæˆæ–°æ•°æ®ï¼šå·²çŸ¥æœ€ä¼˜å‡è®¾håï¼Œä¾¿å¯ä»¥ç›´æ¥ä»¥è¯¥ä¼°è®¡ä½œä¸ºæ¡ä»¶ï¼Œæ±‚å‡ºç”Ÿæˆå„ç§å…ƒç´ ï¼ˆxï¼‰çš„æ¦‚ç‡ï¼š p(xË‰âˆ£D)=âˆ‘hâˆˆHP(hâˆ£D)P(xË‰âˆ£h)â‰ˆP(xË‰âˆ£h^map)p(\\bar x| \\mathcal {D} ) = \\sum_{h\\in H}{P(h|\\mathcal {D})P(\\bar x|h)} \\approx P(\\bar x|\\hat{h}^{map}) p(xË‰âˆ£D)=hâˆˆHâˆ‘â€‹P(hâˆ£D)P(xË‰âˆ£h)â‰ˆP(xË‰âˆ£h^map) ä»¥ä¸Šæ˜¯ä¸€ä¸ªç¦»æ•£åˆ†å¸ƒçš„è´å¶æ–¯æ¦‚å¿µæ¨¡å‹å­¦ä¹ çš„ä¾‹å­ï¼Œæ ¹æ®æ¦‚ç‡è®ºï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥æ¨å¹¿åˆ°çš„è¿ç»­éšæœºå˜é‡çš„æƒ…å†µï¼Œæ¯”å¦‚æœä»äºŒé¡¹åˆ†å¸ƒçš„æ¦‚ç‡æ¨¡å‹ã€‚ç›¸åº”åœ°ï¼Œæˆ‘ä»¬éœ€è¦å°†è®¡ç®—ä¼¼ç„¶å’Œæ¦‚ç‡ä¼°è®¡çš„æ¦‚ç‡P(X)æ”¹ä¸ºæ¦‚ç‡å¯†åº¦p(x)ï¼Œè€Œå°†æ±‚å’Œè®¡ç®—è½¬ä¸ºç§¯åˆ†ã€‚ä¸‹é¢ä¼šä»‹ç»ä¸¤ä¸ªè¿ç»­åˆ†å¸ƒçš„è´å¶æ–¯æ¦‚å¿µæ¨¡å‹ BetaäºŒé¡¹åˆ†å¸ƒç”Ÿæˆæ¨¡å‹ ç°åœ¨æ¥çœ‹è¿ç»­éšæœºå˜é‡çš„æƒ…å†µï¼Œä»¥æŠ›ç¡¬å¸çš„äºŒé¡¹åˆ†å¸ƒä¸ºä¾‹ï¼š æŠ›ä¸€ä¸ªç¡¬å¸Næ¬¡ï¼Œè®°å½•æœ‰N0N_0N0â€‹æ¬¡æ­£é¢æœä¸Šï¼ŒN1N_1N1â€‹æ¬¡åé¢æœä¸Š å‡è®¾æ¯æ¬¡æŠ›ç¡¬å¸çš„ç»“æœä¸ºéšæœºå˜é‡xï¼Œxæœä»äºŒé¡¹åˆ†å¸ƒï¼Œæ­£é¢æœä¸Šè®°ä¸º1ï¼Œåé¢æœä¸Šè®°ä¸º0 é‚£ä¹ˆï¼ŒäºŒé¡¹åˆ†å¸ƒçš„å‚æ•°Î¸\\thetaÎ¸ï¼ˆæ­£é¢æœä¸Šçš„æ¦‚ç‡ï¼‰åœ¨[0,1]ä¹‹é—´ï¼Œæ˜¯ä¸€ä¸ªè¿ç»­å˜é‡ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è¦ä¼°è®¡çš„ æ³¨æ„ï¼šæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä¼°è®¡Î¸\\thetaÎ¸çš„åˆ†å¸ƒï¼Œè€Œä¸æ˜¯ç›´æ¥æ±‚å‡ºä¸€ä¸ªç»“æœï¼ˆä¸ç„¶ç›´æ¥é¢‘ç‡ä½œä¸ºæ¦‚ç‡ä¸å°±å®Œäº†ï¼Œä¸è¡Œï¼Œä½ è¿™ä¸è´å¶æ–¯å•Šï¼‰ã€‚ å› ä¸ºæœ‰å¾ˆå¤šå¯èƒ½çš„Î¸\\thetaÎ¸ï¼Œéƒ½å¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„æŠ›ç¡¬å¸å®éªŒå¾—åˆ°ä¸Šè¿°çš„ç»“æœã€‚ æˆ‘ä»¬ç°åœ¨å·²çŸ¥Næ¬¡ç‹¬ç«‹å®éªŒçš„ç»“æœï¼ŒN0N_0N0â€‹æ¬¡æ­£é¢æœä¸Šï¼ŒN1N_1N1â€‹æ¬¡åé¢æœä¸Šå°±æ˜¯â€œæ•°æ®é›†â€çš„æ•°æ®ï¼Œå› æ­¤å¯ä»¥å†™å‡ºå·²çŸ¥é‡‡æ ·ä¸æˆ‘ä»¬å®é™…è¦æ±‚çš„â€œæŠ›ç¡¬å¸å“ªä¸€é¢å‘ä¸Šâ€åˆ†å¸ƒçš„ä¼¼ç„¶ï¼š likehoodï¼š$$P(\\mathcal {D} | \\theta) = \\theta{N_1}(1-\\theta){N_0}$$ è®°ä½æˆ‘ä»¬è¦æ±‚åéªŒæ¦‚ç‡ï¼Œå®ƒç­‰ä»·äºå…ˆéªŒæ¦‚ç‡å’Œä¼¼ç„¶çš„ä¹˜ç§¯ã€‚ç°åœ¨çš„é—®é¢˜åœ¨äºï¼šæˆ‘ä»¬æ€ä¹ˆçŸ¥é“å…ˆéªŒæ¦‚ç‡p(Î¸)p(\\theta)p(Î¸)ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨è´å¡”åˆ†å¸ƒæ¥ä½œä¸ºæˆ‘ä»¬çš„å…ˆéªŒæ¦‚ç‡æ¨¡å‹ï¼Œä¹‹æ‰€ä»¥æ˜¯å®ƒçš„ç†ç”±å¦‚ä¸‹ï¼š è´å¡”åˆ†å¸ƒå¸¸ç”¨äºä¼°è®¡[0,1]åˆ†å¸ƒä¸Šï¼Œç¼ºå°‘è¶³å¤Ÿå…ˆéªŒæ ·æœ¬çš„åˆ†å¸ƒ è´å¡”åˆ†å¸ƒæœ‰ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§ï¼šå…±è½­å…ˆéªŒï¼Œå³å°†å…¶å¸¦å…¥è´å¶æ–¯æ¨¡å‹ï¼Œå¾—åˆ°çš„åéªŒæ¦‚ç‡çš„å‡½æ•°å½¢å¼ä¸å…ˆéªŒç›¸åŒã€‚è€Œå¦‚æœæˆ‘ä»¬å°†ç‹¬ç«‹å®éªŒçš„ç»“æœN0N_0N0â€‹æˆ–N1N_1N1â€‹æ¬¡ä½œä¸ºéšæœºå˜é‡è®¡ç®—å…ˆéªŒï¼Œå…¶æœä»ä¼¯åŠªåˆ©åˆ†å¸ƒï¼Œä¼¼ç„¶å‡½æ•°çš„å½¢å¼ä¹Ÿä¸è´å¡”åˆ†å¸ƒçš„å…ˆéªŒç›¸åŒã€‚ æˆ‘ä»¬å‡è®¾å…ˆéªŒæœä»è´å¡”åˆ†å¸ƒï¼šp(Î¸)âˆ¼Beta(Î¸âˆ£a,b)p(\\theta) \\sim Beta(\\theta|a,b)p(Î¸)âˆ¼Beta(Î¸âˆ£a,b)äºæ˜¯æˆ‘ä»¬ç°åœ¨å¯ä»¥è®¡ç®—åéªŒï¼š P(Î¸âˆ£D)âˆ[Î¸N1(1âˆ’Î¸)N0][Î¸aâˆ’1(1âˆ’Î¸)bâˆ’1]=[Î¸N1+aâˆ’1(1âˆ’Î¸)N0+bâˆ’1]=Beta(Î¸âˆ£N1+a,N0+b)P(\\theta|\\mathcal {D}) \\propto [\\theta^{N_1}(1-\\theta)^{N_0}][ \\theta^{a-1}(1-\\theta)^{b-1}] = [\\theta^{N_1+a-1}(1-\\theta)^{N_0+b-1}]\\\\ = Beta(\\theta|N_1+a,N_0+b) P(Î¸âˆ£D)âˆ[Î¸N1â€‹(1âˆ’Î¸)N0â€‹][Î¸aâˆ’1(1âˆ’Î¸)bâˆ’1]=[Î¸N1â€‹+aâˆ’1(1âˆ’Î¸)N0â€‹+bâˆ’1]=Beta(Î¸âˆ£N1â€‹+a,N0â€‹+b) ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€ä¼°è®¡åéªŒå‡½æ•°å–å°½å¯èƒ½å¤§å€¼æ—¶ï¼Œå‚æ•°Î¸çš„åˆ†å¸ƒï¼Œæ ¹æ®è´å¡”åˆ†å¸ƒçš„ç‰¹æ€§ï¼Œ Beta(a,b) åˆ†å¸ƒçš„éšæœºå˜é‡å–æœ€å¤§å€¼æ—¶ï¼Œå‚æ•°ä¸ºaâˆ’1a+bâˆ’2\\frac{a-1}{a+b-2}a+bâˆ’2aâˆ’1â€‹ å¾—åˆ°æœ€å¤§åéªŒæ¦‚ç‡ä¼°è®¡ï¼šÎ¸^map=aâˆ’1+N1a+bâˆ’2+N\\hat \\theta^{map} = \\frac{a-1+N_1}{a+b-2+N}Î¸^map=a+bâˆ’2+Naâˆ’1+N1â€‹â€‹ï¼Œæ ¹æ®å…±è½­å…ˆéªŒçš„æ€§è´¨ï¼Œæˆ‘ä»¬è¦ä¼°è®¡çš„Î¸\\thetaÎ¸åˆ†å¸ƒä¹Ÿæ˜¯ä¸€ä¸ªè´å¡”åˆ†å¸ƒï¼Œå…¶å…·ä½“å½¢çŠ¶ä¸å‚æ•°aï¼Œbæœ‰å…³ã€‚ å¦‚æœæˆ‘ä»¬ä½¿ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡ï¼Œå³ä¸è€ƒè™‘å…ˆéªŒï¼Œåˆ™ç»“æœé€€åŒ–ä¸ºï¼šÎ¸^mle=N1N\\hat\\theta^{mle} = \\frac{N_1}{N}Î¸^mle=NN1â€‹â€‹ï¼Œå³ç›´æ¥ç”¨é¢‘ç‡ä¼°è®¡æ¦‚ç‡çš„ç»“æœï¼Œå¦‚æœæˆ‘ä»¬å–ä¸Šè¿°è´å¡”åˆ†å¸ƒçš„a=b=1ï¼ˆå‡åŒ€åˆ†å¸ƒï¼Œè®¤ä¸ºå…ˆéªŒçš„ç»“æœç¡¬å¸æ­£é¢æœä¸Šçš„æ¦‚ç‡å°±æ˜¯äº”äº”å¼€çš„ï¼‰ï¼Œé‚£ä¹ˆä¹Ÿä¼šå¾—åˆ°è¿™ä¸ªç»“æœã€‚ ä½¿ç”¨MAPçš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸‹ä¸€æ¬¡æŠ›ç¡¬å¸æ­£é¢æœä¸Šçš„ç»“æœä¼°è®¡ï¼š P(xË‰=1âˆ£D)=âˆ«01P(xË‰=1âˆ£Î¸)P(Î¸âˆ£D)dÎ¸=âˆ«01Î¸Beta(Î¸âˆ£a+N1,b+N0)dÎ¸=E[Î¸âˆ£D]=a+N1a+b+NP(\\bar x=1|\\mathcal D) = \\int_0^1P(\\bar x =1 |\\theta)P(\\theta|\\mathcal D)d\\theta = \\int_0^1\\theta Beta(\\theta|a+N_1,b+N_0) d\\theta \\\\= E[\\theta|D] = \\frac{a+N_1}{a+b+N} P(xË‰=1âˆ£D)=âˆ«01â€‹P(xË‰=1âˆ£Î¸)P(Î¸âˆ£D)dÎ¸=âˆ«01â€‹Î¸Beta(Î¸âˆ£a+N1â€‹,b+N0â€‹)dÎ¸=E[Î¸âˆ£D]=a+b+Na+N1â€‹â€‹ å¯ä»¥å‘ç°ï¼Œç»“æœæ­£å¥½æ˜¯æˆ‘ä»¬çš„è´å¡”åˆ†å¸ƒæ¨¡å‹çš„å‡å€¼ã€‚æœ‰è¶£çš„æ˜¯ï¼Œåªè¦æˆ‘ä»¬ä½¿ç”¨MAPçš„ç”Ÿæˆç»“æœï¼Œå³ä½¿å–a=b=1çš„å‡åŒ€åˆ†å¸ƒï¼Œä¹Ÿä¼šä½¿å¾—ä¼°è®¡æ­£é¢æœä¸Šçš„æ¦‚ç‡ä¸­ï¼Œåˆ†å­è‡³å°‘ä¸º1ï¼Œä¸ä¼šå‡ºç° _å› ä¸ºå®éªŒæ•°æ®é›†ä¸­æ²¡æœ‰æ­£é¢æœä¸Šï¼Œå°±å°†å…¶åˆ¤å®šä¸ºä¸å¯èƒ½äº‹ä»¶ _çš„æƒ…å†µã€‚å› æ­¤ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿè¢«ç§°ä¸º**â€ï¼ˆæ‹‰æ™®æ‹‰æ–¯ï¼‰+1å¹³æ»‘â€œ** ç‹„åˆ©å…‹é›·å¤šé¡¹åˆ†å¸ƒç”Ÿæˆæ¨¡å‹ å†æ¥çœ‹ä¸€ä¸ªå¤æ‚ä¸€ç‚¹çš„æƒ…å†µï¼šéšæœºå˜é‡æœ‰Kä¸ªå¯èƒ½çš„å–å€¼ï¼Œæ¯”å¦‚è¯´ï¼Œä¼°è®¡ä¸€ä¸ªæœ‰ké¢çš„éª°å­ï¼Œæ¯ä¸ªé¢æœä¸Šçš„æ¦‚ç‡ã€‚æˆ‘ä»¬å‡è®¾åšäº†Næ¬¡å®éªŒï¼Œæ¯ä¸ªé¢æœä¸Šçš„æ¬¡æ•°åˆ†åˆ«ä¸ºï¼šN1,N2,...NkN_1,N_2,...N_kN1â€‹,N2â€‹,...Nkâ€‹å’Œä¼¯åŠªåˆ©å®éªŒç±»ä¼¼ï¼Œå¯ä»¥è¿™æ ·å®šä¹‰ï¼š ä¼¼ç„¶å‡½æ•°ï¼š p(Dâˆ£Î¸)=Î¸1N1Î¸2N2...Î¸kNkp(\\mathcal D|\\theta) = \\theta_1^{N_1}\\theta_2^{N_2}...\\theta_k^{N_k} p(Dâˆ£Î¸)=Î¸1N1â€‹â€‹Î¸2N2â€‹â€‹...Î¸kNkâ€‹â€‹ å…ˆéªŒå‡½æ•°ï¼Œå°†ä¹‹å‰è´å¡”åˆ†å¸ƒçš„å…±è½­å…ˆéªŒæ¨å¹¿åˆ°å¤šä¸ªå˜é‡ï¼Œè¿™å°±æ˜¯ç‹„åˆ©å…‹é›·å¤šé¡¹åˆ†å¸ƒï¼š p(Î¸)=Dir(Î¸âˆ£Î±)p(\\theta) = Dir(\\theta|\\alpha) p(Î¸)=Dir(Î¸âˆ£Î±) åéªŒè®¡ç®—ï¼š æœ€å¤§åéªŒæ¦‚ç‡ä¼°è®¡ï¼š Î¸^k=Nk+Î±kâˆ’1N+âˆ‘k=1KÎ±kâˆ’K\\hat \\theta_k = \\frac{N_k+\\alpha_k-1}{N+\\sum^K_{k=1}\\alpha_k - K} Î¸^kâ€‹=N+âˆ‘k=1Kâ€‹Î±kâ€‹âˆ’KNkâ€‹+Î±kâ€‹âˆ’1â€‹ åŒæ ·çš„ï¼Œå¦‚æœä½¿ç”¨æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼Œä¼šé€€åŒ–ä¸ºï¼šÎ¸^k=NkN\\hat \\theta_k = \\frac{N_k}{N}Î¸^kâ€‹=NNkâ€‹â€‹ ç”Ÿæˆä¸€ä¸ªéª°å­ç‚¹æ•°ï¼Œå…¶ç»“æœæ˜¯jç‚¹çš„æ¦‚ç‡ï¼š P(xË‰=jâˆ£D)=E(Î¸jâˆ£D)=Î±j+Njâˆ‘k=1KÎ±k+NP(\\bar x=j|\\mathcal D) = E(\\theta_j|\\mathcal D) = \\frac{\\alpha_j+N_j}{\\sum^K_{k=1}\\alpha_k+N} P(xË‰=jâˆ£D)=E(Î¸jâ€‹âˆ£D)=âˆ‘k=1Kâ€‹Î±kâ€‹+NÎ±jâ€‹+Njâ€‹â€‹ æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ï¼ˆNBCï¼‰ åœ¨ç¬¬ä¸€ç« ï¼Œæˆ‘ä»¬è¯´äº† ç”Ÿæˆæ¨¡å‹ åŒ…å« åˆ†ç±»æ¨¡å‹çš„æ‰€æœ‰åŠŸèƒ½ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªåˆ†ç±»é—®é¢˜ï¼š ä»»åŠ¡ï¼šå°†è‹¥å¹²ä¸ªç”±ç¦»æ•£æ•°æ®ç»„æˆçš„å‘é‡è¿›è¡Œåˆ†ç±»ã€‚è®¾å˜é‡ x=(x1,x2,...xD)Tx = (x_1,x_2,...x_D)^Tx=(x1â€‹,x2â€‹,...xDâ€‹)Tæ˜¯é•¿åº¦ä¸ºDçš„ç‰¹å¾å‘é‡ï¼Œæ¯ä¸ªå…ƒç´ ï¼ˆç‰¹å¾ï¼‰æœ‰KKKä¸ªå¯èƒ½çš„å–å€¼ï¼Œå¸Œæœ›å°†æ‰€æœ‰è¿™æ ·çš„å‘é‡åˆ†ä¸ºCç±»ï¼š {1,2,â€¦C} ï¼Œç”¨ Y=c æ¥è¡¨ç¤ºç»“æœçš„ç±»æ ‡å·ã€‚äºæ˜¯æˆ‘ä»¬æƒ³è¦çŸ¥é“ï¼Œç»™å®šå‘é‡xå’Œæ¨¡å‹å‚æ•°å‘é‡Î¸ï¼Œåˆ†ç±»çš„æ¦‚ç‡ï¼šPy=P(Y=câˆ£x,Î¸)P_y=P(Y=c|x,\\theta)Pyâ€‹=P(Y=câˆ£x,Î¸)ï¼Œåªè¦å¯¹æ‰€æœ‰çš„ç±»åˆ«cè®¡ç®—è¿™ä¸ªæ¦‚ç‡ï¼Œå–æœ€å¤§å€¼ä½œä¸ºæœ€ç»ˆåˆ†ç±»ã€‚ æˆ‘ä»¬å°è¯•ç”¨è´å¶æ–¯ç”Ÿæˆæ¨¡å‹çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¿™æ¶‰åŠåˆ°åˆšæ‰ä¸¤èŠ‚äºŒé¡¹åˆ†å¸ƒå’Œç‹„åˆ©å…‹é›·å¤šé¡¹åˆ†å¸ƒæ–¹æ³•çš„ç»¼åˆã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬è€ƒè™‘ç»™å®šç±»åˆ«cï¼Œèƒ½ç”Ÿæˆç‰¹å¾å‘é‡xçš„æ¦‚ç‡ï¼š Px=P(xâˆ£Y=c,Î¸)P_x = P(x|Y=c,\\theta)Pxâ€‹=P(xâˆ£Y=c,Î¸) åˆ™ç”±è´å¶æ–¯å…¬å¼ï¼Œè¦æ±‚çš„æ¦‚ç‡å¯ä»¥è¡¨ç¤ºä¸ºï¼š Py=P(Y=câˆ£x,Î¸)=P(x,Y=câˆ£Î¸)P(xâˆ£Î¸)=P(x,Y=câˆ£Î¸)âˆ‘iâˆˆC[P(x,Y=iâˆ£Î¸)]=P(xâˆ£Y=c,Î¸)P(Y=câˆ£Î¸)âˆ‘iâˆˆC[P(xâˆ£Y=i,Î¸)P(Y=iâˆ£Î¸)]âˆP(Y=câˆ£Î¸)PxP_y=P(Y=c|x,\\theta) = \\frac{P(x,Y=c|\\theta)}{P(x|\\theta)} = \\frac{P(x,Y=c|\\theta)}{\\sum_{i \\in C}[P(x,Y=i|\\theta)]} = \\frac{P(x|Y=c,\\theta)P(Y=c|\\theta)}{\\sum_{i \\in C}[P(x|Y=i,\\theta)P(Y=i|\\theta)]} \\propto {P(Y=c|\\theta)}P_x Pyâ€‹=P(Y=câˆ£x,Î¸)=P(xâˆ£Î¸)P(x,Y=câˆ£Î¸)â€‹=âˆ‘iâˆˆCâ€‹[P(x,Y=iâˆ£Î¸)]P(x,Y=câˆ£Î¸)â€‹=âˆ‘iâˆˆCâ€‹[P(xâˆ£Y=i,Î¸)P(Y=iâˆ£Î¸)]P(xâˆ£Y=c,Î¸)P(Y=câˆ£Î¸)â€‹âˆP(Y=câˆ£Î¸)Pxâ€‹ å¯ä»¥å‘ç°ï¼Œå› ä¸ºç°åœ¨é—®é¢˜ç©ºé—´åŒ…å«ä¸¤ä¸ªéšæœºå˜é‡xï¼ŒYï¼Œå¯¹äºç±»åˆ«çš„å˜é‡Yï¼Œå¼å­ä¸­ä¹Ÿæ¨å‡ºäº†å…ˆéªŒæ¦‚ç‡ã€‚ P(Y=câˆ£Î¸)P(Y=c|\\theta)P(Y=câˆ£Î¸)å°±æ˜¯åˆ†ç±»å…ˆéªŒï¼ˆåœ¨è®­ç»ƒçš„æ•°æ®é›†ä¸­ï¼Œæœ€ç»ˆè¢«æ¯ä¸€ç±»è¢«åˆ†å…¥äº†å¤šå°‘ä¸ªå‘é‡ï¼‰ã€‚ è¿™ä¼šä½¿å¾—æ¨¡å‹çš„å‚æ•°å‘é‡Î¸ä¸­è¿˜è¦åŒ…å«åˆ†ç±»å…ˆéªŒçš„å‚æ•°ã€‚å¦‚æœå°†å®ƒä»¬å’Œå‘é‡xçš„å‚æ•°æ··ä¸ºä¸€è°ˆï¼Œè¿™å°†å¯¼è‡´æ— æ³•æ›´æ–°å‚æ•°ã€‚ä¸ºäº†èƒ½å°†å‘é‡å†…çš„æ¯ä¸ªç‰¹å¾å¯¹åº”çš„å‚æ•°æ‹†åˆ†å‡ºæ¥è®¡ç®—ï¼Œæœ´ç´ è´å¶æ–¯æå‡ºä¸€ä¸ªé‡è¦çš„å‡è®¾ï¼š ç»™å®šåŒä¸€ä¸ªç±»åˆ«çš„æ ‡ç­¾ï¼Œæ¯ä¸€ä¸ªç‰¹å¾çš„æ¡ä»¶éƒ½æ˜¯ç‹¬ç«‹çš„ æ³¨æ„ï¼šçœŸå®ä¸–ç•Œä¸­ï¼Œè¿™ä¸ªå‡è®¾æ˜¯å¾ˆéš¾æˆç«‹çš„ï¼Œä½†æ˜¯ä¾ç„¶è¯¥æ–¹æ³•ä¾ç„¶å¯ä»¥ç”¨æ¥ä¼°è®¡åˆ†ç±»å™¨ åˆ™æˆ‘ä»¬å¯ä»¥å°†ç‰¹å¾å‘é‡åœ¨æ¨¡å‹ä¸­çš„å‚æ•°ç”¨Î¸è¡¨ç¤ºï¼Œè€Œåˆ†ç±»å…ˆéªŒçš„å‚æ•°åœ¨ä¸‹æ–‡å°†ç”¨Ï€\\piÏ€æ¥è¡¨ç¤ºï¼Œå®ƒä»¬å°†è¢«åˆ†åˆ«ä¼°è®¡ã€‚å…ˆæ¥çœ‹ç‰¹å¾å‘é‡ï¼š Px=P(xâˆ£Y=c,Î¸)=Î i=1DP(xiâˆ£Y=c,Î¸ic)=Î i=1DTiP_x = P(x|Y=c,\\theta) = \\Pi_{i=1}^{D}P(x_i|Y=c,\\theta_{ic}) = \\Pi_{i=1}^{D} T_i Pxâ€‹=P(xâˆ£Y=c,Î¸)=Î i=1Dâ€‹P(xiâ€‹âˆ£Y=c,Î¸icâ€‹)=Î i=1Dâ€‹Tiâ€‹ æˆ‘ä»¬ç”¨TiT_iTiâ€‹æ¥æ ‡è®°ä»¥ å‘é‡ä¸­çš„æ¯ä¸ªç‰¹å¾ ä¸ºéšæœºå˜é‡çš„ åˆ†å¸ƒã€‚å¯¹äºç‰¹å¾çš„å®šä¹‰ä¸åŒï¼Œè¿™ä¸ªåˆ†å¸ƒä¼šè¡¨ç¤ºæˆä¸åŒçš„å½¢å¼ï¼š å¦‚æœç‰¹å¾æ˜¯0-1ç¼–ç çš„ï¼šå€¼ä¸æ˜¯0å°±æ˜¯1ï¼Œé‚£ä¹ˆTiT_iTiâ€‹æ˜¯ä¼¯åŠªåˆ©åˆ†å¸ƒï¼Œå‚æ•°Î¸ic\\theta_{ic}Î¸icâ€‹è¦è¡¨ç¤º ç¬¬iä¸ªç‰¹å¾çš„å€¼ä¼šä½¿å¾—æ•´ä¸ªå‘é‡æœ‰å¤šå¤§å¯èƒ½æ€§è½åœ¨åˆ†ç±»cä¸­ å¦‚æœæ¯ä¸ªç‰¹å¾æœ‰KKKä¸ªå¯èƒ½çš„å–å€¼ï¼ˆåŸå§‹çš„é—®é¢˜ï¼‰ï¼Œé‚£ä¹ˆTiT_iTiâ€‹æ˜¯å¤šé¡¹åˆ†å¸ƒï¼Œå‚æ•°Î¸ic\\theta_{ic}Î¸icâ€‹è¦è¡¨ç¤ºä¸ºä¸€ç»„å‘é‡ã€‚ å¦‚æœç‰¹å¾æ˜¯è¿ç»­çš„å®æ•°æ¥è¡¨ç¤ºçš„ï¼Œé‚£ä¹ˆTiT_iTiâ€‹å°†æ˜¯ä¸€ä¸ªè¿ç»­çš„é«˜æ–¯åˆ†å¸ƒï¼Œå‚æ•°ä¹Ÿè¦è¡¨ç¤ºä¸º&lt;å‡å€¼ï¼Œæ–¹å·®&gt;çš„ä¸€ç»„å€¼ã€‚ å›åˆ°é—®é¢˜çš„å¼€å§‹ï¼Œä¸ºäº†ä¸‹é¢çš„æ¨å¯¼å†™çš„æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å°†é—®é¢˜ç®€åŒ–ä¸ºåªè¦0-1ç¼–ç çš„ä¸¤ç§ç‰¹å¾ ï¼ˆå®ƒå·²ç»å¾ˆå¤æ‚äº†QAQï¼Œå†åŠ ä¸ŠKä¸ªç±»åˆ«æˆ‘éƒ½ä¸æ•¢æƒ³â€¦â€¦ï¼‰ ç„¶åæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è´å¶æ–¯å­¦ä¹ æ¥è¿›è¡Œè®­ç»ƒï¼šå‡è®¾è®­ç»ƒæ•°æ®é›†ä¸­åŒ…å«äº†Nä¸ª**&lt;å‘é‡x, åˆ†ç±»æ ‡ç­¾Y&gt;**çš„æ•°æ®å¯¹ï¼Œæ¯ä¸ªå¯¹ç”¨&lt;xi,Yi&gt;(i=1,2,...,n)&lt;x_i,Y_i&gt;(i=1,2,...,n)&lt;xiâ€‹,Yiâ€‹&gt;(i=1,2,...,n)æ¥è¡¨ç¤ºï¼Œé‚£ä¹ˆåˆ†ç±»çš„å…ˆéªŒè¡¨ç¤ºä¸ºï¼š$$P(Y_i|\\pi) = \\Pi\\ \\pi_c^{if(Y_i =c)}$$ [...]if(Yi=c)[...]^{if(Y_i =c)}[...]if(Yiâ€‹=c)è¡¨ç¤ºè®¡æ•°å‡½æ•°ï¼Œå³åªæœ‰ç¬¬iä¸ªåˆ†ç±»æ ‡ç­¾ä¸ºcæ—¶ï¼Œæ‰ä¿ç•™å‚æ•°Ï€c\\pi_cÏ€câ€‹ã€æ²¡é”™ï¼Œè¿˜æ˜¯ç»Ÿè®¡æ–¹æ³•ã€‘ æ³¨æ„è¿™é‡Œä½œä¸ºæ¡ä»¶æ¦‚ç‡çš„piå’Œä¸‹é¢çš„Î¸éƒ½æ˜¯å‘é‡ï¼Œè€Œå³ä¾§å¼å­è¡¨ç¤ºå–å‘é‡ä¸­çš„å“ªä¸€ä¸ªæœ‰æ•ˆå€¼ï¼ˆç”¨ç¬¦å·Ï€\\piÏ€æ¥åŒºåˆ† åˆ†ç±»çš„å‚æ•°å‘é‡ å’Œ ç‰¹å¾çš„å‚æ•°å‘é‡Î¸\\thetaÎ¸ï¼‰ åŒæ ·ï¼Œç‰¹å¾çš„å…ˆéªŒè®¡ç®—ä¸ºï¼š P(xiâˆ£Yi,Î¸)=Î j=1DP(xi[j]Â âˆ£Yi,Î¸j)=Î j=1D(Î Â P(xi[j]Â âˆ£Î¸jc)if(Yi=c))P(x_i|Y_i,\\theta) = \\Pi_{j=1}^DP(x_i[j]\\ |Y_i,\\theta_j) = \\Pi_{j=1}^D(\\Pi\\ P(x_i[j]\\ |\\theta_{jc})^{if(Y_i=c)}) P(xiâ€‹âˆ£Yiâ€‹,Î¸)=Î j=1Dâ€‹P(xiâ€‹[j]Â âˆ£Yiâ€‹,Î¸jâ€‹)=Î j=1Dâ€‹(Î Â P(xiâ€‹[j]Â âˆ£Î¸jcâ€‹)if(Yiâ€‹=c)) äºæ˜¯ï¼Œæ¨å¯¼æ•´ä¸ªæ•°æ®é›†çš„åéªŒæ¦‚ç‡å‡½æ•°ï¼Œå³å°†æ‰€æœ‰æ•°æ®çš„ç»“æœç›¸ä¹˜èµ·æ¥ï¼š P(Dâˆ£Î¸)=Î i=1N[P(Yiâˆ£Î¸)P(xiâˆ£Yi,Î¸)]P(\\mathcal D|\\theta) = \\Pi_{i=1}^N[P(Y_i|\\theta)P(x_i|Y_i,\\theta)] P(Dâˆ£Î¸)=Î i=1Nâ€‹[P(Yiâ€‹âˆ£Î¸)P(xiâ€‹âˆ£Yiâ€‹,Î¸)] å°è¯•ä½¿ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡æ¥ç›´æ¥è®¡ç®—å‚æ•°ï¼ˆMLEï¼‰ï¼Œç›´æ¥å¯¹ä¸¤è¾¹å–å¯¹æ•°ï¼Œå¾—åˆ°ï¼š log[P(Dâˆ£Î¸)]=âˆ‘c=1CNc+âˆ‘j=1D(âˆ‘c=1C(âˆ‘Yi=clogP(xi[j]âˆ£Î¸jc)))log[P(\\mathcal D|\\theta)] = \\sum_{c=1}^C N_c + \\sum_{j=1}^D(\\sum_{c=1}^C(\\sum_{Y_i=c}logP(x_i[j]|\\theta_{jc}))) log[P(Dâˆ£Î¸)]=c=1âˆ‘Câ€‹Ncâ€‹+j=1âˆ‘Dâ€‹(c=1âˆ‘Câ€‹(Yiâ€‹=câˆ‘â€‹logP(xiâ€‹[j]âˆ£Î¸jcâ€‹))) ï¼ˆå…¶ä¸­xi[j]x_i[j]xiâ€‹[j]è¡¨ç¤ºå‘é‡xix_ixiâ€‹ä¸­çš„ç¬¬jjjä¸ªå€¼ï¼‰ä¸Šé¢çš„å¼å­çœ‹ç€éå¸¸å¤æ‚ï¼Œå…¶å®æœ¬è´¨ä¸Šä¸ä¸Šä¸€èŠ‚çš„äºŒé¡¹åˆ†å¸ƒä¼°è®¡ç›¸åŒï¼š åˆ†ç±»çš„å…ˆéªŒä¼°è®¡å°±æ˜¯ï¼šä»æ•°æ®é›†Nä¸­ç»Ÿè®¡å‡ºåˆ†ç±»cå‡ºç°æ¬¡æ•°NcN_cNcâ€‹ï¼Œå¹¶è®¡ç®—æ¯”ä¾‹ï¼š Ï€c=NcN\\pi_{c} = \\frac{N_{c}}{N}Ï€câ€‹=NNcâ€‹â€‹ ç‰¹å¾çš„ä¼¼ç„¶å‚æ•°ä¼°è®¡å°±æ˜¯ï¼šä»æ¯ä¸ªå·²çŸ¥ç±»åˆ«çš„å‡ºç°æ¬¡æ•°ä¸­ï¼Œç»Ÿè®¡å‡ºæ˜¯å½“å‰ç‰¹å¾çš„æ¯”ä¾‹ï¼Œå³ï¼š Î¸jc=NjcNc\\theta_{jc} = \\frac{N_{jc}}{N_c}Î¸jcâ€‹=Ncâ€‹Njcâ€‹â€‹ ï¼ˆä¸æ˜¯0-1ç¼–ç çš„ï¼ŒNjcN_{jc}Njcâ€‹å°±æ˜¯ä¸€ä¸ªåµŒå¥—çš„å‘é‡äº†ï¼‰ è¿™ä¸ªç»“æœï¼Œä¸æŠ›ç¡¬å¸å’Œéª°å­ä¸€æ ·ï¼Œå› ä¸ºå…ˆéªŒæ˜¯å®Œå…¨æŒ‰ç…§ç»Ÿè®¡ç»“æœçš„ï¼Œå®¹æ˜“å‡ºç°è¿‡æ‹Ÿåˆçš„é—®é¢˜ã€‚å¦ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨åˆšæ‰çš„è´å¶æ–¯æ–¹æ³•ï¼Œå¯¹piå’ŒÎ¸ä¸¤ä¸ªå‚æ•°çš„åˆ†å¸ƒå‡è®¾å…ˆéªŒï¼š :::warning å‡è®¾P(Yiâˆ£Ï€)P(Y_i|\\pi)P(Yiâ€‹âˆ£Ï€)æ˜¯ä¸€ä¸ªç‹„åˆ©å…‹é›·åˆ†å¸ƒï¼Œå‚æ•°æ˜¯Î±=(Î±0,Î±1,...Î±C)\\alpha = (\\alpha_0,\\alpha_1,...\\alpha_C)Î±=(Î±0â€‹,Î±1â€‹,...Î±Câ€‹) å‡è®¾æ¯ä¸ª P(xi[j]Â âˆ£Î¸jc)P(x_i[j]\\ |\\theta_{jc})P(xiâ€‹[j]Â âˆ£Î¸jcâ€‹)éƒ½æ˜¯ä¸€ä¸ªè´å¡”åˆ†å¸ƒï¼Œå‚æ•°æ˜¯(Î²0,Î²1)(\\beta_0,\\beta_1)(Î²0â€‹,Î²1â€‹) ::: ç„¶åè®¡ç®—åéªŒï¼Œå½¢å¼æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ä¸‘é™‹çš„è®¡æ•°å‡½æ•°è¢«æ›¿æ¢æˆäº†å…ˆéªŒåˆ†å¸ƒçš„å‡å€¼ï¼šä»£å…¥æœ€å¤§åéªŒæ¦‚ç‡ä¼°è®¡MAPçš„ä¼°è®¡ç»“æœæ˜¯ï¼šå¦‚æœæœ‰ä¸€æ¡æ–°çš„æ•°æ®éœ€è¦åˆ†ç±»ï¼Œé‚£ä¹ˆå¯¹äºæ¯ä¸ªç±»åˆ«c=1,2,...Cc=1,2,...Cc=1,2,...Cï¼Œå°†MAPä¼°è®¡çš„å‚æ•°å¸¦å…¥P(Y=câˆ£xË‰,Î¸)P(Y=c|\\bar x,\\theta)P(Y=câˆ£xË‰,Î¸)ï¼Œå¾—åˆ°ä½¿å¾—æ¦‚ç‡æœ€å¤§çš„cå°±æ˜¯è¦æ±‚çš„åˆ†ç±»ã€‚å¯ä»¥çœ‹å‡ºï¼Œæœ´ç´ è´å¶æ–¯æ¨¡å‹è™½ç„¶æ¨å¯¼èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼ˆå…¶å®ä¹Ÿåªæ˜¯å¤æ‚åœ¨æ•°æ®ç»´åº¦æ¯”è¾ƒå¤šï¼Œäººè„‘CPUå®¹æ˜“å¹²çƒ§ï¼Œäº¤ç»™è®¡ç®—æœºæ¥è¿˜æ˜¯å¾ˆå¿«çš„ï¼‰ï¼Œä½†æ˜¯è®¡ç®—å¤æ‚åº¦å¾ˆä½ï¼Œæ‰€ä»¥åœ¨å°åœºæ™¯ä¸­ä½¿ç”¨å¹¿æ³›ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªæ¨¡å‹ç”Ÿæˆæ–°çš„æ•°æ®ï¼šå’ŒäºŒé¡¹åˆ†å¸ƒç”Ÿæˆæ¨¡å‹ä¸€æ ·ï¼Œåœ¨ç”Ÿæˆæ–°çš„æ•°æ®æ—¶ï¼Œä»£å…¥æ¨¡å‹çš„å‚æ•°å°±æ˜¯åˆ†å¸ƒçš„å‡å€¼ï¼š","tags":["ç”Ÿæˆæ¨¡å‹","ç¬”è®°"]},{"title":"ã€ç¬”è®°ã€‘ç”Ÿæˆæ¨¡å‹åŸºç¡€ä¸åº”ç”¨ - ç¬¬1ç« ","path":"/2023/10/28/ç”Ÿæˆæ¨¡å‹åŸºç¡€ä¸åº”ç”¨ç¬”è®°-ç¬¬1ç« /","content":"C1 æ¦‚ç‡è®ºå’Œç»Ÿè®¡åŸºç¡€ C1 æ¦‚ç‡è®ºå’Œç»Ÿè®¡åŸºç¡€ ä»€ä¹ˆæ˜¯æ¦‚ç‡ï¼Ÿ é¢‘æ•°çš„æ¦‚ç‡è§£é‡Šï¼šé¢‘ç‡ä¼°è®¡æ¦‚ç‡ï¼ˆå°å­¦å°±å­¦è¿‡çš„ï¼‰ è´å¶æ–¯æ¦‚ç‡è§£é‡Šï¼šæ¦‚ç‡æ˜¯æŸæ ·äº‹ä»¶çš„â€œä¸ç¡®å®šåº¦â€ï¼Œæ˜¯äººä»¬åœ¨å¤šå¤§ç¨‹åº¦ä¸Šç›¸ä¿¡æŸä»¶äº‹æƒ…å°†ä¼šå‘ç”Ÿï¼ˆä¼¼ç„¶likehoodï¼‰ å› ä¸ºè´å¶æ–¯æ¦‚ç‡èƒ½é€‚ç”¨æ›´å¤šæ›´å¹¿æ³›çš„æ¦‚ç‡äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼šä»æœªå‘ç”Ÿä½†å¯èƒ½çš„äº‹ä»¶ï¼‰ï¼Œå› æ­¤ä»¥ä¸‹è®¨è®ºçš„æ¦‚ç‡å¶éƒ½åŸºäºè´å¶æ–¯æ¦‚ç‡ äº‹ä»¶ã€éšæœºå˜é‡å’Œæ¦‚ç‡åˆ†å¸ƒï¼š äº‹ä»¶ï¼šè‡ªç„¶è¯­è¨€æè¿°çš„å…·æœ‰éšæœºæ€§çš„äº‹ä»¶ éšæœºå˜é‡ï¼šå¯èƒ½ä»æœ‰é™ æˆ– å¯æ•°çš„æ— é™ é›†åˆXä¸­éšæœºå–å€¼çš„å˜é‡ æ¦‚ç‡çš„è¡¨ç¤ºï¼šP(äº‹ä»¶A) = P(éšæœºå˜é‡X=æŸå€¼a) ã€å¦‚æœæˆ‘ä»¬å®šä¹‰å½“Xå–aæ—¶äº‹ä»¶Aå‘ç”Ÿã€‘ æ¦‚ç‡åˆ†å¸ƒï¼šè¡¨è¿°éšæœºå˜é‡Xçš„ å–å€¼ çš„ æ¦‚ç‡è§„å¾‹ çš„é›†å‡½æ•° ç¦»æ•£éšæœºå˜é‡è¦ç‚¹å›é¡¾ äº‹ä»¶åˆå¹¶æ¦‚ç‡ï¼š P(AâˆªB)=P(A)+P(B)âˆ’P(Aâˆ©B)P(A âˆª B) = P(A) + P(B) - P(A âˆ© B)P(AâˆªB)=P(A)+P(B)âˆ’P(Aâˆ©B) å¦‚æœAå’ŒBæ˜¯äº’æ–¥äº‹ä»¶ï¼Œåˆ™ï¼šP(AâˆªB)=P(A)+P(B)P(A âˆª B) = P(A) + P(B)P(AâˆªB)=P(A)+P(B) ä¸¤ä¸ªéšæœºå˜é‡çš„è”åˆæ¦‚ç‡ï¼š P(A,B)=P(A)P(Bâˆ£A)=P(B)P(Aâˆ£B)P(A,B) = P(A)P(B|A) = P(B)P(A|B)P(A,B)=P(A)P(Bâˆ£A)=P(B)P(Aâˆ£B) è”åˆæ¦‚ç‡åˆ†å¸ƒçš„é“¾å¼æ³•åˆ™ï¼š P(X1,X2,...,XD)=P(X1)P(X2âˆ£X1)P(X3âˆ£X1,X2)...P(XDâˆ£X1,X2...XD)P(X_1,X_2,...,X_D)=P(X_1)P(X_2|X_1)P(X_3|X_1,X_2)...P(X_D|X_1,X_2...X_D)P(X1â€‹,X2â€‹,...,XDâ€‹)=P(X1â€‹)P(X2â€‹âˆ£X1â€‹)P(X3â€‹âˆ£X1â€‹,X2â€‹)...P(XDâ€‹âˆ£X1â€‹,X2â€‹...XDâ€‹) ä¸¤ä¸ªéšæœºå˜é‡çš„æ¡ä»¶æ¦‚ç‡ï¼š P(Bâˆ£A)=P(B,A)P(A)=P(B)P(Aâˆ£B)P(A)Â ,P(A)&gt;0P(B|A) = \\frac{P(B,A)}{P(A)}=\\frac{P(B)P(A|B)}{P(A)} \\ ,P(A) &gt; 0P(Bâˆ£A)=P(A)P(B,A)â€‹=P(A)P(B)P(Aâˆ£B)â€‹Â ,P(A)&gt;0 è´å¶æ–¯æ¡ä»¶æ¦‚ç‡å…¬å¼ é‡è¦åç§°ï¼š å…ˆéªŒï¼šå·²çŸ¥çš„ï¼ŒBäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡ ä¼¼ç„¶ï¼šåœ¨Bçš„æ¡ä»¶ä¸‹Aå‘ç”Ÿçš„æ¦‚ç‡ ä¸ Aå‘ç”Ÿçš„æ¦‚ç‡ ä¹‹æ¯”ï¼šP(Aâˆ£B)P(A)\\frac{P(A|B)}{P(A)}P(A)P(Aâˆ£B)â€‹ åéªŒï¼šåœ¨Açš„æ¡ä»¶ä¸‹ï¼ŒBå‘ç”Ÿçš„æ¦‚ç‡ï¼Œå³P(B|A) ä¸¤ä¸ªéšæœºå˜é‡çš„æ¡ä»¶ç‹¬ç«‹æ€§ï¼š å¦‚æœä¸¤ä¸ªå˜é‡çš„è”åˆæ¦‚ç‡å¯ä»¥è¢«æ‹†åˆ†ä¸ºå„è‡ªæ¦‚ç‡çš„ä¹˜ç§¯ï¼Œåˆ™ç§°ä¸¤ä¸ªå˜é‡æ˜¯ ï¼ˆæ— æ¡ä»¶ï¼‰ç‹¬ç«‹çš„ P(X,Y)=P(X)P(Y)P(X,Y) = P(X)P(Y)P(X,Y)=P(X)P(Y) è€Œå¦‚æœç»™å®šéšæœºå˜é‡Zï¼Œåœ¨Zçš„æ¡ä»¶æ¦‚ç‡ä¸‹æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œåˆ™ç§°ä¸¤ä¸ªå˜é‡X,Yæ˜¯ æ¡ä»¶ç‹¬ç«‹çš„ P(X,Yâˆ£Z)=P(Xâˆ£Z)P(Yâˆ£Z)P(X,Y|Z) = P(X|Z)P(Y|Z)P(X,Yâˆ£Z)=P(Xâˆ£Z)P(Yâˆ£Z) è¿ç»­éšæœºå˜é‡è¦ç‚¹å›é¡¾ ç´¯è®¡åˆ†å¸ƒå‡½æ•°ï¼ˆcdfï¼‰ï¼šF(x) = P(X &lt;= x)å½“è¿ç»­å˜é‡çš„å–å€¼å°äºxæ—¶ï¼Œæ€»è®¡çš„æ¦‚ç‡ æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆpdfï¼‰ï¼šp(x) = F(x) dx æ˜¯ç´¯è®¡åˆ†å¸ƒå‡½æ•°çš„å¾®åˆ† è®¡ç®—è¿ç»­éšæœºå˜é‡åœ¨a,båŒºé—´ä¸Šçš„æ¦‚ç‡ï¼šF(b) - F(a)ï¼Œæˆ–æ˜¯åœ¨p(x)ä¸Šç§¯åˆ† è¿ç»­åˆ†å¸ƒçš„æ•°å­¦é‡ï¼šå‡å€¼Eã€æ–¹å·®Ïƒ^2ã€ä¸­ä½æ•°â€¦â€¦ åæ–¹å·®ï¼šå¯¹äºä¸¤ä¸ªéšæœºå˜é‡X,Yï¼Œè¡¡é‡å®ƒä»¬çš„çº¿æ€§ç›¸å…³æ€§ï¼š cov[X,Y]=E[(Xâˆ’E(X))(Yâˆ’E(Y))]=E(XY)âˆ’E(X)E(Y)cov[X,Y] = E[(X-E(X))(Y-E(Y))] = E(XY) - E(X)E(Y)cov[X,Y]=E[(Xâˆ’E(X))(Yâˆ’E(Y))]=E(XY)âˆ’E(X)E(Y) ç›¸å…³ç³»æ•°ï¼šå°†åæ–¹å·®æ ‡å‡†åŒ–åçš„æ•°å­¦é‡ï¼š corr[X,Y]=R=cov[X,Y]Ïƒ2(X)Ïƒ2(Y)corr[X,Y] = R= \\frac{cov[X,Y]}{\\sqrt{\\sigma^2(X) \\sigma^2(Y)}}corr[X,Y]=R=Ïƒ2(X)Ïƒ2(Y)â€‹cov[X,Y]â€‹ ç‹¬ç«‹çš„ä¸¤ä¸ªå˜é‡ï¼Œå®ƒä»¬ä¸ç›¸å…³ ä½†æ˜¯ï¼Œä¸ç›¸å…³çš„ä¸¤ä¸ªå˜é‡ï¼Œå¯èƒ½äº’ç›¸ç‹¬ç«‹ å¦‚æœä¸¤ä¸ªç¬¦åˆé«˜æ–¯åˆ†å¸ƒçš„å˜é‡ä¸ç›¸å…³ï¼Œåˆ™å®ƒä»¬ä¸€å®šç‹¬ç«‹ å¯¹äºå¤šå…ƒéšæœºå˜é‡çš„è”åˆåˆ†å¸ƒï¼Œåæ–¹å·®å’Œç›¸å…³ç³»æ•°çš„è®¡ç®—å°†å˜ä¸ºçŸ©é˜µçš„å½¢å¼ï¼š å¸¸è§æ¦‚ç‡åˆ†å¸ƒå›é¡¾ ã€ç¦»æ•£çš„ã€‘ ç»éªŒåˆ†å¸ƒï¼ˆeCDFï¼‰ï¼šæè¿°ä»æŠ½æ ·ä¸­å¾—åˆ°çš„æ¦‚ç‡åˆ†å¸ƒï¼Œç»éªŒåˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°å³ä¸ºæ‰€æœ‰æŠ½æ ·çš„ç»“æœä¹‹å’Œï¼Œå…¶ä¸­æŠ½æ ·è¢«å®šä¹‰ä¸º ç‹„åˆ©å…‹é›·å‡½æ•°ï¼šå³æŠ½æ ·çš„ç»“æœåªæœ‰0æˆ–è€…1. äºŒé¡¹åˆ†å¸ƒï¼šé‡å¤næ¬¡ç‹¬ç«‹çš„ ä¼¯åŠªåˆ©äº‹ä»¶ å®éªŒï¼Œè·å¾—å…¶ä¸­ä¸€ç§ç»“æœkæ¬¡çš„æ¦‚ç‡åˆ†å¸ƒ ä¼¯åŠªåˆ©äº‹ä»¶ï¼šæŸä¸ªäº‹ä»¶åªæœ‰ä¸¤ç§å¯èƒ½çš„ç»“æœï¼ˆå¸ƒå°”éšæœºå˜é‡ï¼‰ï¼Œå…¶ä¸­ä¸€ç§çš„æ¦‚ç‡ä¸ºpï¼Œå¦ä¸€ä¸ªä¸º1-p ç»å…¸çš„ä¾‹å­æ˜¯æŠ›ç¡¬å¸ å¤šé¡¹åˆ†å¸ƒï¼šé‡å¤næ¬¡ç‹¬ç«‹çš„ å¤šé‡ä¼¯åŠªåˆ©äº‹ä»¶ å®éªŒï¼Œè·å¾— æ¯ç§ç»“æœçš„æ¬¡æ•° çš„æ¦‚ç‡åˆ†å¸ƒ å¤šé‡ä¼¯åŠªåˆ©äº‹ä»¶ï¼šæŸä¸ªäº‹ä»¶å¯èƒ½æœ‰kç§ä¸åŒçš„ç»“æœï¼Œå¹¶ä¸”æ¯ç§ç»“æœå…·æœ‰å›ºå®šçš„æ¦‚ç‡ ç»å…¸çš„ä¾‹å­æ˜¯æŠ•ä¸€ä¸ªké¢çš„éª°å­ ã€è¿ç»­çš„ã€‘ å‡åŒ€åˆ†å¸ƒï¼šåœ¨ä¸€ä¸ªåŒºé—´æˆ–åŸŸä¸Šï¼Œéšæœºå˜é‡çš„å–å€¼ä¸ºå›ºå®šå€¼ å¯¹äºä¸€ç»´å˜é‡ï¼Œéšæœºåˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸ºï¼šUnif(x)=1bâˆ’a(aâ‰¤xâ‰¤b)Unif(x) = \\frac{1}{b-a} (a \\leq x \\leq b )Unif(x)=bâˆ’a1â€‹(aâ‰¤xâ‰¤b) æ­£æ€åˆ†å¸ƒï¼ˆé«˜æ–¯åˆ†å¸ƒï¼‰ï¼šå¤šä¸ªç›¸äº’ç‹¬ç«‹çš„éšæœºå˜é‡ä¹‹å’Œ çš„åˆ†å¸ƒ ä¼šè¶‹è¿‘äºè¿™ä¸ªåˆ†å¸ƒï¼Œå› æ­¤å®ƒè¢«å¹¿æ³›ä½¿ç”¨ æ­£æ€åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°å’Œç¬¦åˆè¯¥åˆ†å¸ƒçš„éšæœºå˜é‡çš„å‡å€¼å’Œæ–¹å·®æœ‰å…³ N(xâˆ£Î¼,Ïƒ2)=12Ï€Ïƒ2eâˆ’12Ïƒ2(xâˆ’Î¼)2N(x|\\mu,\\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}}e^{-\\frac{1}{2\\sigma^2}(x-\\mu)^2}N(xâˆ£Î¼,Ïƒ2)=2Ï€Ïƒ2â€‹1â€‹eâˆ’2Ïƒ21â€‹(xâˆ’Î¼)2 å¯ä»¥æ‹“å±•ä¸ºå¤šå…ƒå˜é‡çš„æ­£æ€åˆ†å¸ƒï¼Œå°†å‡å€¼ä¿®æ”¹ä¸ºå¤šå…ƒå˜é‡çš„æ•°å­¦æœŸæœ›ï¼Œæ–¹å·®ä¿®æ”¹ä¸ºå¤šå…ƒå˜é‡çš„åæ–¹å·® æ³Šæ¾åˆ†å¸ƒï¼šå¯¹äºŒé¡¹åˆ†å¸ƒçš„è¿ç»­è¿‘ä¼¼ï¼Œåœ¨äºŒé¡¹åˆ†å¸ƒçš„å®éªŒæ¬¡æ•°nå¾ˆå¤§ï¼Œå•æ¬¡æ¦‚ç‡på¾ˆå°æ—¶ï¼ŒäºŒé¡¹åˆ†å¸ƒå¯è¢«è¿‘ä¼¼ä¸ºæ³Šæ¾åˆ†å¸ƒã€‚ P(xâˆ£Î»)=eâˆ’Î»Î»xx!P(x|\\lambda) = e^{-\\lambda}\\frac{\\lambda^x}{x!}P(xâˆ£Î»)=eâˆ’Î»x!Î»xâ€‹, å…¶æ–¹å·®å’Œå‡å€¼éƒ½æ˜¯ Î» Student t åˆ†å¸ƒï¼šåŸºäºæ­£æ€åˆ†å¸ƒï¼Œä¸ºäº†å¢å¼ºå…¶æŠ—å¹²æ‰°æ€§è€Œæå‡ºçš„åˆ†å¸ƒï¼ŒåŠ å…¥ä¸€ä¸ªå‚æ•°vï¼š æ‹‰æ™®æ‹‰æ–¯åˆ†å¸ƒï¼ˆåŒæŒ‡æ•°åˆ†å¸ƒï¼‰ï¼šåœ¨å‡å€¼çš„ä¸¤ä¾§ï¼Œå‘ˆç°å¯¹ç§°åˆ†å¸ƒè§„å¾‹çš„ä¸€ç§ æŒ‡æ•°åˆ†å¸ƒ å˜ç§ Lap(xâˆ£Î¼,b)=12beâˆ’âˆ£xâˆ’Î¼âˆ£bLap(x|\\mu,b) = \\frac{1}{2b}e^{-\\frac{|x-\\mu|}{b}}Lap(xâˆ£Î¼,b)=2b1â€‹eâˆ’bâˆ£xâˆ’Î¼âˆ£â€‹ï¼Œå…¶å‡å€¼ä¸º Î¼\\muÎ¼ï¼Œæ–¹å·®ä¸º 2b22b^22b2 ä¼½é©¬åˆ†å¸ƒï¼šå¯¹æ­£å®æ•°åŸŸä¸Šçš„éšæœºå˜é‡å»ºæ¨¡çš„åˆ†å¸ƒï¼Œæ˜¯å¤šä¸ªç‹¬ç«‹åŒåˆ†å¸ƒçš„æŒ‡æ•°åˆ†å¸ƒå˜é‡ å’Œ çš„åˆ†å¸ƒ Gamma(xâˆ£a,b)=baÎ³(a)xaâˆ’1eâˆ’xbGamma(x|a,b) = \\frac{b^a}{\\gamma(a)}x^{a-1}e^{-xb}Gamma(xâˆ£a,b)=Î³(a)baâ€‹xaâˆ’1eâˆ’xbï¼Œå…¶ä¸­Î³(a)æ˜¯ä¼½é©¬å‡½æ•°ï¼š\\gamma(a) = \\int_0^\\inf t^{a-1}e^{-t}dt å‚æ•°aè¢«ç§°ä¸ºshapeï¼Œbè¢«ç§°ä¸ºrateï¼Œè¯¥åˆ†å¸ƒå‡å€¼ä¸º ab\\frac{a}{b}baâ€‹ï¼Œæ–¹å·®ä¸ºab2\\frac{a}{b^2}b2aâ€‹ è´å¡”åˆ†å¸ƒï¼šå¯¹[0,1]åŒºé—´ä¸Šå–å€¼çš„éšæœºå˜é‡å»ºæ¨¡çš„åˆ†å¸ƒ Beta(x,âˆ£a,b)=1Î²(a,b)xaâˆ’1(1âˆ’x)bâˆ’1Beta(x,|a,b) = \\frac{1}{\\beta(a,b)}x^{a-1}(1-x)^{b-1}Beta(x,âˆ£a,b)=Î²(a,b)1â€‹xaâˆ’1(1âˆ’x)bâˆ’1,å…¶ä¸­ Î²(a,b)\\beta(a,b)Î²(a,b)æ˜¯è´å¡”å‡½æ•°ï¼Œå®ƒåªæ˜¯ä¸ºäº†ä½¿å¾—è¿™ä¸ªåˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦ç§¯åˆ†ç­‰äº1æ‰åŠ ä¸Šçš„ã€‚ ç‹„åˆ©å…‹é›·åˆ†å¸ƒï¼šå°†è´å¡”åˆ†å¸ƒæ‹“å±•åˆ°å¤šå…ƒå˜é‡çš„æ³›åŒ– ã€åˆ†å¸ƒçš„å˜æ¢ã€‘ è‹¥åˆ†å¸ƒYå¯ä»¥ç”±æœä»åˆ†å¸ƒXçš„éšæœºå˜é‡ï¼Œå°†æ¯ä¸ªå–å€¼ç”¨ç¦»æ•£æˆ–è¿ç»­çš„å‡½æ•°få˜æ¢å¾—åˆ°ï¼Œé‚£ä¹ˆåˆ†å¸ƒYçš„å‡å€¼å’Œæ–¹å·®ä¼šéµå¾ªä»¥ä¸‹å…¬å¼ çº¿æ€§å˜æ¢ï¼š é€šç”¨å˜æ¢ï¼š ç¦»æ•£å˜é‡ï¼š py(y)=âˆ‘x:f(x)=ypx(x)p_y(y)=\\sum_{x:f(x)=y}p_x(x)pyâ€‹(y)=âˆ‘x:f(x)=yâ€‹pxâ€‹(x) è¿ç»­å˜é‡ï¼š py(y)=px(x)âˆ£dxdyâˆ£p_y(y)=p_x(x)|\\frac{dx}{dy}|pyâ€‹(y)=pxâ€‹(x)âˆ£dydxâ€‹âˆ£ å…¶ä»–é‡è¦æ¦‚å¿µ å¤§æ•°å®šå¾‹ï¼šéšç€æ ·æœ¬è§„æ¨¡çš„å¢åŠ ï¼Œæ ·æœ¬å‡å€¼å¯¹æ€»ä½“å‡å€¼çš„ä¼°è®¡è¶Šå‡†ç¡®ã€‚ ä¸­å¿ƒä¸å˜å®šç†ï¼šå¤šä¸ªéšæœºå˜é‡æ ·æœ¬çš„å‡å€¼åˆ†å¸ƒï¼ˆéšæœºå˜é‡å’Œçš„åˆ†å¸ƒï¼‰å°†è¿‘ä¼¼äºé«˜æ–¯åˆ†å¸ƒã€‚ è’™ç‰¹å¡æ´›è¿‘ä¼¼ï¼šå¦‚æœæŸéšæœºå˜é‡Xçš„åˆ†å¸ƒæœªçŸ¥ï¼Œä½†å¯ä»¥å¯¹å…¶è¿›è¡ŒæŠ½æ ·æ¥å®éªŒï¼Œåˆ™å¯ä»¥ä½¿ç”¨ç»éªŒåˆ†å¸ƒæ¥è¿‘ä¼¼Xçš„åˆ†å¸ƒï¼š è¡¡é‡ä¸¤ä¸ªåˆ†å¸ƒçš„ç›¸ä¼¼åº¦ï¼ˆè·ç¦»ï¼‰ï¼šKLæ•£åº¦ å…ˆè¡¥å……ä¿¡æ¯è®ºçš„çŸ¥è¯†ï¼šä¿¡æ¯ç†µ ä¿¡æ¯ç†µå¯ä»¥æè¿°éšæœºå˜é‡Xåœ¨åˆ†å¸ƒPä¸Šçš„ä¸ç¡®å®šæ€§çš„ç¨‹åº¦ï¼šH(X)=âˆ’âˆ‘Kk=1p(X=k)log2p(X=k)H(X) = -\\sum_K^{k=1}p(X=k)log_2p(X=k)H(X)=âˆ’âˆ‘Kk=1â€‹p(X=k)log2â€‹p(X=k) å‡åŒ€åˆ†å¸ƒçš„ä¿¡æ¯ç†µæœ€å¤§ äº¤å‰ç†µï¼šå°†æœä»åˆ†å¸ƒPçš„å˜é‡è½¬æ¢åˆ°åˆ†å¸ƒQï¼Œéœ€è¦æä¾›é¢å¤–ä¿¡æ¯ï¼ˆbitsï¼‰çš„é‡ï¼Œå…¶ä¸­på’Œqä»£è¡¨På’ŒQçš„æ¦‚ç‡å¯†åº¦å‡½æ•° H(p,q)=âˆ’âˆ‘kpklogqkH(p,q) = -\\sum_{k}p_klogq_kH(p,q)=âˆ’âˆ‘kâ€‹pkâ€‹logqkâ€‹ KLæ•£åº¦ï¼šæè¿°ä¸¤ä¸ªåˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°på’Œqçš„ç›¸ä¼¼åº¦ï¼š KL(pâˆ£âˆ£q)=âˆ‘k=1Kpklogpkqk=âˆ’H(p)+H(p,q)KL(p||q) = \\sum_{k=1}^Kp_klog\\frac{p_k}{q_k}=-H(p)+H(p,q)KL(pâˆ£âˆ£q)=âˆ‘k=1Kâ€‹pkâ€‹logqkâ€‹pkâ€‹â€‹=âˆ’H(p)+H(p,q) äº’ä¿¡æ¯åº¦ï¼šè¡¡é‡ä¸¤ä¸ªåˆ†å¸ƒçš„å˜é‡ä¹‹é—´äº’ç›¸ä¾èµ–çš„ç¨‹åº¦ï¼š II(X;Y)=KL(p(X,Y)âˆ£âˆ£p(X)p(Y))Â =âˆ‘xâˆ‘yp(x,y)logp(x,y)p(x)p(y)=H(X)âˆ’H(Xâˆ£Y)=H(Y)âˆ’H(Yâˆ£X)II(X;Y) = KL(p(X,Y)||p(X)p(Y))\\ = \\sum_x\\sum_yp(x,y)log\\frac{p(x,y)}{p(x)p(y)}\\\\=H(X)-H(X|Y)=H(Y)-H(Y|X)II(X;Y)=KL(p(X,Y)âˆ£âˆ£p(X)p(Y))Â =âˆ‘xâ€‹âˆ‘yâ€‹p(x,y)logp(x)p(y)p(x,y)â€‹=H(X)âˆ’H(Xâˆ£Y)=H(Y)âˆ’H(Yâˆ£X)","tags":["ç”Ÿæˆæ¨¡å‹","ç¬”è®°"]},{"title":"Test Article","path":"/2023/10/28/Test-Article/","content":"Hello world! Hi there! å¦‚æœä½ çœ‹åˆ°è¿™ä¸ªï¼Œè¯´æ˜è¿™ä¸ªåšå®¢æ¡†æ¶ä¼¼ä¹è¿è¡Œæ­£å¸¸ã€‚ This marks the blog is running well. ä¸‹é¢çš„éƒ¨åˆ†ç”¨äºæµ‹è¯•hexoå’Œstellarä¸»é¢˜æ‰©å±•çš„ç›¸å…³åŠŸèƒ½ï¼Œè¯·å¿½ç•¥å…¶ä¸­çš„å†…å®¹ã€‚ è¡¨æƒ… è¡Œå†…æ–‡æœ¬ä¿®é¥° ç¾åŒ–æ–‡æœ¬æ ¼å¼ è¿™æ˜¯ ä½ çŸ¥é“çš„å¤ªå¤šäº† éšè—æ ‡ç­¾ è¿™æ˜¯ ä¸‹åˆ’çº¿ æ ‡ç­¾ è¿™æ˜¯ ç€é‡å· æ ‡ç­¾ è¿™æ˜¯ æ³¢æµªçº¿ æ ‡ç­¾ è¿™æ˜¯ åˆ é™¤çº¿ æ ‡ç­¾ è¿™æ˜¯ X2 ä¸Šæ ‡æ ‡ç­¾ è¿™æ˜¯ X2 ä¸‹æ ‡æ ‡ç­¾ è¿™æ˜¯ é”®ç›˜æ ·å¼ æ ‡ç­¾ï¼Œè¯•ä¸€è¯•ï¼šCtrl + D mark æ ‡è®° è¿™æ˜¯å½©è‰²æ ‡è®°ï¼šé»˜è®¤ çº¢ æ©™ é»„ ç»¿ é’ è“ ç´« è¿™æ˜¯åº•è‰²æ ‡è®°ï¼šæµ… æ·± è¿™æ˜¯ç‰¹æ®Šæ ‡è®°ï¼š è­¦å‘Š é”™è¯¯ ä¸€å…± 12 ç§é¢œè‰²ã€‚ tagæ ‡ç­¾ å’Œmarkç±»ä¼¼ï¼Œä½†æ˜¯å¯ä»¥é«˜äº®å’Œæ·»åŠ é“¾æ¥ï¼Œä½¿ç”¨å±æ€§coloræŒ‡å®šé¢œè‰²ï¼Œä¸æŒ‡å®šä¸ºéšæœº Stellar Hexo MyGitHub ä½¿ç”¨æ ‡ç­¾æ’å…¥å›¾ç‰‡ è¿™å°†æ¯”ä½¿ç”¨é»˜è®¤markdownæ ¼å¼æ’å…¥å›¾ç‰‡è¦å¥½ src: å›¾ç‰‡åœ°å€ description: å›¾ç‰‡æè¿° width:å’Œpadding:å¯ä»¥å¯¹ä¸åŒçš„å°ºå¯¸åšé€‚åº” bg:å¯ä»¥æ·»åŠ èƒŒæ™¯é¢œè‰²ï¼Œä½¿ç”¨bg:var(â€“card)ä½¿å¾—èƒŒæ™¯é¢œè‰²é€‚é…å…¨å±€é…è‰² download: è®¾ç½®ä¸ºtrueå¯ä»¥å¢åŠ ä¸€ä¸ªä¸‹è½½å›¾ç‰‡çš„æŒ‰é’®ï¼Œä½†è¿™åªä¼šä»srcä¸­ä¸‹è½½å›¾ç‰‡ï¼Œå¦‚æœï¼ˆå¯¹äºå¤§å›¾ï¼‰å›¾ç‰‡çš„ä¸‹è½½åœ°å€å’Œsrcçš„é¢„è§ˆåœ°å€ä¸åŒï¼Œå¯ä»¥å°†ä¸‹è½½åœ°å€å†™åœ¨è¿™é‡Œ ç‚¹å‡»æ”¾å¤§åŠŸèƒ½ï¼šåœ¨ä»»æ„ image æ ‡ç­¾ä¸­å¢åŠ  fancybox:true å‚æ•°å³å¯ä¸ºç‰¹å®šå›¾ç‰‡å¼€å¯ç¼©æ”¾åŠŸèƒ½ 1&#123;% image src [description] [download:bool/string] [width:px] [padding:px] [bg:hex] %&#125; ç‚¹å‡»ä¸‹è½½ä½ å¯ä»¥è·å¾—å¦ä¸€å¼ æ¥è‡ªAppleçš„å›¾ç‰‡ æ–‡æœ¬ç¾åŒ–å— ç¾åŒ–çš„å¼•ç”¨ é€‚åˆå±…ä¸­ä¸”é†’ç›®çš„å¼•ç”¨ï¼šè¿™å¥è¯ä¸æ˜¯æˆ‘è¯´çš„ â€”â€”é²è¿… æ”¯æŒè‡ªå®šä¹‰å¼•å·ï¼šè¯é¢˜001 è¯—è¯æ–‡æœ¬å±•ç¤º æ¸¸å±±è¥¿æ‘é™†æ¸¸è«ç¬‘å†œå®¶è…Šé…’æµ‘ï¼Œä¸°å¹´ç•™å®¢è¶³é¸¡è±šã€‚å±±é‡æ°´å¤ç–‘æ— è·¯ï¼ŒæŸ³æš—èŠ±æ˜åˆä¸€æ‘ã€‚ç®«é¼“è¿½éšæ˜¥ç¤¾è¿‘ï¼Œè¡£å† ç®€æœ´å¤é£å­˜ã€‚ä»ä»Šè‹¥è®¸é—²ä¹˜æœˆï¼Œæ‹„æ–æ— æ—¶å¤œå©é—¨ã€‚è¯—è¯èŠ‚é€‰ å¤‡æ³¨å— æ­£å¼å†…å®¹ä¸­ï¼Œç¬¬ä¸€ä¸ªç©ºæ ¼å‰é¢çš„æ˜¯æ ‡é¢˜ï¼Œåé¢çš„æ˜¯æ­£æ–‡ã€‚å¦‚æœæ ‡é¢˜ä¸­éœ€è¦æ˜¾ç¤ºç©ºæ ¼ï¼Œè¯·ä½¿ç”¨&amp;nbsp;ä»£æ›¿ã€‚ æ— è‰²å¤‡æ³¨å—ï¼šå’Œä»£ç å—ä¸€æ ·çš„å±•ç¤ºæ–¹å¼ ä½ &nbsp;æ ‡é¢˜&nbsp;ä¸­æœ‰&nbsp;ç©º&nbsp;æ ¼æ­£æ–‡éƒ¨åˆ†å¯ä»¥éšä¾¿ç©ºæ ¼ã€‚ å½©è‰²å¤‡æ³¨å—ï¼šä½¿ç”¨color:&lt;color&gt;è®¾ç½®èƒŒæ™¯é¢œè‰²ï¼Œé¢œè‰²æ ‡ç­¾å’Œè¡Œå†…æ–‡æœ¬ä¸€è‡´ å¯ç”¨é¢œè‰²ï¼šcolor = redã€orangeã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error åªä½¿ç”¨æ ‡é¢˜çš„å¤‡æ³¨å—ï¼Œä½¿å¾—æ–‡æœ¬é»˜è®¤åŠ ç²—ï¼š è¿™ä¸ªåªæœ‰æ ‡é¢˜ï¼Œæ²¡æœ‰æ­£æ–‡ã€‚ å¤–é“¾å¡ç‰‡ 12345&#123;% link href [title] [icon:src] [desc:true/false] %&#125;href: é“¾æ¥title: å¯é€‰ï¼Œæ‰‹åŠ¨è®¾ç½®æ ‡é¢˜ï¼ˆä¸ºç©ºæ—¶ä¼šè‡ªåŠ¨æŠ“å–é¡µé¢æ ‡é¢˜ï¼‰icon: å¯é€‰ï¼Œæ‰‹åŠ¨è®¾ç½®å›¾æ ‡ï¼ˆä¸ºç©ºæ—¶ä¼šè‡ªåŠ¨æŠ“å–é¡µé¢å›¾æ ‡ï¼‰desc: å¯é€‰ï¼Œæ˜¯å¦æ˜¾ç¤ºæ‘˜è¦æè¿°ï¼Œä¸ºtrueæ—¶å°†ä¼šæ˜¾ç¤ºé¡µé¢æè¿° https://www.bilibili.com/video/BV1ic411R77s/Nickbitçš„bilibiliæŠ•ç¨¿ mermaidä»£ç è¯­è¨€ç»˜å›¾ éœ€è¦å®‰è£…æ’ä»¶ï¼Œç›®å‰è¿˜æ²¡æœ‰æ”¯æŒ ä½¿ç”¨å‰éœ€è¦åœ¨ Markdown æ–‡ä»¶å¼€å¤´åŠ å…¥ 123---mermaid: true--- ç„¶åä½¿ç”¨ä»£ç å—ï¼Œåœ¨è¯­è¨€ä¸­æŒ‡å®šmermaidå³å¯ frameæ’å…¥ä¸€ä¸ªç§»åŠ¨è®¾å¤‡UIæ¡†æ¶ å¯ç”¨æ’é€‰æ‹©å‚æ•°imgï¼ˆå›¾ç‰‡ï¼‰å’Œvideoï¼ˆè§†é¢‘ï¼‰ iframeæ’å…¥è§†é¢‘ é™æ€æ—¶é—´çº¿ 2021 å¹´ 6 æœˆBTå¤å­£ç‰ˆbanner2021 å¹´ 2 æœˆè¿‡å¹´æ”¾å‡ å‹æƒ…é“¾æ¥ è¦ç°åœ¨source/_data/links.ymlä¸­åŠ å…¥é“¾æ¥çš„é™æ€æ•°æ®ï¼š 123456789101112&#x27;é“¾æ¥ç»„åç§°&#x27;: - title: æŸæŸæŸ url: https:// screenshot: avatar: description: - title: æŸæŸæŸ2 url: https:// screenshot: avatar: description: ... ç„¶åè¿™æ ·å†™ï¼š 1&#123;% friends é“¾æ¥ç»„åç§° %&#125; ä¸€ä¸ªé“¾æ¥ç»„å¯ä»¥æœ‰å¤šä¸ªé“¾æ¥ï¼Œå®ƒä»¬ä¼šè‡ªé€‚åº”æ’å¸ƒåˆ°é¡µé¢ã€‚ ç½‘ç«™å¡ç‰‡é“¾æ¥ åŒæ ·è¦å…ˆåœ¨source/_data/links.ymlä¸­åŠ å…¥é“¾æ¥çš„é™æ€æ•°æ®ï¼Œå†™æ³•å’Œå‹é“¾ä¸€æ ·ã€‚ å†™æ³•æ˜¯ï¼š 1&#123;% sites åˆ†ç»„å %&#125; 616.sbçº¯å‡€çš„éŸ³æ¸¸ä¸‹è½½ç«™BEMANICNBEMANICN è®ºå›BestdoriBanG Dream! èµ„æºåº“å’Œç¤¾åŒº github cardå¡ç‰‡ å¡«å†™githubä»“åº“çš„åç§°åç¼€å³å¯ å®¹å™¨æ ‡ç­¾ æ”¯æŒæ›´åŠ ä¸°å¯Œçš„åˆ†å—æ–‡æœ¬ï¼Œnoteç­‰æ ‡ç­¾æ˜¯ç”±å®¹å™¨æ ‡ç­¾ç®€åŒ–å®ç°çš„ã€‚ å®¹å™¨æ ‡ç­¾éœ€è¦å¤šè¡Œæ¥å†™ æ ‡å‡†å®¹å™¨å— è¿™æ˜¯æ ‡é¢˜è¿™æ˜¯å®¹å™¨å—ä¸­çš„å†…å®¹æ’å…¥ä¸€ä¸ªé“¾æ¥ï¼š#172 å¯æŠ˜å æ ‡é¢˜çš„å®¹å™¨å— å®¹å™¨å—ä¸­å¯ç”¨åµŒå¥—å…¶ä»–å—ï¼ŒåŒ…æ‹¬å¦ä¸€ä¸ªå®¹å™¨å—ã€‚ä½¿ç”¨childå±æ€§è®¾ç½®åµŒå…¥å—çš„å±æ€§ openå±æ€§è®¾ç½®å—æ˜¯å¦é»˜è®¤æ‰“å¼€ é»˜è®¤æ‰“å¼€çš„ä»£ç æŠ˜å æ¡†ä»£ç å— å¹³é“ºæŠ˜å åˆ—è¡¨å— #1è¿™æ˜¯ç­”æ¡ˆ1#2è¿™æ˜¯ç­”æ¡ˆ2#3è¿™æ˜¯ç­”æ¡ˆ3 åˆ†æ tabå®¹å™¨ æ–¹ä¾¿åœ°åˆ‡æ¢å±•ç¤ºçš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥åµŒå¥— å›¾ç‰‡ä»£ç å—è¡¨æ ¼12let x = 123print(&quot;hello world&quot;) a b c a1 b1 c1 a2 b2 c2 è½®æ’­å®¹å™¨ é€‚ç”¨äºè½®æ’­å›¾ç‰‡ï¼Œé»˜è®¤ä¸€å¼ å›¾ç‰‡æ˜¯ 50% å®½åº¦ï¼Œé€šè¿‡è®¾ç½® width:min è®¾ç½®ä¸º 25% å®½åº¦ï¼Œwidth:max è®¾ç½®ä¸º 100% å®½åº¦ã€‚ æ·»åŠ å‚è€ƒå¼•ç”¨åˆ—è¡¨ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š references: title: â€˜ä½¿ç”¨ Stellar ä¸»é¢˜çš„åšå®¢â€™ url: https://xaoxuu.com/wiki/stellar/examples/ title: â€˜Hexo Stellar å’Œ Next ä¸»é¢˜æ”¯æŒ KaTex å…¬å¼ä¸ Markdown å¤æ‚è¡¨æ ¼â€™ url: https://www.panoshu.top/blog/2c3f9e38/"},{"title":"2022å½±è§†æ¸¸è‰ºæ€»ç»“","path":"/2022/09/27/2022å½±è§†æ¸¸è‰ºæ€»ç»“/","content":"åç§° ç±»å‹ è¯„åˆ†ï¼ˆæ»¡åˆ†10åˆ†+é™„åŠ åˆ†2åˆ†ï¼‰ å¤‡æ³¨ ä¸‰è§’ç¬¦æ–‡ï¼ˆDeltaruneç¬¬äºŒç« ï¼‰ æ¸¸æˆ 10+2 JOJOçš„å¥‡å¦™å†’é™© çŸ³ä¹‹æµ·ï¼ˆä¸Šéƒ¨ï¼‰ åŠ¨æ¼« 9+1 å¸ˆçˆ¶ã€ŠSifuã€‹ æ¸¸æˆ 8 ã€ŠElden Ringã€‹è‰¾å°”ç™»æ³•ç¯ æ¸¸æˆ 9+0.5 å²ä¸¹åˆ©çš„å¯“è¨€ è¶…çº§è±ªåç‰ˆã€ŠThe Stanley Parable Ultra Deluxeã€‹ æ¸¸æˆ 9+1.5 ç¬æ¯å…¨å®‡å®™ã€ŠEverything.Everywhere.All.At.Onceã€‹ ç”µå½±/å‰§é›† 9+1.5 çˆ±ï¼Œæ­»äº¡å’Œæœºå™¨äºº ç¬¬ä¸‰å­£ã€ŠLove.Death.and.Robots.S03ã€‹ ç”µå½±/å‰§é›† 9 æ—ä¸­å°å¥³å·«ã€ŠLittle Witch in the Woodsã€‹ æ¸¸æˆ 7.5+1 è¯¡é‡è¥¿éƒ¨ã€ŠWeird Westã€‹ æ¸¸æˆ 6 æœªå®Œæ•´ä½“éªŒ å­¤å±±éš¾è¶Šã€ŠInsurmountableã€‹ æ¸¸æˆ 7 æœªå®Œæ•´ä½“éªŒ æ´¾å¯¹æµªå®¢è¯¸è‘›å­”æ˜ã€ŠParipi Koumeiã€‹ã€‹ åŠ¨æ¼« 8+1 é—´è°è¿‡å®¶å®¶ã€ŠSpy x Familyã€‹ åŠ¨æ¼« 9+0.5 è¿·å¤±ã€ŠStrayã€‹ æ¸¸æˆ 8.5+0.5 è‰å¯ä¸½ä¸ã€ŠLycoris Recoilã€‹ åŠ¨æ¼« 8.5+1 å“¥å¸ƒæ—å¼¹çƒã€ŠPeglinã€‹ æ¸¸æˆ 7+1 ç‹¬è¡Œæœˆçƒ ç”µå½±/å‰§é›† 5.5 Arcaea 4.0 æ¸¸æˆ 8+1 å’©å’©å¯ç¤ºå½•ã€ŠCult of the Lambã€‹ æ¸¸æˆ 7+0.5 æœªå®Œæ•´ä½“éªŒ æ±‰åŒ–æ—¥è®° ç¬¬ä¸‰å­£ åŠ¨æ¼« 7.5+1 JOJOçš„å¥‡å¦™å†’é™© çŸ³ä¹‹æµ· Part.2ï¼ˆä¸‹éƒ¨ï¼‰ åŠ¨æ¼« 8+0.5","tags":["æ€»ç»“","è¯„åˆ†è¡¨"]},{"title":"Nickbit's 2021å½±è§†æ¸¸è‰ºæ€»ç»“","path":"/2021/12/28/2021å½±è§†æ¸¸è‰ºæ€»ç»“/","content":"åç§° ç±»å‹ ä½“éªŒæ—¶é—´ï¼ˆä¼°è®¡ï¼‰ ä½“éªŒåœ°ç‚¹ è¯„åˆ†ï¼ˆæ»¡åˆ†10åˆ†+é™„åŠ åˆ†1åˆ†ï¼‰ å¤‡æ³¨ Alba: A Wildlife Adventure æ¸¸æˆ 2021.1 Home 7+1 è™½ç„¶ç©æ³•ã€å‰§æƒ…éƒ½å¾ˆç®€å•ï¼Œç”šè‡³è¯´ä½å¹¼ï¼Œä½†ä»è®©æˆ‘æ„Ÿåˆ°ååˆ†æ”¾æ¾ã€‚ å’’æœ¯å›æˆ˜ åŠ¨æ¼« 2021.1 Home 9+1 å¥‡è›‹ç‰©è¯­ åŠ¨æ¼« 2021.1 Home+å¯å®¤ 8+1 ç‰¹åˆ«ç¯‡æ˜¯6æœˆä»½åœ¨å¯å®¤çœ‹çš„ï¼Œè¯´å®è¯æ²¡çœ‹æ‡‚ã€‚ å”äººè¡—æ¢æ¡ˆ3 ç”µå½± 2021.1 ç”µå½±é™¢ 7 æ²¡å•¥æ„Ÿè§‰ ä½ å¥½ï¼Œæç„•è‹± ç”µå½± 2021.1 ç”µå½±é™¢ 8 åˆºæ€å°è¯´å®¶ ç”µå½± 2021.2 Home 6 äººæ½®æ±¹æ¶Œ ç”µå½± 2021.2 Home 8 æœ‰ç‚¹æ„Ÿè§‰ åˆºå®¢äº”å…­ä¸ƒï¼ˆç¬¬ä¸‰å­£ï¼‰ åŠ¨æ¼« 2021.4 å¯å®¤ 8+1 æ±‰åŒ–æ—¥è®°ï¼ˆç¬¬äºŒå­£ï¼‰ åŠ¨æ¼« 2021.1 Home 8+1 ã€Šç©æ¢—ç‹è€…ã€‹ å·¥ä½œç»†èƒï¼ˆç¬¬äºŒå­£ï¼‰ åŠ¨æ¼« 2021.2 Home 8+1 æˆ‘çš„ä¸‰ä½“ å¼ åŒ—æµ·ä¼  åŠ¨æ¼« 2021.1 Home 9+1 å‰è¿›å››ï¼ The Unfinished Swanæœªå®Œæˆçš„å¤©é¹… æ¸¸æˆ 2021.2 Home 8+0.5 å¾ˆç¥ï¼Œä½†æ˜¯å¾ˆéš¾è¯´å‡ºæ¥åœ¨å“ªé‡Œ Spiritfarer çµé­‚æ‘†æ¸¡äºº æ¸¸æˆ 2021.2 Home 8.5+1 æ­»äº¡æ•™è‚²å–œ+1 æˆ´æ£®çƒè®¡åˆ’ æ¸¸æˆ 2021.2 Home 10+1 æˆ´æ£®çƒï¼ŒYYDSï¼ åŒäººæˆè¡Œ æ¸¸æˆ 2021.3 å¯å®¤ 10+1 GOTYï¼ èŠ‚å¥åŒ»ç”Ÿ æ¸¸æˆ 2021.2 Home+å¯å®¤ 10+1 ä¸€äºŒä¸‰å››äº”å…­ä¸ƒï¼ æ ¸èšå˜2021åŒ—äº¬ç«™ å±•ä¼š 2021.5 äº¦åˆ›å›½é™…ä¼šå±•ä¸­å¿ƒ 9 äººäººäººä»ä»ä»ä¼—ä¼—ä¼— å¯»æ‰¾æç™½ è¯å‰§ 2021.5 ç§‘å­¦ä¼šå ‚ 8.5 ã€Šä¸­è½´çº¿ã€‹ ä¹¦ç± 2021.5 å¯å®¤ 8 å†²åŠ¨æ¶ˆè´¹çš„ç»˜æœ¬ç«Ÿæˆä¸ºä»Šå¹´å”¯ä¸€çº¸è´¨é˜…è¯»å…¥è´¦ï¼Œå •è½å•Šï¼ çˆ±ï¼Œæ­»äº¡å’Œæœºå™¨äºº(ç¬¬äºŒå­£) å‰§é›† 2021.5 å¯å®¤ 7+0.5 å¹´åº•æƒ³æ¥ï¼Œåªè®°å¾—å†°é¢äº† çµç¬¼ï¼ˆä¸‹åŠéƒ¨åˆ†åŠç»ˆç« ï¼‰ åŠ¨æ¼« 2021.5 å¯å®¤ 6.5+0.5 æ˜Ÿéœ²è°·ç‰©è¯­ æ¸¸æˆ 2021.8 å¯å®¤ ã€æœªå®Œæ•´ä½“éªŒã€‘ ä½†æ˜¯çœŸçš„å¤ªä¸Šå¤´äº† éœ“è™¹æ·±æ¸Š æ¸¸æˆ 2021.7 å¯å®¤ ã€æœªå®Œæ•´ä½“éªŒã€‘ Lacuna æ¸¸æˆ 2021.9 å¯å®¤ 7.5+0.5 éŸ³ä¹å¥½å¬ å°æ—å®¶çš„é¾™å¥³ä»†S åŠ¨æ¼« 2021.10 å¯å®¤ 9.5+1 å°æ—ç”¨çš„pythonï¼Œæ‰˜å„¿ä»–çˆ¸è¯´pythonæ˜¯é¾™æ—çš„è¯­è¨€ï¼šæ‡‚äº†ï¼Œpythonå¤©ä¸‹ç¬¬ä¸€ï¼ï¼ˆ ç‘å…‹å’Œè«è’‚ï¼ˆç¬¬äº”å­£ï¼‰ å‰§é›† 2021.10 å¯å®¤ 10+1 è¶Šæ¥è¶Šè´¹è„‘å­äº† ç©ºæ´éª‘å£« æ¸¸æˆ 2021.10 å·¥ä½+å¯å®¤ ã€æœªå®Œæ•´ä½“éªŒã€‘ å‰åŠéƒ¨åˆ†æ˜¯çœŸæ»´åŠé€€ï¼Œä½†æ˜¯City of Tearsè¿˜æ˜¯è®©æˆ‘æœ‰ä¿¡å¿ƒæ‰“ä¸‹å»çš„ DELTARUNE (ç¬¬äºŒç« ) æ¸¸æˆ 2021.10 å¯å®¤ ã€æœªå®Œæ•´ä½“éªŒã€‘ ä¸­æ–‡ä¼°è®¡å·²ç»æœ‰äº†ï¼Œä½†æ˜¯ddläººä¼°è®¡è¦é¸½åˆ°æ˜å¹´ç©äº†ï¼ˆï¼‰ å½±å­å·¥å‚ æ¸¸æˆ 2021.10 å¯å®¤ 9+1 ç°å“¥ï¼Œæˆ‘çš„ç°å“¥ï¼ˆThe Great Wild Unknow å¾ªç¯ä¸­ï¼‰ å¤±æ§ç©å®¶ ç”µå½± 2021.10 ç”µå½±é™¢ 7.5 æ²™ä¸˜ ç”µå½± 2021.10 å¯å®¤ 8 æœ‰ç©ºå»çœ‹çœ‹åŸè‘— åŒåŸä¹‹æˆ˜ å‰§é›† 2021.11 å¯å®¤ 9+1 çœ‹ä¹‹å‰æ²¡æƒ³åˆ°è¿™ä¹ˆå¸… Inscryption é‚ªæ¶å†¥åˆ» æ¸¸æˆ 2021.11 å¯å®¤ 10+1 çœ‹çœ‹äººå®¶æ€ä¹ˆåšå¡ç‰Œæ¸¸æˆçš„ï¼ å…‰æ˜è®°å¿†ï¼šæ— é™ æ¸¸æˆ 2021.11 å¯å®¤ 7 JOJOçš„å¥‡å¦™å†’é™©ï¼šçŸ³ä¹‹æµ· åŠ¨æ¼« 2021.12 å¯å®¤ 9+1","tags":["æ€»ç»“","è¯„åˆ†è¡¨"]},{"title":"ä½¿ç”¨Springå’ŒJPAæ„å»ºRESTè§„èŒƒçš„åç«¯APIé¡¹ç›®","path":"/2021/09/19/ä½¿ç”¨Springå’ŒJPAæ„å»ºRESTè§„èŒƒçš„åç«¯APIé¡¹ç›®/","content":"å…³äºå¦‚ä½•ä½¿ç”¨Springå’ŒJPAçš„å…¥é—¨æ•™ç¨‹ æ³¨æ„ï¼šè¯¥æ–‡æ¡£æœ€åˆåˆ›å»ºäºSep 19, 2021ï¼Œå¯èƒ½å­˜åœ¨å·²è¿‡æ—¶çš„å†…å®¹ï¼Œä»…ä¾›å‚è€ƒ å»ºç«‹Springé¡¹ç›® ä½¿ç”¨Spring Initializrï¼ˆSpringæä¾›çš„ä¾èµ–åŒ…ç”Ÿæˆç½‘ç«™ï¼‰ Dependenciesä¸­åŠ å…¥ä»¥ä¸‹ä¾èµ– Spring Web Spring Data JPA ä¸€ä¸ªæ•°æ®åº“é©±åŠ¨ï¼ˆä½¿ç”¨ä½ å–œæ¬¢çš„æ•°æ®åº“é©±åŠ¨ï¼Œæ¯”å¦‚MySQL Driverï¼‰ è®¾ç½®å¥½ä»¥åï¼Œç‚¹å‡»Generate Projectï¼Œå°±å¯ä»¥ä¸‹è½½åˆ°å¯¹åº”çš„zipæ ¼å¼çš„ç©ºé¡¹ç›®åŒ… åœ¨IDEä¸­å¯ä»¥ä½¿ç”¨Mavenç®¡ç†é¡¹ç›®åŒ…ï¼ˆå»ºç«‹Mavené¡¹ç›®ï¼‰ï¼Œåªè¦æŠŠå¯¹åº”çš„åŒ…ç‰ˆæœ¬æŒ‰ç…§xmlçš„æ ¼å¼å†™åˆ°é¡¹ç›®æ ¹ç›®å½•çš„pom.xmlä¸­å°±å¯ä»¥äº† 12345678910111213141516&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.5.4&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; ...... &lt;dependencies&gt; &lt;dependency&gt; *æ·»åŠ ä½ çš„ä¾èµ–åŒ…* &lt;/dependency&gt; é…ç½®ç¨‹åºä¸»å…¥å£ ä¸€èˆ¬æ¥è¯´ï¼Œä¸»å…¥å£æ–‡ä»¶éƒ½å‘½åä¸ºXXXAplication.javaï¼Œæ ¼å¼å¦‚ä¸‹ 12345678910import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;@SpringBootApplicationpublic class YourApplication &#123; public static void main(String... args) &#123; SpringApplication.run(YourApplication.class, args); &#125;&#125; å…¶ä¸­@SpringBootApplicationæ ‡è¯†æœåŠ¡ç«¯çš„å…¥å£ç±»ï¼ŒSpringApplication.run(YourApplication.class, args)ä½¿ç”¨SpringBootå¯åŠ¨æœåŠ¡ï¼Œä¸€åˆ‡é…ç½®éƒ½ç”±å…¶è‡ªåŠ¨å®Œæˆã€‚ ä½¿ç”¨JPAé“¾æ¥æ¨¡å‹ç±»å’Œæ•°æ®åº“ JPAä½¿ç”¨ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¥æ–¹ä¾¿æˆ‘ä»¬ç”¨ä»£ç é“¾æ¥æ•°æ®åº“ï¼Œç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªç±»å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ï¼Œç±»ä¸­çš„æˆå‘˜å¯¹åº”è¡¨ä¸­çš„å±æ€§ï¼Œå½“ç±»æˆå‘˜çš„å€¼å˜åŒ–æ—¶ï¼Œè®©JPAè‡ªåŠ¨åŒæ­¥æ•°æ®è¡¨ä¸­çš„å€¼ã€‚è¿™æ ·çš„ç±»ä¸€èˆ¬ç§°ä¸ºæ¨¡å‹ç±»ï¼ˆMVCä¸­çš„Modelï¼‰æˆ–å®ä½“ç±»ï¼Œå¯ä»¥å­˜æ”¾ä¸€äº›åŸºç¡€æ•°æ®ï¼ˆæ¯”å¦‚ç”¨æˆ·ç±»Userï¼‰ è¯­æ³•è¯´æ˜ å¯¼å…¥å‘½åç©ºé—´ï¼š 123import javax.persistence.Entity;import javax.persistence.GeneratedValue;import javax.persistence.Id; 1234@Entityclass User&#123;\t...&#125; @Entity æ³¨è§£ï¼Œå†™åœ¨ç±»å‰é¢ï¼Œå£°æ˜JPAæ‰˜ç®¡è¯¥ç±» 123@Id @GeneratedValueprivate int id; @Id å’Œ @GeneratedValueï¼šæ³¨è§£ï¼Œå†™åœ¨ç±»æˆå‘˜å˜é‡å‰é¢ï¼Œå£°æ˜è¯¥å˜é‡åœ¨æ•°æ®è¡¨ä¸­æ‰€å¯¹åº”çš„å±æ€§æ˜¯ä¸»å…³é”®å­—ï¼ˆPKï¼‰ å…¶ä¸­@GeneratedValueæ³¨è§£å‘JPAå£°æ˜ä¸»å…³é”®å­—çš„ç”Ÿæˆç­–ç•¥ 123456@Id @GeneratedValueprivate long id;private String email; private String username; å¯¹äºéä¸»å…³é”®å­—çš„å±æ€§ï¼ŒJPAä¼šè‡ªåŠ¨ä»¥ç±»æˆå‘˜å˜é‡çš„å‘½åï¼Œç”Ÿæˆå¯¹åº”çš„å±æ€§åï¼Œæ— éœ€å†åŠ å…¥æ³¨è§£ã€‚ 12345User() &#123;&#125;User(String email,String username) &#123;\tthis.email = eamil;\tthis.username = username;&#125; æœ‰å‚æ„é€ å‡½æ•°ç”¨æ¥åˆ›å»ºæ²¡æœ‰æŒ‡å®šidï¼ˆä¸»å…³é”®å­—ï¼‰çš„å®ä¾‹ é…ç½®æ•°æ®åº“çš„åŠ è½½ JPAå¯¹ç±»æ•°æ®çš„æ“ä½œï¼Œéƒ½æ˜¯é€šè¿‡è‡ªå®šä¹‰ä¸€ä¸ªæ–°çš„æ¥å£å®ç°çš„ã€‚ å»ºç«‹ä¸€ä¸ªæ–°æ¥å£ï¼Œç»§æ‰¿JpaRepositoryæ¥å£ï¼š 12345import org.springframework.data.jpa.repository.JpaRepository;interface UserRepository extends JpaRepository&lt;User, long&gt; &#123;\t...&#125; å…¶ä¸­ï¼Œæ³›å‹å‚æ•°&lt;User, long&gt;åˆ†åˆ«æŒ‡JPAæ‰€é“¾æ¥çš„ç±»çš„ç±»å‹å’Œå…¶ä¸»å…³é”®å­—çš„ç±»å‹. æ¥å£ç±»ä¸­å¯ä»¥è‡ªå®šä¹‰å¢åˆ æ”¹æŸ¥å‡½æ•°ï¼Œå¦‚ï¼š 1234// è¿”å›ä¸€ä¸ªå¯¹è±¡User findByUsername(String username);// æ ¹æ®pageableå‚æ•°è¿”å›åˆ†é¡µå¯¹è±¡ï¼ˆä¸€é¡µçš„å†…å®¹ï¼‰Page&lt;User&gt; findAllBy(Pageable pageable); å…¶ä¸­ï¼ŒfindByXXXXXå‡½æ•°ï¼ŒSpringå¯ä»¥æ ¹æ®â€œXXXXXâ€çš„å‘½åï¼Œè‡ªåŠ¨å¯¹åº”æ¨¡å‹ç±»ä¸­åŒåï¼ˆé™¤äº†ä¸»é”®ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼‰çš„æ•°æ®å˜é‡ï¼Œå¸®åŠ©ä½ å®ç°æŸ¥æ‰¾å‡½æ•°ã€‚å³ç¨‹åºå‘˜åªéœ€å£°æ˜è¯¥å‡½æ•°ï¼Œå¹¶å†™å¯¹å‚æ•°å’Œè¿”å›ç±»å‹ã€‚ findAllByè¿”å›ä¸€ä¸ªåˆ†é¡µç±»å‹çš„æ‰€æœ‰æ•°æ®æˆå‘˜ã€‚ ç„¶åï¼Œå»ºç«‹ä¸€ä¸ªé…ç½®ç±»ï¼Œå‘Šè¯‰Spring BootåŠ è½½æ¥å£å¯¹åº”æ•°æ®ç±»ï¼š 12345678910111213import ...@Configuration public class Initialize &#123; @Bean CommandLineRunner init(UserRepository userRepository, ...) &#123; return args -&gt; &#123; userRepository.save(new User()...) &#125;; &#125; å…¶ä¸­ï¼š @Configurationæ ‡è¯†ç±»æ˜¯ç”¨æ¥é…ç½®Spring Bootçš„åŠ è½½é¡¹çš„ @Beanæ ‡è¯†å¯¹è±¡æ˜¯ä¸€ä¸ªSpring Bean CommandLineRunneræ¥å£ï¼šå®ç°è¯¥æ¥å£çš„æ‰€æœ‰Beanéƒ½ä¼šåœ¨å¯åŠ¨Spirng Bootæ—¶è¢«åŠ è½½ã€‚å…¶ä¸­ä¼ å…¥çš„å‚æ•°å³ä¸ºJpaRepositoryç±»å‹çš„è‡ªå®šä¹‰æ¥å£å¯¹è±¡ï¼ˆå¯ä»¥æœ‰å¤šä¸ªï¼Œå¯¹åº”å¤šä¸ªæ•°æ®è¡¨ï¼‰ï¼Œé€šè¿‡è¿™äº›å¯¹è±¡ï¼Œå³å¯ä»¥åœ¨æœåŠ¡åŠ è½½æ—¶åˆå§‹åŒ–æ•°æ®åº“ä¸­å†…å®¹ã€‚ åœ¨è¿”å›çš„åŒ¿åå‡½æ•°å†…ç”¨JpaRepositoryå¯¹è±¡å¯¹æ•°æ®è¡¨è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼š ä½¿ç”¨xxxRepository.findByXXXX()å‡½æ•°ï¼ŒæŸ¥æ‰¾æ•°æ®è¡¨çš„æ¡ç›®ï¼ˆå‰æï¼šç°åœ¨æ¥å£ç±»ä¸­å®šä¹‰å¯¹åº”çš„å‡½æ•°ï¼‰ ä½¿ç”¨xxxRepository.save()å‡½æ•°ï¼Œä¿®æ”¹å¹¶ä¿å­˜å¯¹åº”repositoryå¯¹åº”çš„æ¨¡å‹ç±»çš„æˆå‘˜æ•°æ®ï¼ŒåŒæ—¶JPAä¼šåŒæ­¥æ›´æ–°æ•°æ®åº“çš„å†…å®¹ æ³¨æ„ï¼šå¦‚æœè¦æ“ä½œæ¨¡å‹ç±»å¯¹è±¡ï¼Œä½¿ç”¨å…¶getterå’Œsetterå‡½æ•°ï¼Œå¦‚ 12345User user = userRepository.findByUsername(&quot;wht&quot;)String _info = user.getInfo();userRepository.save(new User().setUsername(&quot;admin&quot;) .setInfo(_info)) åœ¨æ¨¡å‹ç±»ä¸­ï¼Œæ³¨æ„å°è£…å¥½å„ä¸ªæˆå‘˜å˜é‡çš„getterå’Œsetterå‡½æ•° å®ç°HTTPæ§åˆ¶æ¨¡å— å»ºç«‹ä¸€ä¸ªæ–°ç±»ï¼Œç”¨æ¥å¤„ç†å‰ç«¯è¯·æ±‚ï¼Œä¸ºäº†è®©Springè¯†åˆ«è¿™ä¸ªæ§åˆ¶ç±»ï¼Œåœ¨ç±»å‰åŠ å…¥æ³¨è§£@RestController åŠ å…¥è¿™äº›æ³¨è§£çš„ç›®çš„æ˜¯ä¸ºäº†æ ‡è®°ç±»ä¸ºä¸€ä¸ªSpirngçš„Beanï¼ŒSpring Bootå¸®æˆ‘ä»¬é…ç½®å¥½äº†æ‰«æå™¨ï¼Œå…¶ä¼šåœ¨å¯åŠ¨æ—¶æ‰«æå…¨éƒ¨å¸¦æœ‰@Componentæ³¨è§£çš„ç±»ï¼Œå°†å…¶æ³¨å†Œä¸º Spring Beanã€‚åªæœ‰è¿™æ ·ï¼ŒSpringæ‰ä¼šåœ¨æœ‰ç½‘ç»œè¯·æ±‚è¿›å…¥æ—¶ï¼Œé€šè¿‡RequestMappingå»ç´¢å¼• æ³¨å†Œè¿‡çš„ç»„ä»¶ç±» çš„ç›¸åº”å‡½æ•°ã€‚ @Componentæ ¹æ®ç±»çš„åŠŸèƒ½ä¸åŒï¼Œå…¶åˆåˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªå­æ³¨è§£ç±»å‹ï¼š @Controllerï¼šæ§åˆ¶å±‚ï¼Œæ ‡æ³¨è¿”å›å‰ç«¯çš„æ§åˆ¶ç»„ä»¶ @Serviceï¼šä¸šåŠ¡é€»è¾‘å±‚ï¼Œæ ‡æ³¨ä¸­é—´å±‚çš„æ§åˆ¶ç»„ä»¶ @Repositoryï¼šDAOå±‚ï¼Œæ ‡æ³¨æ•°æ®åº“è®¿é—®çš„ç»„ä»¶ è€Œ@RestControlleræ˜¯@Controllerçš„ä¸€ä¸ªå‡çº§ç‰ˆï¼Œå…¶ç›¸å½“äº@Controller + @ResponseBodyï¼Œå¯ä»¥æ”¯æŒè¿”å›jsonæ ¼å¼çš„æ•°æ®ç»™å‰ç«¯ã€‚åœ¨RESTæ¨¡å¼è®¾è®¡çš„æœåŠ¡ä¸Šï¼Œåº”è¯¥ä½¿ç”¨@RestController åœ¨æ§åˆ¶ç±»ä¸­ï¼Œåœ¨å‡½æ•°å‰åŠ å…¥æ³¨è§£@RequestMapping(&#123;urlåœ°å€&#125;)ï¼Œå®ç°è·¯ç”±çš„ä½œç”¨ï¼Œå³ç”¨ URLè¯·æ±‚çš„åœ°å€ å¯¹åº” æ§åˆ¶ç±»è°ƒç”¨ç›¸åº”çš„å‡½æ•° æ ¹æ®RESTè§„èŒƒï¼Œè¯·æ±‚çš„ç±»å‹å¯ä»¥åˆ†ä¸º GET/POST/PUT/DELETEï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å­æ³¨è§£ï¼š @GetMapping(&quot;url&quot;) @PostMapping(&quot;url&quot;) @PutMapping(&quot;url&quot;) @DeleteMapping(&quot;url&quot;) 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768// EmployeeController.javaimport java.util.List;// å¯¼å…¥RequestMappingä½¿ç”¨çš„å‘½åç©ºé—´import org.springframework.web.bind.annotation.DeleteMapping;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.PutMapping;import org.springframework.web.bind.annotation.RequestBody;import org.springframework.web.bind.annotation.RestController;@RestControllerclass EmployeeController &#123; // å¼•ç”¨æ¥å£æœåŠ¡ï¼Œç”¨æ¥å®ç°å„ç§åŠŸèƒ½ï¼Œè®°å¾—è¦ä½¿ç”¨finalé™æ€å˜é‡ // æ¯”å¦‚è¿™é‡Œä½¿ç”¨å®šä¹‰çš„JpaRepositoryæ¥å£å¯¹è±¡ï¼Œç”¨æ¥æ“ä½œæ•°æ®åº“ private final EmployeeRepository repository; EmployeeController(EmployeeRepository repository) &#123; this.repository = repository; &#125; // å¦‚æœç”¨æˆ·è¯·æ±‚GETï¼Œåœ°å€ä¸º/employeesï¼Œè°ƒç”¨è¯¥å‡½æ•° @GetMapping(&quot;/employees&quot;) List&lt;Employee&gt; all() &#123; return repository.findAll(); &#125; // å¦‚æœç”¨æˆ·è¯·æ±‚GETï¼Œåœ°å€ä¸º/employeesï¼Œè°ƒç”¨è¯¥å‡½æ•° @PostMapping(&quot;/employees&quot;) // @RequestBody ç”¨äºè¯»å–å‘æ¥çš„è¯·æ±‚ä¸­åŒ…å«çš„å‚æ•°æ•°æ®ï¼Œæ³¨æ„ä¿æŒç±»å‹ä¸€è‡´ Employee newEmployee(@RequestBody Employee newEmployee) &#123; return repository.save(newEmployee); &#125; @GetMapping(&quot;/employees/&#123;id&#125;&quot;) // @PathVariable ç”¨äºè¯»å–urlåœ°å€ä¸­åŒ…å«çš„å‚æ•°æ•°æ®ï¼Œç”¨&#123;&#125;åŒ…èµ·å‚æ•°å Employee one(@PathVariable Long id) &#123; return repository.findById(id).orElseThrow(() -&gt; new EmployeeNotFoundException(id)); &#125; // å¦‚æœç”¨æˆ·è¯·æ±‚PUTï¼ˆä¿®æ”¹ï¼‰ï¼Œåœ°å€ä¸º/employees/&#123;id&#125;ï¼Œè°ƒç”¨è¯¥å‡½æ•° @PutMapping(&quot;/employees/&#123;id&#125;&quot;) Employee replaceEmployee(@RequestBody Employee newEmployee, @PathVariable Long id) &#123; return repository.findById(id) .map(employee -&gt; &#123; employee.setName(newEmployee.getName()); employee.setRole(newEmployee.getRole()); return repository.save(employee); &#125;) .orElseGet(() -&gt; &#123; newEmployee.setId(id); return repository.save(newEmployee); &#125;); &#125; // å¦‚æœç”¨æˆ·è¯·æ±‚DELETEï¼ˆåˆ é™¤ï¼‰ï¼Œåœ°å€ä¸º/employees/&#123;id&#125;ï¼Œè°ƒç”¨è¯¥å‡½æ•° /employees/&#123;id&#125; @DeleteMapping(&quot;/employees/&#123;id&#125;&quot;) void deleteEmployee(@PathVariable Long id) &#123; repository.deleteById(id); &#125;&#125; å¼‚å¸¸å¤„ç† åœ¨æˆ‘ä»¬çš„åç«¯æœåŠ¡ä¸­ï¼Œä¸€æ—¦å‡ºç°å¼‚å¸¸ï¼Œå…‰è¿›è¡ŒJavaæœ¬èº«çš„å¼‚å¸¸å¤„ç†æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºè¿™æ ·å‰ç«¯æ”¶ä¸åˆ°å¯¹åº”çš„å¼‚å¸¸æ¶ˆæ¯ï¼Œæ²¡æœ‰åŠæ³•çŸ¥é“æ¥ä¸‹æ¥è¦å¹²ä»€ä¹ˆï¼ˆå‰ç«¯ï¼šä½ è¿™ä¸æ˜¯æ‘†çƒ‚å—è¿™æ˜¯ï¼‰ï¼Œå› æ­¤Springè¿˜æä¾›ExceptionHandleråå°„æœºåˆ¶ï¼Œå½“åç«¯äº§ç”Ÿå¼‚å¸¸æ—¶è¿”å›é”™è¯¯ä¿¡æ¯åˆ°å‰ç«¯ã€‚ ä¸»è¦æ­¥éª¤ å…ˆåˆ›å»ºè‡ªå·±çš„å¼‚å¸¸ç±»ï¼Œç»§æ‰¿RuntimeExceptionï¼Œå®šä¹‰ä¸€ç§å¼‚å¸¸ï¼Œå¦‚ï¼š XXXXException.java 1234567// EmployeeNotFoundException.javaclass EmployeeNotFoundException extends RuntimeException &#123; EmployeeNotFoundException(Long id) &#123; super(&quot;Could not find employee &quot; + id); &#125;&#125; æ³¨æ„ï¼Œè¿™ä¸ªå¼‚å¸¸ç±»åªæŠ›å‡ºåç«¯çš„é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®©Springè¿”å›å‰ç«¯ä¿¡æ¯ æ‰€ä»¥ï¼Œåœ¨è¯¥ç±»ä¸‹å†åˆ›å»ºä¸€ä¸ª XXXXAdvice.java 123456789101112131415161718192021// EmployeeNotFoundAdvice.java// å¯¼å…¥å‘½åç©ºé—´import org.springframework.http.HttpStatus;import org.springframework.web.bind.annotation.ControllerAdvice;import org.springframework.web.bind.annotation.ExceptionHandler;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.bind.annotation.ResponseStatus;@ControllerAdviceclass EmployeeNotFoundAdvice &#123; @ResponseBody // åå°„è‡ªå®šä¹‰å¼‚å¸¸ç±» @ExceptionHandler(EmployeeNotFoundException.class) // æ³¨è§£ï¼Œè¯´æ˜è¿”å›æ—¶å‘å‰ç«¯å›å¤é”™è¯¯çŠ¶æ€ç ï¼ˆHttpStatus.NOT_FOUND å³ 404ï¼‰ @ResponseStatus(HttpStatus.NOT_FOUND) String employeeNotFoundHandler(EmployeeNotFoundException ex) &#123;\t// è¿”å›çš„é”™è¯¯ä¿¡æ¯ return ex.getMessage(); &#125;&#125; å®šä¹‰XXXXAdviceç±»æ—¶ï¼Œä½¿ç”¨@ControllerAdviceæ³¨è§£ï¼Œå¹¶ä¸”åœ¨å…¶å¤„ç†å‡½æ•°ï¼ˆé€šå¸¸å‘½åä¸ºXXXXHandlerï¼‰å‰ï¼Œä½¿ç”¨@ResponseBodyã€@ExceptionHandlerã€@ResponseStatusï¼Œå®ƒä»¬çš„ä½œç”¨åˆ†åˆ«æ˜¯ï¼š æ³¨è§£ ä½œç”¨ @ResponseBody è¯´æ˜è¿”å›ç»™å‰ç«¯çš„æ¶ˆæ¯é‡‡ç”¨jsonæ ¼å¼ @ExceptionHandler è¯´æ˜è¿™æ˜¯ä¸€ä¸ªå¤„ç†å¼‚å¸¸çš„æ¶ˆæ¯ï¼ˆå‚æ•°å¡«å†™å¯¹åº”å¼‚å¸¸ç±»çš„åå°„ï¼‰ @ResponseStatus è¯´æ˜è¿”å›çš„HTTPçŠ¶æ€ç ï¼ˆå¯ä»¥ä½¿ç”¨HttpStatusæšä¸¾ï¼‰ DTOï¼ˆData Transfer Objectï¼‰æ”¯æŒ æ·»åŠ Spring HATEOAS åœ¨pom.xmlä¸­åŠ å…¥ä»¥ä¸‹ä¾èµ–éƒ¨åˆ†ä»£ç å³å¯ 1234&lt;dependency&gt;\t&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\t&lt;artifactId&gt;spring-boot-starter-hateoas&lt;/artifactId&gt;&lt;/dependency&gt; HATEOASæ˜¯Springä¸­ç”¨æ¥å®ç°é“¾æ¥ï¼ˆLinkï¼‰çš„å·¥å…·ï¼Œé“¾æ¥çš„å­˜åœ¨ä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥åŠ¨æ€å‘ç°å…¶æ‰€èƒ½æ‰§è¡Œçš„åŠ¨ä½œã€‚ é“¾æ¥çš„ä½œç”¨ è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„jsonè¿”å›åŒ…ï¼š 12345&#123; &quot;id&quot;: 1, &quot;name&quot;: &quot;Bilbo Baggins&quot;, &quot;role&quot;: &quot;burglar&quot;,&#125; è¿™æ˜¯ä¸€ä¸ªå¸¦Linksçš„jsonè¿”å›åŒ…ï¼š 12345678910111213&#123; &quot;id&quot;: 1, &quot;name&quot;: &quot;Bilbo Baggins&quot;, &quot;role&quot;: &quot;burglar&quot;, &quot;_links&quot;: &#123; &quot;self&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/employees/1&quot; &#125;, &quot;employees&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/employees&quot; &#125; &#125;&#125; è¿”å›çš„é“¾æ¥ â€œ_linksâ€éƒ¨åˆ†å°†å‘Šè¯‰å‰ç«¯ï¼Œç”¨æˆ·å½“å‰çš„æ“ä½œï¼ˆæˆ–æ˜¯æ‰€åœ¨çš„ä½ç½®ï¼‰å¯ä»¥è·³è½¬åˆ°å“ªäº›å¯èƒ½çš„åœ°å€ï¼Œå› æ­¤å‰ç«¯å¯ä»¥æ ¹æ®è¿™äº›é“¾æ¥ä¸ºç”¨æˆ·æä¾›æ›´æ–¹ä¾¿çš„æ“ä½œã€‚ è¿”å›å¸¦é“¾æ¥çš„æ•°æ®åŒ… æ³¨æ„ï¼Œä»¥ä¸‹ä»£ç å¯ä»¥ç®€åŒ–ï¼Œå†™è¿™äº›çš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½çš„ç†è§£é“¾æ¥ï¼Œå¦‚æœè¦é€Ÿæˆï¼Œè¯·è·³è½¬åˆ°ç®€åŒ–ç”Ÿæˆé“¾æ¥çš„æ­¥éª¤ä¸€èŠ‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªå‘å‰ç«¯è¿”å›å¸¦é“¾æ¥çš„æ•°æ®çš„ä¾‹å­ï¼š 12345678910@GetMapping(&quot;/employees/&#123;id&#125;&quot;)EntityModel&lt;Employee&gt; one(@PathVariable Long id) &#123; Employee employee = repository.findById(id).orElseThrow( () -&gt; new EmployeeNotFoundException(id)); return EntityModel.of(employee, linkTo(methodOn(EmployeeController.class).one(id)).withSelfRel(), linkTo(methodOn(EmployeeController.class).all()).withRel(&quot;employees&quot;));&#125; è¿™ä¸ªMappingå‡½æ•°å’Œä¹‹å‰çš„ç›¸æ¯”ï¼Œæœ‰ä¸‹é¢è¿™äº›ä¸åŒçš„åœ°æ–¹ï¼š è¿”å›å€¼ç±»å‹ç”±è‡ªå®šä¹‰çš„æ¨¡å‹ç±»Employeeå˜ä¸ºäº†EntityModel&lt;Employee&gt;ã€‚ æ³›å‹EntityModel&lt;T&gt;æ˜¯Spring HATEOASè®¾è®¡çš„ä¸€ç§å®¹å™¨ï¼Œå…¶ä¸­ä¸ä»…èƒ½å­˜å‚¨æ•°æ®ï¼Œè¿˜å¯ä»¥å­˜å‚¨ä¸€ç³»åˆ—é“¾æ¥ã€‚ å½“ä½ è¿”å›å€¼æ—¶ï¼Œä¸å†åªè¿”å›ä¸€ä¸ª Employee employeeçš„æ¨¡å‹å¯¹è±¡ï¼Œè€Œæ˜¯ä½¿ç”¨ 1EntityModel.of(employee,&#123;links&#125;) è¿”å›ä¸€ä¸ªEntityModelç±»å‹ï¼ˆåŒ…æ‹¬employeeå¯¹è±¡å’Œè‹¥å¹²ä¸ªé“¾æ¥ï¼‰ ä½¿ç”¨linkTo()æ–¹æ³•ç”Ÿæˆé“¾æ¥ï¼š å‚æ•°ä¼ å…¥ä¸€ä¸ªmethodOn()å‡½æ•°ï¼Œå‚æ•°ä¸ºä½ è¦é“¾æ¥çš„æ–¹æ³•æ‰€åœ¨çš„ç±»çš„åå°„ï¼Œä¸€èˆ¬ä¸ºæ§åˆ¶ç±»ï¼Œå³XXXXController.classï¼Œç„¶åç”¨.ç‚¹å‡ºè¦è¿æ¥åˆ°çš„ç±»çš„æ–¹æ³•ï¼Œå¦‚ï¼š linkTo(methodOn(EmployeeController.class).one(id)).withSelfRel() å³ä¼šåŠ å…¥EmployeeController&#123;&#125;.one(id)æ–¹æ³•æ‰€åœ¨Mappingçš„URLï¼Œå³ &quot;localhost:8080/employees/&#123;id&#125;&quot; å¯ä»¥ç†è§£ä¸ºè¿™æ˜¯ä¸€ç§åå‘Mappingï¼Œå³ä»è°ƒç”¨çš„æ–¹æ³•æŸ¥æ‰¾åˆ°å¯¹åº”çš„è·¯ç”± linkTo()è¿”å›ä¸€ä¸ªLinkå¯¹è±¡ï¼Œå¯ä»¥ç”¨å…¶.withSelfRel()å’Œ.withRel(Sting)æ¥ä¿®é¥°å…¶åœ¨è¿”å›åŒ…ä¸­çš„Relæ ‡ç­¾ Rel æ˜¯ relation çš„ç®€å†™ï¼Œç”¨æ¥è¯´æ˜é“¾æ¥è‡ªèº«å’Œé“¾æ¥ä¹‹é—´çš„å…³ç³» .withSelfRel()è¿”å›çš„é“¾æ¥çš„Relæ ‡ç­¾ä¸ºâ€œselfâ€ï¼š&#123;&#125;ï¼Œè¿™è¯´æ˜è¿”å›çš„æ˜¯è¯·æ±‚çš„é“¾æ¥æœ¬èº«ã€‚ä¸€èˆ¬æ¥è¯´å¸¦é“¾æ¥çš„è¿”å›åŒ…éƒ½è¦è¿”å›è‡ªå·±ï¼Œå…¶ç›®çš„å¤§æ¦‚å’Œç±»é‡Œé¢ä¸ºå•¥è¦æœ‰thisè¿™ä¸ªå¯¹è±¡ä¸€æ ·ã€‚ .withRel(Sting)è¿”å›çš„é“¾æ¥å¸¦æœ‰ä¸€ä¸ªç”¨Stringå‚æ•°ä¿®é¥°çš„æ ‡ç­¾ï¼Œå³â€œxxxxâ€ï¼š&#123;&#125;ï¼Œè¿™ä¸ªæ ‡ç­¾æœ‰åŠ©äºå‰ç«¯æ ¹æ®æ ‡ç­¾çš„åç§°æ‰€ä»¥é“¾æ¥ã€‚ Spring HATEOASçš„å„ç§å®¹å™¨ï¼ˆModelï¼‰ EntityModel&lt;&gt; ç”¨æ¥å®¹çº³å•ä¸ªæ¨¡å‹å¯¹è±¡åŠå…¶é“¾æ¥ CollectionModel&lt;&gt;ç”¨æ¥å®¹çº³å¤šä¸ªæ¨¡å‹å¯¹è±¡åŠå…¶é“¾æ¥ï¼Œä¸€ä¸ªCollectionå¯ä»¥åŒ…å«å¤šä¸ªEntityï¼Œå†™ä¸ºï¼šCollectionModel&lt;EntityModel&lt;T&gt;&gt; å°†å¤šä¸ªå®ä½“æ¨¡å‹æ‰“åŒ…æˆCollectionæ—¶ï¼Œæœ€å¥½å°†æ¯ä¸ªæ¨¡å‹å¯¹è±¡éƒ½åŒ…è£…å¥½é“¾æ¥ï¼Œå†ä¸ºæ•´ä½“çš„Collectionï¼ˆå¯ä»¥æ˜¯Listã€Mapæˆ–æ˜¯Dictä¹‹ç±»ï¼‰åŒ…è£…é“¾æ¥ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213141516@GetMapping(&quot;/employees&quot;)CollectionModel&lt;EntityModel&lt;Employee&gt;&gt; all() &#123;// è¿™ä¸€è¡Œå†™äº†å¾ˆå¤šä¸œè¥¿ï¼Œä½†ä¸»è¦çš„æ­¥éª¤æ˜¯ï¼š// findæ‰€æœ‰employeeçš„å¯¹è±¡ -&gt; è½¬æ¢ä¸ºjava8æµå¯¹è±¡ï¼ˆstreamï¼‰-&gt; ç”¨mapå‡½æ•°æŠŠæ¯ä¸ª// employeeçš„å¯¹è±¡æ¢ä¸ºEntityModelå¯¹è±¡ï¼Œæ‰“åŒ…é“¾æ¥ -&gt; å°†æ‰€æœ‰å•ä½“å¯¹è±¡ç”¨collectå‡½æ•°// é‡æ–°æ‰“åŒ…è¿›åˆ—è¡¨\tList&lt;EntityModel&lt;Employee&gt;&gt; employees = repository.findAll().stream() .map(employee -&gt; EntityModel.of(employee, linkTo(methodOn(EmployeeController.class).one(employee.getId())).withSelfRel(), linkTo(methodOn(EmployeeController.class).all()).withRel(&quot;employees&quot;))) .collect(Collectors.toList());//è¿”å›CollectionModelå¯¹è±¡ï¼Œæ‰“åŒ…æ•´ä½“çš„é“¾æ¥ return CollectionModel.of(employees, linkTo(methodOn(EmployeeController.class).all()).withSelfRel());&#125; â€‹\tè¯¥ä»£ç æœ€åè¿”å›çš„jsonåŒ…æ ¼å¼å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637&#123; &quot;_embedded&quot;: &#123; &quot;employeeList&quot;: [ &#123; &quot;id&quot;: 1, &quot;name&quot;: &quot;Bilbo Baggins&quot;, &quot;role&quot;: &quot;burglar&quot;, &quot;_links&quot;: &#123; &quot;self&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/employees/1&quot; &#125;, &quot;employees&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/employees&quot; &#125; &#125; &#125;, &#123; &quot;id&quot;: 2, &quot;name&quot;: &quot;Frodo Baggins&quot;, &quot;role&quot;: &quot;thief&quot;, &quot;_links&quot;: &#123; &quot;self&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/employees/2&quot; &#125;, &quot;employees&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/employees&quot; &#125; &#125; &#125; ] &#125;, &quot;_links&quot;: &#123; &quot;self&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/employees&quot; &#125; &#125;&#125; è¿™å°±æ˜¯ä¸€ä¸ªéå¸¸ç¬¦åˆRESTè§„èŒƒçš„èµ„æºåŒ…äº†ã€‚ PagedModel&lt;&gt;ä¹Ÿç”¨æ¥å®¹çº³å¤šä¸ªæ¨¡å‹å¯¹è±¡åŠå…¶é“¾æ¥ï¼Œå¹¶ä¸”æ”¯æŒåˆ†é¡µï¼Œç”ŸæˆPageModelå¿…é¡»ä½¿ç”¨Page&lt;&gt;ç±»å‹çš„æ³›å‹å¯¹è±¡ï¼Œåœ¨ç”ŸæˆPageModelæ—¶æä¾›ä¸€ä¸ªPageable çš„åˆ†é¡µå¯¹è±¡ï¼Œç”¨æ¥è®°å½•åˆ†é¡µä¿¡æ¯ï¼š 1234567891011// PageModel.of()çš„å‡½æ•°é‡è½½ç±»å‹ï¼š// ä¸ä¼ å…¥Linkå‚æ•°ï¼Œæ‰€æœ‰å¯¹è±¡è‡ªåŠ¨è¿”å›ç©ºLinkpublic static &lt;T&gt; PagedModel&lt;T&gt; model = PageModel.of (Collection&lt;T&gt; content, @Nullable PagedModel.PageMetadata metadata);// ä¼ å…¥ä¸€ç»„Linkå‚æ•°ï¼Œæ¯ä¸ªLinkä¸contentä¸€ä¸€å¯¹åº”public static &lt;T&gt; PagedModel&lt;T&gt; model = PageModel.of (Collection&lt;T&gt; content, @Nullable PagedModel.PageMetadata metadata, Link... links); // ä¼ å…¥ä¸€ä¸ªLinkè¿­ä»£å¯¹è±¡ï¼Œæ¯ä¸ªLinkä¸contentä¸€ä¸€å¯¹åº”public static &lt;T&gt; PagedModel&lt;T&gt; model = PageModel.of (Collection&lt;T&gt; content, @Nullable PagedModel.PageMetadata metadata, Iterable&lt;Link&gt;); å¸¦æœ‰åˆ†é¡µä¿¡æ¯çš„è¿”å›åŒ…æ ¼å¼å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°é™¤äº†CollectionModelçš„ä¿¡æ¯å¤–ï¼Œè¿˜å¦å¤–å¢åŠ ä¸€ä¸ªâ€Pageâ€œå­—æ®µï¼Œå­˜å‚¨åˆ†é¡µä¿¡æ¯ï¼š 123456789101112131415161718192021222324252627282930313233&#123; &quot;_embedded&quot;: &#123; &quot;userDtoList&quot;: [ &#123; &quot;email&quot;: &quot;admin@frogsoft.com&quot;, &quot;username&quot;: &quot;admin&quot;, &quot;roles&quot;: [ &quot;ROLE_USER&quot;, &quot;ROLE_ADMIN&quot; ], &quot;_links&quot;: &#123; &quot;self&quot;: &#123; &quot;href&quot;: &quot;http://127.0.0.1:8080/v1/users/admin&quot; &#125;, &quot;allUsers&quot;: &#123; &quot;href&quot;: &quot;http://127.0.0.1:8080/v1/users/?page=0&amp;size=10&quot; &#125; &#125; &#125; ] &#125;, &quot;_links&quot;: &#123; &quot;self&quot;: &#123; &quot;href&quot;: &quot;http://127.0.0.1:8080/v1/users?page=0&amp;size=10&quot; &#125; &#125;, &quot;page&quot;: &#123; &quot;size&quot;: 10, &quot;totalElements&quot;: 1, &quot;totalPages&quot;: 1, &quot;number&quot;: 0 &#125;&#125; å¯ä»¥ä½¿ç”¨Springæä¾›çš„PagedResourcesAssemblerç±»ï¼Œç®€åŒ–PagedModel&lt;&gt;çš„ç”Ÿæˆï¼Œ åœ¨é˜…è¯»ä»¥ä¸‹ä»£ç ä¹‹å‰ï¼Œå…ˆé˜…è¯»ä¸‹ä¸€èŠ‚å…³äºRepresentationModelAssembleræ¥å£çš„ä»‹ç»ã€‚ 12345678910111213141516// ä½¿ç”¨å•ä¸ªEntityModelçš„RepresentationModelAssembleræ¥å£ç”ŸæˆPageModelçš„å‡½æ•°ã€‚public PagedModel&lt;EntityModel&lt;T&gt;&gt; getPageModelT(Pageable pageable) &#123; // è·å–å®ä½“ç±»å‹Tå¯¹åº”çš„PagedResourcesAssemblerç±»å‹ private final PagedResourcesAssembler&lt;T&gt; pagedResourcesAssembler; // è·å–å®ä½“ç±»å‹Tçš„RepresentationModelAssemblerï¼ˆè‡ªè¡Œå®ç°ï¼‰ private final XXXXModelAssembler tModelAssembler; // å°†å¤šä¸ªå®ä½“ç±»å‹Tæ‰“åŒ…ä¸ºPage&lt;T&gt;ç±»å‹ï¼ˆå¯ä»¥ä½¿ç”¨å‰é¢æåˆ°çš„JpaRepositoryä¸­çš„findAllBy()å®ç°ï¼‰ Page&lt;T&gt; contents = /* find the contents and packed in Page*/ // è°ƒç”¨.toModelè¿”å›åˆ†é¡µæ¨¡å‹ï¼Œå‚æ•°åˆ†åˆ«ä¸ºæ‰“åŒ…çš„Page&lt;T&gt;ç±»å‹ å’Œ å•ä¸ªTç±»å‹å¯¹åº”çš„RepresentationModelAssemblerå¯¹è±¡ return pagedResourcesAssembler.toModel(contents, tModelAssembler); &#125; ç®€åŒ–ç”Ÿæˆé“¾æ¥çš„æ­¥éª¤ ä¸ºäº†å‡å°‘ä»£ç å¤ç”¨ï¼Œä¸è¦åœ¨æ¯æ¬¡åˆ›å»ºlinkæ—¶éƒ½é‡å¤å†™ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªå‡½æ•°ï¼Œå°†æ¨¡å‹å¯¹è±¡ï¼ˆæ¯”å¦‚ Employeeï¼‰è½¬æ¢ä¸ºå¯¹åº”çš„EntityModel&lt;T&gt;å¯¹è±¡ã€‚è¿™æ ·å½“æˆ‘ä»¬éœ€è¦åˆ›å»ºlinkæ—¶ï¼Œåªéœ€ç®€å•çš„è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ å¹¸è¿çš„æ˜¯ï¼ŒSpring HATEOASå¸®ä½ æä¾›äº†RepresentationModelAssembleræ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ï¼Œä½ å¯ä»¥å¿«é€Ÿåˆ›å»ºè½¬æ¢ç±»ï¼Œè€Œä¸ç”¨è‡ªå·±æ­å»ºæ¡†æ¶ã€‚ å®ç°RepresentationModelAssembleræ¥å£çš„æ–¹æ³•å¦‚ä¸‹ï¼š 123456789101112131415161718//EmployeeModelAssembler.javaimport static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.*;import org.springframework.hateoas.EntityModel;import org.springframework.hateoas.server.RepresentationModelAssembler;import org.springframework.stereotype.Component;@Componentclass EmployeeModelAssembler implements RepresentationModelAssembler&lt;Employee, EntityModel&lt;Employee&gt;&gt; &#123; @Override public EntityModel&lt;Employee&gt; toModel(Employee employee) &#123; return EntityModel.of(employee, linkTo(methodOn(EmployeeController.class).one(employee.getId())).withSelfRel(), linkTo(methodOn(EmployeeController.class).all()).withRel(&quot;employees&quot;)); &#125;&#125; ä¸ºä½ çš„æ¥å£å®ç°ç±»èµ·ä¸€ä¸ª XXXModelAssemblerçš„åå­—ï¼›åŠ å…¥Springçš„æ³¨å…¥æ³¨è§£@Componentï¼›å®ç°æ¥å£çš„æ³›å‹å‚æ•°&lt;Employee, EntityModel&lt;Employee&gt;&gt;è¡¨æ˜å…¶æ˜¯å°†æ¨¡å‹å¯¹è±¡XXXè½¬æ¢ä¸ºEntityModel&lt;XXX&gt; è¯¥æ¥å£åªéœ€è¦å®ç°ï¼ˆé‡è½½ï¼‰ä¸€ä¸ªtoModelå‡½æ•°ï¼Œå…¶å†…å®¹å’Œä¹‹å‰ç›´æ¥åœ¨æ§åˆ¶å™¨ç±»çš„å‡½æ•°ä¸­åˆ›å»ºé“¾æ¥çš„ä»£ç ä¸€æ¨¡ä¸€æ ·ã€‚ ä½¿ç”¨è¯¥æ¥å£å¯¹è±¡çš„æ–¹æ³•å’Œrepositoryæ¥å£å¯¹è±¡çš„æ–¹æ³•ç±»ä¼¼ï¼Œåªéœ€åœ¨æ§åˆ¶å™¨ä¸­å£°æ˜å…¶é™æ€å¼•ç”¨ï¼š 1private final EmployeeModelAssembler assembler; åˆ«å¿˜äº†åœ¨æœ‰å‚æ„é€ å‡½æ•°ä¸­ä¹Ÿä¸ºå…¶æ·»åŠ å‚æ•°ï¼Œç„¶ååªè¦åœ¨è¿”å›å‡½æ•°ä¸­è°ƒç”¨toModelå‡½æ•°å³å¯ï¼š 1234567@GetMapping(&quot;/employees/&#123;id&#125;&quot;)EntityModel&lt;Employee&gt; one(@PathVariable Long id) &#123; ... return assembler.toModel(employee);&#125; ä¹‹å‰æ‰“åŒ…Collectionçš„ä»£ç ä¹Ÿå¯ä»¥ç®€åŒ–ä¸ºï¼š 123456789@GetMapping(&quot;/employees&quot;)CollectionModel&lt;EntityModel&lt;Employee&gt;&gt; all() &#123; List&lt;EntityModel&lt;Employee&gt;&gt; employees = repository.findAll().stream() .map(assembler::toModel) .collect(Collectors.toList()); return CollectionModel.of(employees, linkTo(methodOn(EmployeeController.class).all()).withSelfRel());&#125; ä»£ç ç®€æ´äº†å¾ˆå¤šå‘¢ï¼ ä½¿ç”¨ResponseEntityè¿”å›æ•°æ® å¦ä¸€ä¸ªè®©ä½ çš„ä»£ç ç¬¦åˆRESTè§„èŒƒçš„è¦ç‚¹æ˜¯æ°¸è¿œè¿”å›åˆé€‚çš„Respone ä¹‹å‰è¿”å›çš„jsonåŒ…ä¸­çš„HTTPçŠ¶æ€ç éœ€è¦æˆ‘ä»¬è‡ªè¡Œå†™å…¥å’Œå¤„ç†ï¼ŒResponseEntityåˆ™å¸®æˆ‘ä»¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼ŒåŒæ—¶æ”¯æŒå¤šç§æ ¼å¼çš„è¿”å›åŒ…æ•°æ®ã€‚ æ›´æ–°ä¸Šé¢çš„POSTå‡½æ•°ï¼Œä»¥ä¾¿ä½¿ç”¨ResponseEntityç±»æ¥å¤„ç†è¿”å›å€¼ï¼š 123456789@PostMapping(&quot;/employees&quot;)ResponseEntity&lt;?&gt; newEmployee(@RequestBody Employee newEmployee) &#123; EntityModel&lt;Employee&gt; entityModel = assembler.toModel(repository.save(newEmployee)); return ResponseEntity // .created(entityModel.getRequiredLink(IanaLinkRelations.SELF).toUri()) // .body(entityModel);&#125; å’Œä¸ä½¿ç”¨ResponseEntityç›¸æ¯”ï¼Œè¿”å›å€¼ç±»å‹å˜ä¸ºResponseEntity&lt;EntityModel&lt;Employee&gt;&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦åœ¨EntityModelå¤–å±‚ï¼Œå†åŒ…è£…ä¸€å±‚ResponseEntityç±»å‹çš„æ³›å‹ã€‚åœ¨ä¸è‡³äºæ··æ·†çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ResponseEntity&lt;?&gt; è‡ªåŠ¨æ¨å¯¼ç±»å‹ã€‚ ä½¿ç”¨ResponseEntity.created()ä¼šè¿”å›HTTP 201 çŠ¶æ€ç ï¼Œè¡¨ç¤ºåˆ›å»ºEmployeeçš„æ“ä½œæˆåŠŸã€‚å½“è¿”å›è¿™ä¸ªå†…å®¹æ—¶ï¼Œå‰ç«¯é€šå¸¸å¸Œæœ›èƒ½åŒæ—¶è·å¾—è¯¥æ“ä½œæ‰€å¯¹åº”çš„URLåœ°å€ï¼ˆLocationï¼‰ï¼Œä»¥ä¾¿è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚ç”±äºæˆ‘ä»¬å·²ç»åœ¨è¿”å›åŒ…é‡Œæ‰“åŒ…äº†Linkï¼Œå› æ­¤æ·»åŠ å“åº”å¤´éå¸¸æ–¹ä¾¿ï¼Œä»£ç ä¸­.created()çš„å‚æ•°ï¼šentityModel.getRequiredLink(IanaLinkRelations.SELF).toUri()å³æ˜¯å°†Linkçš„Selféƒ¨åˆ†å†™å…¥è¿”å›åŒ…çš„å¤´éƒ¨ï¼Œæœ€åå¾—åˆ°çš„è¿”å›æ•°æ®å¦‚ä¸‹ï¼š 1234567891011121314151617181920&lt; Location: http://localhost:8080/employees/3&lt; Content-Type: application/hal+json;charset=UTF-8&lt; Transfer-Encoding: chunked&lt; Date: Fri, 10 Aug 2018 19:44:43 GMT&lt;&#123; &quot;id&quot;: 3, &quot;firstName&quot;: &quot;Samwise&quot;, &quot;lastName&quot;: &quot;Gamgee&quot;, &quot;role&quot;: &quot;gardener&quot;, &quot;name&quot;: &quot;Samwise Gamgee&quot;, &quot;_links&quot;: &#123; &quot;self&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/employees/3&quot; &#125;, &quot;employees&quot;: &#123; &quot;href&quot;: &quot;http://localhost:8080/employees&quot; &#125; &#125;&#125; ResponseEntity.created()åªè¿”å›ä¸€ä¸ªç‰¹å®šçš„çŠ¶æ€ï¼ˆ201ï¼‰ï¼Œ é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ResponseEntity.status()è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çŠ¶æ€ç çš„æ•°æ®åŒ…ï¼ŒçŠ¶æ€ç å¯ä»¥ç”¨HttpStatusæšä¸¾è¡¨ç¤ºã€‚ HTTPçŠ¶æ€ç  HttpStatusæšä¸¾ å«ä¹‰ 100 HttpStatus.CONTINUE ç»§ç»­ 102 HttpStatus.PROCESSING å¤„ç†ä¸­ 200 HttpStatus.OK æ­£å¸¸ 201 HttpStatus.CREATED å·²åˆ›å»º 202 HttpStatus.ACCEPTED å·²æ¥å— 204 HttpStatus.NO_CONTENT å·²æ— å†…å®¹ 302 HttpStatus.FOUND å·²æ‰¾åˆ° 400 HttpStatus.BAD_REQUEST è¯·æ±‚é”™è¯¯ 401 HttpStatus.UNAUTHORIZED æœªæˆæƒ 403 HttpStatus.FORBIDDEN ç¦æ­¢è®¿é—® 404 HttpStatus.NOT_FOUND æ— æ³•æ‰¾åˆ° 408 HttpStatus.REQUEST_TIMEOUT è¯·æ±‚è¶…æ—¶ 429 HttpStatus.TOO_MANY_REQUESTS è¯·æ±‚è¿‡å¤š 500 HttpStatus.INTERNAL_SERVER_ERROR å†…éƒ¨æœåŠ¡é”™è¯¯ 502 HttpStatus.BAD_GATEWAY ç½‘å…³é”™è¯¯ 503 HttpStatus.SERVICE_UNAVAILABLE æœåŠ¡ä¸å¯ç”¨ 504 HttpStatus.GATEWAY_TIMEOUT ç½‘å…³è¶…æ—¶ 1ResponseEntity.status(/* httpçŠ¶æ€ç  */HttpStatus.XXX).body(model); å…¶ä»–ä¸€äº›å¸¸ç”¨çš„çŠ¶æ€ï¼ŒResponseEntityä¹Ÿä¸ºæˆ‘ä»¬å°è£…å¥½äº†ä»¥ä¸‹å¸¸ç”¨å‡½æ•°ï¼š 123456// okï¼šè¿”å›çŠ¶æ€ç 200ResponseEntity.ok().body(model);// badRequestï¼šè¿”å›çŠ¶æ€ç 400ResponseEntity.badRequest().body(model);// notFoundï¼šè¿”å›çŠ¶æ€ç 404ResponseEntity.notFound().body(model); Controllerã€Serviceã€Repository ä¸‰å±‚ç»“æ„ ä¹‹å‰æˆ‘ä»¬æåˆ°ï¼ŒSpringç”¨æ¥æ³¨å†ŒBeançš„æ§åˆ¶æ¥å£@Componentæ ¹æ®åç§°ä¸åŒåˆåˆ†ä¸ºä¸‰ç§ï¼š @Controllerï¼šæ§åˆ¶å±‚ï¼Œæ ‡æ³¨è¿”å›å‰ç«¯çš„æ§åˆ¶ç»„ä»¶ @Serviceï¼šä¸šåŠ¡é€»è¾‘å±‚ï¼Œæ ‡æ³¨ä¸­é—´å±‚çš„æ§åˆ¶ç»„ä»¶ @Repositoryï¼šDAOå±‚ï¼Œæ ‡æ³¨æ•°æ®åº“è®¿é—®çš„ç»„ä»¶ ä¹‹æ‰€ä»¥è¿™ä¹ˆè®¾è®¡ï¼Œæ˜¯ç”±ç¼–å†™ä»£ç ä¸­åˆ†å±‚è§„èŒƒå†³å®šçš„ï¼Œé€šå¸¸Controllerå±‚æœ€æ¥è¿‘å‰ç«¯ï¼ŒRepository(DAO)å±‚æœ€æ¥è¿‘åç«¯ï¼ˆæ•°æ®åº“ï¼‰ï¼Œè¿™æ ·çš„ç»“æ„æœ€åˆ©äºä»£ç è§£è€¦åŒ–ï¼Œä¹Ÿåˆ©äºæ¯ä¸ªéƒ¨åˆ†çš„ä»£ç æ›´åŠ ç®€æ´ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥æ•´ç†é¡¹ç›®ä»¥é€‚åº”ä¸‰å±‚ç»“æ„ã€‚ @Controlleræ§åˆ¶å±‚ åœ¨é¡¹ç›®ç»“æ„ä¸­å»ºç«‹ä¸€ä¸ªControlleråŒ…ï¼Œç”¨æ¥å¤„ç†æ§åˆ¶å±‚ã€‚ æ§åˆ¶å±‚æ˜¯æœ€æ¥è¿‘å‰ç«¯çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥è¦é€‚åº”å¯èƒ½éšæ—¶æ”¹å˜çš„å‰ç«¯éœ€æ±‚ã€‚å› æ­¤æœ€å¥½åšå¥½ç‰ˆæœ¬æ§åˆ¶ï¼Œå¯ä»¥å°†ControlleråŒ…å‘½åä¸º/Controller.v&#123;ç‰ˆæœ¬å·&#125;ã€‚å½“éœ€è¦ä¿®æ”¹éœ€æ±‚æ—¶ï¼Œå¯ä»¥ä¿ç•™æ—§ç‰ˆæœ¬ï¼Œé‡æ–°å»ºç«‹æ–°ç‰ˆæœ¬çš„ControlleråŒ…ï¼Œä»¥å®ç°å‘åå…¼å®¹ã€‚ æ§åˆ¶å±‚è¦å®ç°çš„å†…å®¹ï¼š æ ¹æ®è®¾è®¡å¥½çš„APIï¼Œå»ºç«‹è‹¥å¹²æ§åˆ¶ç±»ï¼šXXXXControllerï¼Œæ”¾ç½®äº/Controller/apiåŒ…ä¸‹ã€‚ è‹¥APIéœ€è¦æ¥å—å‰ç«¯è¯·æ±‚çš„æ•°æ®æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å•ç‹¬ç”¨ä¸€ä¸ªæ•°æ®ç±»å­˜å‚¨ï¼Œå¯ä»¥å»ºç«‹å¯¹åº”çš„æ•°æ®ç±»XXXXRequestï¼Œæ”¾ç½®äº/Controller/requeståŒ…ä¸‹ã€‚ æ§åˆ¶ç±»ä¸­è¦åšçš„äº‹æƒ…ï¼š è·¯ç”±å¤„ç†ï¼šç”¨@RequestMappingç´¢å¼•ï¼ˆè¿™ä¸ªæ¨¡å—çš„ï¼‰æ ¹åœ°å€ï¼ˆå¯ä»¥å†™åœ¨classçš„å®šä¹‰å‰ï¼‰ï¼Œç„¶åç”¨@Get/Post/Put/DeleteMappingç´¢å¼•å­åœ°å€ æƒé™å¤„ç†ï¼šåˆ¤æ–­è®¿é—®è¯·æ±‚æ˜¯å¦å…·æœ‰ç‰¹æ®Šçš„æƒé™ï¼š tokené‰´æƒï¼šä»è¯·æ±‚ä¸­è·å–usernameï¼Œä¸æˆæƒç³»ç»Ÿä¸­çš„åˆ—è¡¨åŒ¹é… Rolesåˆ¤æ–­ï¼šå‡½æ•°å‰åŠ å…¥æ³¨è§£@RolesAllowed(&quot;èº«ä»½å&quot;)ï¼Œè‡ªåŠ¨æ‹’ç»æ²¡æœ‰å¯¹åº”èº«ä»½æƒé™çš„ç”¨æˆ·çš„è®¿é—®ï¼Œåˆ¤æ–­ç”¨æˆ·çš„èº«ä»½åœ¨ç™»é™†æ—¶ç”±é‰´æƒç³»ç»Ÿå®ç° å¤„ç†è¯·æ±‚æ•°æ®ï¼š è¯»è¯·æ±‚æ•°æ®ï¼šå‡½æ•°å‚æ•°ä¸­é…ç½®@RequestParamå’Œ@PathVariableï¼Œè·å¾—è¯·æ±‚æˆ–URLä¸­çš„æ•°æ® è¯»å†™æ•°æ®ï¼šè°ƒç”¨Serviceå±‚çš„æ¥å£å¯¹è±¡ æ³¨æ„ï¼Œå¯¹äºæ•°æ®çš„å…·ä½“å¤„ç†è¦åœ¨Serviceå±‚å®ç°ï¼ŒControllerå±‚åªç®€å•å¤„ç†å’Œä¼ è¾“å‚æ•°ï¼Œå¹¶è¯»å–ç»“æœï¼ˆEntityå¯¹è±¡ï¼‰ è¿”å›çŠ¶æ€ç ï¼Œç”¨ResponseEntity.status()å®ç° @ServiceæœåŠ¡å±‚ æœåŠ¡å±‚ï¼Œå³ä½œä¸ºä¸€ä¸ªæ‰¿ä¸Šå¯ä¸‹çš„ä¸­é—´éƒ¨åˆ†ï¼Œç”¨æ¥å¤„ç†æ•°æ®ã€æ‰“åŒ…æ•°æ®ã€‚ æœåŠ¡å±‚çš„åŸºæœ¬ç»“æ„ï¼š å»ºç«‹è‹¥å¹²æœåŠ¡æ¥å£ï¼Œåœ¨/serviceæ–‡ä»¶å¤¹ä¸‹ï¼Œå¦‚æœåŠŸèƒ½ç»†åˆ†éœ€è¦å¤šä¸ªåŠŸèƒ½æ¨¡å—ï¼Œä¹Ÿå¯ä»¥å»ºç«‹å­æ–‡ä»¶å¤¹ æœåŠ¡æ¥å£ï¼Œä»¥XXXXServiceå‘½åï¼Œæ¥å£çš„å®ç°ç±»ä»¥XXXXServiceImplå‘½åï¼Œä½¿ç”¨æ¥å£çš„ç›®çš„æ˜¯ä¸ºäº†å¤šä¸ªç±»è®¿é—®åŒä¸€ä¸ªæ•°æ®ä»“åº“æ—¶æ–¹ä¾¿é‡è½½å’Œå¤ç”¨ã€‚ æœåŠ¡å®ç°ç±»ä¸­è¦åšçš„äº‹æƒ…ï¼š è¯»å†™æ•°æ®ï¼šè°ƒç”¨Repositoryå±‚çš„æ¥å£å¯¹è±¡ï¼Œå¤„ç†æ•°æ® è¯»æ•°æ®ï¼šä½¿ç”¨findByç³»åˆ—æ–¹æ³•ï¼ˆåœ¨Repositoryå±‚å®šä¹‰ï¼‰ å†™æ•°æ®ï¼šä½¿ç”¨saveæ–¹æ³• æ‰“åŒ…æ•°æ®ï¼šå°†è¦è¿”å›çš„æ•°æ®é€šè¿‡RepresentationModelAssembleræ¥å£å¯¹è±¡ï¼ˆè¿™ä¹Ÿå±äºæŒä¹…å±‚ï¼‰æ‰“åŒ…ä¸ºEntityå¯¹è±¡ï¼Œè¿”å›ç»™æ§åˆ¶å±‚ @RepositoryæŒä¹…å±‚ æŒä¹…å±‚ï¼Œç”¨æ¥å’Œæ•°æ®åº“è¿›è¡Œç›´æ¥è¿æ¥ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨JPAæ¥å»ºç«‹æŒä¹…å±‚ï¼Œæ•°æ®åº“è¿æ¥å˜å¾—ååˆ†æ–¹ä¾¿ï¼Œä½†è¦æ»¡è¶³DTOæ•°æ®æ¨¡å‹çš„è¦æ±‚ï¼Œå› æ­¤æŒä¹…å±‚åˆ†ä¸ºRepositoryå’ŒDtoä¸¤ä¸ªå¹³è¡Œå±‚ æŒä¹…å±‚çš„åŸºæœ¬ç»“æ„ï¼š å»ºç«‹è‹¥å¹²ä»“åº“æ¥å£ï¼Œä»¥XXXXRepositoryå‘½åï¼Œæ¥å£è¦ç»§æ‰¿è‡ªJpaRepositoryï¼Œä»¥å®ç°æ•°æ®åº“è¿æ¥ï¼Œæ¥å£æ— éœ€å®ç°ï¼ˆSpringé‡‘ç‰ŒæœåŠ¡ï¼Œå¸®æ‚¨å®ç°ï¼ï¼‰ å»ºç«‹Dtoæ–‡ä»¶å¤¹ï¼Œå…¶åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š modelæ–‡ä»¶å¤¹ï¼šå»ºç«‹Dtoæ•°æ®ç±»ï¼ŒDtoæ•°æ®ç±»çš„å‘½ååœ¨åŸºæœ¬æ•°æ®å®ä½“ç±»ååŠ Dtoå³å¯ï¼ˆå¦‚UserDtoï¼‰ Dtoæ•°æ®ç±»çš„æˆå‘˜å˜é‡å†…å®¹å’ŒåŸºæœ¬æ•°æ®ç±»ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ— éœ€å†™ä¸æ•°æ®åº“è¿æ¥çš„æ³¨è§£ï¼Œæ•°æ®çš„è¿é€šç”±mapperç±»æå®š mapperæ–‡ä»¶å¤¹ï¼šå¯¹äºæ¯ä¸ªDtoç±»ï¼Œå»ºç«‹ä¸€ä¸ªMapperç±»ï¼Œä»¥XXXXMapperå‘½åã€‚ mapperç±»å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œå°†åŸºæœ¬æ•°æ®å®ä½“ç±»ï¼ˆå¦‚Userï¼‰è½¬åŒ–ä¸ºDtoæ•°æ®ç±»ï¼ˆå¦‚UserDtoï¼‰ mapperå‡½æ•°çš„å®ç°æ–¹æ³•ï¼šnewä¸€ä¸ªDtoå¯¹è±¡ï¼Œç„¶åå°†ä½¿ç”¨setterå‡½æ•°é…ç½®æ‰€æœ‰æˆå‘˜å³å¯ã€‚ä¹‹æ‰€ä»¥åœ¨mapperä¸­newå¯¹è±¡ï¼Œä¹Ÿæ˜¯å¤„äºæ–¹ä¾¿è§£è€¦å’Œç±»åµŒå¥—ä¹‹ç±»çš„ç›®çš„ assemleræ–‡ä»¶å¤¹ï¼Œå¯¹äºæ¯ä¸ªDtoç±»ï¼Œå»ºç«‹ä¸€ä¸ªAssemblerç±»ï¼Œä»¥XXXXModelAssemblerå‘½åã€‚è¯¥ç±»å®ç°RepresentationModelAssembleræ¥å£ã€‚ æ³¨æ„ï¼Œè¿™é‡Œå®ç°RepresentationModelAssembleræ¥å£æ—¶ï¼Œä¼ å…¥çš„å®ä½“å¯¹è±¡è¦æ˜¯å·²ç»æ‰“åŒ…å¥½çš„Dtoç±»å¯¹è±¡ï¼Œä¸ç„¶æˆ‘è´¹è¿™ä¹ˆå¤§åŠ²æ‰“åŒ…Dtoå¹²å•¥ï¼ˆæ„Ÿè§‰åœ¨è¯´åºŸè¯ï¼‰ Assemblerç±»å³ä¸»è¦å®ç°toModelå‡½æ•°ï¼Œå®ç°å°†Dtoæ•°æ®æ‰“åŒ…ä¸ºEntityå®ä½“å¯¹è±¡ï¼Œè¿™æ ·ï¼ŒæœåŠ¡å±‚åªéœ€è°ƒç”¨å¯¹åº”çš„æ¥å£å®ç°ç±»ï¼Œå³å¯ä»¥è·å¾—ç¬¦åˆRESTè§„èŒƒçš„è¿”å›æ•°æ®åŒ… å¯¹äºåŸºæœ¬æ•°æ®å®ä½“ç±»ï¼Œå»ºç«‹ä¸€ä¸ª\\Modelæ–‡ä»¶å¤¹å­˜å‚¨ï¼Œä½¿ç”¨@Entityå®ç°ç±»ä¸æ•°æ®åº“çš„ORMè¿æ¥ã€‚è¿™äº›å³ä¸ºæŒä¹…å±‚æ‰€éœ€å¤„ç†çš„éƒ¨åˆ†ã€‚","tags":["java","Spring"]},{"title":"å…³äº","path":"/about/index.html","content":"About ME å…³äºæˆ‘ï¼š AI Robotics LLMç›¸å…³æ–¹å‘ EHDåœ¨è¯» å†™è¿‡å°è¯´ ç¬¬äºŒåå®Œç¾ä¸»ä¹‰è€… ç‹¬ç«‹æ¸¸æˆçˆ±å¥½è€… æ··å‰ªçˆ±å¥½è€… ï¼ˆéå¸¸ä¸šä½™çš„ï¼‰é“é“è¿· å¥½å§ï¼Œå…¶å®æˆ‘åªæ˜¯å–œæ¬¢çº¿è·¯å›¾å’Œæ ‡å¿—è®¾è®¡ éŸ³æ¸¸äºº ä¸»æŒè¿‡ä¸¤æ¬¡COCè·‘å›¢ å·²ç»å‘è¡¨çš„è®ºæ–‡ â€¦â€¦ â€¦â€¦ â€¦â€¦ ä»€ä¹ˆï¼Ÿï¼å±…ç„¶ä¸€ç¯‡è®ºæ–‡ä¹Ÿæ²¡æœ‰ï¼Ÿï¼ï¼ å¤©å“ªæˆ‘æ€ä¹ˆè¿™ä¹ˆèœ ä¸€äº›ä¸ªäººä¸»é¡µ Githubï¼š#Nick-bit233 bilibiliï¼š@èµ›å› æ–¯æ²¡æœ‰å¦ Steamï¼š@Nick_bit åšè¿‡çš„ä¸€äº›æœ‰æ„æ€çš„ä¸œè¥¿ Link-Up Heroä¸€ä¸ªåŸºäºè¿è¿çœ‹+DBG Rougelikeçš„Demoæ¸¸æˆDreaming Butterflyã€Šå¦‚æ¢¦ä¹‹æ¢¦ã€‹æ°´å½©æ¼«ç”»2/3Dè§†è§‰è§£è°œæ¸¸æˆï¼Œ2021ç½‘æ˜“é›·ç«MiniGameå¤ä»¤è¥ ç¬¬ä¸€åPuzzle mazeä¸€ä¸ªç‹¬ç«‹æ¸¸æˆã€ŠVVVVVVã€‹çš„è‡ªåˆ¶å…³å¡ éŸ³æ¸¸æˆç»© æˆ‘æ­£åœ¨ç ”ç©¶å¦‚ä½•å®æ—¶çš„æ›´æ–°è¿™ä¸ªä¸œè¥¿ï¼Œå¦‚æœä½ æœ‰å»ºè®®ï¼Œæ¬¢è¿å†™åœ¨è¯„è®ºåŒº~ Game Ranking Last Update Date Arcaea 11.78 23/12/04 Lanota 15.80 23/12/04 Chunithmï¼ˆCNï¼‰ 14.68 23/12/01 maimaiDXï¼ˆCNï¼‰ 11746 23/12/01 Phigros 14.61 23/12/04 osu! Standard 803pp 22/08 æœ‰ç”¨çš„ç½‘ç«™æ”¶è—å¤¹ å®ç”¨å·¥å…· Complier Exploreråœ¨çº¿ç¼–è¯‘å™¨Vocal RemoverAIäººå£°éŸ³è½¨åˆ†ç¦»å›¾ç‰‡èƒŒæ™¯æ¶ˆé™¤åœ¨çº¿æŠ å›¾ï¼Œå»é™¤èƒŒæ™¯Bç«™å°é¢æå–æŠ“å–Bç«™è§†é¢‘çš„å°é¢Wolfram Alphaæ•°å­¦æ±‚è§£å™¨å’Œç§‘å­¦é—®é¢˜æœç´¢Latex Liveåœ¨çº¿Latexç¼–è¾‘å’Œå›¾åƒç”Ÿæˆå™¨Tiki-Tokiæ—¶é—´è½´å±•ç¤ºç”Ÿæˆ å¯»æ‰¾èµ„æº Pexelså…è´¹æ‘„å½±å›¾ç‰‡ç´ æPanzoidå…è´¹çš„ç‰‡å¤´å±•ç¤ºè§†é¢‘æ¨¡æ¿å’Œç”Ÿæˆå™¨æ¸…åTunaé•œåƒç«™å¼€æºè½¯ä»¶é•œåƒAudio Libraryå…è´¹æ— ç‰ˆæƒéŸ³ä¹Story Blockså…è´¹éŸ³æ•ˆä¸‹è½½ ä¸æ­£ç»çš„éƒ¨åˆ† 616.sbçº¯å‡€çš„éŸ³æ¸¸ä¸‹è½½ç«™BEMANICNBEMANICN è®ºå›BestdoriBanG Dream! èµ„æºåº“å’Œç¤¾åŒº"},{"title":"å‹é“¾","path":"/friends/index.html","content":"See also my friends! Geeks RiddNOAM CHI Artists Waldo Yang"},{"title":"ç¬”è®°åˆ†ç±»é¡µ","path":"/notes/index.html","content":"æ­£åœ¨æ–½å·¥ä¸­â€¦"}]